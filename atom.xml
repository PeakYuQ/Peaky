<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>NoteBook</title>
  
  <subtitle>Always believe that something wonderful is about to hanppen!</subtitle>
  <link href="http://peaky2022.gitee.io/peaky/atom.xml" rel="self"/>
  
  <link href="http://peaky2022.gitee.io/peaky/"/>
  <updated>2022-09-13T14:38:45.813Z</updated>
  <id>http://peaky2022.gitee.io/peaky/</id>
  
  <author>
    <name>Peaky</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>API7</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/09/20/f7569fb7.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/09/20/f7569fb7.html</id>
    <published>2022-09-20T09:50:11.000Z</published>
    <updated>2022-09-13T14:38:45.813Z</updated>
    
    <content type="html"><![CDATA[<div class="post">    <div class="post-content" id="peak">    </div>    </div><script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script><script>        //获取元素开始插入        var main = document.getElementById('peak');        var p = document.createElement("p");        var a = document.createElement("a");        var img = document.createElement("img");        //a.setAttribute("href", data_link[i]);        a.setAttribute("class", "fancybox");        a.setAttribute("rel", "gallery");        img.src='http://api.sangbo520.cn/API/sese/st.php';        a.appendChild(img);        p.appendChild(a);        main.appendChild(p);  </script>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;post&quot;&gt;
    &lt;div class=&quot;post-content&quot; id=&quot;peak&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;


&lt;script src=&quot;https://cdn.staticfile.org/jquery/1.10.2/jq</summary>
      
    
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/categories/HTML/"/>
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>API6</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/09/20/8051af21.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/09/20/8051af21.html</id>
    <published>2022-09-20T08:50:11.000Z</published>
    <updated>2022-09-13T14:38:45.813Z</updated>
    
    <content type="html"><![CDATA[<div class="post">    <div class="post-content" id="peak">    </div>    </div><script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script><script>        //获取元素开始插入        var main = document.getElementById('peak');        var p = document.createElement("p");        var a = document.createElement("a");        var img = document.createElement("img");        //a.setAttribute("href", data_link[i]);        a.setAttribute("class", "fancybox");        a.setAttribute("rel", "gallery");        img.src='http://tfkapi.top/API/setu_pic.php';        a.appendChild(img);        p.appendChild(a);        main.appendChild(p);  </script>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;post&quot;&gt;
    &lt;div class=&quot;post-content&quot; id=&quot;peak&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;


&lt;script src=&quot;https://cdn.staticfile.org/jquery/1.10.2/jq</summary>
      
    
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/categories/HTML/"/>
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>API5</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/09/20/1958fe9b.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/09/20/1958fe9b.html</id>
    <published>2022-09-20T07:50:11.000Z</published>
    <updated>2022-09-13T14:38:45.812Z</updated>
    
    <content type="html"><![CDATA[<div class="post">    <div class="post-content" id="peak">    </div>    </div><script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script><script>        //获取元素开始插入        var main = document.getElementById('peak');        var p = document.createElement("p");        var a = document.createElement("a");        var img = document.createElement("img");        //a.setAttribute("href", data_link[i]);        a.setAttribute("class", "fancybox");        a.setAttribute("rel", "gallery");        img.src='http://tfkapi.top/API/nypic.php';        a.appendChild(img);        p.appendChild(a);        main.appendChild(p);        </script>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;post&quot;&gt;
    &lt;div class=&quot;post-content&quot; id=&quot;peak&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;


&lt;script src=&quot;https://cdn.staticfile.org/jquery/1.10.2/jq</summary>
      
    
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/categories/HTML/"/>
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>API4</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/09/20/6e5fce0d.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/09/20/6e5fce0d.html</id>
    <published>2022-09-20T06:50:11.000Z</published>
    <updated>2022-09-13T14:38:45.812Z</updated>
    
    <content type="html"><![CDATA[<div class="post">    <div class="post-content" id="peak">    </div>    </div><script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script><script>    $.ajax({      url: "https://ovooa.com/API/meinv/api.php",      type: "GET",      contextType: "application/json",      success: function (res) {        //获取返回数据        var json = res;        var data_link = json.data.image;        //获取元素开始插入        var main = document.getElementById('peak');        var p = document.createElement("p");        var a = document.createElement("a");        var img = document.createElement("img");        //a.setAttribute("href", data_link[i]);        a.setAttribute("class", "fancybox");        a.setAttribute("rel", "gallery");        img.src=data_link;        a.appendChild(img);        p.appendChild(a);        main.appendChild(p);      },      error: function (err) {        alert("API is expire！")      }    });  </script>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;post&quot;&gt;
    &lt;div class=&quot;post-content&quot; id=&quot;peak&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;


&lt;script src=&quot;https://cdn.staticfile.org/jquery/1.10.2/jq</summary>
      
    
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/categories/HTML/"/>
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>API3</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/09/20/f03b5bae.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/09/20/f03b5bae.html</id>
    <published>2022-09-20T05:50:11.000Z</published>
    <updated>2022-09-13T14:38:45.811Z</updated>
    
    <content type="html"><![CDATA[<div class="post">    <div class="post-content" id="peak">    </div>    </div><script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script><script>    $.ajax({      url: "https://ovooa.com/API/Pximg/",      type: "GET",      contextType: "application/json",      success: function (res) {        //获取返回数据        var json = res;        var data_link = json.data.urls.original;        //获取元素开始插入        var main = document.getElementById('peak');        var p = document.createElement("p");        var a = document.createElement("a");        var img = document.createElement("img");        //a.setAttribute("href", data_link[i]);        a.setAttribute("class", "fancybox");        a.setAttribute("rel", "gallery");        img.src=data_link;        a.appendChild(img);        p.appendChild(a);        main.appendChild(p);      },      error: function (err) {        alert("API is expire！")      }    });  </script>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;post&quot;&gt;
    &lt;div class=&quot;post-content&quot; id=&quot;peak&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;


&lt;script src=&quot;https://cdn.staticfile.org/jquery/1.10.2/jq</summary>
      
    
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/categories/HTML/"/>
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>API1</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/09/20/1e353a82.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/09/20/1e353a82.html</id>
    <published>2022-09-20T04:53:11.000Z</published>
    <updated>2022-09-13T14:38:45.809Z</updated>
    
    <content type="html"><![CDATA[<div class="post">    <div class="post-content" id="peak">    </div>    </div><script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script><script>    $.ajax({      url: "http://ovooa.com/API/cosplay/api.php",      type: "GET",      contextType: "application/json",      success: function (res) {        //获取返回数据        var json = res;        var title = json.data.Title;        var data_link = json.data.data;        //获取元素开始插入        var main = document.getElementById('peak');        //插入标题        //添加 div        var h1 = document.createElement("h1");        h1.setAttribute("class", "post-title");        h1.innerHTML = title;        main.appendChild(h1);        for (var i = data_link.length - 1; i >= 0; i--) {            var p = document.createElement("p");            var a = document.createElement("a");            var img = document.createElement("img");            //a.setAttribute("href", data_link[i]);            a.setAttribute("class", "fancybox");            a.setAttribute("rel", "gallery");            img.src=data_link[i];            a.appendChild(img);            p.appendChild(a);            main.appendChild(p);        }          },      error: function (err) {        alert("API is expire！")      }    });  </script>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;post&quot;&gt;
    &lt;div class=&quot;post-content&quot; id=&quot;peak&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;







&lt;script src=&quot;https://cdn.staticfile.org/jquery/1.10</summary>
      
    
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/categories/HTML/"/>
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>API2</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/09/20/873c6b38.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/09/20/873c6b38.html</id>
    <published>2022-09-20T04:50:11.000Z</published>
    <updated>2022-09-13T14:38:45.811Z</updated>
    
    <content type="html"><![CDATA[<div class="post">    <div class="post-content" id="peak">    </div>    </div><script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script><script>    $.ajax({      url: "https://ovooa.com/API/meizi/api.php",      type: "GET",      contextType: "application/json",      success: function (res) {        //获取返回数据        var json = res;        var data_link = json.text;        //获取元素开始插入        var main = document.getElementById('peak');        var p = document.createElement("p");        var a = document.createElement("a");        var img = document.createElement("img");        //a.setAttribute("href", data_link[i]);        a.setAttribute("class", "fancybox");        a.setAttribute("rel", "gallery");        img.src=data_link;        a.appendChild(img);        p.appendChild(a);        main.appendChild(p);      },      error: function (err) {        alert("API is expire！")      }    });  </script>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;post&quot;&gt;
    &lt;div class=&quot;post-content&quot; id=&quot;peak&quot;&gt;
    &lt;/div&gt;
    &lt;/div&gt;


&lt;script src=&quot;https://cdn.staticfile.org/jquery/1.10.2/jq</summary>
      
    
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/categories/HTML/"/>
    
    
    <category term="HTML" scheme="http://peaky2022.gitee.io/peaky/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>日迹</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/04/09/1e5d734c.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/04/09/1e5d734c.html</id>
    <published>2022-04-08T16:53:11.000Z</published>
    <updated>2022-04-09T15:13:41.180Z</updated>
    
    <content type="html"><![CDATA[<h3 id="日迹"><a href="#日迹" class="headerlink" title="日迹"></a>日迹</h3><h4 id="简单记录一些日常或者什么或者其他或者或者"><a href="#简单记录一些日常或者什么或者其他或者或者" class="headerlink" title="简单记录一些日常或者什么或者其他或者或者"></a>简单记录一些日常或者什么或者其他或者或者</h4><span id="more"></span><h4 id="2022年4月10日"><a href="#2022年4月10日" class="headerlink" title="2022年4月10日"></a>2022年4月10日</h4><h4 id="2022年4月9日"><a href="#2022年4月9日" class="headerlink" title="2022年4月9日"></a>2022年4月9日</h4><blockquote><p>dailyCheckIn 脚本 <a href="https://sitoi.github.io/dailycheckin/">脚本</a></p></blockquote><blockquote><p>JSON文件格式化 <a href="https://www.json.cn/">JSON文件格式化</a> </p></blockquote><blockquote><p>酷安神评论：<a href="https://www.coolapk.com/dyh/1527">酷安神评论</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;日迹&quot;&gt;&lt;a href=&quot;#日迹&quot; class=&quot;headerlink&quot; title=&quot;日迹&quot;&gt;&lt;/a&gt;日迹&lt;/h3&gt;&lt;h4 id=&quot;简单记录一些日常或者什么或者其他或者或者&quot;&gt;&lt;a href=&quot;#简单记录一些日常或者什么或者其他或者或者&quot; class=&quot;headerlink&quot; title=&quot;简单记录一些日常或者什么或者其他或者或者&quot;&gt;&lt;/a&gt;简单记录一些日常或者什么或者其他或者或者&lt;/h4&gt;</summary>
    
    
    
    <category term="日迹" scheme="http://peaky2022.gitee.io/peaky/categories/%E6%97%A5%E8%BF%B9/"/>
    
    
    <category term="日迹" scheme="http://peaky2022.gitee.io/peaky/tags/%E6%97%A5%E8%BF%B9/"/>
    
  </entry>
  
  <entry>
    <title>EC Abstract</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/03/28/d285d8df.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/03/28/d285d8df.html</id>
    <published>2022-03-28T06:51:32.000Z</published>
    <updated>2022-03-28T03:05:02.555Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>This is EC abstract</p></blockquote><span id="more"></span><p>摘要</p><h4 id="A-New-Task-Scheduling-Scheme-Based-on-Genetic-Algorithm-for-Edge-Computing："><a href="#A-New-Task-Scheduling-Scheme-Based-on-Genetic-Algorithm-for-Edge-Computing：" class="headerlink" title="A New Task Scheduling Scheme Based on Genetic Algorithm for Edge Computing："></a>A New Task Scheduling Scheme Based on Genetic Algorithm for Edge Computing：</h4><p>随着智能电网和全球能源互联技术的不断发展，智能终端数量已连接到电网，可用于提供资源服务作为边缘节点。传统的云计算可以用来在电网中提供存储服务和任务计算服务，但是它面临着资源瓶颈，时滞和有限的网络带宽资源等挑战。边缘计算是云计算的有效补充，因为它可以为用户提供具有较低延迟的本地计算服务。但是，由于单边缘节点中的资源有限，资源密集型任务需要分为多个子任务，然后通过资源协作分配给不同的边缘节点。使任务调度更有效是一个重要问题。本文基于边缘计算的概念，提出了一种双层资源管理方案。另外，基于遗传算法，提出了一种名为GA-EC（边缘计算遗传算法）的新任务调度算法，该算法可以根据不同的调度目标动态调度任务。仿真结果表明，该算法对能耗和负载平衡有一定的影响，减少了时延</p><h4 id="Task-Scheduling-in-Deadline-Aware-Mobile-Edge-Computing-Systems"><a href="#Task-Scheduling-in-Deadline-Aware-Mobile-Edge-Computing-Systems" class="headerlink" title="Task Scheduling in Deadline-Aware Mobile Edge Computing Systems"></a>Task Scheduling in Deadline-Aware Mobile Edge Computing Systems</h4><p>移动边缘计算（MEC）是一种新的计算方法，其中移动设备（MD）携带的计算任务可以卸载到MEC服务器或本地计算。由于MDs始终受到电池限制，计算任务有严格的最后期限，因此如何有效地安排每个任务的执行非常重要。与现有工作相比，我们考虑了一个复杂得多的场景，其中多个移动MDs共享多个异构MEC服务器，并且在截止日期感知MEC系统中提出了一个名为最小能耗问题的问题。这种问题被证明是NP难的，并且分别针对单个和多个MD场景提出了两种近似算法。这些算法的性能因理论分析和仿真而异。</p><h4 id="Deep-Reinforcement-Learning-Based-Task-Scheduling-in-Edge-Computing-Networks"><a href="#Deep-Reinforcement-Learning-Based-Task-Scheduling-in-Edge-Computing-Networks" class="headerlink" title="Deep Reinforcement Learning Based Task Scheduling in Edge Computing Networks"></a>Deep Reinforcement Learning Based Task Scheduling in Edge Computing Networks</h4><p>随着5G移动网络服务的快速发展，海量数据在网络边缘爆炸式增长。云计算服务的延迟时间长，带宽要求大。边缘计算已成为减少5G移动网络服务延迟和流量负载的关键技术。然而，如何在边缘计算环境中智能地安排任务仍然是一项关键挑战。在本文中，我们定义了云边缘网络体系结构中最小化任务调度延迟的优化问题。这个问题被证明是NP难的，并按照马尔可夫决策过程建模。我们设计了一种基于异步优势演员批评（CECSA3C）的云边协作调度算法。仿真结果表明，与现有的DQN和RL-G算法相比，该算法收敛速度快，任务处理时间平均缩短28.3%和46.1%，同时保持了性能的可扩展性。</p><h4 id="Profit-Maximized-Collaborative-Computation-Offloading-and-Resource-Allocation-in-Distributed-Cloud-and-Edge-Computing-Systems"><a href="#Profit-Maximized-Collaborative-Computation-Offloading-and-Resource-Allocation-in-Distributed-Cloud-and-Edge-Computing-Systems" class="headerlink" title="Profit-Maximized Collaborative Computation Offloading and Resource Allocation in Distributed Cloud and Edge Computing Systems"></a>Profit-Maximized Collaborative Computation Offloading and Resource Allocation in Distributed Cloud and Edge Computing Systems</h4><p>边缘计算是一种新架构，可提供用于实现物联网的计算，存储和网络资源。它将计算带到用户附近的网络边缘。但是，边缘节点的能源和资源有限。在边缘完全运行任务可能会导致性能不佳。云数据中心（CDC）拥有丰富的执行任务资源，但它们位于远离用户的地方。疾病预防控制中心导致长时间的传输延迟和利用资源的巨大财务成本。因此，在CDC层和边缘计算层之间智能卸载用户的任务至关重要。这项工作提出了一个云边缘计算系统，它有一个终端层，边缘计算层和CDC层。在此基础上，设计了一种利润最大化的协作计算卸载和资源分配算法，以最大限度地提高系统的利润，保证严格满足任务的响应时间限制。在每个时隙中，这项工作共同考虑CPU，内存和带宽资源，边缘层中所有异构节点的负载平衡，最大能量，最大服务器数量以及CDC层中的任务队列稳定性。考虑到上述因素，通过提出的基于模拟退火的候鸟优化程序来制定和解决单目标约束优化问题，以获得接近最优的解决方案。所提出的方法实现了CDC与边缘计算卸载的联合优化，以及CDC中的资源分配。现实的基于数据的仿真结果表明，它实现了比同龄人更高的利润。</p><h4 id="Dynamic-Request-Scheduling-Optimization-in-Mobile-Edge-Computing-for-IoT-Applications"><a href="#Dynamic-Request-Scheduling-Optimization-in-Mobile-Edge-Computing-for-IoT-Applications" class="headerlink" title="Dynamic Request Scheduling Optimization in Mobile Edge Computing for IoT Applications"></a>Dynamic Request Scheduling Optimization in Mobile Edge Computing for IoT Applications</h4><p>在5G时代，随着对物联网（IoT）的计算和海量数据流量的需求不断增加，移动边缘计算（MEC）和超密集网络（UDN）被认为是两种有前途的技术，其中导致在所谓的超密集边缘计算（UDEC）中。任务卸载作为一种有效的解决方案，为UDEC网络中的移动用户提供了低延迟和灵活的计算。然而，边缘云的有限计算资源和移动用户的动态需求使得将计算请求安排到适当的边缘云具有挑战性。为此，我们首先为移动用户制定传输功率分配（PA）问题，以最大限度地降低能耗。使用准凸技术，我们解决了PA问题，并提出了一个基于子梯度（NCGG）的非合作博弈模型。然后，我们将联合请求卸载和资源调度（JRORS）问题建模为一个混合集成非线性程序，以尽量减少请求的响应延迟。JRORS问题可以分为两个问题，即请求卸载（RO）问题和计算资源调度（RS）问题。因此，我们将JRORS问题分析为双重决策问题，并提出了一种基于i-NSGA-II的多目标优化算法，称为MO-NSGA。仿真结果表明，NCGG可以节省传输能耗，具有良好的收敛性，MO-NSGA在响应速率方面优于现有方法，并且可以在动态UDEC网络中保持良好的性能。</p><h4 id="Deep-Reinforcement-Learning-Based-Offloading-Scheduling-for-Vehicular-Edge-Computing"><a href="#Deep-Reinforcement-Learning-Based-Offloading-Scheduling-for-Vehicular-Edge-Computing" class="headerlink" title="Deep-Reinforcement-Learning-Based Offloading Scheduling for Vehicular Edge Computing"></a>Deep-Reinforcement-Learning-Based Offloading Scheduling for Vehicular Edge Computing</h4><p>车辆边缘计算（VEC）是一种新的计算范例，具有很大的潜力来增强车辆终端（VT）在低延迟和高能量效率的车辆应用中支持资源匮乏的能力。在本文中，我们研究了典型VEC场景中的一个重要的计算卸载调度问题，其中沿着快速行驶的VT打算安排其排队等待的任务，以便在任务延迟和能源消耗。由于不同的任务特征，动态无线环境以及由车辆移动引起的频繁切换事件，最佳解决方案应该考虑在哪里安排（即本地计算或卸载）以及何时安排（即执行的顺序和时间）每个任务。为了解决这样一个复杂的随机优化问题，我们通过精心设计的马尔可夫决策过程（MDP）对其进行建模，并求助于深度强化学习（DRL）来处理巨大的状态空间。我们的DRL实现是基于最先进的近端策略优化（PPO）算法设计的。利用参数共享网络体系结构结合卷积神经网络（CNN）来逼近策略函数和值函数，可以有效地提取代表性特征。对状态和奖励表示进行了一系列调整，以进一步提高培训效率。广泛的仿真实验和与六种已知基线算法及其启发式组合的综合比较清楚地证明了所提出的基于DRL的卸载调度方法的优点。</p><h4 id="Evaluation-of-T-ask-Scheduling-Algorithms-in-Heterogeneous-Computing-Environments"><a href="#Evaluation-of-T-ask-Scheduling-Algorithms-in-Heterogeneous-Computing-Environments" class="headerlink" title="Evaluation of T ask Scheduling Algorithms in Heterogeneous Computing Environments"></a>Evaluation of T ask Scheduling Algorithms in Heterogeneous Computing Environments</h4><p>这项工作建立了一套方法来评估异构计算环境中任何任务调度策略的性能。我们正式提出了混合边缘云计算生态系统的调度模型，并在大工作量上进行基于仿真的实验。除了传统的云数据中心之外，我们还考虑边缘数据中心，包括智能手机和Raspberry Pi edge设备，这些设备都是电池供电的。定义计算资源的现实能力。一旦找到时间表，资源容量就可以或不能满足各种任务需求。我们构建了一个调度和评估框架，并测量了典型的调度指标，如平均等待时间，平均周转时间，makespan，循环吞吐量，最短作业时间，最小最小和最大最小调度方案。我们的分析和结果表明，与仅云介质相比，最先进的独立任务调度算法在异构边缘云介质中的数据中心的重大任务故障和非最佳资源利用方面遭受性能下降。特别是，对于大量任务，由于电池容量低或内存有限，每个调度方案无法执行超过25%的任务。</p><h4 id="Deep-Reinforcement-Learning-for-Collaborative-Edge-Computing-in-V-ehicular-Networks"><a href="#Deep-Reinforcement-Learning-for-Collaborative-Edge-Computing-in-V-ehicular-Networks" class="headerlink" title="Deep Reinforcement Learning for Collaborative Edge Computing in V ehicular Networks"></a>Deep Reinforcement Learning for Collaborative Edge Computing in V ehicular Networks</h4><p>移动边缘计算（MEC）是支持任务关键车辆应用（如智能路径规划和安全应用）的有前途的技术。本文开发了一种协作边缘计算框架，以减少计算服务延迟，提高车辆网络的服务可靠性。首先，提出一种任务分区和调度算法（TPSA）来决定工作量分配，并在给定计算卸载策略的情况下，将卸载到边缘服务器的任务的执行顺序安排给边缘服务器。其次，开发了一种基于人工智能（AI）的协作计算方法来确定车辆的任务卸载，计算和结果传递策略。具体而言，卸载和计算问题被表述为马尔可夫决策过程。采用深度强化学习技术，即深度确定性策略梯度，在复杂的城市交通网络中寻找最优解决方案。通过我们的方法，可以通过协作计算中的最佳工作负载分配和服务器选择来最小化包括计算服务延迟和服务故障罚分的服务成本。仿真结果表明，所提出的基于AI的协作计算方法可以适应具有出色性能的高动态环境。</p><h4 id="Assignment-of-IoT-Nodes-to-Edge-Computing-Devices-in-Internet-of-Things"><a href="#Assignment-of-IoT-Nodes-to-Edge-Computing-Devices-in-Internet-of-Things" class="headerlink" title="Assignment of IoT Nodes to Edge Computing Devices in Internet of Things"></a>Assignment of IoT Nodes to Edge Computing Devices in Internet of Things</h4><p>物联网（IoT）是一种描述将物理对象连接到互联网的想法的计算概念。一般来说，物联网是一个设备网络-每个对象都通过互联网或一些非互联网导向的连接（如蓝牙，ZigBee等）连接。它具有互联网连接的IP地址，并且这些对象之间发生通信和其他互联网启用的设备和系统。物联网通常用于监控实时环境，从而生成大量数据。由于其成本和容量优势，云是一种具有吸引力的物联网数据存储选项。但对于时间关键的应用程序，这可能是一个挑战。边缘计算是解决这个问题的方法。边缘计算是指在网络边缘计算靠近其创建位置的数据，而不是远离中心点的数据。然后将计算和处理的数据发送到云。为了实现这一点，物联网节点必须连接到边缘计算设备。然而，识别每个物联网节点应该连接的边缘计算设备（ECD）是一项挑战。这项工作描述了一种基于动态阈值将物联网节点分配给ECD的方法，并且应用元启发式来安排任务以使完成时间最短。基于仿真的结果显示了所提出工作的优点。</p><h4 id="Task-Scheduling-for-Edge-Computing-with-Agile-VNFs-On-Demand-Service-Model-toward-5G-and-Beyond"><a href="#Task-Scheduling-for-Edge-Computing-with-Agile-VNFs-On-Demand-Service-Model-toward-5G-and-Beyond" class="headerlink" title="Task Scheduling for Edge Computing with Agile VNFs On-Demand Service Model toward 5G and Beyond"></a>Task Scheduling for Edge Computing with Agile VNFs On-Demand Service Model toward 5G and Beyond</h4><p>随着互联网的快速发展，满足服务请求，有效分配计算资源和按需服务应用的需求不断增加。边缘计算用于满足低延迟，网络连接和本地数据处理要求，并减轻云中的工作量。本文提出了一种基于网关的边缘计算服务模型，以减少数据传输的延迟和往返云的网络带宽。通过轻量级虚拟化技术Docker调整边缘网关的任务计划，可以实现按需计算资源分配。边缘网关还可以处理本地网络中的服务请求。所提出的边缘计算服务模型不仅消除了传统云服务模型的计算负担，而且提高了边缘计算节点的运行效率。该模型还可用于5G及以上云边缘计算环境中的各种创新应用。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;This is EC abstract&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Study" scheme="http://peaky2022.gitee.io/peaky/categories/Study/"/>
    
    
    <category term="Study" scheme="http://peaky2022.gitee.io/peaky/tags/Study/"/>
    
  </entry>
  
  <entry>
    <title>论文格式</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/03/20/9f2153c9.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/03/20/9f2153c9.html</id>
    <published>2022-03-20T14:53:11.000Z</published>
    <updated>2022-03-30T14:23:05.452Z</updated>
    
    <content type="html"><![CDATA[<p>基于遗传算法的边缘计算任务调度新方案</p><h4 id="abstract"><a href="#abstract" class="headerlink" title="abstract"></a>abstract</h4><p>随着智能电网和全球能源互联技术的不断演进，大量智能终端接入电网，可作为边缘节点提供资源服务。传统云计算可用于在电网中提供存储服务和任务计算服务，但面临资源瓶颈、时延、网络带宽资源受限等挑战。边缘计算是云计算的有效补充，因为它可以为用户提供低延迟的本地计算服务。但是，由于单个边缘节点的资源有限，需要将资源密集型任务划分为多个子任务，然后通过资源协作分配给不同的边缘节点。使任务调度更有效是一个重要的问题。本文基于边缘计算的概念提出了一种两层资源管理方案。此外，基于遗传算法，提出了一种新的任务调度算法GA-EC(Genetic Algorithm for Edge Computing)，可以根据不同的调度目标动态调度任务。仿真结果表明，该算法对能耗和负载均衡有有益的效果，减少了时延。</p><h4 id="1-Background-研究现状"><a href="#1-Background-研究现状" class="headerlink" title="1 Background 研究现状"></a>1 Background 研究现状</h4><p>随着智能电网和通信技术的快速发展,海量电力设备接入网络，电力服务用户日益增多。云能够存储大量数据并处理具有可扩展性、灵活性和安全性的计算密集型任务。云计算可以通过数据存储、容灾、智能用电、仿真分析等方式为电网提供支撑。云平台可以整合电网中不同系统的数据和资源并进行管理，实现智能电网中数据和资源的共享。为了保证电力云计算系统的有效性和稳定运行，必须实现合理的资源管理和任务调度。</p><p>云资源管理已经有很多研究。在节能研究中，[9]中的作者提出了一种方案，可以通过降低处理器速度来实现虚拟集群中的节能。 [10]中的作者提出了一种动态资源分配方法，可以根据实际需求调整资源节点的数量。为了降低将低分辨率视频转换为高分辨率的计算复杂度，同时最大限度地减少与移动客户端相关的计算和额外通信成本，中的作者研究了通过将计算任务卸载到移动云计算 (MCC) 来提高视频质量环境。</p><p>研究人员针对提高资源利用率提出了一种两层资源调度方案，可以根据启发式算法实现合理的任务调度,中的作者提出了一种节能的资源调度方法，可以提供实时的云服务，时延很小。此外，遗传算法被用于云计算的许多领域，包括资源管理。</p><p>云计算用于在电力网络中提供资源存储和任务计算服务。由于云计算的传输延迟长和边缘节点的计算资源有限，本文提出了一种两层资源管理模型和一种新颖的任务调度算法来满足电力网络的要求，如图1所示。 1、在智能电网中，边缘节点可以是智能终端、能源路由器、集中器等。</p><p>下文第二部分介绍了基于边缘计算的电源管理方案，第三部分详细介绍了任务调度算法。第四部分，我们模拟了新算法与其他三种对比算法的性能。第五部分是本文的总结。</p><h4 id="2-Power-Resource-Management-Scheme-Based-on-Edge-Computing-基于边缘计算的电源管理方案"><a href="#2-Power-Resource-Management-Scheme-Based-on-Edge-Computing-基于边缘计算的电源管理方案" class="headerlink" title="2 Power Resource Management Scheme Based on Edge Computing  基于边缘计算的电源管理方案"></a>2 Power Resource Management Scheme Based on Edge Computing  基于边缘计算的电源管理方案</h4><p>随着云计算的快速演进，越来越多的智能终端接入网络。传统云计算中，所有计算任务都转移到云数据中心，无法始终满足用户的实时性要求。此外，在需要同时执行大量计算任务时，传统云计算不可避免地会出现带宽瓶颈。</p><p>在电力网络的边缘，有许多设备消耗大量资源[17]。如果这些设备中的资源可以用来提供计算服务，那么云计算的能量就可以得到扩展。对于本文的资源管理模型，云服务器中的部分计算任务可以卸载到边缘设备上，本地计算任务也可以在本地边缘设备上执行。</p><p>在新的资源管理模型中，计算节点有两层。第一层包括云服务器中的分析控制节点，第二层包括边缘设备中的计算节点。第一层节点用于执行计算密集型任务和管理第二层节点，第二层节点用于执行本地计算任务。因此，第二层节点中的资源应该由第一层节点统一调度。资源管理模型可应用于供电服务指挥系统、大数据平台、热点定位等多种应用场景。</p><p>在这种资源管理模型中，由于二层节点中边缘节点的资源是有限的，一些任务会被划分为子任务，由不同的边缘节点执行。因此，第二层的资源将在不同的任务之间共享和调度。</p><h4 id="3-Introduction-of-Task-Scheduling-Algorithm-in-Detail-任务调度算法详细介绍"><a href="#3-Introduction-of-Task-Scheduling-Algorithm-in-Detail-任务调度算法详细介绍" class="headerlink" title="3 Introduction of Task Scheduling Algorithm in Detail 任务调度算法详细介绍"></a>3 Introduction of Task Scheduling Algorithm in Detail 任务调度算法详细介绍</h4><p>电力网络中的任务调度问题变得越来越复杂。调度算法对于提高节能性能、减少时间延迟和改善负载平衡至关重要。因此，在本文中，我们提出了一种新颖的任务调度智能优化算法。</p><p>对于本文提出的资源管理模型，边缘节点位于第二层，有限的资源会影响一些计算密集型任务的完成。因此，计算密集型任务将被划分为子任务，由不同的边缘节点执行。这使得在不同边缘节点之间分配任务成为一个关键问题。</p><p>许多学者研究了任务调度问题。例如，[18] 中提出了一种称为 DSF ACO 的任务调度算法，该算法可以在同一个调度队列中分配多个任务，以减少执行时间。该算法可以改善虚拟机资源的运行。 [19]提出的一种任务调度方法，采用质量函数的蚁群算法的信息素更新规则，通过加载标准差函数改进启发式信息模型，实现云中虚拟机的负载均衡。 [20] 中提出了一种称为 ECMM（代表 Energy-Considered Min-Min）的低功耗调度算法，但人们认为该算法可能会降低任务执行效率。 [21]中的作者提出了一种节能的资源分配算法，将高负载的应用程序迁移到新的多核服务器上，将低负载的应用程序迁移到现有的单核服务器上。</p><p>在第二层资源管理模型中，计算密集型任务将被划分为多个子任务，边缘节点通过相互协作来执行子任务。在本文中，我们提出了一种基于遗传算法的任务调度算法，以实现不同边缘节点之间的资源共享和任务分配。</p><h5 id="3-1-Mathematical-Model-数学模型"><a href="#3-1-Mathematical-Model-数学模型" class="headerlink" title="3.1  Mathematical Model 数学模型"></a>3.1  Mathematical Model 数学模型</h5><p>本节介绍任务调度算法的计算模型和流程图。对于本文，边缘节点数为n，任务数为m。边缘节点的集合是 R&#x3D;{R1,R2。 .里。 . .,Rn}，任务集为 T&#x3D;{T1,T2。 . .Tj . 。，Tm值}。任务调度的目的是根据调度目标函数为任务分配合适的边缘节点。</p><p>能耗计算模型</p><p>能耗计算模型</p><h5 id="3-2-算法介绍"><a href="#3-2-算法介绍" class="headerlink" title="3.2 算法介绍"></a>3.2 算法介绍</h5><h4 id="4-Simulations"><a href="#4-Simulations" class="headerlink" title="4 Simulations"></a>4 Simulations</h4><p>在基于边缘计算概念的新资源管理模型中，我们提出了一种基于遗传算法的任务调度算法。在本节中，我们将模拟新算法的性能。不失一般性，所有数据均为10次实验的平均值。信道增益值 hUPi &#x3D; l−τn , a n d τ &#x3D; 4, ln ∈ [0, 50]。其他参数列在表中。 1、我们设置了一些对比方法来验证新算法的有效性。</p><h4 id="5-Conclusion"><a href="#5-Conclusion" class="headerlink" title="5 Conclusion"></a>5 Conclusion</h4><p>Task Scheduling for Edge Computing with Agile VNFs On-Demand Service Model toward 5G and Beyond</p><p>Abstract</p><p>随着互联网的快速发展，满足服务请求、有效分配计算资源、提供服务按需应用的需求不断增加。边缘计算用于满足低延迟、网络连接和本地数据处理要求，并减轻云中的工作量。本文提出了一种基于网关的边缘计算服务模型，以减少数据传输的延迟和往返云的网络带宽。通过轻量级虚拟化技术Docker，调整边缘网关的任务调度，实现按需计算资源分配。边缘网关还可以处理本地网络中的服务请求。所提出的边缘计算服务模型不仅消除了传统云服务模型的计算负担，而且提高了边缘计算节点的运行效率。该模型还可用于 5G 及以后的云边缘计算环境中的各种创新应用。</p><h4 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1 Introduction"></a>1 Introduction</h4><p>云计算、移动宽带网络、物联网（IoT）的快速发展，伴随着对网络资源分配、数据处理和服务管理的巨大需求，不可避免地改变了传统的网络基础设施。软件定义网络 (SDN) 和网络功能虚拟化 (NFV) 技术不仅将网络基础设施从复杂的物理实体转变为虚拟和可编程节点，而且还为信息和通信技术 (ICT) 的发展带来了重大变化 [1 , 2]。</p><p>NFV 代表了电信基础设施部署方式的核心结构变化 [3]。如图1所示，NFV旨在解决与网络设备资源分配相关的问题。具体来说，NFV 使用虚拟化技术将位于数据中心、网络节点和客户端设备 (CPE) 上的不同类型的设备（包括路由器、交换机、防火墙和入侵检测系统）集成到标准或通用硬件中设备。这样，NFV可以有效降低网络物理设备的采购成本和相关的网络维护成本。作为 NFV 的逻辑结果，虚拟网络功能 (VNF) 是以前由专有的专用硬件执行的虚拟化任务。 VNF 将单个网络功能从专用硬件设备转移到在商品硬件上运行的软件。同时，NFV 将网络功能从专有硬件设备中分离出来，通过使用软件来运行它们，并随后加速服务创新和配置，尤其是在服务提供商环境中。 NFV的出现有利于软件运营的网络，而不是物理设备运营的网络，增强了各个网络服务功能的灵活性和快速部署。 SDN是另一种用于解决传统网络刚性问题，满足多样化和动态网络服务需求的技术[4]。</p><p>SDN的主要目的是解决传统网络架构中网络分为控制平面和数据平面的局限性。软件通过集中控制的方式将网络管理权限授予控制平面上的软件控制器，从而重新安排网络架构。这样，这种从现有网络架构中抽离出来，转变为可编程网络的控制方式，有效地解决了传统网络设计的局限性。使用单个逻辑点控制整个网络，可以实现网络的集中控制和灵活运行。 SDN 和 NFV 是在数据传输和电信基础设施环境下，可以相互协同，引领网络设计的改造、部署和管理的网络技术。这些技术的融合也为互联网的未来发展指明了方向，尤其是在5G技术出现之后[5, 6]。</p><p>随着网络变得越来越灵活、软件定义和虚拟化，一些标准组织正在努力将 SDN&#x2F;NFV 技术引入移动网络，以满足 5G&#x2F;IoT 网络对数据处理和信息传输的低延迟要求，并间接驱动边缘计算技术的发展[7-9]。边缘计算是一种分布式计算架构，它将应用程序、数据和服务的计算能力从云数据中心服务器转移到靠近待处理用户网络边缘的 CPE [10-12]。网关是一种 CPE 和通用边缘计算设备，具有计算、分析和预处理在主机和其他物联网设备附近收集的数据的基本能力，以加速数据处理并减少传输延迟 [13, 14] .在基于网关的边缘网络架构中，数据在其源头附近进行计算和处理，从而使该架构适用于处理即时服务请求。</p><p>边缘计算的概念如图 2 所示。边缘网络位于物联网设备和云之间 [15]。边缘计算将现有的云计算范式扩展到网络边缘，以满足延迟关键和计算密集型物联网应用的需求。边缘计算节点的分布式架构满足了从云数据中心到CPE或微数据中心的多种应用、数据和服务的计算需求。根据不同的发展领域，边缘计算网络可以分为cloudlet、移动边缘计算（MEC）和雾计算[16-18]。 Cloudlet 是一种通信工具，它为用户周围的网络提供微服务，并虚拟化和缩小计算资源，以将计算资源部署在用户端附近。目前，Akamai 和 Microsoft 正在推广 cloudlets 的应用服务和技术。 MEC 由欧洲电信标准协会（ETSI）推出，在移动通信领域具有高度应用性，由通信公司运营和管理[19]。该技术主要旨在减轻网络设备日益增长的压力，帮助移动公司打造独特的移动服务模式。由 Cisco 推出，目前由 OpenFog Consortium Alliance 推动，雾计算是扩展云计算的概念，专注于本地网络的数据处理功能[20]。通过强调近场数据通信，雾计算可用于不同的网络设备，用于个人或企业管理，以及在特定领域提供相关的物联网服务。 OpenFog Consortium 旨在通过开发一种能够识别某些核心技术和能力的开放架构来推广 OpenFog 计算技术，例如分布式计算、网络和存储，为物联网边缘提供智能支持。顺应当前技术融合趋势，OpenFog还与ETSI工业规范组合作，为ICT的规范和互操作建立应用框架和开发技术，扩大边缘计算的应用范围。</p><p>5G技术的出现，增加了对传统集中式云计算架构的数据移动、数据存储、数据处理、数据分析等方面的要求，从而增加了提高核心网承载能力和网络承载能力所需的硬件设备数量。服务器。鉴于物联网产生的大量数据，现有的云服务模式无法满足用户大而分散的需求。该模型已用于数据计算、分析和处理。然而，对低延迟和即时性的需求逐渐增加，从而使该模型略显不足。边缘计算的引入有助于提前处理数据，减少数据流量和传输时间；该技术还允许将计算能力转移到 CPE 或终端节点，以增强边缘操作对环境的即时反馈 [21]。思科互联网业务解决方案集团 [22] 预测，到 2020 年物联网将拥有超过 500 亿个终端和设备，而国际数据公司估计未来超过 40% 的数据需要分析、处理和存储在网络边缘[23]。为了有效应对上述变化带来的挑战，必须重新定义网络边缘的服务模型，优化网络运行和服务处理效率，减少云端的工作量，满足网络的时延要求。 5G物联网。本文的其余部分安排如下。第二部分介绍了研究背景和相关工作。第 3 节描述了边缘计算服务模型的设计。第 4 节介绍了实验结果。第 5 节总结了本文。</p><h4 id="2-Background-and-Related-Works"><a href="#2-Background-and-Related-Works" class="headerlink" title="2 Background and Related Works"></a>2 Background and Related Works</h4><p>网络运营商必须部署各种类型的网络设备和软件平台，以支持日益多样化的互联网需求。然而，目前的网络设计是基于硬件概念的，各种硬件设备往往不兼容或无法相互通信，网络维护管理复杂度高，成本高。最近提出了 NFV 作为网络运营商面临的困难的解决方案。通过NFV，网络和通信运营商可以降低相关成本，灵活高效地处理客户网络部署需求，减少硬件资源浪费，提高资源利用效率。当前的NFV相关标准主要由ETSI驱动。鉴于网络功能虚拟化带来的影响和好处，运营商——尤其是网络服务提供商和电信运营商——被认为是 NFV 标准开发中最积极的参与者。</p><p>如图 3 所示，管理程序和容器是 VNF [24] 的两个主要框架。 Hypervisor是最常见的虚拟化技术，它使用一组虚拟化硬件设备以虚拟的方式执行宿主操作系统，并抽象出宿主操作系统的物理硬件。虚拟机（VM）是部署在虚拟管理程序上的操作系统，而Linux容器（LXC）是操作系统级的虚拟化技术，主要将应用服务系统封装成一个软件容器，存储应用服务的代码软件、所需的操作系统核心和库。作为其最吸引人的特点，LXC 具有简化的软件结构。因此，容器的镜像文件只包含了一小部分比一般VM小的操作系统组件，它是一个完整的操作系统。鉴于其体积小、重量轻的特点，与 VM 相比，容器的部署或移动速度要快得多。因此，大多数行业从业者更喜欢容器而不是 VM。 Docker 是一个基于 LXC 技术 [25] 的开源项目，在 Linux 操作系统上运行。该技术创建了一个额外的软件抽象层，用于虚拟化服务应用程序以响应微服务的开发 [26]。 Docker 除了作为 Git Hub 社区的著名产品外，还受到了 Google 和 Red Hat 的青睐，是目前发展最快的 NFV 虚拟化技术。还进行了许多研究来检验 Docker 作为边缘计算平台的实现</p><p>虚拟化技术的发展推动了物联网架构的多项创新。边缘计算也作为一个新概念出现，满足了物联网对分布式数据处理和设备数量的要求。边缘网关等 CPE 设备使用虚拟化技术提供本地操作，特别适用于具有低延迟和即时性的 IoT 应用程序。边缘计算可以将原本由云数据中心处理的大规模服务完全拆解，将这些服务切割成小而易管理的部分，分布在边缘网络节点或微数据中心，以加速其分辨率，减少云中的工作负载。在这种情况下，用户的服务请求在边缘网络的网关上进行处理，而超出计算能力或边缘网络无法处理的请求被转发到边缘网络。减少发送回云端的数据量。这些数据最初在边缘节点进行处理，然后在将它们传输回云端之前进行预处理或过滤，以确保仅传输有用的数据。边缘计算不仅可以降低网络连接时延，满足5G&#x2F;IoT改善时延的需求，还可以促进ICT行业技术的融合。使用轻量级虚拟技术还可以帮助网络运营商在边缘网关上安装应用程序和控制软件，提供本地化服务，并创建创新的服务模式。参考文献 [29] 提出了一种基于 SDN 的边缘计算架构，称为软件定义基础架构（SDI），它使用 OpenFlow 和 OpenStack 将服务资源虚拟化，用于在可以灵活调度网络资源的虚拟基础架构上构建智能应用程序。为了引入资源共享的概念，[30] 提出了一种云-边缘框架，其中每个边缘节点可以使用本地处理平台共享计算资源，以减少处理数据的云端的计算负担，并提高边缘网络的运行。为了满足移动网络的低延迟和快速数据处理要求，[12] 检查了移动边缘操作，确定了不同 MEC 的适用情况和参考场景，并提出了 MEC 卸载决策、计算资源分配和移动管理的边际。互联网的计算需求也可以作为检验边缘网络服务管理和应用创新的参考。</p><p>考虑到本地网关硬件的资源限制（如 CPU、内存和网络密集型服务请求），处理用户服务请求的任务调度机制对于提高边缘计算的服务能力具有重要作用。计算机系统中提供了几种任务调度算法[31]。还对云计算的几种任务调度算法进行了深入研究[32, 33]。参考文献[34]提出了一种称为HealthEdge的任务调度方法，它根据收集到的人体健康数据为不同的任务设置不同的处理优先级，并确定一个任务是必须在本地设备上运行还是在远程云上运行，以减少总处理量尽可能多的时间。参考文献[35]采用马尔可夫决策过程方法来解决MEC系统中的随机优化问题。在这种方法中，计算任务是根据任务缓冲区的排队状态、本地处理单元的执行状态和传输单元的状态来调度的。参考文献[36]提出了一种贪婪的最佳可用性（GBA）机制来识别理想化的任务调度策略，并通过根据任务完成时间调度任务来减少服务的排队时间。参考文献[37]分析了循环（RR）算法在云计算环境中的性能，揭示了RR调度通过使用时间片的方法在相同优先级的任务之间公平地分配计算资源。结果表明，与其他算法相比，RR算法表现出更好的响应时间和负载平衡。</p><h4 id="3-Problem-Definition"><a href="#3-Problem-Definition" class="headerlink" title="3 Problem Definition"></a>3 Problem Definition</h4><p>NFV 是目前最有价值的解决与网络服务的运营成本和效率相关的问题的解决方案。因此，许多ICT公司已经开始研究虚拟化技术。尽管对该技术寄予厚望，但满足服务请求、有效分配虚拟计算资源、提供服务按需应用等仍然对 NFV 的部署提出挑战，并在 5G&#x2F;IoT 服务的未来发展中发挥关键作用。 NFV还允许基于共同的底层网络资源建立多个独立的、异构的虚拟网络，从而使服务提供商能够根据用户的需求提供定制化的服务。虚拟网络嵌入是根据基础设施提供商当前的资源情况，通过映射算法将虚拟网络映射到底层网络（底层网络）的过程。这个过程是一个 NPHard 问题，已经在 NFV 资源分配研究中进行了调查 [38, 39]。以往的研究[40, 41]也系统地讨论了虚拟网络映射问题，为研究提供了很好的参考。</p><p>本文旨在通过使用提出的边缘计算服务模式来优化任务调度和资源分配。与云计算相比，S c h e d u l i n g t a s k s i n e d g e c o m p u t i n g a r e m o r e c o m p l e x。边缘计算操作通常分布在客户端设备、边缘网关上，有时还分布在云网络的代理上。因此，决定在哪里安排计算任务仍然是边缘计算中的一个关键问题。鉴于目前基于网关的物联网架构是主流，本文讨论的任务调度机制主要集中在边缘网关。在可用计算资源有限的情况下，调度和资源分配是该网关要解决的主要问题。轻量级 NFV 技术在开发过程中发挥着不可或缺的作用。主机服务请求的任务调度和资源分配之间的关系如图 4 所示。由于每个服务请求到达的时间不同，所需的 VNF 服务和处理时间也不同。边缘网关可以根据服务请求之间的差异，调整任务调度和资源配置。作为服务按需模型的基本思想，只有一个 VNF 专用于单个服务请求。这个服务模型问题可以用排队论来分析，把request和react处理看成一个排队系统，把排队系统的输入看成服务请求，把服务计数器看成网关调度函数，输出为请求的 VNF 资源。尽管许多队列模型可用于运营管理 [42]，但本文主要关注任务调度方法，该方法允许某个边缘网关一个接一个地处理队列中的多个 VNF。由于容量有限，边缘网关只能调度有限数量的服务请求，而后续的服务请求需要转发到云端进行处理。考虑到这些，研究问题制定如下。假设服务请求是一个边缘网关内的泊松比，服务时间是指数分布。服务请求集可以表示为 푅 &#x3D; {푅1, 푅2, 푅3, . . . , 푅푛}, w h e r e n 表示系统中的服务请求数。等式 (1) 和 (2) 用于确定系统中 n 个服务请求的概率。在这些等式中，N表示网关中可以调度的最大服务请求数，휆是单位时间内平均传入的用户请求数，휇是服务效率（服务计数器的能力），휌 &#x3D; 휆&#x2F;휇 为单位时间内可以满足请求的比率，P0表示初始条件，L表示计划时间内到达系统的服务请求总数，퐿푞表示服务器总数在系统中排队的请求。 L 和 퐿푞 可以分别使用 (3) 和 (4) 计算。等式（5）计算系统中服务的等待和服务时间，而（6）计算푊푞或用户请求的平均等待时间。</p><h3 id="4-Design-of-the-Edge-Computing-Service-Model"><a href="#4-Design-of-the-Edge-Computing-Service-Model" class="headerlink" title="4  Design of the Edge Computing Service Model"></a>4  Design of the Edge Computing Service Model</h3><p>如何构建弹性且高性价比的边缘计算服务模型，提高管理效率，满足用户服务需求，实现集中管理，开发灵活配置的服务模型，是当前5G SDN&#x2F;NFV网络发展的研究趋势。本文提出了一种基于网关的边缘计算服务模型（图5），以提高边缘计算节点的运行效率，加速用户服务请求的处理，提高有限数量计算资源的利用效率。在该模型中，当不同的用户请求进入边缘网关时，该网关决定所请求的服务是否可以被处理。如果边缘网关本身缺乏计算能力或资源，则控制器将服务请求转发到云端，以减少数据处理延迟。</p><p>提出的边缘计算服务模型可以分为资源估计、调度器和轻量级VNF配置。图 6 展示了所提出的边缘计算服务模型中的操作流程图，这三个部分将在以下部分中进一步描述。<br>资源估计检查边缘网关是否有足够的计算资源来提供边缘计算服务。对于用户请求集R，资源分配必须遵守以下规则，边缘网关方式也使用这些规则</p><h5 id="5-Experiment"><a href="#5-Experiment" class="headerlink" title="5 Experiment"></a>5 Experiment</h5><p>进行了实验以评估所提出的任务调度算法并测试其在部署轻量级 VNF 中的性能。实验环境如图 7 所示。最初进行模拟，通过改变服务需求的数量来评估算法的任务调度性能。服务请求是<br>仿真评估了服务请求对不同调度机制的平均等待时间、平均响应时间和任务调度的影响。 FCFS基于进入边缘网关排队系统的服务请求，按照这些请求的先后顺序调度任务。优先级任务调度是一种不公平的调度算法，服务请求按照优先级进行排序，优先执行高优先级的任务。优先级相同的任务采用先进先出的调度机制进行排序。 GBA根据排队系统中服务请求的完成时间对任务进行排序。 RR算法是基于在进程调度中执行的常规RR调度。 RR调度通过使用时间片的方法（时间量子）将计算资源公平地分配给具有相同优先级的任务。</p><h4 id="6-Conclusions"><a href="#6-Conclusions" class="headerlink" title="6 Conclusions"></a>6 Conclusions</h4><p>本文提出了基于网关的边缘计算服务模型和 GAF 任务调度机制，允许边缘网关在较短的平均时间内调度更多的任务。使用 VNF 配置技术提高边缘计算服务的运行效率，增加资源利用率，实现VNF的快速部署，满足服务按需请求。资源估计、任务调度和轻量级VNF配置设计相结合，提供了一个可以满足5G网络业务按需请求的一体化解决方案。仿真结果表明，所提出的 GAF 机制优于其他调度算法。同时，比较表明，在边缘网关中使用轻量级虚拟化技术比使用传统虚拟机更高效、更具竞争力。未来，我们计划研究边缘计算的多队列任务调度问题，边缘网关和云服务器之间可能的合作，以及利用SD-W AN技术实现云边缘网络的无缝运行。</p><p>Evaluation of Task Scheduling Algorithms in Heterogeneous Computing Environments<br>异构计算环境中 T ask 调度算法的评估</p><p>Abstract</p><p>这项工作建立了一套方法来评估异构计算上下文中任何任务调度策略的性能。我们正式陈述了混合边缘-云计算生态系统的调度模型，并对大型工作负载进行了基于仿真的实验。除了传统的云数据中心，我们还考虑由电池供电的智能手机和 Raspberry Pi 边缘设备组成的边缘数据中心。我们定义了计算资源的实际容量。一旦找到时间表，各种任务需求可以或不能通过资源容量来满足。我们建立了一个调度和评估框架，并测量了典型的调度指标，例如平均等待时间、平均周转时间、制造时间、轮询的吞吐量、最短作业优先、最小-最小和最大-最小调度方案。我们的分析和结果表明，与纯云媒体相比，最先进的独立任务调度算法在异构边缘云媒体中的数据中心的重大任务失败和非最佳资源利用方面存在性能下降。特别是对于大型任务集，由于电池电量不足或内存有限，每个调度方案都有超过 25% 的任务无法执行。</p><h4 id="1-Introduction-1"><a href="#1-Introduction-1" class="headerlink" title="1 Introduction"></a>1 Introduction</h4><p>执行工作负载的调度对于任何计算系统的性能都至关重要。特别是在异构计算环境中大规模处理异构大数据时，由于作业调度和资源分配的非最优以及物联网（IoT）移动性等因素，容易出现高延迟。考虑到目前智能边缘设备和物联网传感器数量空前，来自各种用例的大量异构数据不断产生 [1]。这直接转化为对延迟感知、节能计算技术的新兴需求[2]。在制定解决上述考虑的优化调度策略方面存在广泛的研究兴趣[3-5]。为了测试当前技术的性能，重要的是要有一个准确和正确评估的框架</p><p>通过对异构分布式系统任务调度领域的当前进展进行广泛的文献回顾 [6,7]，我们发现在现有调度算法（如 Min-Min 和 Max）的性能评估中迫切需要更加清晰和形式化-Min，在[8]中介绍。</p><p>我们在本文中解决的问题是对异构环境中的调度算法 Round-Robin (RR)、最短作业优先 (SJF)、Min-Min 和 Max-Min 的评估。这些算法已经在调度文献[9,10]中得到了广泛的研究，我们认为它们是评估和决定它们是否可以的合适选择异构计算的候选者。将来可以扩展这项工作以分析其他调度算法（例如，公平和容量调度、资源感知调度、遗传算法）。</p><p>我们明确定义了 CPU 和内存等云和边缘资源容量。为了实现真实的设置，我们进一步将执行工作负载的异构性定义为具有不同 CPU、内存和 I&#x2F;O 要求的读取和写入任务的组合。考虑到边缘设备的某些资源容量可能不足以执行任务，我们获得的结果对前面提到的算法进行了新颖的分析。我们的分析阐明了何时可以安全地使用现有的调度算法，以及在分配任务以在低容量资源上执行时它们的性能受到多少影响。最后，我们确定需要开发考虑到上述计算约束的进一步调度算法。这是未来工作的主题。</p><p>Contributions</p><p>本文的研究贡献如下：  <a href="https://github.com/roxana-stan/2HD-Scheduling-Algorithms-Evaluation-Framework">https://github.com/roxana-stan/2HD-Scheduling-Algorithms-Evaluation-Framework</a></p><p>数学定义异构计算的调度模型，用于我们的性能评估；</p><p>构建一个框架（<a href="https://github.com/roxana-stan/2HD-Scheduling-AlgorithmsEvaluation-Framework%EF%BC%8C%E4%BA%8E">https://github.com/roxana-stan/2HD-Scheduling-AlgorithmsEvaluation-Framework，于</a> 2021 年 8 月 15 日访问），用于评估边缘云异构环境中的调度算法。此外，作为框架的一部分，我们实施了一套全面的绩效评估指标；</p><p>通过我们的框架进行实验，根据一组指标评估最先进的调度算法的性能。我们选择了具有代表性需求和不同计算资源能力的异构任务；</p><p>根据传统调度算法的任务失败和非最优资源利用来评估性能下降。这是我们得出结论的关键，即需要开发未来的调度算法，以便在边缘云设置的背景下更好地优化低容量边缘资源的执行。</p><p>Structure</p><p>我们简要介绍了论文的概要。第 2 节概述了任务调度过程，突出了各种目标并详细说明了协作边缘-云系统中调度过程的步骤。在第 3 节中，我们从理论上定义了我们提出的异构计算环境调度模型。第 4 节解释了异构工作负载的概念并列出了可能的任务类型。在第 5 节中，我们基于一套完整的指标建立了一个评估方法，突出了实际实验的参数、假设和各种资源的配置。第 6 节介绍了不同调度算法的性能分析。我们讨论了实验结果，并在第 7 节中总结了这项研究工作的结论。</p><h4 id="2-Task-Scheduling"><a href="#2-Task-Scheduling" class="headerlink" title="2 Task Scheduling"></a>2 Task Scheduling</h4><p>我们的论文评估了几种解决独立任务调度问题的技术，也称为任务袋 (BoT) 工作负载调度 [11]。给定一个由任务组成的应用程序，它们之间没有相互依赖，调度挑战包括为每个任务分配最适合其及时执行的计算资源。然而，所提出的评估方法也可以应用于工作流调度，以及具有优先约束的任务[12]。<br>一般来说，在计算机上优化调度任务的问题已被证明是 NP 完全的 [13]，因此有必要依赖启发式算法。</p><p>在分布式计算环境中，挑战在于是否将边缘资源或云资源分配给传入的任务。特别是，在本文中，我们考虑边缘数据中心将配备电池供电的边缘设备，例如智能手机和树莓派。<br>通过处理边缘数据中心内的任务，与传统云数据中心的过度消耗相比，我们可以从降低的能源利用率中受益。边缘数据中心的缺点是它们的处理能力低于云数据中心 [14]，因此，调度策略对于大小可变的任务至关重要。</p><p>Scheduling Objective<br>我们区分了调度策略旨在完成的几个功能：<br>实现高系统吞吐量；<br>最小化系统的响应时间；<br>最小化所有任务的总体完成时间。 （可选）完成工作量的最后期限（如果有）；<br>最大限度地降低边缘云计算服务的成本；<br>最大限度地减少数据中心的能源消耗；<br>有效利用系统资源。</p><p>Scheduling Steps</p><p>调度过程的架构如图 1 所示。在该框架中，边缘云数据中心代理负责工作负载调度，单个队列保存所有待提交执行的就绪任务。</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20220330214351487.png" alt="image-20220330214351487"></p><h4 id="Scheduling-Model-for-Heterogeneous-Computing"><a href="#Scheduling-Model-for-Heterogeneous-Computing" class="headerlink" title="Scheduling Model for Heterogeneous Computing"></a>Scheduling Model for Heterogeneous Computing</h4><p>在本节中，我们提出并正式陈述了混合计算环境中独立任务调度的模型。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;基于遗传算法的边缘计算任务调度新方案&lt;/p&gt;
&lt;h4 id=&quot;abstract&quot;&gt;&lt;a href=&quot;#abstract&quot; class=&quot;headerlink&quot; title=&quot;abstract&quot;&gt;&lt;/a&gt;abstract&lt;/h4&gt;&lt;p&gt;随着智能电网和全球能源互联技术的不断演进</summary>
      
    
    
    
    <category term="paper" scheme="http://peaky2022.gitee.io/peaky/categories/paper/"/>
    
    
    <category term="paper" scheme="http://peaky2022.gitee.io/peaky/tags/paper/"/>
    
  </entry>
  
  <entry>
    <title>Linux部署git与Nodejs</title>
    <link href="http://peaky2022.gitee.io/peaky/2022/03/01/8d39085b.html"/>
    <id>http://peaky2022.gitee.io/peaky/2022/03/01/8d39085b.html</id>
    <published>2022-03-01T01:49:06.000Z</published>
    <updated>2022-07-01T12:29:25.504Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">sudo 权限执行</span></span><br><span class="line">wget https://github.com/git/git/archive/v2.35.1.tar.gz</span><br><span class="line">tar -zxvf git-2.35.1.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="language-bash">安装依赖</span></span><br><span class="line">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker</span><br><span class="line"><span class="meta">#</span><span class="language-bash">卸载自动安装的git版本太低</span></span><br><span class="line">yum remove git</span><br><span class="line"><span class="meta">#</span><span class="language-bash">执行编译</span></span><br><span class="line">cd git-2.35.1</span><br><span class="line">make prefix=/usr/local/git all</span><br><span class="line"><span class="meta">#</span><span class="language-bash">安装Git</span></span><br><span class="line">sudo make prefix=/usr/local/git install</span><br><span class="line"><span class="meta">#</span><span class="language-bash">编辑环境变量配置</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">PATH=$PATH:/usr/local/git/bin</span><br><span class="line">export PATH</span><br><span class="line"><span class="meta">#</span><span class="language-bash">初始化配置文件</span></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="language-bash">验证</span></span><br><span class="line">git --version</span><br></pre></td></tr></table></figure><span id="more"></span><h4 id="安装Nodejs"><a href="#安装Nodejs" class="headerlink" title="安装Nodejs"></a>安装Nodejs</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">Linux安装Nodejs</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">获取二进制文件</span></span><br><span class="line">wget https://nodejs.org/dist/v14.14.0/node-v14.14.0-linux-x64.tar.xz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Unzip the binary archive 创建文件目录</span></span><br><span class="line">sudo mkdir -p /usr/local/lib/nodejs</span><br><span class="line">sudo tar -xJvf node-v14.14.0-linux-x64.tar.xz -C /usr/local/lib/nodejs </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">设置环境变量 ~/.profile, 创建文件</span></span><br><span class="line">vi ~/.profile</span><br><span class="line"></span><br><span class="line">VERSION=v14.14.0</span><br><span class="line">DISTRO=linux-x64</span><br><span class="line">export PATH=/usr/local/lib/nodejs/node-$VERSION-$DISTRO/bin:$PATH</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">加载 /.profile配置文件</span></span><br><span class="line">vi ~/.bashrc</span><br><span class="line"></span><br><span class="line">. ~/.profile</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">验证</span></span><br><span class="line">node -v</span><br><span class="line">npm version</span><br><span class="line">npx -v</span><br></pre></td></tr></table></figure><h4 id="Hexo配置"><a href="#Hexo配置" class="headerlink" title="Hexo配置"></a>Hexo配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">安装Hexo 这里需要切换到root用户或者使用sudo权限</span></span><br><span class="line">npm install hexo-cli -g</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">把hexo命令添加到全局：hexo在nodejs的nodejs/bin目录可以找到hexo命令,方式是采用软连接：</span></span><br><span class="line">ln -s /usr/local/lib/nodejs/node-v16.14.0-linux-x64/bin/hexo /usr/local/bin/hexo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">验证</span></span><br><span class="line">hexo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">部署</span></span><br><span class="line">mkdir hexo</span><br><span class="line">hexo init</span><br><span class="line">npm install</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">启动本地服务：</span></span><br><span class="line">hexo s</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">替换已有的Hexo配置 覆盖文件</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">文件地址 https://fengfeng.lanzouj.com/iCJC800ugubi</span></span><br><span class="line">unzip -o hexo.zip -d hexo</span><br></pre></td></tr></table></figure><h4 id="使用基本命令"><a href="#使用基本命令" class="headerlink" title="使用基本命令"></a>使用基本命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">创建新文件</span></span><br><span class="line">hexo new post &quot;new&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">上传文件</span></span><br><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">or 创建新文件 bash new.sh</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">or 上传文件 bash up.sh</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="安装hexo到Linux并部署到Gitee"><a href="#安装hexo到Linux并部署到Gitee" class="headerlink" title="安装hexo到Linux并部署到Gitee"></a>安装hexo到Linux并部署到Gitee</h2><blockquote><p>接上文安装Git和Nodejs之后的记录<br>&lt;! – more –&gt;</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">更换国内淘宝源 npm    其实不能用，我也不知道为啥</span></span><br><span class="line">npm config set registry https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">// 配置后可通过下面方式来验证是否成功</span><br><span class="line">npm config get registry</span><br><span class="line">// 或</span><br><span class="line">npm info express</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">真SB 不好用</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">注：依赖hexo-renderer-sass安装时容易报错，很可能是国内网络问题，请尝试使用代理或者切换至NPM的国内镜像源安装。</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">最终解决方案是安装python 2.7</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">RockyLinux中安装python2.7</span></span><br><span class="line">dnf install python2</span><br><span class="line">sudo rm -rf /usr/bin/python</span><br><span class="line">sudo ln -s /usr/bin/python2.7 /usr/bin/python</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">安装 hexo 主题与渲染器 到hexo目录下</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git clone https://github.com/tufu9441/maupassant-hexo.git themes/maupassant </span><br><span class="line"></span><br><span class="line">npm install hexo-renderer-pug --save  </span><br><span class="line">npm install hexo-renderer-sass --save  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">注：依赖hexo-renderer-sass安装时容易报错，很可能是国内网络问题，请尝试使用代理或者切换至NPM的国内镜像源安装。</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">npm install dart-sass --save</span> </span><br><span class="line"><span class="meta"># </span><span class="language-bash">我选择使用 dart-sass 来代替 hexo-renderer-sass</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">编辑Hexo目录下的 _config.yml，将theme的值改为maupassant。</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">最终解决方案是安装python 2.7 node版本14.14.0</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">RockyLinux中安装python2.7</span></span><br><span class="line">dnf install python2</span><br><span class="line">ln -s /usr/local/python-2.7.9/bin/python2.7 /usr/bin/python</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署到gitee 在Blog目录下安装一个hexo部署插件</span></span><br><span class="line">npm install --save hexo-deployer-git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建电脑公玥</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;git@gitee.com&quot;</span> </span><br><span class="line"><span class="comment"># 接着完成三次回车，即可生成 ssh密钥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取生成的 public 密钥</span></span><br><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub</span><br><span class="line"><span class="comment"># 复制生成后的 ssh 密钥，通过仓库主页 「管理」—「部署公钥管理」—「添加部署个人公钥」， 添加生成的 public 密钥</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑Hexo目录下的 _config.yml，</span></span><br><span class="line"><span class="comment"># Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="comment"># git@gitee.com:用户名/仓库名.git</span></span><br><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: git@gitee.com:Peaky2022/Peaky.git</span><br><span class="line">  branch: master</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br><span class="line">npm install valine --save</span><br><span class="line">npm install hexo-wordcount</span><br><span class="line">npm install hexo-generator-search</span><br><span class="line">npm install hexo-renderer-sass --save</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久地址插件配置</span></span><br><span class="line">permalink: posts/:abbrlink.html</span><br><span class="line">abbrlink:</span><br><span class="line">  alg: crc32  <span class="comment"># 算法：crc16(default) and crc32</span></span><br><span class="line">  rep: hex    <span class="comment"># 进制：dec(default) and hex</span></span><br><span class="line"><span class="comment">#add v7.8.0</span></span><br><span class="line">permalink_defaults:</span><br><span class="line">pretty_urls:</span><br><span class="line">  trailing_index: <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span></span><br><span class="line">  trailing_html: <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;.html&#x27; from permalinks</span></span><br><span class="line"></span><br><span class="line">  </span><br></pre></td></tr></table></figure><h3 id="部署到githubpage"><a href="#部署到githubpage" class="headerlink" title="部署到githubpage"></a>部署到githubpage</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">创建仓库 例如我的用户名 Notes366 则创建一个仓库 notes366.github.io   大小写无关 部署后访问 https://notes366.github.io/</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">git config --global user.email <span class="string">&quot;xiaozhenniaini@gmail.com&quot;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">git config --global user.name <span class="string">&quot;peaky&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">仓库设置默认Branch为 master</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">编辑Hexo目录下的 _config.yml，</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">git@gitee.com:用户名/仓库名.git</span></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:Notes366/notes366.github.io.git</span><br><span class="line">  branch: master</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">登录https://www.leancloud.cn/ 华东feng</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">添加白名单域名 https://notes366.github.io/ 可以评论</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;安装git&quot;&gt;&lt;a href=&quot;#安装git&quot; class=&quot;headerlink&quot; title=&quot;安装git&quot;&gt;&lt;/a&gt;安装git&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;sudo 权限执行&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget https://github.com/git/git/archive/v2.35.1.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf git-2.35.1.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;安装依赖&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;卸载自动安装的git版本太低&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum remove git&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;执行编译&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd git-2.35.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make prefix=/usr/local/git all&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;安装Git&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo make prefix=/usr/local/git install&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;编辑环境变量配置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim /etc/profile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PATH=$PATH:/usr/local/git/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;export PATH&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;初始化配置文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;source /etc/profile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;language-bash&quot;&gt;验证&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git --version&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://peaky2022.gitee.io/peaky/categories/Linux/"/>
    
    
    <category term="Hexo" scheme="http://peaky2022.gitee.io/peaky/tags/Hexo/"/>
    
    <category term="Linux" scheme="http://peaky2022.gitee.io/peaky/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>MIUI教程</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/08/27/87d44b9d.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/08/27/87d44b9d.html</id>
    <published>2021-08-27T09:00:55.000Z</published>
    <updated>2022-03-03T15:01:47.596Z</updated>
    
    <content type="html"><![CDATA[<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><blockquote><p>手机数据会全部清除，包括所有照片，微信聊天，各个软件</p><p>需要提前备份好数据，1.小米云空间备份   2.MIUI自带备份与恢复，备份后拷贝到电脑</p></blockquote><p><strong>数据会全部清除！数据会全部清除！数据会全部清除！</strong> 数据无价，丢失数据自负</p><span id="more"></span><h4 id="打钱-支付宝还是微信"><a href="#打钱-支付宝还是微信" class="headerlink" title="打钱 支付宝还是微信"></a>打钱 支付宝还是微信</h4><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210827151051221.png" alt="image-20210827151051221"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210827151104840.png" alt="image-20210827151104840"></p><p>远程</p><p><a href="https://fengfeng.lanzoui.com/i1yLGtfgqri">todesk</a></p><h4 id="解BL锁"><a href="#解BL锁" class="headerlink" title="解BL锁"></a>解BL锁</h4><p><a href="http://www.miui.com/unlock/index.html">解BL官网</a></p><p>首先绑定好<strong>小米账号</strong></p><p>步骤如下：</p><p>1.设置—我的设备—全部参数—MIUI版本   连续点击5次</p><p>   <img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210827151606258.png" alt="image-20210827151606258"></p><p>2.设置—更多设置—开发者选项—<strong>OEM解锁勾选</strong>上—<strong>设备解锁状态</strong>—<strong>绑定小米账号</strong>—绑定</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210827163337898.png" alt="image-20210827163337898"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210827163412930.png" alt="image-20210827163412930"></p><p>打开<a href="https://fengfeng.lanzoui.com/iZaGLt8mbgb">解锁工具 </a> </p><p>登入小米账户</p><p>手机关机        按住  <strong>音量减键</strong> 和 <strong>开机键</strong> 直到出现一个兔子在修手机</p><p>开始解锁</p><h4 id="MIUI线刷"><a href="#MIUI线刷" class="headerlink" title="MIUI线刷"></a>MIUI线刷</h4><p>首先下载MIUI刷机包，MIUI线刷刷机包以 .tgz结尾 并且解压后为tar在解压后才能刷入</p><p>几个下载刷机包的网站<a href="http://www.miui.com/download-312.html">官方</a>            <a href="https://xiaomirom.com/">xiaomirom</a>     <a href="https://github.com/mooseIre/update_miui_ota">github</a>       <a href="https://roms.miuier.com/">发烧友</a>           <a href="https://miuiver.com/">签到币</a></p><p>下载解压后</p><p>打开<a href="https://fengfeng.lanzoui.com/i9Enbt8mh2d">线刷工具</a></p><h4 id="MIUI卡刷"><a href="#MIUI卡刷" class="headerlink" title="MIUI卡刷"></a>MIUI卡刷</h4><p><a href="https://fengfeng.lanzoui.com/iyojit8rd5c">TWRP</a></p><p><a href="https://archive.orangefox.download/OrangeFox-Stable/">橙狐镜像站</a>  </p><p><a href="https://orangefox.download/en/device/raphael">橙狐官方站</a></p><p><a href="https://fengfeng.lanzoui.com/iPawft8ovqd">REC刷入工具</a>   :将rec替换为recovery.img 运行一键刷入</p><p>下载  .zip 刷机包刷入</p><p>格式化data分区</p><p>双清</p>]]></content>
    
    
    <summary type="html">&lt;h4 id=&quot;注意事项&quot;&gt;&lt;a href=&quot;#注意事项&quot; class=&quot;headerlink&quot; title=&quot;注意事项&quot;&gt;&lt;/a&gt;注意事项&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;手机数据会全部清除，包括所有照片，微信聊天，各个软件&lt;/p&gt;
&lt;p&gt;需要提前备份好数据，1.小米云空间备份   2.MIUI自带备份与恢复，备份后拷贝到电脑&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;数据会全部清除！数据会全部清除！数据会全部清除！&lt;/strong&gt; 数据无价，丢失数据自负&lt;/p&gt;</summary>
    
    
    
    <category term="MIUI" scheme="http://peaky2022.gitee.io/peaky/categories/MIUI/"/>
    
    
    <category term="MIUI" scheme="http://peaky2022.gitee.io/peaky/tags/MIUI/"/>
    
  </entry>
  
  <entry>
    <title>常用的一些命令</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/06/01/9211474f.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/06/01/9211474f.html</id>
    <published>2021-06-01T06:51:32.000Z</published>
    <updated>2022-07-13T10:16:24.368Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>record all common commands</p></blockquote><span id="more"></span><h4 id="Windows-安装-typora"><a href="#Windows-安装-typora" class="headerlink" title="Windows 安装 typora"></a>Windows 安装 typora</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">需要下载安装包文件</span><br><span class="line">1. 安装文件版本 0.9.78 安装</span><br><span class="line">https://fengfeng.lanzouj.com/i9xo1vi</span><br><span class="line">2. 升级文件版本0.11.18 安装</span><br><span class="line">https://fengfeng.lanzouj.com/itJ7R07nrytg</span><br><span class="line"></span><br><span class="line">如果提示过期无法使用则重新下载2安装覆盖即可</span><br><span class="line"></span><br><span class="line">3. 更换主题</span><br><span class="line">https://fengfeng.lanzouj.com/i8HBb07s8isf</span><br><span class="line">解压 将upc.css放到theme目录下重启应用即可</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Linux-安装-screen-命令"><a href="#Linux-安装-screen-命令" class="headerlink" title="Linux 安装 screen 命令"></a>Linux 安装 screen 命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">No match <span class="keyword">for</span> argument: screen</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">未配置yum源</span></span><br><span class="line"></span><br><span class="line">sudo yum install epel-release </span><br><span class="line"></span><br><span class="line">sudo yum install screen</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">2 利用screen 命令 ，重起一个新的screen.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">新screen的名字，可以任起</span></span><br><span class="line"></span><br><span class="line">screen -S name </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">3 开始训练.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">4 可以断开terminal，此时训练不受影响</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">恢复</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">1 启动terminal，查看存在的screen的命令.</span></span><br><span class="line"></span><br><span class="line">screen -ls</span><br><span class="line"></span><br><span class="line">screen -r 30362</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">2 断开当前的screen.</span></span><br><span class="line">按 Ctrl + A， 然后 K 键 然后 y 键</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Linux-安装-jupyter-lab"><a href="#Linux-安装-jupyter-lab" class="headerlink" title="Linux 安装 jupyter lab"></a>Linux 安装 jupyter lab</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 安装miniconda  创建conda 环境</span><br><span class="line">2. 进入conda环境 安装依赖</span><br><span class="line">conda install -c conda-forge jupyterlab</span><br><span class="line"><span class="meta"># </span><span class="language-bash">or pip install jupyterlab</span></span><br><span class="line"></span><br><span class="line">3. 开放一个端口 比如8889 启动jypyter lab           </span><br><span class="line"><span class="meta"># </span><span class="language-bash">sudo firewall-cmd --zone=public --add-port=8889/tcp --permanent</span></span><br><span class="line">jupyter-lab --ip 0.0.0.0 --port 8889 --no-browser</span><br><span class="line"></span><br><span class="line">4. 设置一个screen 来保持jupyter的运行</span><br><span class="line">screen -S jupyter</span><br><span class="line">jupyter-lab --ip 0.0.0.0 --port 8889 --no-browser</span><br><span class="line"></span><br><span class="line">退出就可以了</span><br><span class="line"></span><br><span class="line">5. 添加内核</span><br><span class="line"><span class="meta">#</span><span class="language-bash">在新conda环境里面</span></span><br><span class="line">conda install ipykernel</span><br><span class="line"><span class="meta">#</span><span class="language-bash">然后</span></span><br><span class="line">python -m ipykernel install --user --name 环境名称 --display-name &quot;前端展示的名称&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">exp：</span></span><br><span class="line">python -m ipykernel install --user --name pytorch --display-name &quot;Python 3 (pytorch)&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">然后重启jupyter服务就可以了</span></span><br></pre></td></tr></table></figure><p>进阶 -端口转发</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">import threading</span><br><span class="line">import sys,getopt</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment"># 这个代码是用来做端口转发的 emmm 你问有什么用？没用，删了他吧 (摊手</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">错误</span></span><br><span class="line">def l_w(s):</span><br><span class="line">   print(&quot;[!] &#123;&#125;&quot;.format(s))</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">信息</span></span><br><span class="line">def l_i(s):</span><br><span class="line">   print(&quot;[+] &#123;&#125;&quot;.format(s))</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">毁灭性错误</span></span><br><span class="line">def l_a(s):</span><br><span class="line">   print(&quot;[-] &#123;&#125;&quot;.format(s))</span><br><span class="line">   exit()</span><br><span class="line"></span><br><span class="line">def help():</span><br><span class="line">   print(&quot;&quot;&quot;</span><br><span class="line">      -h 提供帮助，就是你看到的这个</span><br><span class="line">      -s 指定监听的本地ip，默认为 127.0.0.1</span><br><span class="line">      -l 指定监听的端口号，必须指定</span><br><span class="line">      -d 指定转发的目的主机，默认为 127.0.0.1</span><br><span class="line">      -p 指定转发的目的端口，必须指定</span><br><span class="line"></span><br><span class="line">         本程序具有超级牛力！ moo~~ moo~~~</span><br><span class="line">   &quot;&quot;&quot;)</span><br><span class="line">   exit()</span><br><span class="line"></span><br><span class="line">s_host = &quot;0.0.0.0&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">s_port = 20000</span></span><br><span class="line">s_port = 10001</span><br><span class="line">d_host = &quot;192.168.1.101&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">d_host = <span class="string">&quot;192.168.1.102&quot;</span></span></span><br><span class="line">d_port = 8889</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">将来自s套接字的数据转发到d套接字(函数名 forward)</span></span><br><span class="line">def fw(s,d):</span><br><span class="line">   try:</span><br><span class="line">      while True:</span><br><span class="line">         buf = s.recv(4096)</span><br><span class="line">         l_i(&quot;&#123;&#125; ====&gt; &#123;&#125; &#123;&#125; 字节&quot;.format(s.getpeername(),d.getpeername(),len(buf)))</span><br><span class="line">         if(len(buf) == 0):</span><br><span class="line">            l_w(&quot;&#123;&#125; 断开连接&quot;.format(s.getpeername()))</span><br><span class="line">            return</span><br><span class="line">         d.send(buf)</span><br><span class="line">   except:</span><br><span class="line">      return</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">处理请求，每一个连接对应一个 (函数名 request thread)</span></span><br><span class="line">def rt(request_socket):</span><br><span class="line">   des_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">   try:</span><br><span class="line">      des_socket.connect((d_host,int(d_port)))</span><br><span class="line">   except Exception as e:</span><br><span class="line">      l_a(&quot;连接目标 &#123;&#125;:&#123;&#125; 失败！err: &#123;&#125;&quot;.format(d_host,d_port,str(e)))</span><br><span class="line">   threading.Thread(target=fw,args=(request_socket,des_socket)).start()</span><br><span class="line">   fw(des_socket,request_socket)</span><br><span class="line"></span><br><span class="line">l_i(&quot;这个程序由 Startu 开发 o_o | ^_^ ~~~&quot;)</span><br><span class="line"><span class="meta"># </span><span class="language-bash">获取参数</span></span><br><span class="line">try:</span><br><span class="line">   opts,args = getopt.getopt(sys.argv[1:],&quot;hs:l:d:p:&quot;)</span><br><span class="line">except getopt.GetoptError:</span><br><span class="line">   l_w(&quot;参数不正确&quot;)</span><br><span class="line">   help()</span><br><span class="line">for opt,arg in opts:</span><br><span class="line">      if opt == &#x27;-h&#x27;:</span><br><span class="line">         help()</span><br><span class="line">      elif opt == &#x27;-s&#x27;:</span><br><span class="line">         s_host = arg</span><br><span class="line">      elif opt == &#x27;-l&#x27;:</span><br><span class="line">         s_port = arg</span><br><span class="line">      elif opt == &#x27;-d&#x27;:</span><br><span class="line">         d_host = arg</span><br><span class="line">      elif opt == &#x27;-p&#x27;:</span><br><span class="line">         d_port = arg</span><br><span class="line">if s_host == &quot;127.0.0.1&quot;:</span><br><span class="line">   l_w(&quot;将会监听: 127.0.0.1&quot;)    # 因为可能你不想绑定 127.0.0.1 所以作出提示 (也许是0.0.0.0呢)</span><br><span class="line">if s_port == 0 or d_port == 0:</span><br><span class="line">   l_a(&quot;没有指定端口号或指定为0 通过 -h 参数看帮助&quot;)</span><br><span class="line"></span><br><span class="line">l_i(&quot;监听 &#123;&#125;:&#123;&#125;&quot;.format(s_host,s_port))</span><br><span class="line">l_i(&quot;将会连接 &#123;&#125;:&#123;&#125;&quot;.format(d_host,d_port))</span><br><span class="line"></span><br><span class="line">server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">try:</span><br><span class="line">   server_socket.bind((s_host,int(s_port)))</span><br><span class="line">except Exception as e:</span><br><span class="line">   l_a(&quot;绑定 &#123;&#125;:&#123;&#125; 端口失败 &#123;&#125;&quot;.format(s_host,s_port,str(e)))</span><br><span class="line">server_socket.listen(50)      # 应该同时连接不会超过 50 个吧...</span><br><span class="line">l_i(&quot;准备就绪&quot;)</span><br><span class="line">while True:</span><br><span class="line">   request_socket,addr = server_socket.accept()</span><br><span class="line">   l_i(&quot;&#123;&#125; 已连接&quot;.format(request_socket.getpeername()))</span><br><span class="line">   threading.Thread(target=rt,args=(request_socket,)).start()</span><br></pre></td></tr></table></figure><p>进阶 -使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 提交任务 开启jupyterlab </span><br><span class="line"></span><br><span class="line">jupyter-lab --ip 0.0.0.0 --port 8888 --no-browser</span><br><span class="line"></span><br><span class="line">2. 运行端口转发 访问对应端口即可</span><br></pre></td></tr></table></figure><h4 id="如何更改linux下目录所属用户和用户组"><a href="#如何更改linux下目录所属用户和用户组" class="headerlink" title="如何更改linux下目录所属用户和用户组"></a>如何更改linux下目录所属用户和用户组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、更改目录所属的用户必须位于(/etc/passwd)目录下；</span><br><span class="line">执行 chown [-R] 所属用户名 目录名</span><br><span class="line">例: chown cx-root test</span><br><span class="line">2、更改目录所属用户组必须位于(/etc/group)目录下；</span><br><span class="line">执行 chgrp [-R] 所属用户组 目录名</span><br><span class="line">例: chgrp -R cx-root test_dir</span><br><span class="line">3、同时更改文件或目录的所有者和用户组</span><br><span class="line">执行 chown [-R] 所属用户:所属用户组 文件或者目录名</span><br><span class="line">例: chown -R cx-root:cx-root test_dir</span><br></pre></td></tr></table></figure><h4 id="ZIP"><a href="#ZIP" class="headerlink" title="ZIP"></a>ZIP</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">1、把/home目录下面的data目录压缩为data.zip</span></span><br><span class="line">zip -r data.zip data #压缩data目录</span><br><span class="line"><span class="meta">#</span><span class="language-bash">2、把/home目录下面的data.zip解压到databak目录里面</span></span><br><span class="line">unzip data.zip -d databak</span><br><span class="line"><span class="meta">#</span><span class="language-bash">3、把/home目录下面的a文件夹和3.txt压缩成为a123.zip</span></span><br><span class="line">zip -r a123.zip a 3.txt</span><br><span class="line"><span class="meta">#</span><span class="language-bash">4、把/home目录下面的t.zip直接解压到/home目录里面</span></span><br><span class="line">unzip t.zip</span><br><span class="line"><span class="meta">#</span><span class="language-bash">5、把/home目录下面的a1.zip、a2.zip、a3.zip同时解压到/home目录里面</span></span><br><span class="line">unzip a*.zip</span><br><span class="line"><span class="meta">#</span><span class="language-bash">6、把/home目录下面w.zip里面的所有文件解压到第一级目录</span></span><br><span class="line">unzip -j wt.zip</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">linux tar.gz命令是一个常见的文件解压缩命令，那么它具体用法是怎样的呢?下面由学习啦小编为大家整理了linux tar.gz命令的相关知识，希望对大家有帮助!</span><br><span class="line"></span><br><span class="line">1.linux tar.gz压缩命令：</span><br><span class="line"></span><br><span class="line">命令格式：tar -zcvf 压缩文件名.tar.gz 被压缩文件名</span><br><span class="line"></span><br><span class="line">可先切换到当前目录下。压缩文件名和被压缩文件名都可加入路径。</span><br><span class="line"></span><br><span class="line">2.linux tar.gz解压命令：</span><br><span class="line"></span><br><span class="line">命令格式：tar -zxvf 压缩文件名.tar.gz</span><br><span class="line"></span><br><span class="line">解压缩后的文件只能放在当前的目录</span><br><span class="line"></span><br><span class="line">3.补充：其他linux tar解压缩命令</span><br><span class="line"></span><br><span class="line">压缩</span><br><span class="line"></span><br><span class="line">tar –cvf jpg.tar *.jpg //将目录里所有jpg文件打包成tar.jpg</span><br><span class="line"></span><br><span class="line">tar –czf jpg.tar.gz *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用gzip压缩，生成一个gzip压缩过的包，命名为jpg.tar.gz</span><br><span class="line"></span><br><span class="line">tar –cjf jpg.tar.bz2 *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用bzip2压缩，生成一个bzip2压缩过的包，命名为jpg.tar.bz2</span><br><span class="line"></span><br><span class="line">tar –cZf jpg.tar.Z *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用compress压缩，生成一个umcompress压缩过的包，命名为jpg.tar.Z</span><br><span class="line"></span><br><span class="line">rar a jpg.rar *.jpg //rar格式的压缩，需要先下载rar for Linux</span><br><span class="line"></span><br><span class="line">zip jpg.zip *.jpg //zip格式的压缩，需要先下载zip for linux</span><br><span class="line"></span><br><span class="line">解压</span><br><span class="line"></span><br><span class="line">tar –xvf file.tar //解压 tar包</span><br><span class="line"></span><br><span class="line">tar -xzvf file.tar.gz //解压tar.gz</span><br><span class="line"></span><br><span class="line">tar -xjvf file.tar.bz2 //解压 tar.bz2</span><br><span class="line"></span><br><span class="line">tar –xZvf file.tar.Z //解压tar.Z</span><br><span class="line"></span><br><span class="line">unrar e file.rar //解压rar</span><br><span class="line"></span><br><span class="line">unzip file.zip //解压zip</span><br></pre></td></tr></table></figure><h4 id="Linux-clash"><a href="#Linux-clash" class="headerlink" title="Linux clash"></a>Linux clash</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GitHub：https://github.com/bannedbook/fanqiang/wiki</span><br><span class="line">Github: https://git.io/v2free</span><br><span class="line">机场：https://cdn.v2free.net/user </span><br><span class="line">每天签到送400M免费流量</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置Linux 环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">下载 clash：https://github.com/Dreamacro/clash/releases</span><br><span class="line"><span class="meta"># </span><span class="language-bash">我下载amd64 版本</span></span><br><span class="line">wget -O clash.gz https://github.com/Dreamacro/clash/releases/download/v1.10.6/clash-linux-amd64-v1.10.6.gz</span><br><span class="line"><span class="meta"># </span><span class="language-bash">解压到当前文件夹</span></span><br><span class="line">gzip -f clash.gz -d </span><br><span class="line"><span class="meta"># </span><span class="language-bash">授权可执行权限</span></span><br><span class="line">chmod +x clash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">初始化执行 clash</span></span><br><span class="line">./clash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">初始化执行 clash 会默认在 ~/.config/clash/ 目录下生成配置文件和全球IP地址库：config.yaml 和 Country.mmdb</span></span><br><span class="line"></span><br><span class="line">下载 clash 配置文件</span><br><span class="line">wget -U &quot;Mozilla/6.0&quot; -O ~/.config/clash/config.yaml  你的Clash订阅链接网址</span><br><span class="line">./clash &amp; exit</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">开放端口访问 clash 默认 http 端口默认监听 7890 , socks5 端口默认监听 7891</span></span><br><span class="line"></span><br><span class="line">设置代理 ip 和端口号</span><br></pre></td></tr></table></figure><h4 id="Linux-开启网络控制台-RockyLinux"><a href="#Linux-开启网络控制台-RockyLinux" class="headerlink" title="Linux 开启网络控制台 RockyLinux"></a>Linux 开启网络控制台 RockyLinux</h4><p><code>Activate the web console with: systemctl enable --now cockpit.socket</code></p><h4 id="Linux-安装chrome"><a href="#Linux-安装chrome" class="headerlink" title="Linux 安装chrome"></a>Linux 安装chrome</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">获取安装包</span></span><br><span class="line"></span><br><span class="line">wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">安装几个依赖</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">yum install -y lsb</span> </span><br><span class="line"><span class="meta"># </span><span class="language-bash">yum install -y libXScrnSaver</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">yum install liberation-fonts</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">yum install vulkan</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">本地安装</span></span><br><span class="line">yum localinstall google-chrome-stable_current_x86_64.rpm</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">打开google</span></span><br><span class="line">google-chrome</span><br><span class="line"></span><br><span class="line">用户名：xiaozhenniaini@gmail.com</span><br><span class="line">密码：3wnCFk5Kw4s6</span><br></pre></td></tr></table></figure><h4 id="Linux-添加新的硬盘分区"><a href="#Linux-添加新的硬盘分区" class="headerlink" title="Linux 添加新的硬盘分区"></a>Linux 添加新的硬盘分区</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">添加硬盘后 查看分区</span></span><br><span class="line"></span><br><span class="line">lsblk   -f </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">此时只有sdb，因为没有分区，所有没有sdb1</span></span><br></pre></td></tr></table></figure><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20220624191031061.png" alt="image-20220624191031061"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fdisk   /dev/sdb</span><br><span class="line"></span><br><span class="line">1：fdisk   /dev/sdb</span><br><span class="line"></span><br><span class="line">                2：Command（m  for  help）:m</span><br><span class="line"></span><br><span class="line">                3：Command（m  for  help）：n（add  a  new  partition）</span><br><span class="line"></span><br><span class="line">                4：Command   action：e：extend（扩展分区）p（primary  partition）（1-4）可输入p</span><br><span class="line"></span><br><span class="line">                5：partition   number（1-4）输入1</span><br><span class="line"></span><br><span class="line">                6：然后Command（m  for  help）:w（写入磁盘并退出）</span><br><span class="line">                </span><br><span class="line"><span class="meta">#</span><span class="language-bash">添加分区后 查看分区</span></span><br><span class="line"></span><br><span class="line">lsblk   -f </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">但通过lsblk   -f只能看到sdb1，看不到对应的uuid，不能正常使用，需要格式化</span></span><br></pre></td></tr></table></figure><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20220624191231645.png" alt="image-20220624191231645"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">格式化</span></span><br><span class="line">mkfs   -t   ext4   /dev/sdb1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">挂载分区</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">在配置文件 /etc/fstab下最后一行输入一下内容，这里将分区/dev/sdb1挂到 /home/data目录下</span></span><br><span class="line"></span><br><span class="line">/dev/sdb1 /home/data ext4 defaults 0 0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">保存</span></span><br><span class="line"></span><br><span class="line">mount -a</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">挂载成功</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">如果不想挂载想直接加入扩展分区</span></span><br><span class="line">vgscan</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">得到rl分区</span></span><br><span class="line">vgextend rl /dev/sdb1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">扩展想扩展的分区</span></span><br><span class="line"></span><br><span class="line">lvextend -L +180G /dev/mapper/rl-root</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">重新识别分区</span></span><br><span class="line"></span><br><span class="line">xfs_growfs /dev/mapper/rl-root</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看</span></span><br><span class="line">df -h</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Python-实现进度条"><a href="#Python-实现进度条" class="headerlink" title="Python 实现进度条"></a>Python 实现进度条</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pip install tqdm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在进行迭代训练时使用trange即可</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">10</span>): </span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Linux配置Samba共享磁盘"><a href="#Linux配置Samba共享磁盘" class="headerlink" title="Linux配置Samba共享磁盘"></a>Linux配置Samba共享磁盘</h4><p>1 安装Samba服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">前期工作 关闭防火墙 关闭Selinux</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">关闭防火墙</span></span><br><span class="line">sudo systemctl stop firewalld.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">禁止自启动</span></span><br><span class="line">sudo systemctl disable firewalld.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">关闭Selinux 设置为 SELINUX=disabled</span></span><br><span class="line">sudo vi /etc/sysconfig/selinux</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">centos</span></span><br><span class="line">sudo yum -y install samba samba-common samba-client</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">查看samba服务状态，启动服务</span></span><br><span class="line">service smb status //查看samba服务状态</span><br><span class="line">service smb start//启动samba服务</span><br><span class="line">service smb restart//重启samba服务</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">设置开机启动</span></span><br><span class="line">sudo systemctl enable smb.service</span><br><span class="line">sudo systemctl start smb</span><br></pre></td></tr></table></figure><p>2 配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">备份配置文件</span></span><br><span class="line">cp /etc/samba/smb.conf /etc/samba/smb.conf.bak</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">编辑</span></span><br><span class="line">sudo vim  /etc/samba/smb.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">找到cups options = raw 下面加上</span></span><br><span class="line">map to guest = Bad User</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">在最后一行加</span></span><br><span class="line"></span><br><span class="line">[disk]</span><br><span class="line">        path = /home/peak/disk</span><br><span class="line">        public = yes</span><br><span class="line">        writable = yes</span><br><span class="line">        browseable = yes</span><br><span class="line">        guest ok = yes</span><br><span class="line">        valid users = peak</span><br><span class="line">        available = yes</span><br></pre></td></tr></table></figure><p>3 创建访问用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo smbpasswd -a peak   </span><br><span class="line"></span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><h4 id="Linux中crontab-定时任务找不到命令问题"><a href="#Linux中crontab-定时任务找不到命令问题" class="headerlink" title="Linux中crontab 定时任务找不到命令问题"></a>Linux中crontab 定时任务找不到命令问题</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">crontab 定时任务找不到命令问题</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment">### Environments ####</span></span></span><br><span class="line">. ~/.bash_profile</span><br><span class="line">. /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment">#####################</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">下面是要执行的脚本文件，以及参数</span></span><br><span class="line">绝对路径最好</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">要执行的脚本一定要有执行权限。</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">例如：要执行的脚本名称为：myShell.sh</span></span><br><span class="line">chmod 777 myShell.sh</span><br></pre></td></tr></table></figure><h4 id="查看GPU显卡并发送给微信"><a href="#查看GPU显卡并发送给微信" class="headerlink" title="查看GPU显卡并发送给微信"></a>查看GPU显卡并发送给微信</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">title1 = sys.argv[<span class="number">1</span>]</span><br><span class="line">txt1 = sys.argv[<span class="number">2</span>]</span><br><span class="line">title2 = sys.argv[<span class="number">3</span>]</span><br><span class="line">txt2 = sys.argv[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">Secret = <span class="string">&quot;Aly-JNu9VttOcY3wKx8m76IjqfzNtUJ98web-aQns4o&quot;</span></span><br><span class="line">corpid = <span class="string">&#x27;ww41560323f54f5b7b&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=&#123;&#125;&amp;corpsecret=&#123;&#125;&#x27;</span></span><br><span class="line">getr = requests.get(url=url.<span class="built_in">format</span>(corpid, Secret))</span><br><span class="line">access_token = getr.json().get(<span class="string">&#x27;access_token&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送信息</span></span><br><span class="line"><span class="comment"># 微信推送</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weChatPush</span>(<span class="params">title,txt</span>):</span><br><span class="line">    <span class="comment">#print(access_token)</span></span><br><span class="line">    data = &#123;</span><br><span class="line">            <span class="string">&quot;touser&quot;</span>: <span class="string">&quot;@all&quot;</span>,</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="string">&quot;agentid&quot;</span>: <span class="number">1000005</span>,</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: title+ <span class="string">&quot;:\n&quot;</span> + txt</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;safe&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            &#125;</span><br><span class="line">    c = requests.post(url=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(access_token),data=json.dumps(data))</span><br><span class="line">    <span class="comment">#print(c.json)</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"> weChatPush(title1,txt1)</span><br><span class="line">weChatPush(title2,txt2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看显卡命令</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">sleep <span class="number">1</span></span><br><span class="line">/apps/jhinno/unischeduler/<span class="built_in">bin</span>/jsub &lt;/hpcfiles/users/qyf/workDir/sub1.sh</span><br><span class="line"></span><br><span class="line">sleep <span class="number">5</span></span><br><span class="line"></span><br><span class="line">a=$(ls | grep output)</span><br><span class="line">gpu1=$(cat $a | grep -A <span class="number">30</span> <span class="string">&#x27;The output&#x27;</span>)</span><br><span class="line">wx1=$(cat $a | grep  <span class="string">&#x27;MiB&#x27;</span>)</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;*******************************************&quot;</span></span><br><span class="line">echo <span class="string">&quot;****************GPU01**********************&quot;</span></span><br><span class="line">echo <span class="string">&quot;*******************************************&quot;</span></span><br><span class="line">echo <span class="string">&quot;$gpu1&quot;</span></span><br><span class="line">echo <span class="string">&quot;*******************************************&quot;</span></span><br><span class="line">echo <span class="string">&quot;*******************************************&quot;</span></span><br><span class="line"></span><br><span class="line">rm output.*</span><br><span class="line">rm error.*</span><br><span class="line"></span><br><span class="line">/apps/jhinno/unischeduler/<span class="built_in">bin</span>/jsub &lt;/hpcfiles/users/qyf/workDir/sub2.sh</span><br><span class="line"></span><br><span class="line">sleep <span class="number">5</span></span><br><span class="line"></span><br><span class="line">c=$(ls | grep output)</span><br><span class="line">gpu2=$(cat $c | grep -A <span class="number">30</span> <span class="string">&#x27;The output&#x27;</span>)</span><br><span class="line">wx2=$(cat $c | grep  <span class="string">&#x27;MiB&#x27;</span>)</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;*******************************************&quot;</span></span><br><span class="line">echo <span class="string">&quot;****************GPU02**********************&quot;</span></span><br><span class="line">echo <span class="string">&quot;*******************************************&quot;</span></span><br><span class="line">echo <span class="string">&quot;$gpu2&quot;</span></span><br><span class="line">echo <span class="string">&quot;*******************************************&quot;</span></span><br><span class="line">echo <span class="string">&quot;*******************************************&quot;</span></span><br><span class="line"></span><br><span class="line">rm output.*</span><br><span class="line">rm error.*</span><br><span class="line"></span><br><span class="line">/apps/software/anaconda3/<span class="built_in">bin</span>/python /hpcfiles/users/qyf/workDir/Mess.py <span class="string">&quot;GPU01 Info&quot;</span> <span class="string">&quot;$wx1&quot;</span> <span class="string">&quot;GPU02 Info&quot;</span> <span class="string">&quot;$wx2&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="comment">#JSUB -q normal</span></span><br><span class="line"><span class="comment">#JSUB -n 1</span></span><br><span class="line"><span class="comment">#JSUB -m gpu01</span></span><br><span class="line"><span class="comment">#JSUB -e error.%J</span></span><br><span class="line"><span class="comment">#JSUB -o output.%J</span></span><br><span class="line"><span class="comment">#JSUB -J check_task</span></span><br><span class="line">nvidia-smi</span><br><span class="line"></span><br><span class="line">* * * * * bash /hpcfiles/users/qyf/workDir/checkGpu.sh &gt;&gt; /hpcfiles/users/qyf/workDir/GPU.log &amp;</span><br><span class="line"><span class="number">0</span> * * * * bash /hpcfiles/users/qyf/workDir/checkGpu.sh &gt;&gt; /hpcfiles/users/qyf/workDir/GPU.log &amp;</span><br></pre></td></tr></table></figure><h4 id="20220628改进版本"><a href="#20220628改进版本" class="headerlink" title="20220628改进版本"></a>20220628改进版本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">checkGpu.sh</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">gpu1=$(cat /hpcfiles/users/qyf/gpuInfo/gpu01Hour.log | grep  &#x27;MiB&#x27;)</span><br><span class="line">gpu2=$(cat /hpcfiles/users/qyf/gpuInfo/gpu02Hour.log | grep  &#x27;MiB&#x27;)</span><br><span class="line"></span><br><span class="line">/apps/software/anaconda3/bin/python /hpcfiles/users/qyf/gpuInfo/Mess.py &quot;GPU01 Info&quot; &quot;$gpu1&quot; &quot;GPU02 Info&quot; &quot;$gpu2&quot;</span><br><span class="line"></span><br><span class="line">0 * * * * bash /hpcfiles/users/qyf/gpuInfo/checkGpu.sh</span><br></pre></td></tr></table></figure><h4 id="python传入参数"><a href="#python传入参数" class="headerlink" title="python传入参数"></a>python传入参数</h4><p> 使用<code>sys.argv</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">python     script.py    <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>    <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">gpus = sys.argv[<span class="number">1</span>]</span><br><span class="line">batch_size = sys.argv[<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(gpus)</span><br><span class="line"><span class="built_in">print</span>(batch_size)</span><br></pre></td></tr></table></figure><h4 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">rm error.*</span><br><span class="line">rm output.*</span><br><span class="line">jsub -q normal -n 1 -e error.%J -o output.%J -J my_job -m gpu01 nvidia-smi</span><br><span class="line">sleep 1</span><br><span class="line"><span class="meta"># </span><span class="language-bash">a是后面命令返回得结果</span></span><br><span class="line">a=$(ls | grep output)</span><br><span class="line"><span class="meta"># </span><span class="language-bash">b中调用<span class="variable">$a</span></span></span><br><span class="line">b=$(cat $a | grep -A 30 &#x27;The output&#x27;)</span><br><span class="line">echo &quot;*******************************************&quot;</span><br><span class="line">echo &quot;****************GPU01**********************&quot;</span><br><span class="line">echo &quot;*******************************************&quot;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">输出b</span></span><br><span class="line">echo &quot;$b&quot;</span><br><span class="line">echo &quot;*******************************************&quot;</span><br><span class="line">echo &quot;*******************************************&quot;</span><br><span class="line">rm output.*</span><br><span class="line">rm error.*</span><br><span class="line">jsub -q normal -n 1 -e error.%J -o output.%J -J my_job -m gpu02 nvidia-smi</span><br><span class="line">sleep 1</span><br><span class="line">c=$(ls | grep output)</span><br><span class="line">d=$(cat $c | grep -A 30 &#x27;The output&#x27;)</span><br><span class="line">echo &quot;*******************************************&quot;</span><br><span class="line">echo &quot;****************GPU02**********************&quot;</span><br><span class="line">echo &quot;*******************************************&quot;</span><br><span class="line">echo &quot;$d&quot;</span><br><span class="line">echo &quot;*******************************************&quot;</span><br><span class="line">echo &quot;*******************************************&quot;</span><br><span class="line">rm output.*</span><br><span class="line">rm error.*</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="为最小化安装linux配置VNC桌面"><a href="#为最小化安装linux配置VNC桌面" class="headerlink" title="为最小化安装linux配置VNC桌面"></a>为最小化安装linux配置VNC桌面</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">环境说明 CentOS 8</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$ </span><span class="language-bash"><span class="built_in">cat</span> /etc/centos-release</span></span><br><span class="line">Rocky Linux release 8.6 (Green Obsidian)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1 安装桌面</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">需要root权限</span></span><br><span class="line">sudo dnf groupinstall &quot;workstation&quot;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">耗时较长</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">安装桌面</span> </span><br><span class="line">sudo dnf groupinstall &quot;Server with GUI&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2 设置默认启动桌面</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">设置后需要重启服务器</span></span><br><span class="line">sudo systemctl set-default graphical</span><br><span class="line"></span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>3 安装VNC</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">yum 安装VNC service</span></span><br><span class="line">sudo dnf install tigervnc-server tigervnc-server-module</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4 添加用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">sudo vim /etc/tigervnc/vncserver.users</span></span><br><span class="line"></span><br><span class="line">:1=username </span><br><span class="line"><span class="meta"># </span><span class="language-bash">:1表示5901端口 username表示用户名</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5 拷贝模板</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /usr/lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@.service</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">@1.service表示为：1端口创建</span> </span><br><span class="line"><span class="meta"># </span><span class="language-bash">如果多用户，则@2.service</span></span><br></pre></td></tr></table></figure><p>6 设置密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vncpasswd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">设置密码后 Would you like to enter a view-only password (y/n)? 输入n 意思是只读？ 当然要操控所以用 n</span></span><br></pre></td></tr></table></figure><p>7 设置开机启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">:1对应1用户</span></span><br><span class="line">sudo systemctl enable vncserver@:1.service</span><br><span class="line"><span class="meta">#</span><span class="language-bash">启动</span></span><br><span class="line">sudo systemctl start vncserver@:1.service</span><br></pre></td></tr></table></figure><p>8 设置防火墙</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">配置后需要reload</span></span><br><span class="line">sudo firewall-cmd --permanent --add-service vnc-server</span><br><span class="line"></span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>9 测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start vncserver@:1.service</span><br><span class="line">sudo systemctl status vncserver@:1.service</span><br></pre></td></tr></table></figure><p>10 连接</p><h2 id="配置vnc"><a href="#配置vnc" class="headerlink" title="配置vnc"></a>配置vnc</h2><p><a href="https://www.cnblogs.com/xuanbjut/p/14289178.html">https://www.cnblogs.com/xuanbjut/p/14289178.html</a></p><p>添加用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/tigervnc/vncserver.users</span><br><span class="line"></span><br><span class="line">:1=qyf   #对应5901端口</span><br></pre></td></tr></table></figure><p>拷贝模板</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /usr/lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@1.service</span><br><span class="line"><span class="meta"># </span><span class="language-bash">@1.service 对应：1用户</span></span><br></pre></td></tr></table></figure><p>设置密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vncpasswd</span><br><span class="line"></span><br><span class="line">sudo systemctl start vncserver@:1  #对应：1用户</span><br><span class="line"></span><br><span class="line">设置开机启动</span><br><span class="line">sudo systemctl enable vncserver@:1</span><br></pre></td></tr></table></figure><p>开启服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start vncserver@:1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">sudo systemctl start vncserver@:1.service</span></span><br></pre></td></tr></table></figure><p>查看端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tulpn | grep vnc</span><br></pre></td></tr></table></figure><p>配置防火墙</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --add-service vnc-server</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><h4 id="配置青龙面板后-执行python脚本"><a href="#配置青龙面板后-执行python脚本" class="headerlink" title="配置青龙面板后 执行python脚本"></a>配置青龙面板后 执行python脚本</h4><p>1 进入青龙内部</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">进入docker</span></span><br><span class="line">docker exec -it qinglong bash</span><br></pre></td></tr></table></figure><p>2 安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">安装 一些看不懂的依赖</span></span><br><span class="line">apk add --no-cache gcc g++ python python-dev py-pip mysql-dev linux-headers libffi-dev openssl-dev</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">安装 脚本 例如dailycheckin签到</span></span><br><span class="line">pip3 install dailycheckin --upgrade</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment"># 失败时</span></span></span><br><span class="line">apk add --no-cache --virtual .build-deps gcc musl-dev python2-dev python3-dev libffi libffi-dev openssl openssl-dev</span><br><span class="line">pip3 install pip setuptools --upgrade</span><br><span class="line">pip3 install cryptography~=3.2.1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3 执行其他脚本时</p><p>将脚本文件放在 &#x2F;ql&#x2F;scripts&#x2F;目录下，比如&#x2F;ql&#x2F;scripts&#x2F;config.json</p><p>4 执行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">task everphoto.py</span><br><span class="line"></span><br><span class="line">15 8 * * *</span><br></pre></td></tr></table></figure><h4 id="签到文件"><a href="#签到文件" class="headerlink" title="签到文件"></a>签到文件</h4><h5 id="时光相册"><a href="#时光相册" class="headerlink" title="时光相册"></a>时光相册</h5><p>来源：<a href="https://github.com/ICE99125/everphoto_checkin">https://github.com/ICE99125/everphoto_checkin</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment">#import Demjson</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 时光相册签到领空间</span></span><br><span class="line"><span class="comment"># 登录信息 账户，密码</span></span><br><span class="line"><span class="comment"># fork in github : https://github.com/ICE99125/everphoto_checkin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户登录信息</span></span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">&quot;multi&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;account&quot;</span>: <span class="string">&quot;17156087896&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">&quot;abc211314&quot;</span>,</span><br><span class="line">            <span class="string">&quot;push&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment"># together 为 True 时失效, 不写不推送</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;account&quot;</span>: <span class="string">&quot;17806275268&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">&quot;abc211314&quot;</span>,</span><br><span class="line">            <span class="string">&quot;push&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment"># together 为 True 时失效, 不写不推送</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment"># &#123;</span></span><br><span class="line">        <span class="comment">#     &quot;account&quot;: &quot;123&quot;,</span></span><br><span class="line">        <span class="comment">#     &quot;password&quot;: &quot;123&quot;,</span></span><br><span class="line">        <span class="comment">#     &quot;push&quot;: &quot;pushplus&quot;,</span></span><br><span class="line">        <span class="comment"># &#125;,</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;together&quot;</span>: <span class="literal">False</span>, <span class="comment"># 是否合并发送结果, 不写或 True 时合并发送</span></span><br><span class="line">    <span class="string">&quot;push&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment"># 推送类型, together 为 True 或者不写时必须有, 否则不推送</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weChatPush</span>(<span class="params">txt</span>):</span><br><span class="line">    Secret = <span class="string">&quot;GuabRMpWYTIeIkk_Dc-sX5LJi59M_7JfCk9KJrtn8Bs&quot;</span></span><br><span class="line">    corpid = <span class="string">&#x27;ww41560323f54f5b7b&#x27;</span></span><br><span class="line">    url = <span class="string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=&#123;&#125;&amp;corpsecret=&#123;&#125;&#x27;</span></span><br><span class="line">    getr = requests.get(url=url.<span class="built_in">format</span>(corpid, Secret))</span><br><span class="line">    access_token = getr.json().get(<span class="string">&#x27;access_token&#x27;</span>)</span><br><span class="line">    data = &#123;</span><br><span class="line">            <span class="string">&quot;touser&quot;</span>: <span class="string">&quot;@all&quot;</span>,</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="string">&quot;agentid&quot;</span>: <span class="number">1000003</span>,</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: <span class="string">&quot;时光相册签到信息：\n\n&quot;</span> + txt</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;safe&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            &#125;</span><br><span class="line">    requests.post(url=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(access_token),data=json.dumps(data))</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回状态信息</span></span><br><span class="line"><span class="comment">#if res[&quot;status&quot;]: </span></span><br><span class="line"><span class="comment">#             return [</span></span><br><span class="line"><span class="comment">#                 &#123;</span></span><br><span class="line"><span class="comment">#                     &quot;h4&quot;: &#123;</span></span><br><span class="line"><span class="comment">#                         &quot;content&quot;: f&quot;账号: &#123;res[&#x27;account&#x27;]&#125;&quot;,</span></span><br><span class="line"><span class="comment">#                     &#125;</span></span><br><span class="line"><span class="comment">#                 &#125;,</span></span><br><span class="line"><span class="comment">#                 &#123;</span></span><br><span class="line"><span class="comment">#                     &quot;h4&quot;: &#123;</span></span><br><span class="line"><span class="comment">#                         &quot;content&quot;: f&quot;用户名: &#123;res[&#x27;name&#x27;]&#125;&quot;,</span></span><br><span class="line"><span class="comment">#                     &#125;</span></span><br><span class="line"><span class="comment">#                 &#125;,</span></span><br><span class="line"><span class="comment">#                 &#123;</span></span><br><span class="line"><span class="comment">#                     &quot;txt&quot;: &#123;</span></span><br><span class="line"><span class="comment">#                         &quot;content&quot;: res[&quot;message&quot;],</span></span><br><span class="line"><span class="comment">#                     &#125;,</span></span><br><span class="line"><span class="comment">#                     &quot;table&quot;: &#123;</span></span><br><span class="line"><span class="comment">#                         &quot;content&quot;: [</span></span><br><span class="line"><span class="comment">#                             (&quot;描述&quot;, &quot;内容&quot;),</span></span><br><span class="line"><span class="comment">#                             (&quot;今日获得&quot;, f&quot;&#123;res[&#x27;reward&#x27;]&#125;M&quot;),</span></span><br><span class="line"><span class="comment">#                             (&quot;明日获得&quot;, f&quot;&#123;res[&#x27;tomorrow&#x27;]&#125;M&quot;),</span></span><br><span class="line"><span class="comment">#                             (&quot;总共获得&quot;, f&quot;&#123;res[&#x27;total&#x27;]&#125;M&quot;),</span></span><br><span class="line"><span class="comment">#                             (&quot;连续签到&quot;, f&quot;&#123;res[&#x27;continuity&#x27;]&#125;天&quot;),</span></span><br><span class="line"><span class="comment">#                             (&quot;注册时间&quot;, f&quot;&#123;res[&#x27;created&#x27;]&#125;&quot;),</span></span><br><span class="line"><span class="comment">#                             (&quot;注册天数&quot;, f&quot;&#123;res[&#x27;day&#x27;]&#125;天&quot;),</span></span><br><span class="line"><span class="comment">#                         ]</span></span><br><span class="line"><span class="comment">#                     &#125;,</span></span><br><span class="line"><span class="comment">#                 &#125;,</span></span><br><span class="line"><span class="comment">#             ]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        res = fn(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> res[<span class="string">&quot;status&quot;</span>]: </span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;h4&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: <span class="string">f&quot;账号: <span class="subst">&#123;res[<span class="string">&#x27;account&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;txt&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: res[<span class="string">&quot;message&quot;</span>],</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;table&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: [</span><br><span class="line">                            (<span class="string">&quot;今日获得&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;res[<span class="string">&#x27;reward&#x27;</span>]&#125;</span>M&quot;</span>),</span><br><span class="line">                            (<span class="string">&quot;明日获得&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;res[<span class="string">&#x27;tomorrow&#x27;</span>]&#125;</span>M&quot;</span>),</span><br><span class="line">                            (<span class="string">&quot;总共获得&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;res[<span class="string">&#x27;total&#x27;</span>]&#125;</span>M&quot;</span>),</span><br><span class="line">                            (<span class="string">&quot;连续签到&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;res[<span class="string">&#x27;continuity&#x27;</span>]&#125;</span>天&quot;</span>),</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 登录失败 or 签到失败</span></span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;h4&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: <span class="string">f&quot;账号: <span class="subst">&#123;res[<span class="string">&#x27;account&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;txt&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: res[<span class="string">&quot;message&quot;</span>],</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日期字符串格式化</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dateTime_format</span>(<span class="params">dt: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        dl = datetime.strptime(dt, <span class="string">&quot;%Y-%m-%dT%H:%M:%S+08:00&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dl.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;格式化日期时出错, 原因: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Everphoto</span>:</span><br><span class="line">    <span class="comment"># 登录地址</span></span><br><span class="line">    LOGIN_URL = <span class="string">&quot;https://web.everphoto.cn/api/auth&quot;</span></span><br><span class="line">    <span class="comment"># 签到地址</span></span><br><span class="line">    CHECKIN_URL = <span class="string">&quot;https://openapi.everphoto.cn/sf/3/v4/PostCheckIn&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account: <span class="built_in">str</span>, password: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.__account = account</span><br><span class="line">        self.__password = password</span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;EverPhoto/4.5.0 (Android;4050002;MuMu;23;dev)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;application&quot;</span>: <span class="string">&quot;tc.everphoto&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        self.userInfo = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取 md5 加密后的密码</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_pwd_md5</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        salt = <span class="string">&quot;tc.everphoto.&quot;</span></span><br><span class="line">        pwd = salt + self.__password</span><br><span class="line">        md5 = hashlib.md5(pwd.encode())</span><br><span class="line">        <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 登陆</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self, country_code: <span class="built_in">str</span> = <span class="string">&quot;+86&quot;</span></span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&quot;mobile&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;country_code&#125;</span><span class="subst">&#123;self.__account&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&quot;password&quot;</span>: self.get_pwd_md5(),</span><br><span class="line">            &#125;</span><br><span class="line">            res = req.post(</span><br><span class="line">                Everphoto.LOGIN_URL,</span><br><span class="line">                data=data,</span><br><span class="line">                headers=self.headers,</span><br><span class="line">            ).json()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> res.get(<span class="string">&quot;code&quot;</span>) == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;🎉 登录账号 <span class="subst">&#123;self.__account&#125;</span> 成功&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                data = res.get(<span class="string">&quot;data&quot;</span>)</span><br><span class="line"></span><br><span class="line">                self.headers.update(&#123;<span class="string">&quot;authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;data[<span class="string">&#x27;token&#x27;</span>]&#125;</span>&quot;</span>&#125;)</span><br><span class="line">                self.userInfo.update(&#123;</span><br><span class="line">                    <span class="string">&quot;account&quot;</span>: self.__account, <span class="comment"># 账号</span></span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: data[<span class="string">&quot;user_profile&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="comment"># 用户名</span></span><br><span class="line">                    <span class="string">&quot;vip&quot;</span>: data[<span class="string">&quot;user_profile&quot;</span>].get(<span class="string">&quot;vip_level&quot;</span>), <span class="comment"># vip等级</span></span><br><span class="line">                    <span class="string">&quot;created&quot;</span>: dateTime_format(data[<span class="string">&quot;user_profile&quot;</span>][<span class="string">&quot;created_at&quot;</span>]), <span class="comment"># 创建时间</span></span><br><span class="line">                    <span class="string">&quot;day&quot;</span>: data[<span class="string">&quot;user_profile&quot;</span>][<span class="string">&quot;days_from_created&quot;</span>], <span class="comment"># 注册时长</span></span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&quot;status&quot;</span>: <span class="literal">True</span></span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(res.get(<span class="string">&quot;message&quot;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;😭 登录账号 <span class="subst">&#123;self.__account&#125;</span> 时出现错误, 原因: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;message&quot;</span>: e,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 签到</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            headers = &#123;</span><br><span class="line">                <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                <span class="string">&quot;host&quot;</span>: <span class="string">&quot;openapi.everphoto.cn&quot;</span>,</span><br><span class="line">                <span class="string">&quot;connection&quot;</span>: <span class="string">&quot;Keep-Alive&quot;</span>,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            headers.update(self.headers)</span><br><span class="line">            </span><br><span class="line">            res = req.post(</span><br><span class="line">                Everphoto.CHECKIN_URL,</span><br><span class="line">                headers=headers,</span><br><span class="line">            ).json()</span><br><span class="line"></span><br><span class="line">            code = res.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> code == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;🎉 账号 <span class="subst">&#123;self.__account&#125;</span> 签到成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">                data = res.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> data.get(<span class="string">&quot;checkin_result&quot;</span>) <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">                    rwd = data[<span class="string">&quot;reward&quot;</span>] / (<span class="number">1024</span> * <span class="number">1024</span>)  <span class="comment"># 今日获得</span></span><br><span class="line">                    msg = <span class="string">&quot;签到成功&quot;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    rwd = <span class="number">0</span></span><br><span class="line">                    msg = <span class="string">&quot;今日已签到&quot;</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&quot;status&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                    <span class="string">&quot;reward&quot;</span>: rwd,</span><br><span class="line">                    <span class="string">&quot;message&quot;</span>: msg,</span><br><span class="line">                    <span class="string">&quot;continuity&quot;</span>: data.get(<span class="string">&quot;continuity&quot;</span>), <span class="comment"># 连续签到天数</span></span><br><span class="line">                    <span class="string">&quot;total&quot;</span>: data.get(<span class="string">&quot;total_reward&quot;</span>) / (<span class="number">1024</span> * <span class="number">1024</span>), <span class="comment"># 总计获得</span></span><br><span class="line">                    <span class="string">&quot;tomorrow&quot;</span>: data.get(<span class="string">&quot;tomorrow_reward&quot;</span>) / (<span class="number">1024</span> * <span class="number">1024</span>), <span class="comment"># 明日可获得</span></span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">elif</span> code == <span class="number">20104</span>:</span><br><span class="line">                <span class="comment"># 未登录</span></span><br><span class="line">                <span class="keyword">raise</span> Exception(res.get(<span class="string">&#x27;message&#x27;</span>))</span><br><span class="line">            <span class="keyword">elif</span> code == <span class="number">30001</span>:</span><br><span class="line">                <span class="comment"># 服务器内部错误?</span></span><br><span class="line">                <span class="keyword">raise</span> Exception(res.get(<span class="string">&#x27;message&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;账号 <span class="subst">&#123;self.__account&#125;</span> 签到时出现错误, 原因: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;message&quot;</span>: <span class="string">f&quot;签到失败, 原因: <span class="subst">&#123;e&#125;</span>&quot;</span>,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @handler</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        r = self.login()</span><br><span class="line">        <span class="keyword">if</span> r[<span class="string">&quot;status&quot;</span>]:</span><br><span class="line">            res = self.checkin()</span><br><span class="line">            </span><br><span class="line">            result = &#123;&#125;</span><br><span class="line">            result.update(self.userInfo)</span><br><span class="line">            result.update(res)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;status&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;message&quot;</span>: <span class="string">f&quot;登录失败, 原因: <span class="subst">&#123;r[<span class="string">&#x27;message&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">                <span class="string">&quot;account&quot;</span>: self.__account,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">*arg</span>):</span><br><span class="line">    together = config.get(<span class="string">&quot;together&quot;</span>)</span><br><span class="line">    <span class="built_in">type</span> = config.get(<span class="string">&quot;push&quot;</span>)</span><br><span class="line">    multi = config.get(<span class="string">&quot;multi&quot;</span>)</span><br><span class="line">    txt = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    msg_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> multi:</span><br><span class="line">        b = Everphoto(i[<span class="string">&quot;account&quot;</span>], i[<span class="string">&#x27;password&#x27;</span>])</span><br><span class="line">        res = b.start()</span><br><span class="line">        msg_list.extend(res)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> msg_list:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;h4&#x27;</span> <span class="keyword">in</span> i:</span><br><span class="line">            txt =txt + i[<span class="string">&#x27;h4&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]+ <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;txt&#x27;</span> <span class="keyword">in</span> i:</span><br><span class="line">            txt =txt + i[<span class="string">&#x27;txt&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]+ <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;table&#x27;</span> <span class="keyword">in</span> i:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> i[<span class="string">&#x27;table&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]:</span><br><span class="line">                txt =txt + j[<span class="number">0</span>]+<span class="string">&#x27;:&#x27;</span>+ j[<span class="number">1</span>]+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    weChatPush(txt)</span><br><span class="line">    <span class="comment">#print(txt)</span></span><br><span class="line">      </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="UPC"><a href="#UPC" class="headerlink" title="UPC"></a>UPC</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests, time, json, configparser, random, os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟包头</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;X-Requested-With&#x27;</span>: <span class="string">&#x27;XMLHttpRequest&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前的时间</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_time</span>():</span><br><span class="line">    <span class="keyword">return</span> time.strftime(<span class="string">&#x27;%Y%m%d&#x27;</span>, time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 帐号密码信息读取</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getUserInfo</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        usernames = (<span class="string">&#x27;Z20070031&#x27;</span>, )</span><br><span class="line">        passwords = (<span class="string">&#x27;Qyf9999.&#x27;</span>, )</span><br><span class="line">        emails = (<span class="string">&#x27;1490316377@qq.com&#x27;</span>, )</span><br><span class="line"></span><br><span class="line">        <span class="comment">#print(&#x27;get userdata success&#x27;)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">zip</span>(usernames, passwords, emails))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get userdata failed\n %s&#x27;</span> % e)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 帐号密码信息读取</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSMTPInfo</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user = <span class="string">&#x27;1490316377@qq.com&#x27;</span></span><br><span class="line">        password = <span class="string">&#x27;uujoaixwfcdkhdca&#x27;</span></span><br><span class="line">        host = <span class="string">&#x27;smtp.qq.com&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#print(&#x27;get SMTP info success&#x27;)</span></span><br><span class="line">        <span class="keyword">return</span> user, password, host</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;get userdata failed\n %s&#x27;</span> % e)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录并获取old_info</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">userdata</span>):</span><br><span class="line">    login_url = <span class="string">&quot;https://app.upc.edu.cn/uc/wap/login/check&quot;</span></span><br><span class="line">    session = requests.session()</span><br><span class="line">    response = session.post(login_url, headers=headers, data=userdata, timeout=<span class="number">20</span>)</span><br><span class="line">    response.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    <span class="comment"># print(response.text,&#x27;\n&#x27;)</span></span><br><span class="line">    info_url = <span class="string">&quot;https://app.upc.edu.cn/ncov/wap/default/index&quot;</span></span><br><span class="line">    html_info = session.get(info_url, headers=headers, timeout=<span class="number">20</span>)</span><br><span class="line">    html_info.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    <span class="keyword">return</span> session, html_info.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 企业号推送</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weChatPush</span>(<span class="params">txt</span>):</span><br><span class="line">    Secret = <span class="string">&quot;GuabRMpWYTIeIkk_Dc-sX5LJi59M_7JfCk9KJrtn8Bs&quot;</span></span><br><span class="line">    corpid = <span class="string">&#x27;ww41560323f54f5b7b&#x27;</span></span><br><span class="line">    url = <span class="string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=&#123;&#125;&amp;corpsecret=&#123;&#125;&#x27;</span></span><br><span class="line">    getr = requests.get(url=url.<span class="built_in">format</span>(corpid, Secret))</span><br><span class="line">    access_token = getr.json().get(<span class="string">&#x27;access_token&#x27;</span>)</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;touser&quot;</span>: <span class="string">&quot;@all&quot;</span>,</span><br><span class="line">        <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;agentid&quot;</span>: <span class="number">1000003</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;疫情防控\n&quot;</span> + txt</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;safe&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    requests.post(url=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(access_token),</span><br><span class="line">                  data=json.dumps(data))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_info</span>(<span class="params">session, info</span>):</span><br><span class="line">    save_url = <span class="string">&quot;https://app.upc.edu.cn/ncov/wap/default/save&quot;</span></span><br><span class="line">    save_response = session.post(url=save_url, data=info, headers=headers, timeout=<span class="number">20</span>)</span><br><span class="line">    save_response.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    <span class="keyword">return</span> save_response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">userdata, email_address</span>):</span><br><span class="line">    <span class="comment"># 登录返回old_info</span></span><br><span class="line">    session, html = login(userdata)</span><br><span class="line">    <span class="comment"># print(html)</span></span><br><span class="line">    old_info = json.loads(html)[<span class="string">&#x27;d&#x27;</span>][<span class="string">&#x27;oldInfo&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取当前日期</span></span><br><span class="line">    today_date = get_time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重构old_info</span></span><br><span class="line">    old_info[<span class="string">&#x27;date&#x27;</span>] = today_date</span><br><span class="line">    <span class="comment"># print(old_info)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提交信息，对应的接口为save</span></span><br><span class="line">    save_res = save_info(session, old_info)</span><br><span class="line">    <span class="built_in">print</span>(userdata.get(<span class="string">&quot;username&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(json.loads(save_res)[<span class="string">&#x27;m&#x27;</span>]))</span><br><span class="line">    session.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> email_address:</span><br><span class="line">        <span class="comment"># 结束后发送邮件</span></span><br><span class="line">        <span class="keyword">if</span> json.loads(save_res)[<span class="string">&#x27;m&#x27;</span>] == <span class="string">&#x27;操作成功&#x27;</span>:</span><br><span class="line">            <span class="comment">#send_email(&quot;信息填报成功！&quot;, &quot;账号：&quot; + userdata.get(&quot;username&quot;) + &quot;\n结果：&quot; + str(json.loads(save_res)[&#x27;m&#x27;]),</span></span><br><span class="line">            <span class="comment">#           email_address)</span></span><br><span class="line">            <span class="keyword">if</span> (userdata.get(<span class="string">&quot;username&quot;</span>) == <span class="string">&#x27;Z20070031&#x27;</span>):</span><br><span class="line">                weChatPush(<span class="string">&quot;信息填报成功！\n账号：&quot;</span> + userdata.get(<span class="string">&quot;username&quot;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#send_email(&quot;信息填报失败！可能是已经提交过了！&quot;,</span></span><br><span class="line">            <span class="comment">#           &quot;账号：&quot; + userdata.get(&quot;username&quot;) + &quot;\n&quot; + str(json.loads(save_res)[&#x27;m&#x27;]) + &quot;\n请看今天第一个邮件或手动签到！&quot;,</span></span><br><span class="line">            <span class="comment">#           email_address)</span></span><br><span class="line">            <span class="keyword">if</span> (userdata.get(<span class="string">&quot;username&quot;</span>) == <span class="string">&#x27;Z20070031&#x27;</span>):</span><br><span class="line">                weChatPush(<span class="string">&quot;信息填报失败！\n账号：&quot;</span> + userdata.get(<span class="string">&quot;username&quot;</span>) + <span class="string">&quot;\n请看今天第一条信息或手动签到！&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 获取用户信息</span></span><br><span class="line">    userinfos = getUserInfo()</span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())))</span><br><span class="line">    time.sleep(random.randint(<span class="number">300</span>, <span class="number">500</span>))</span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())))</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> userinfos:</span><br><span class="line">        user_data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: user[<span class="number">0</span>],</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: user[<span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        process(user_data, user[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="网易云音乐"><a href="#网易云音乐" class="headerlink" title="网易云音乐"></a>网易云音乐</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 需要在docke内导入几个包</span></span><br><span class="line"><span class="comment"># from Crypto.Cipher import AES</span></span><br><span class="line"><span class="comment"># from future.builtins import int, pow</span></span><br><span class="line"><span class="comment"># pip3 install future</span></span><br><span class="line"><span class="comment"># pip3 install pycrypto</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function, unicode_literals, division, absolute_import</span><br><span class="line"><span class="keyword">import</span> random, hashlib, math, re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> http.cookiejar <span class="keyword">import</span> Cookie</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> future.builtins <span class="keyword">import</span> <span class="built_in">int</span>, <span class="built_in">pow</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># API</span></span><br><span class="line">DEFAULT_TIMEOUT = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">BASE_URL = <span class="string">&quot;http://music.163.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NetEase</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.header = &#123;</span><br><span class="line">            <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip,deflate,sdch&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,gl;q=0.6,zh-TW;q=0.4&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;music.163.com&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://music.163.com&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        self.session = requests.Session()</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toplists</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [l[<span class="number">0</span>] <span class="keyword">for</span> l <span class="keyword">in</span> TOP_LIST_ALL.values()]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_raw_request</span>(<span class="params">self, method, endpoint, data=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">            resp = self.session.get(</span><br><span class="line">                endpoint, params=data, headers=self.header, timeout=DEFAULT_TIMEOUT</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">elif</span> method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">            resp = self.session.post(</span><br><span class="line">                endpoint, data=data, headers=self.header, timeout=DEFAULT_TIMEOUT</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成Cookie对象</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_cookie</span>(<span class="params">self, name, value</span>):</span><br><span class="line">        <span class="keyword">return</span> Cookie(</span><br><span class="line">            version=<span class="number">0</span>,</span><br><span class="line">            name=name,</span><br><span class="line">            value=value,</span><br><span class="line">            port=<span class="literal">None</span>,</span><br><span class="line">            port_specified=<span class="literal">False</span>,</span><br><span class="line">            domain=<span class="string">&quot;music.163.com&quot;</span>,</span><br><span class="line">            domain_specified=<span class="literal">True</span>,</span><br><span class="line">            domain_initial_dot=<span class="literal">False</span>,</span><br><span class="line">            path=<span class="string">&quot;/&quot;</span>,</span><br><span class="line">            path_specified=<span class="literal">True</span>,</span><br><span class="line">            secure=<span class="literal">False</span>,</span><br><span class="line">            expires=<span class="literal">None</span>,</span><br><span class="line">            discard=<span class="literal">False</span>,</span><br><span class="line">            comment=<span class="literal">None</span>,</span><br><span class="line">            comment_url=<span class="literal">None</span>,</span><br><span class="line">            rest=&#123;&#125;,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self, method, path, params=&#123;&#125;, default=&#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>&#125;, custom_cookies=&#123;<span class="string">&#x27;os&#x27;</span>:<span class="string">&#x27;pc&#x27;</span>&#125;</span>):</span><br><span class="line">        endpoint = <span class="string">&quot;&#123;&#125;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(BASE_URL, path)</span><br><span class="line">        csrf_token = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> cookie <span class="keyword">in</span> self.session.cookies:</span><br><span class="line">            <span class="keyword">if</span> cookie.name == <span class="string">&quot;__csrf&quot;</span>:</span><br><span class="line">                csrf_token = cookie.value</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        params.update(&#123;<span class="string">&quot;csrf_token&quot;</span>: csrf_token&#125;)</span><br><span class="line">        data = default</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> custom_cookies.items():</span><br><span class="line">            cookie = self.make_cookie(key, value)</span><br><span class="line">            self.session.cookies.set_cookie(cookie)</span><br><span class="line"></span><br><span class="line">        params = encrypted_request(params)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = self._raw_request(method, endpoint, params)</span><br><span class="line">            data = resp.json()</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            log.error(e)</span><br><span class="line">        <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">            log.error(<span class="string">&quot;Path: &#123;&#125;, response: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path, resp.text[:<span class="number">200</span>]))</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="comment">#self.session.cookies.load()</span></span><br><span class="line">        <span class="keyword">if</span> username.isdigit():</span><br><span class="line">            path = <span class="string">&quot;/weapi/login/cellphone&quot;</span></span><br><span class="line">            params = <span class="built_in">dict</span>(phone=username, password=password, rememberLogin=<span class="string">&quot;true&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># magic token for login</span></span><br><span class="line">            <span class="comment"># see https://github.com/Binaryify/NeteaseCloudMusicApi/blob/master/router/login.js#L15</span></span><br><span class="line">            client_token = (</span><br><span class="line">                <span class="string">&quot;1_jVUMqWEPke0/1/Vu56xCmJpo5vP1grjn_SOVVDzOc78w8OKLVZ2JH7IfkjSXqgfmh&quot;</span></span><br><span class="line">            )</span><br><span class="line">            path = <span class="string">&quot;/weapi/login&quot;</span></span><br><span class="line">            params = <span class="built_in">dict</span>(</span><br><span class="line">                username=username,</span><br><span class="line">                password=password,</span><br><span class="line">                rememberLogin=<span class="string">&quot;true&quot;</span>,</span><br><span class="line">                clientToken=client_token,</span><br><span class="line">            )</span><br><span class="line">        data = self.request(<span class="string">&quot;POST&quot;</span>, path, params)</span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;code&#x27;</span>] == <span class="number">200</span>:</span><br><span class="line">            self.uid = data[<span class="string">&#x27;account&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">            <span class="built_in">print</span>(username+<span class="string">&#x27;登录成功！&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.uid = <span class="number">0</span>            </span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每日签到</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">daily_task</span>(<span class="params">self, is_mobile=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/point/dailyTask&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="number">0</span> <span class="keyword">if</span> is_mobile <span class="keyword">else</span> <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用户歌单</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_playlist</span>(<span class="params">self, uid, offset=<span class="number">0</span>, limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/user/playlist&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(uid=uid, offset=offset, limit=limit, csrf_token=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;playlist&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每日推荐歌单</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recommend_resource</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/discovery/recommend/resource&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path).get(<span class="string">&quot;recommend&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每日推荐歌曲</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recommend_playlist</span>(<span class="params">self, total=<span class="literal">True</span>, offset=<span class="number">0</span>, limit=<span class="number">20</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/discovery/recommend/songs&quot;</span>  <span class="comment"># NOQA</span></span><br><span class="line">        params = <span class="built_in">dict</span>(total=total, offset=offset, limit=limit, csrf_token=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;recommend&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 私人FM</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">personal_fm</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/radio/get&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path).get(<span class="string">&quot;data&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># like</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fm_like</span>(<span class="params">self, songid, like=<span class="literal">True</span>, time=<span class="number">25</span>, alg=<span class="string">&quot;itembased&quot;</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/radio/like&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(</span><br><span class="line">            alg=alg, trackId=songid, like=<span class="string">&quot;true&quot;</span> <span class="keyword">if</span> like <span class="keyword">else</span> <span class="string">&quot;false&quot;</span>, time=time</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)[<span class="string">&quot;code&quot;</span>] == <span class="number">200</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># FM trash</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fm_trash</span>(<span class="params">self, songid, time=<span class="number">25</span>, alg=<span class="string">&quot;RT&quot;</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/radio/trash/add&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(songId=songid, alg=alg, time=time)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)[<span class="string">&quot;code&quot;</span>] == <span class="number">200</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 搜索单曲(1)，歌手(100)，专辑(10)，歌单(1000)，用户(1002) *(type)*</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">self, keywords, stype=<span class="number">1</span>, offset=<span class="number">0</span>, total=<span class="string">&quot;true&quot;</span>, limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/search/get&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(s=keywords, <span class="built_in">type</span>=stype, offset=offset, total=total, limit=limit)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;result&quot;</span>, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 新碟上架</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">new_albums</span>(<span class="params">self, offset=<span class="number">0</span>, limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/album/new&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(area=<span class="string">&quot;ALL&quot;</span>, offset=offset, total=<span class="literal">True</span>, limit=limit)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;albums&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 歌单（网友精选碟） hot||new http://music.163.com/#/discover/playlist/</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">top_playlists</span>(<span class="params">self, category=<span class="string">&quot;全部&quot;</span>, order=<span class="string">&quot;hot&quot;</span>, offset=<span class="number">0</span>, limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/playlist/list&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(</span><br><span class="line">            cat=category, order=order, offset=offset, total=<span class="string">&quot;true&quot;</span>, limit=limit</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;playlists&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">playlist_catelogs</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/playlist/catalogue&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 歌单详情</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">playlist_detail</span>(<span class="params">self, playlist_id</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v3/playlist/detail&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(<span class="built_in">id</span>=playlist_id, total=<span class="string">&quot;true&quot;</span>, limit=<span class="number">1000</span>, n=<span class="number">1000</span>, offest=<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># cookie添加os字段</span></span><br><span class="line">        custom_cookies = <span class="built_in">dict</span>(os=platform.system())</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            self.request(<span class="string">&quot;POST&quot;</span>, path, params, &#123;<span class="string">&quot;code&quot;</span>: -<span class="number">1</span>&#125;, custom_cookies)</span><br><span class="line">            <span class="comment">#.get(&quot;playlist&quot;, &#123;&#125;)</span></span><br><span class="line">            <span class="comment">#.get(&quot;tracks&quot;, [])</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 热门歌手 http://music.163.com/#/discover/artist/</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">top_artists</span>(<span class="params">self, offset=<span class="number">0</span>, limit=<span class="number">100</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/artist/top&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset, total=<span class="literal">True</span>, limit=limit)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;artists&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 热门单曲 http://music.163.com/discover/toplist?id=</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">top_songlist</span>(<span class="params">self, idx=<span class="number">0</span>, offset=<span class="number">0</span>, limit=<span class="number">100</span></span>):</span><br><span class="line">        playlist_id = TOP_LIST_ALL[idx][<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> self.playlist_detail(playlist_id)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 歌手热门歌曲</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">artists</span>(<span class="params">self, artist_id</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/artist/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(artist_id)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path).get(<span class="string">&quot;hotSongs&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_artist_album</span>(<span class="params">self, artist_id, offset=<span class="number">0</span>, limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/artist/albums/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(artist_id)</span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset, total=<span class="literal">True</span>, limit=limit)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;hotAlbums&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># album id --&gt; song id set</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">album</span>(<span class="params">self, album_id</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/album/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(album_id)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)<span class="comment">#.get(&quot;songs&quot;, [])</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">song_comments</span>(<span class="params">self, music_id, offset=<span class="number">0</span>, total=<span class="string">&quot;false&quot;</span>, limit=<span class="number">100</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/resource/comments/R_SO_4_&#123;&#125;/&quot;</span>.<span class="built_in">format</span>(music_id)</span><br><span class="line">        params = <span class="built_in">dict</span>(rid=music_id, offset=offset, total=total, limit=limit)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># song ids --&gt; song urls ( details )</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">songs_detail</span>(<span class="params">self, ids</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v3/song/detail&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(c=json.dumps([&#123;<span class="string">&quot;id&quot;</span>: _<span class="built_in">id</span>&#125; <span class="keyword">for</span> _<span class="built_in">id</span> <span class="keyword">in</span> ids]), ids=json.dumps(ids))</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;songs&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">songs_url</span>(<span class="params">self, ids</span>):</span><br><span class="line">        quality = Config().get(<span class="string">&quot;music_quality&quot;</span>)</span><br><span class="line">        rate_map = &#123;<span class="number">0</span>: <span class="number">320000</span>, <span class="number">1</span>: <span class="number">192000</span>, <span class="number">2</span>: <span class="number">128000</span>&#125;</span><br><span class="line"></span><br><span class="line">        path = <span class="string">&quot;/weapi/song/enhance/player/url&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(ids=ids, br=rate_map[quality])</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;data&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># lyric http://music.163.com/api/song/lyric?os=osx&amp;id= &amp;lv=-1&amp;kv=-1&amp;tv=-1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">song_lyric</span>(<span class="params">self, music_id</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/song/lyric&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(os=<span class="string">&quot;osx&quot;</span>, <span class="built_in">id</span>=music_id, lv=-<span class="number">1</span>, kv=-<span class="number">1</span>, tv=-<span class="number">1</span>)</span><br><span class="line">        lyric = self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;lrc&quot;</span>, &#123;&#125;).get(<span class="string">&quot;lyric&quot;</span>, [])</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> lyric:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> lyric.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">song_tlyric</span>(<span class="params">self, music_id</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/song/lyric&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(os=<span class="string">&quot;osx&quot;</span>, <span class="built_in">id</span>=music_id, lv=-<span class="number">1</span>, kv=-<span class="number">1</span>, tv=-<span class="number">1</span>)</span><br><span class="line">        lyric = self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;tlyric&quot;</span>, &#123;&#125;).get(<span class="string">&quot;lyric&quot;</span>, [])</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> lyric:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> lyric.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 今日最热（0）, 本周最热（10），历史最热（20），最新节目（30）</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">djchannels</span>(<span class="params">self, offset=<span class="number">0</span>, limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/djradio/hot/v1&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(limit=limit, offset=offset)</span><br><span class="line">        channels = self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;djRadios&quot;</span>, [])</span><br><span class="line">        <span class="keyword">return</span> channels</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">djprograms</span>(<span class="params">self, radio_id, asc=<span class="literal">False</span>, offset=<span class="number">0</span>, limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/dj/program/byradio&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(asc=asc, radioId=radio_id, offset=offset, limit=limit)</span><br><span class="line">        programs = self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;programs&quot;</span>, [])</span><br><span class="line">        <span class="keyword">return</span> [p[<span class="string">&quot;mainSong&quot;</span>] <span class="keyword">for</span> p <span class="keyword">in</span> programs]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunpan_songlist</span>(<span class="params">self, offset=<span class="number">0</span>, limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/cloud/get&quot;</span>  <span class="comment"># NOQA</span></span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset, limit=limit, csrf_token=<span class="string">&quot;&quot;</span>)       </span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)<span class="comment">#.get(&quot;data&quot;, [])</span></span><br><span class="line">    <span class="comment"># 歌手信息</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">artist_info</span>(<span class="params">self, artist_id</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/artist/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(artist_id)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path).get(<span class="string">&quot;artist&quot;</span>, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mv_url</span>(<span class="params">self, <span class="built_in">id</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/song/enhance/play/mv/url&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(<span class="built_in">id</span>=<span class="built_in">id</span>, r=<span class="number">1080</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;data&quot;</span>, []) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">artist_sublist</span>(<span class="params">self, offset=<span class="number">0</span>,limit=<span class="number">50</span>,total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/artist/sublist&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset,limit=limit,total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;data&quot;</span>, [])       </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">album_sublist</span>(<span class="params">self, offset=<span class="number">0</span>,limit=<span class="number">50</span>,total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/album/sublist&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset,limit=limit,total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;data&quot;</span>, [])        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">video_sublist</span>(<span class="params">self, offset=<span class="number">0</span>,limit=<span class="number">50</span>,total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/cloudvideo/allvideo/sublist&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset,limit=limit,total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;data&quot;</span>, [])     </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取视频url</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">video_url</span>(<span class="params">self, <span class="built_in">id</span>, resolution=<span class="number">1080</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/cloudvideo/playurl&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(ids=<span class="string">&#x27;[&quot;&#x27;</span> + <span class="built_in">id</span> + <span class="string">&#x27;&quot;]&#x27;</span>,resolution = resolution)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)<span class="comment">#.get(&quot;urls&quot;, [])    </span></span><br><span class="line">    <span class="comment"># 我的数字专辑</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">digitalAlbum_purchased</span>(<span class="params">self, offset=<span class="number">0</span>,limit=<span class="number">50</span>,total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/api/digitalAlbum/purchased&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset,limit=limit,total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;paidAlbums&quot;</span>, []) </span><br><span class="line"></span><br><span class="line">   <span class="comment"># 热门歌手</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">artist_top</span>(<span class="params">self, offset=<span class="number">0</span>,limit=<span class="number">50</span>,total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/artist/top&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset,limit=limit,total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;artists&quot;</span>, [])     </span><br><span class="line">    <span class="comment"># 歌手MV</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">artist_mvs</span>(<span class="params">self, <span class="built_in">id</span>, offset=<span class="number">0</span>,limit=<span class="number">50</span>,total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/artist/mvs&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(artistId=<span class="built_in">id</span>,offset=offset,limit=limit,total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;mvs&quot;</span>, [])         </span><br><span class="line">    <span class="comment"># 新歌速递 全部:0 华语:7 欧美:96 日本:8 韩国:16</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">new_songs</span>(<span class="params">self, areaId=<span class="number">0</span>, total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/discovery/new/songs&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(areaId=areaId, total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;data&quot;</span>, [])  </span><br><span class="line">    <span class="comment"># 相似歌手</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">similar_artist</span>(<span class="params">self, artistid</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/discovery/simiArtist&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(artistid=artistid)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;artists&quot;</span>, [])    </span><br><span class="line">    <span class="comment">#关注用户</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_follow</span>(<span class="params">self, <span class="built_in">id</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/user/follow/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)      </span><br><span class="line">    <span class="comment"># 用户关注列表</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_getfollows</span>(<span class="params">self, <span class="built_in">id</span>, offset=<span class="number">0</span>,limit=<span class="number">50</span>,order=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/user/getfollows/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>)</span><br><span class="line">        params = <span class="built_in">dict</span>(offset=offset,limit=limit,order=order)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;follow&quot;</span>, [])       </span><br><span class="line">    <span class="comment"># 用户粉丝列表</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_getfolloweds</span>(<span class="params">self, <span class="built_in">id</span>, time=-<span class="number">1</span>,limit=<span class="number">50</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/user/getfolloweds/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>)</span><br><span class="line">        params = <span class="built_in">dict</span>(time=time,limit=limit)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)<span class="comment">#.get(&quot;followeds&quot;, [])         </span></span><br><span class="line">    <span class="comment"># 听歌排行 type: 0 全部时间 1最近一周</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">play_record</span>(<span class="params">self, uid, time_type=<span class="number">0</span>,limit=<span class="number">1000</span>,offset=<span class="number">0</span>,total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/play/record&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(uid=uid,<span class="built_in">type</span>=time_type,limit=limit,offset=offset,total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)<span class="comment">#.get(&quot;allData&quot;, [])   #weekData      </span></span><br><span class="line">    <span class="comment"># 推荐mv </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recommend_mv</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/personalized/mv&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path).get(<span class="string">&quot;result&quot;</span>, [])     </span><br><span class="line"></span><br><span class="line">    <span class="comment"># MV排行榜 area: 地区,可选值为内地,港台,欧美,日本,韩国,不填则为全部</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">top_mv</span>(<span class="params">self, area=<span class="string">&#x27;&#x27;</span>, limit=<span class="number">50</span>, offset=<span class="number">0</span>, total=<span class="literal">True</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/mv/toplist&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(area=area,limit=limit,offset=offset,total=total)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params).get(<span class="string">&quot;data&quot;</span>, [])   <span class="comment">#weekData                                         </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建歌单 privacy:0 为普通歌单，10 为隐私歌单；type:NORMAL|VIDEO</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">playlist_creat</span>(<span class="params">self, name, privacy=<span class="number">0</span>, ptype=<span class="string">&#x27;NORMAL&#x27;</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/playlist/create&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(name=name,privacy=privacy,<span class="built_in">type</span>=ptype)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)        </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加MV到视频歌单中</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">playlist_add</span>(<span class="params">self, pid, ids</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/playlist/track/add&quot;</span></span><br><span class="line">        ids = [&#123;<span class="string">&#x27;type&#x27;</span>:<span class="number">3</span>,<span class="string">&#x27;id&#x27;</span>:song_id&#125; <span class="keyword">for</span> song_id <span class="keyword">in</span> ids]</span><br><span class="line">        params = &#123;<span class="string">&#x27;id&#x27;</span>:pid,<span class="string">&#x27;tracks&#x27;</span>: json.dumps(ids)&#125;</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加/删除单曲到歌单</span></span><br><span class="line">    <span class="comment"># op:&#x27;add&#x27;|&#x27;del&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">playlist_tracks</span>(<span class="params">self, pid, ids,op=<span class="string">&#x27;add&#x27;</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/playlist/manipulate/tracks&quot;</span>        </span><br><span class="line">        params = &#123;<span class="string">&#x27;op&#x27;</span>:op,<span class="string">&#x27;pid&#x27;</span>:pid,<span class="string">&#x27;trackIds&#x27;</span>: json.dumps(ids),<span class="string">&#x27;imme&#x27;</span>:<span class="string">&#x27;true&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">artist_songs</span>(<span class="params">self, <span class="built_in">id</span>, limit=<span class="number">50</span>, offset=<span class="number">0</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/artist/songs&quot;</span></span><br><span class="line">        params = <span class="built_in">dict</span>(<span class="built_in">id</span>=<span class="built_in">id</span>,limit=limit,offset=offset,private_cloud=<span class="literal">True</span>,work_type=<span class="number">1</span>,order=<span class="string">&#x27;hot&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打卡</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">daka</span>(<span class="params">self, song_datas</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/feedback/weblog&quot;</span></span><br><span class="line">        songs = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(song_datas)):</span><br><span class="line">            song = &#123;</span><br><span class="line">                <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;play&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;json&#x27;</span>: song_datas[i]</span><br><span class="line">            &#125;</span><br><span class="line">            songs.append(song)</span><br><span class="line">        params = &#123;<span class="string">&#x27;logs&#x27;</span>: json.dumps(songs)&#125;</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)</span><br><span class="line">    <span class="comment"># 用户信息</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_detail</span>(<span class="params">self, uid</span>):  </span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/user/detail/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(uid)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)         </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_level</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/user/level&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连续签到天数、第二天可获得的云贝数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunbei</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/point/today/get&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path).get(<span class="string">&quot;data&quot;</span>, []) </span><br><span class="line">        <span class="comment">#signed_days=resp[&#x27;data&#x27;][&#x27;days&#x27;]</span></span><br><span class="line">        <span class="comment">#yunbei=resp[&#x27;data&#x27;][&#x27;shells&#x27;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 今日签到可获得的云贝数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunbei_today</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/point/today/get&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path).get(<span class="string">&quot;data&quot;</span>, []) </span><br><span class="line">        <span class="comment">#yunbei=resp[&#x27;data&#x27;][&#x27;shells&#x27;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 账号云贝数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunbei_info</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/v1/user/info&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path).get(<span class="string">&quot;userPoint&quot;</span>, [])</span><br><span class="line">        <span class="comment">#yunbei=resp[&#x27;userPoint&#x27;][&#x27;balance&#x27;]   </span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 云贝所有任务</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunbei_task</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/usertool/task/list/all&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)<span class="comment">#.get(&quot;data&quot;, [])</span></span><br><span class="line">        <span class="comment">#tasks=[&#123;&#x27;userTaskId&#x27;:task[&#x27;userTaskId&#x27;],&#x27;taskName&#x27;:task[&#x27;taskName&#x27;],&#x27;taskPoint&#x27;:task[&#x27;taskPoint&#x27;],&#x27;completed&#x27;:task[&#x27;completed&#x27;],&#x27;taskDescription&#x27;:task[&#x27;taskDescription&#x27;]&#125; for task in resp[&#x27;data&#x27;]]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 云贝todo任务</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunbei_task_todo</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/usertool/task/todo/query&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)<span class="comment">#.get(&quot;data&quot;, [])</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 完成云贝任务</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunbei_task_finish</span>(<span class="params">self, userTaskId, depositCode</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/usertool/task/point/receive&quot;</span>        </span><br><span class="line">        params = <span class="built_in">dict</span>(userTaskId=userTaskId,depositCode=depositCode)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params) </span><br><span class="line">        <span class="comment"># &#123;&#x27;code&#x27;: 200, &#x27;message&#x27;: &#x27;SUCCESS&#x27;, &#x27;data&#x27;: True&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 云贝收入</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunbei_receipt</span>(<span class="params">self, limit=<span class="number">10</span>,offset=<span class="number">0</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/store/api/point/receipt&quot;</span>        </span><br><span class="line">        params = <span class="built_in">dict</span>(limit=limit,offset=offset)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 云贝支出</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">yunbei_expense</span>(<span class="params">self, limit=<span class="number">10</span>,offset=<span class="number">0</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/store/api/point/expense&quot;</span>        </span><br><span class="line">        params = <span class="built_in">dict</span>(limit=limit,offset=offset)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)     </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">share_resource</span>(<span class="params">self, <span class="built_in">type</span>=<span class="string">&#x27;playlist&#x27;</span>,msg=<span class="string">&#x27;&#x27;</span>,<span class="built_in">id</span>=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/share/friends/resource&quot;</span>        </span><br><span class="line">        params = <span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="built_in">type</span>,msg=msg,<span class="built_in">id</span>=<span class="built_in">id</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)     </span><br><span class="line">        <span class="comment"># if resp[&#x27;code&#x27;] == 200:</span></span><br><span class="line">        <span class="comment">#     event_id = resp[&#x27;id&#x27;]</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 获取用户动态</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_event</span>(<span class="params">self, uid,limit=<span class="number">30</span>,time=-<span class="number">1</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/event/get/&#123;&#125;&quot;</span>.<span class="built_in">format</span>(uid)        </span><br><span class="line">        params = <span class="built_in">dict</span>(getcounts=<span class="literal">True</span>,time=time,limit=limit,total=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)  </span><br><span class="line">        <span class="comment"># event_ids = [event[&#x27;id&#x27;] for event in resp[&#x27;events&#x27;]]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 删除动态</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">event_delete</span>(<span class="params">self, <span class="built_in">id</span></span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/event/delete&quot;</span>        </span><br><span class="line">        params = <span class="built_in">dict</span>(<span class="built_in">id</span>=<span class="built_in">id</span>)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)</span><br><span class="line">        <span class="comment"># &#123;&#x27;code&#x27;: 200&#125;          </span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删除歌单</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">playlist_delete</span>(<span class="params">self, ids</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/playlist/remove&quot;</span>        </span><br><span class="line">        params = <span class="built_in">dict</span>(ids=ids)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path, params)</span><br><span class="line">        <span class="comment"># &#123;&#x27;code&#x27;: 200&#125;  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_homepage</span>(<span class="params">self,userId</span>):</span><br><span class="line">        path=<span class="string">&quot;/weapi/personal/home/page/user&quot;</span></span><br><span class="line">        params=<span class="built_in">dict</span>(userId=userId)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path,params)    </span><br><span class="line"></span><br><span class="line">    <span class="comment">###########################</span></span><br><span class="line">    <span class="comment"># 音乐人</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 概况</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">musician_data</span>(<span class="params">self</span>):        </span><br><span class="line">        path=<span class="string">&#x27;/weapi/creator/musician/statistic/data/overview/get&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)     </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取任务</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mission_cycle_get</span>(<span class="params">self,actionType=<span class="string">&#x27;&#x27;</span>,platform=<span class="string">&#x27;&#x27;</span></span>):        </span><br><span class="line">        path=<span class="string">&#x27;/weapi/nmusician/workbench/mission/cycle/list&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> actionType==<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> platform == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            params=<span class="built_in">dict</span>(actionType=actionType,platform=platform)</span><br><span class="line">            <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path,params)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 领取云豆</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reward_obtain</span>(<span class="params">self,userMissionId,period</span>):        </span><br><span class="line">        path=<span class="string">&#x27;/weapi/nmusician/workbench/mission/reward/obtain/new&#x27;</span></span><br><span class="line">        params=<span class="built_in">dict</span>(userMissionId=userMissionId,period=period)</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path,params)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 账号云豆数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cloudbean</span>(<span class="params">self</span>):</span><br><span class="line">        path = <span class="string">&quot;/weapi/cloudbean/get&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)      </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_access</span>(<span class="params">self</span>):        </span><br><span class="line">        path=<span class="string">&#x27;/weapi/creator/user/access&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">&quot;POST&quot;</span>, path)         </span><br><span class="line"><span class="comment"># API end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># jiemi</span></span><br><span class="line">__all__ = [<span class="string">&quot;encrypted_id&quot;</span>, <span class="string">&quot;encrypted_request&quot;</span>]</span><br><span class="line"></span><br><span class="line">MODULUS = (</span><br><span class="line">    <span class="string">&quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7&quot;</span></span><br><span class="line">    <span class="string">&quot;b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280&quot;</span></span><br><span class="line">    <span class="string">&quot;104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932&quot;</span></span><br><span class="line">    <span class="string">&quot;575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b&quot;</span></span><br><span class="line">    <span class="string">&quot;3ece0462db0a22b8e7&quot;</span></span><br><span class="line">)</span><br><span class="line">PUBKEY = <span class="string">&quot;010001&quot;</span></span><br><span class="line">NONCE = <span class="string">b&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 歌曲加密算法, 基于https://github.com/yanunon/NeteaseCloudMusic</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypted_id</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    magic = <span class="built_in">bytearray</span>(<span class="string">&quot;3go8&amp;$8*3*3h0k(2)2&quot;</span>, <span class="string">&quot;u8&quot;</span>)</span><br><span class="line">    song_id = <span class="built_in">bytearray</span>(<span class="built_in">id</span>, <span class="string">&quot;u8&quot;</span>)</span><br><span class="line">    magic_len = <span class="built_in">len</span>(magic)</span><br><span class="line">    <span class="keyword">for</span> i, sid <span class="keyword">in</span> <span class="built_in">enumerate</span>(song_id):</span><br><span class="line">        song_id[i] = sid ^ magic[i % magic_len]</span><br><span class="line">    m = hashlib.md5(song_id)</span><br><span class="line">    result = m.digest()</span><br><span class="line">    result = base64.b64encode(result).replace(<span class="string">b&quot;/&quot;</span>, <span class="string">b&quot;_&quot;</span>).replace(<span class="string">b&quot;+&quot;</span>, <span class="string">b&quot;-&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录加密算法, 基于https://github.com/stkevintan/nw_musicbox</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypted_request</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="comment"># type: (<span class="built_in">str</span>) -&gt; <span class="built_in">dict</span></span></span><br><span class="line">    data = json.dumps(text).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    secret = create_key(<span class="number">16</span>)</span><br><span class="line">    params = aes(aes(data, NONCE), secret)</span><br><span class="line">    encseckey = rsa(secret, PUBKEY, MODULUS)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;params&quot;</span>: params, <span class="string">&quot;encSecKey&quot;</span>: encseckey&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes</span>(<span class="params">text, key</span>):</span><br><span class="line">    pad = <span class="number">16</span> - <span class="built_in">len</span>(text) % <span class="number">16</span></span><br><span class="line">    text = text + <span class="built_in">bytearray</span>([pad] * pad)</span><br><span class="line">    encryptor = AES.new(key, <span class="number">2</span>, <span class="string">b&quot;0102030405060708&quot;</span>)</span><br><span class="line">    ciphertext = encryptor.encrypt(text)</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(ciphertext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa</span>(<span class="params">text, pubkey, modulus</span>):</span><br><span class="line">    text = text[::-<span class="number">1</span>]</span><br><span class="line">    rs = <span class="built_in">pow</span>(<span class="built_in">int</span>(binascii.hexlify(text), <span class="number">16</span>), <span class="built_in">int</span>(pubkey, <span class="number">16</span>), <span class="built_in">int</span>(modulus, <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">format</span>(rs, <span class="string">&quot;x&quot;</span>).zfill(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_key</span>(<span class="params">size</span>):</span><br><span class="line">    <span class="keyword">return</span> binascii.hexlify(os.urandom(size))[:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># jiemi end </span></span><br><span class="line"></span><br><span class="line">msg = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">title = <span class="string">&quot;网易云音乐&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 账号信息</span></span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">&quot;users&quot;</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:<span class="string">&quot;17156087896&quot;</span>,            </span><br><span class="line">            <span class="string">&quot;md5&quot;</span>:<span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="string">&quot;abc211314&quot;</span></span><br><span class="line"></span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:<span class="string">&quot;17806275268&quot;</span>,</span><br><span class="line">            <span class="string">&quot;md5&quot;</span>:<span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="string">&quot;abc211314&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">        </span><br><span class="line">    <span class="string">&quot;setting&quot;</span>:&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="string">&quot;serverChan&quot;</span>:&#123; </span><br><span class="line">            <span class="string">&quot;on&quot;</span>:<span class="literal">False</span>,   </span><br><span class="line">            <span class="string">&quot;SCKEY&quot;</span>:<span class="string">&quot;SCU155663T250c7c2cfb1ed174cfd9dfbb93f9edc4601166eb99dec&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;CoolPush&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;on&quot;</span>:<span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;method&quot;</span>:[<span class="string">&quot;send&quot;</span>],</span><br><span class="line">            <span class="string">&quot;Skey&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;sign&quot;</span>:<span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;musician_sign&quot;</span>:<span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;daka&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;on&quot;</span>:<span class="literal">True</span>,</span><br><span class="line">            <span class="string">&quot;full_stop&quot;</span>:<span class="literal">True</span>,     </span><br><span class="line">            <span class="string">&quot;song_number&quot;</span>:<span class="number">1000</span>,</span><br><span class="line">            <span class="string">&quot;sleep_time&quot;</span>:<span class="number">15</span>,</span><br><span class="line">            <span class="string">&quot;upload_num&quot;</span>:<span class="number">300</span>    </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;yunbei&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;share&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;on&quot;</span>:<span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>:[],</span><br><span class="line">                <span class="string">&quot;msg&quot;</span>:[<span class="string">&quot;每日分享&quot;</span>,<span class="string">&quot;今日分享&quot;</span>,<span class="string">&quot;分享歌单&quot;</span>],</span><br><span class="line">                <span class="string">&quot;delete&quot;</span>:<span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;taskName&quot;</span>:<span class="string">&quot;发布动态&quot;</span></span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;, </span><br><span class="line">        <span class="string">&quot;other&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;play_playlists&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;on&quot;</span>:<span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;playlist_ids&quot;</span>:[],</span><br><span class="line">                <span class="string">&quot;times&quot;</span>:<span class="number">1</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;play_albums&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;on&quot;</span>:<span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;album_ids&quot;</span>:[],</span><br><span class="line">                <span class="string">&quot;times&quot;</span>:<span class="number">1</span>                    </span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;play_songs&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;on&quot;</span>:<span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;song_ids&quot;</span>:[],</span><br><span class="line">                <span class="string">&quot;times&quot;</span>:<span class="number">30</span>                      </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,       </span><br><span class="line">        <span class="string">&quot;follow&quot;</span>:<span class="literal">True</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(config)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weChatPush</span>(<span class="params">txt</span>):</span><br><span class="line">    Secret = <span class="string">&quot;GuabRMpWYTIeIkk_Dc-sX5LJi59M_7JfCk9KJrtn8Bs&quot;</span></span><br><span class="line">    corpid = <span class="string">&#x27;ww41560323f54f5b7b&#x27;</span></span><br><span class="line">    url = <span class="string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=&#123;&#125;&amp;corpsecret=&#123;&#125;&#x27;</span></span><br><span class="line">    getr = requests.get(url=url.<span class="built_in">format</span>(corpid, Secret))</span><br><span class="line">    access_token = getr.json().get(<span class="string">&#x27;access_token&#x27;</span>)</span><br><span class="line">    data = &#123;</span><br><span class="line">            <span class="string">&quot;touser&quot;</span>: <span class="string">&quot;@all&quot;</span>,</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="string">&quot;agentid&quot;</span>: <span class="number">1000003</span>,</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: <span class="string">&quot;网易云音乐信息\n&quot;</span> + txt</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;safe&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            &#125;</span><br><span class="line">    requests.post(url=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(access_token),data=json.dumps(data))</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>():</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    <span class="keyword">global</span> title</span><br><span class="line">    title = <span class="string">&quot;网易云音乐&quot;</span></span><br><span class="line">    msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;开始登录：&#x27;</span>)</span><br><span class="line">    setting = config[<span class="string">&#x27;setting&#x27;</span>]</span><br><span class="line">    <span class="comment">#serverChan_url = &#x27;https://sc.ftqq.com/&#x27;+setting[&#x27;serverChan&#x27;][&#x27;SCKEY&#x27;]+&#x27;.send&#x27;</span></span><br><span class="line">    <span class="comment">#serverChan_url2 = &#x27;https://sctapi.ftqq.com/SCT10915TrbGLdfzI6Cwuy6HqOTS4JaW1.send&#x27;</span></span><br><span class="line">    </span><br><span class="line">    user_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> config[<span class="string">&#x27;users&#x27;</span>]:</span><br><span class="line">        user_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;setting&quot;</span> <span class="keyword">in</span> user:</span><br><span class="line">            user_setting = user[<span class="string">&#x27;setting&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user_setting = setting</span><br><span class="line"></span><br><span class="line">        username = user[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> user[<span class="string">&#x27;md5&#x27;</span>]:</span><br><span class="line">            md5_pwd = user[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pwd = user[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">            md5_pwd = hashlib.md5(pwd.encode(encoding=<span class="string">&#x27;UTF-8&#x27;</span>)).hexdigest()</span><br><span class="line">    </span><br><span class="line">        <span class="comment">#登录</span></span><br><span class="line">        music = NetEase()</span><br><span class="line">        login = music.login(username,md5_pwd)        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> login[<span class="string">&quot;code&quot;</span>] == <span class="number">200</span>:    </span><br><span class="line">            music.user_setting = user_setting  </span><br><span class="line">            userType = login[<span class="string">&#x27;profile&#x27;</span>][<span class="string">&#x27;userType&#x27;</span>]</span><br><span class="line">            user_info(music)</span><br><span class="line">            <span class="keyword">if</span> user_setting[<span class="string">&#x27;follow&#x27;</span>]:</span><br><span class="line">                follow(music)</span><br><span class="line">            <span class="keyword">if</span> user_setting[<span class="string">&#x27;sign&#x27;</span>]:</span><br><span class="line">                sign(music)</span><br><span class="line">            <span class="keyword">if</span> user_setting[<span class="string">&#x27;musician_sign&#x27;</span>] <span class="keyword">and</span> userType == <span class="number">4</span>:</span><br><span class="line">                musician_sign(music)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user_setting[<span class="string">&#x27;daka&#x27;</span>][<span class="string">&#x27;on&#x27;</span>]:</span><br><span class="line">                daka(music,user_setting)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_playlists&#x27;</span>][<span class="string">&#x27;on&#x27;</span>]:</span><br><span class="line">                play_playlists(music,user_setting)</span><br><span class="line">            <span class="keyword">if</span> user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_albums&#x27;</span>][<span class="string">&#x27;on&#x27;</span>]:</span><br><span class="line">                play_albums(music,user_setting)</span><br><span class="line">            <span class="keyword">if</span> user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_songs&#x27;</span>][<span class="string">&#x27;on&#x27;</span>]:</span><br><span class="line">                play_songs(music,user_setting)</span><br><span class="line"></span><br><span class="line">            yunbei_task(music,user_setting) </span><br><span class="line">            get_yunbei(music)            </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            title += <span class="string">&#x27;: 登录失败,请检查账号、密码&#x27;</span></span><br><span class="line">            msg += <span class="string">&#x27;用户信息\n- 登录失败，请检查账号、密码\n\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(msg) </span></span><br><span class="line">    weChatPush(msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>(<span class="params">music</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    resp = music.user_detail(music.uid)</span><br><span class="line">    music.listenSongs = resp[<span class="string">&#x27;listenSongs&#x27;</span>]</span><br><span class="line">    msg += <span class="string">&#x27;用户信息\n- 用户名称:&#x27;</span>+resp[<span class="string">&#x27;profile&#x27;</span>][<span class="string">&#x27;nickname&#x27;</span>]+<span class="string">&#x27;\n- 用户ID:&#x27;</span>+<span class="built_in">str</span>(music.uid)+<span class="string">&#x27;\n- 用户等级：&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;level&#x27;</span>])+<span class="string">&#x27;\n- 云贝数量:&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;userPoint&#x27;</span>][<span class="string">&#x27;balance&#x27;</span>])+<span class="string">&#x27;\n- 粉丝数量:&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;profile&#x27;</span>][<span class="string">&#x27;followeds&#x27;</span>])+<span class="string">&#x27;\n- 听歌总数:&#x27;</span>+<span class="built_in">str</span>(music.listenSongs)</span><br><span class="line">    resp = music.user_level()</span><br><span class="line">    music.full=resp[<span class="string">&#x27;full&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp[<span class="string">&#x27;full&#x27;</span>]:</span><br><span class="line">        msg += <span class="string">&#x27;\n- 距离下级还需&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;nextPlayCount&#x27;</span>]-resp[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;nowPlayCount&#x27;</span>])+<span class="string">&#x27;首歌\n- 登录天数:&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;nowLoginCount&#x27;</span>])+<span class="string">&#x27;\n- 距离下级还需登录&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;nextLoginCount&#x27;</span>]-resp[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;nowLoginCount&#x27;</span>])+<span class="string">&#x27;天\n\n&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg += <span class="string">&#x27;\n\n&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">daka</span>(<span class="params">music,user_setting</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    <span class="keyword">global</span> title</span><br><span class="line">    msg +=  <span class="string">&quot;打卡信息\n&quot;</span>  </span><br><span class="line">    <span class="comment"># msg +=  &#x27;- 预计打卡&#x27;+str(total)+&#x27;首\n&#x27;</span></span><br><span class="line">    resp = music.user_level()</span><br><span class="line">    <span class="keyword">if</span> user_setting[<span class="string">&#x27;daka&#x27;</span>][<span class="string">&#x27;full_stop&#x27;</span>] <span class="keyword">and</span> music.full:</span><br><span class="line">        msg +=  <span class="string">&#x27;- 您的等级已经爆表了，无需再打卡\n\n&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">#---------------开始打卡---------------</span></span><br><span class="line">        playlists = music.recommend_resource()</span><br><span class="line">        <span class="comment">#推荐歌单id列表</span></span><br><span class="line">        playlist_ids = [playlist[<span class="string">&quot;id&quot;</span>] <span class="keyword">for</span> playlist <span class="keyword">in</span>  playlists]</span><br><span class="line">                </span><br><span class="line">        total = user_setting[<span class="string">&#x27;daka&#x27;</span>][<span class="string">&#x27;song_number&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># for i in range(user_setting[&#x27;daka&#x27;][&#x27;loop_count&#x27;]):</span></span><br><span class="line">        <span class="comment"># msg +=  &#x27;- 第&#x27;+str(i+1)+&#x27;次打卡\n&#x27;</span></span><br><span class="line">        song_datas = []</span><br><span class="line">        <span class="comment">#打乱歌单id</span></span><br><span class="line">        random.shuffle(playlist_ids)  </span><br><span class="line">        <span class="keyword">for</span> playlist_id <span class="keyword">in</span> playlist_ids:</span><br><span class="line">            <span class="comment">#获得歌单中歌曲的信息</span></span><br><span class="line">            songs = music.playlist_detail(playlist_id).get(<span class="string">&quot;playlist&quot;</span>, &#123;&#125;).get(<span class="string">&quot;tracks&quot;</span>, [])</span><br><span class="line">            <span class="keyword">for</span> song <span class="keyword">in</span> songs:</span><br><span class="line">                song_data=&#123;</span><br><span class="line">                            <span class="string">&quot;type&quot;</span>: <span class="string">&#x27;song&#x27;</span>,</span><br><span class="line">                            <span class="string">&quot;wifi&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                            <span class="string">&quot;download&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                            <span class="string">&quot;id&quot;</span>: song[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">                            <span class="string">&quot;time&quot;</span>: math.ceil(song[<span class="string">&#x27;dt&#x27;</span>]/<span class="number">1000</span>),</span><br><span class="line">                            <span class="string">&quot;end&quot;</span>: <span class="string">&#x27;ui&#x27;</span>,<span class="comment">#playend                    </span></span><br><span class="line">                            <span class="string">&quot;source&quot;</span>:<span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">                            <span class="string">&quot;sourceId&quot;</span>: playlist_id,                                                </span><br><span class="line">                        &#125;</span><br><span class="line">                song_datas.append(song_data)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(song_datas)&gt;=total:</span><br><span class="line">                song_datas = song_datas[<span class="number">0</span>:total]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        num = music.user_setting[<span class="string">&#x27;daka&#x27;</span>][<span class="string">&#x27;upload_num&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(song_datas), num):</span><br><span class="line">            music.daka(song_datas[i:i+num])</span><br><span class="line">            time.sleep(user_setting[<span class="string">&#x27;daka&#x27;</span>][<span class="string">&#x27;sleep_time&#x27;</span>])</span><br><span class="line">            resp = music.user_detail(music.uid)</span><br><span class="line">            <span class="keyword">if</span> (resp[<span class="string">&#x27;listenSongs&#x27;</span>]-music.listenSongs)&gt;=<span class="number">300</span>:</span><br><span class="line">                title = title + <span class="string">&#x27;本次听歌&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;listenSongs&#x27;</span>]-music.listenSongs)+<span class="string">&#x27;首，累计听歌&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;listenSongs&#x27;</span>])+<span class="string">&#x27;首&#x27;</span></span><br><span class="line">                msg += <span class="string">&#x27;- 听歌总数:&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;listenSongs&#x27;</span>])+<span class="string">&#x27;首\n- 本次打卡:&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;listenSongs&#x27;</span>]-music.listenSongs)+<span class="string">&#x27;首\n- 打卡数据更新有延时，请到网易云音乐APP中查看准确信息\n\n&#x27;</span>  </span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#---------------结束打卡---------------</span></span><br><span class="line">        time.sleep(user_setting[<span class="string">&#x27;daka&#x27;</span>][<span class="string">&#x27;sleep_time&#x27;</span>]+<span class="number">5</span>)</span><br><span class="line">        resp = music.user_detail(music.uid)</span><br><span class="line">        title = title + <span class="string">&#x27;本次听歌&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;listenSongs&#x27;</span>]-music.listenSongs)+<span class="string">&#x27;首，累计听歌&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;listenSongs&#x27;</span>])+<span class="string">&#x27;首&#x27;</span></span><br><span class="line">        msg += <span class="string">&#x27;- 听歌总数:&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;listenSongs&#x27;</span>])+<span class="string">&#x27;首\n- 本次打卡:&#x27;</span>+<span class="built_in">str</span>(resp[<span class="string">&#x27;listenSongs&#x27;</span>]-music.listenSongs)+<span class="string">&#x27;首\n- 打卡数据更新有延时，请到网易云音乐APP中查看准确信息\n\n&#x27;</span>   </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play_playlists</span>(<span class="params">music,user_setting</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    msg +=  <span class="string">&quot;播放歌单\n&quot;</span></span><br><span class="line">    playlist_ids = user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_playlists&#x27;</span>][<span class="string">&#x27;playlist_ids&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(playlist_ids) == <span class="number">0</span>:</span><br><span class="line">        msg += <span class="string">&#x27;- 无可播放歌单\n\n&#x27;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    count = user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_playlists&#x27;</span>][<span class="string">&#x27;times&#x27;</span>]</span><br><span class="line">      </span><br><span class="line">    msg +=  <span class="string">&#x27;- 正在播放以下歌单\n&#x27;</span>   </span><br><span class="line">    song_datas = [] </span><br><span class="line">    <span class="keyword">for</span> playlist_id <span class="keyword">in</span> playlist_ids:</span><br><span class="line">        <span class="comment">#获得歌单中歌曲的信息</span></span><br><span class="line">        result = music.playlist_detail(playlist_id)</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] != <span class="number">200</span>:</span><br><span class="line">            msg += <span class="string">&#x27;    - 歌单id: &#123;&#125; 错误\n&#x27;</span>.<span class="built_in">format</span>(playlist_id)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        songs = result.get(<span class="string">&quot;playlist&quot;</span>, &#123;&#125;).get(<span class="string">&quot;tracks&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">        msg += <span class="string">&#x27;    - &#x27;</span>+result[<span class="string">&quot;playlist&quot;</span>][<span class="string">&#x27;name&#x27;</span>]+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> song <span class="keyword">in</span> songs:</span><br><span class="line">            song_data=&#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&#x27;song&#x27;</span>,</span><br><span class="line">                        <span class="string">&quot;wifi&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="string">&quot;download&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: song[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">                        <span class="string">&quot;time&quot;</span>: math.ceil(song[<span class="string">&#x27;dt&#x27;</span>]/<span class="number">1000</span>),</span><br><span class="line">                        <span class="string">&quot;end&quot;</span>: <span class="string">&#x27;ui&#x27;</span>,<span class="comment">#playend                    </span></span><br><span class="line">                        <span class="string">&quot;source&quot;</span>:<span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">                        <span class="string">&quot;sourceId&quot;</span>: playlist_id,                                                </span><br><span class="line">                    &#125;</span><br><span class="line">            song_datas.append(song_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count): </span><br><span class="line">        play(music,song_datas)   </span><br><span class="line">        time.sleep(<span class="number">1</span>)        </span><br><span class="line">    <span class="comment">#---------------结束播放--------------- </span></span><br><span class="line">    msg += <span class="string">&#x27;- 歌单已播放&#x27;</span>+<span class="built_in">str</span>(count)+<span class="string">&#x27;次\n\n&#x27;</span>     </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play_albums</span>(<span class="params">music,user_setting</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    msg +=  <span class="string">&quot;播放专辑\n&quot;</span></span><br><span class="line">    album_ids = user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_albums&#x27;</span>][<span class="string">&#x27;album_ids&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(album_ids) == <span class="number">0</span>:</span><br><span class="line">        msg += <span class="string">&#x27;- 无可播放专辑\n\n&#x27;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    count = user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_albums&#x27;</span>][<span class="string">&#x27;times&#x27;</span>]</span><br><span class="line">      </span><br><span class="line">    msg +=  <span class="string">&#x27;- 正在播放以下专辑\n&#x27;</span>  </span><br><span class="line">    song_datas = []</span><br><span class="line">    <span class="keyword">for</span> album_id <span class="keyword">in</span> album_ids:</span><br><span class="line">        <span class="comment">#获得专辑中歌曲的信息</span></span><br><span class="line">        result = music.album(album_id)</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] != <span class="number">200</span>:</span><br><span class="line">            msg += <span class="string">&#x27;    - 专辑id: &#123;&#125; 错误\n&#x27;</span>.<span class="built_in">format</span>(album_id)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        songs = result.get(<span class="string">&quot;songs&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">        msg += <span class="string">&#x27;    - &#x27;</span>+result[<span class="string">&#x27;album&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> song <span class="keyword">in</span> songs:</span><br><span class="line">            song_data=&#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&#x27;song&#x27;</span>,</span><br><span class="line">                        <span class="string">&quot;wifi&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="string">&quot;download&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: song[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">                        <span class="string">&quot;time&quot;</span>: math.ceil(song[<span class="string">&#x27;dt&#x27;</span>]/<span class="number">1000</span>),</span><br><span class="line">                        <span class="string">&quot;end&quot;</span>: <span class="string">&#x27;ui&#x27;</span>,<span class="comment">#playend                    </span></span><br><span class="line">                        <span class="string">&quot;source&quot;</span>:<span class="string">&#x27;album&#x27;</span>,</span><br><span class="line">                        <span class="string">&quot;sourceId&quot;</span>: album_id,                                                </span><br><span class="line">                    &#125;</span><br><span class="line">            song_datas.append(song_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):           </span><br><span class="line">        play(music,song_datas)   </span><br><span class="line">        time.sleep(<span class="number">0.1</span>)        </span><br><span class="line">    <span class="comment">#---------------结束播放--------------- </span></span><br><span class="line">    msg += <span class="string">&#x27;- 专辑已播放&#x27;</span>+<span class="built_in">str</span>(count)+<span class="string">&#x27;次\n\n&#x27;</span>     </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play_songs</span>(<span class="params">music,user_setting</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    msg +=  <span class="string">&quot;播放歌曲\n&quot;</span>  </span><br><span class="line">    song_ids = user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_songs&#x27;</span>][<span class="string">&#x27;song_ids&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(song_ids) == <span class="number">0</span>:</span><br><span class="line">        msg += <span class="string">&#x27;- 无可播放歌曲\n\n&#x27;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    count = user_setting[<span class="string">&#x27;other&#x27;</span>][<span class="string">&#x27;play_songs&#x27;</span>][<span class="string">&#x27;times&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    msg +=  <span class="string">&#x27;- 正在播放以下歌曲\n&#x27;</span>  </span><br><span class="line">    song_datas = []</span><br><span class="line">    </span><br><span class="line">    temp_datas = []</span><br><span class="line">    <span class="comment">#获得歌曲的信息</span></span><br><span class="line">    songs = music.songs_detail(song_ids)</span><br><span class="line">    <span class="keyword">for</span> song <span class="keyword">in</span> songs:</span><br><span class="line">        msg += <span class="string">&#x27;    - &#x27;</span>+song[<span class="string">&#x27;name&#x27;</span>]+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        song_data=&#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&#x27;song&#x27;</span>,</span><br><span class="line">                    <span class="string">&quot;wifi&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">&quot;download&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="string">&quot;id&quot;</span>: song[<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">                    <span class="string">&quot;time&quot;</span>: math.ceil(song[<span class="string">&#x27;dt&#x27;</span>]/<span class="number">1000</span>),</span><br><span class="line">                    <span class="string">&quot;end&quot;</span>: <span class="string">&#x27;ui&#x27;</span>,<span class="comment">#playend                                                                   </span></span><br><span class="line">                &#125;</span><br><span class="line">        temp_datas.append(song_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count): </span><br><span class="line">        song_datas.extend(temp_datas)  </span><br><span class="line">    play(music,song_datas)   </span><br><span class="line">          </span><br><span class="line">    <span class="comment">#---------------结束播放--------------- </span></span><br><span class="line">    <span class="comment">#account_info = music.user_detail(uid)</span></span><br><span class="line">    msg += <span class="string">&#x27;- 歌曲已播放&#x27;</span>+<span class="built_in">str</span>(count)+<span class="string">&#x27;次\n\n&#x27;</span>         </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">yunbei_task</span>(<span class="params">music,user_setting</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    msg +=  <span class="string">&quot;云贝任务\n&quot;</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    resp = music.yunbei_task()</span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> resp[<span class="string">&#x27;data&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> task[<span class="string">&#x27;userTaskId&#x27;</span>]==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> user_setting[<span class="string">&#x27;yunbei&#x27;</span>][<span class="string">&#x27;share&#x27;</span>][<span class="string">&#x27;taskName&#x27;</span>]==task[<span class="string">&#x27;taskName&#x27;</span>] <span class="keyword">and</span> user_setting[<span class="string">&#x27;yunbei&#x27;</span>][<span class="string">&#x27;share&#x27;</span>][<span class="string">&#x27;on&#x27;</span>]:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(user_setting[<span class="string">&#x27;yunbei&#x27;</span>][<span class="string">&#x27;share&#x27;</span>][<span class="string">&#x27;id&#x27;</span>])&gt;<span class="number">0</span>:</span><br><span class="line">                    playlist_id = random.choice(user_setting[<span class="string">&#x27;yunbei&#x27;</span>][<span class="string">&#x27;share&#x27;</span>][<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    playlists = music.recommend_resource()</span><br><span class="line">                    playlist_ids = [playlist[<span class="string">&quot;id&quot;</span>] <span class="keyword">for</span> playlist <span class="keyword">in</span>  playlists]</span><br><span class="line">                    playlist_id = random.choice(playlist_ids)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(user_setting[<span class="string">&#x27;yunbei&#x27;</span>][<span class="string">&#x27;share&#x27;</span>][<span class="string">&#x27;msg&#x27;</span>])&gt;<span class="number">0</span>:</span><br><span class="line">                    event_msg = random.choice(user_setting[<span class="string">&#x27;yunbei&#x27;</span>][<span class="string">&#x27;share&#x27;</span>][<span class="string">&#x27;msg&#x27;</span>])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    event_msg = <span class="string">&#x27;每日分享&#x27;</span></span><br><span class="line"></span><br><span class="line">                result = music.share_resource(<span class="built_in">type</span>=<span class="string">&#x27;playlist&#x27;</span>,msg=event_msg,<span class="built_in">id</span>=playlist_id)</span><br><span class="line">                <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>]==<span class="number">200</span>:</span><br><span class="line">                    event_id = result[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">                    <span class="keyword">if</span> user_setting[<span class="string">&#x27;yunbei&#x27;</span>][<span class="string">&#x27;share&#x27;</span>][<span class="string">&#x27;delete&#x27;</span>]:</span><br><span class="line">                        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">                        delete_result = music.event_delete(event_id)</span><br><span class="line">                        msg +=  <span class="string">&#x27;- 分享成功，已删除动态\n&#x27;</span> </span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        msg +=  <span class="string">&#x27;- 分享成功\n&#x27;</span> </span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    msg +=  <span class="string">&#x27;- 分享失败:&#123;&#125;\n&#x27;</span>.<span class="built_in">format</span>(result)    </span><br><span class="line"></span><br><span class="line">                time.sleep(<span class="number">2</span>)       </span><br><span class="line">              </span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">0</span>:</span><br><span class="line">        msg += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg += <span class="string">&#x27;- 无可执行的任务\n\n&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_yunbei</span>(<span class="params">music</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    msg +=  <span class="string">&quot;领取云贝\n&quot;</span></span><br><span class="line">    resp = music.yunbei_task_todo()</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> task <span class="keyword">in</span> resp[<span class="string">&#x27;data&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> task[<span class="string">&#x27;userTaskId&#x27;</span>]&gt;<span class="number">0</span>:</span><br><span class="line">            music.yunbei_task_finish(task[<span class="string">&#x27;userTaskId&#x27;</span>], task[<span class="string">&#x27;depositCode&#x27;</span>])</span><br><span class="line">            msg += <span class="string">&#x27;- &#123;&#125;:云贝+&#123;&#125;\n&#x27;</span>.<span class="built_in">format</span>(task[<span class="string">&#x27;taskName&#x27;</span>],task[<span class="string">&#x27;taskPoint&#x27;</span>])</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">0</span>:</span><br><span class="line">        msg += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg += <span class="string">&#x27;- 无可领取的云贝\n\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">play</span>(<span class="params">music,song_datas,sleep_time=<span class="number">0.4</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;upload_num&quot;</span> <span class="keyword">in</span> music.user_setting[<span class="string">&#x27;daka&#x27;</span>]:</span><br><span class="line">        num = music.user_setting[<span class="string">&#x27;daka&#x27;</span>][<span class="string">&#x27;upload_num&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        num = <span class="number">300</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(song_datas), num):</span><br><span class="line">        music.daka(song_datas[i:i+num])</span><br><span class="line">        time.sleep(sleep_time)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">follow</span>(<span class="params">music</span>):</span><br><span class="line">    author_uid = <span class="number">347837981</span></span><br><span class="line">    result = music.user_detail(author_uid)</span><br><span class="line">    <span class="keyword">if</span> music.uid != author_uid <span class="keyword">and</span> <span class="keyword">not</span> result[<span class="string">&#x27;profile&#x27;</span>][<span class="string">&#x27;followed&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(music.user_follow(author_uid))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">music</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    msg+=<span class="string">&#x27;签到信息\n&#x27;</span></span><br><span class="line">    <span class="comment">#---------------开始签到---------------</span></span><br><span class="line">    <span class="comment">#手机端签到</span></span><br><span class="line">    sign_phone = music.daily_task(<span class="literal">True</span>)</span><br><span class="line">    code_phone = sign_phone[<span class="string">&quot;code&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> code_phone == <span class="number">200</span>:</span><br><span class="line">        msg += <span class="string">&quot;- 手机端:签到成功，云贝+&quot;</span> + <span class="built_in">str</span>(sign_phone[<span class="string">&quot;point&quot;</span>])</span><br><span class="line">    <span class="keyword">elif</span> code_phone == -<span class="number">2</span>:</span><br><span class="line">        msg += <span class="string">&quot;- 手机端:重复签到&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg += <span class="string">&quot;- 手机端:未登录&quot;</span>  </span><br><span class="line">    msg += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#桌面端签到</span></span><br><span class="line">    sign_pc = music.daily_task(<span class="literal">False</span>)</span><br><span class="line">    code_pc = sign_pc[<span class="string">&quot;code&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> code_pc == <span class="number">200</span>:</span><br><span class="line">        msg += <span class="string">&quot;- PC端:签到成功，云贝+&quot;</span> + <span class="built_in">str</span>(sign_pc[<span class="string">&quot;point&quot;</span>])</span><br><span class="line">    <span class="keyword">elif</span> code_pc == -<span class="number">2</span>:</span><br><span class="line">        msg += <span class="string">&quot;- PC端:重复签到&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg += <span class="string">&quot;- PC端:未登录&quot;</span> </span><br><span class="line">    msg += <span class="string">&#x27;\n\n&#x27;</span></span><br><span class="line">    <span class="comment">#---------------结束签到---------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">musician_sign</span>(<span class="params">music</span>):</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    msg+=<span class="string">&#x27;音乐人信息\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    access_result = music.user_access()</span><br><span class="line">    result = music.mission_cycle_get()</span><br><span class="line">    <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">200</span>:</span><br><span class="line">        mission_list = result.get(<span class="string">&#x27;data&#x27;</span>,&#123;&#125;).get(<span class="string">&#x27;list&#x27;</span>,[])</span><br><span class="line">        <span class="keyword">for</span> mission <span class="keyword">in</span> mission_list:</span><br><span class="line">            <span class="keyword">if</span> mission[<span class="string">&#x27;status&#x27;</span>] == <span class="number">20</span>:</span><br><span class="line">                description = mission[<span class="string">&#x27;description&#x27;</span>]</span><br><span class="line">                userMissionId = mission[<span class="string">&#x27;userMissionId&#x27;</span>]</span><br><span class="line">                period = mission[<span class="string">&#x27;period&#x27;</span>]</span><br><span class="line">                rewardWorth = mission[<span class="string">&#x27;rewardWorth&#x27;</span>]</span><br><span class="line">                    </span><br><span class="line">                reward_result = music.reward_obtain(userMissionId=userMissionId,period=period)</span><br><span class="line">                <span class="keyword">if</span> reward_result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">200</span>:</span><br><span class="line">                    msg += <span class="string">&quot;- &quot;</span> + description + <span class="string">&quot;:云豆+&quot;</span>+<span class="built_in">str</span>(rewardWorth) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                                </span><br><span class="line">            <span class="keyword">elif</span> mission[<span class="string">&#x27;description&#x27;</span>] == <span class="string">&#x27;每日登录音乐人中心&#x27;</span> <span class="keyword">and</span> mission[<span class="string">&#x27;status&#x27;</span>] == <span class="number">100</span>:</span><br><span class="line">                msg += <span class="string">&quot;- 每日登录音乐人中心:已领取\n&quot;</span></span><br><span class="line"></span><br><span class="line">        info_result = music.musician_data()      </span><br><span class="line">        data = info_result.get(<span class="string">&#x27;data&#x27;</span>,&#123;&#125;)  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;playCount&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 昨日播放量: -- \n&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 昨日播放量:&quot;</span>+<span class="built_in">str</span>(data[<span class="string">&#x27;playCount&#x27;</span>]) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;followerCountIncrement&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 昨日新增粉丝(人): -- \n&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 昨日新增粉丝(人):&quot;</span>+<span class="built_in">str</span>(data[<span class="string">&#x27;followerCountIncrement&#x27;</span>]) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;productionTotal&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 作品(首): -- \n&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 作品(首):&quot;</span>+<span class="built_in">str</span>(data[<span class="string">&#x27;productionTotal&#x27;</span>]) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;availableExtractIncomeTotal&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 可提现余额: -- \n&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 可提现余额:&quot;</span>+<span class="built_in">str</span>(data[<span class="string">&#x27;availableExtractIncomeTotal&#x27;</span>]) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;musicianLevelScore&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 音乐人指数: -- \n&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&quot;- 音乐人指数:&quot;</span>+<span class="built_in">str</span>(data[<span class="string">&#x27;musicianLevelScore&#x27;</span>]) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">        msg += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="WPS"><a href="#WPS" class="headerlink" title="WPS"></a>WPS</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf8 -*-</span></span><br><span class="line"><span class="comment">#-*- codeing =utf-8 -*-</span></span><br><span class="line"><span class="comment">#@Time : 2021/2/8 10:42</span></span><br><span class="line"><span class="comment">#@File : wps签到领空间.py</span></span><br><span class="line"><span class="comment">#@Software : PyCharm</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">wps_sid=<span class="string">&quot;wps_sid=V02SecH4GwO7-a9BOK7-INGAA04c1bo00aaefe2000435d4e79&quot;</span></span><br><span class="line"><span class="comment">#SCKEY = &#x27;SCU155663T250c7c2cfb1ed174cfd9dfbb93f9edc4601166eb99dec&#x27;</span></span><br><span class="line"><span class="comment">#SCKEY2 = &#x27;SCT10915TrbGLdfzI6Cwuy6HqOTS4JaW1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 微信推送</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">weChatPush</span>(<span class="params">txt</span>):</span><br><span class="line">    Secret = <span class="string">&quot;GuabRMpWYTIeIkk_Dc-sX5LJi59M_7JfCk9KJrtn8Bs&quot;</span></span><br><span class="line">    corpid = <span class="string">&#x27;ww41560323f54f5b7b&#x27;</span></span><br><span class="line">    url = <span class="string">&#x27;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=&#123;&#125;&amp;corpsecret=&#123;&#125;&#x27;</span></span><br><span class="line">    getr = requests.get(url=url.<span class="built_in">format</span>(corpid, Secret))</span><br><span class="line">    access_token = getr.json().get(<span class="string">&#x27;access_token&#x27;</span>)</span><br><span class="line">    data = &#123;</span><br><span class="line">            <span class="string">&quot;touser&quot;</span>: <span class="string">&quot;@all&quot;</span>,</span><br><span class="line">            <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="string">&quot;agentid&quot;</span>: <span class="number">1000003</span>,</span><br><span class="line">            <span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: <span class="string">&quot;WPS签到领空间\n&quot;</span> + txt</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;safe&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            &#125;</span><br><span class="line">    requests.post(url=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(access_token),data=json.dumps(data))</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wps</span>():</span><br><span class="line">    url=<span class="string">&quot;https://vip.wps.cn/sign/v2&quot;</span></span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&quot;Cookie&quot;</span>:wps_sid,</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data=&#123;<span class="string">&quot;platform&quot;</span>:<span class="string">&quot;8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;captcha_pos&quot;</span>:<span class="string">&quot;137.00431974731889, 36.00431593261568&quot;</span>,</span><br><span class="line">        <span class="string">&quot;img_witdh&quot;</span>:<span class="string">&quot;275.164&quot;</span>,</span><br><span class="line">        <span class="string">&quot;img_height&quot;</span>:<span class="string">&quot;69.184&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data0=&#123;<span class="string">&quot;platform&quot;</span>:<span class="string">&quot;8&quot;</span>&#125;</span><br><span class="line">    yz_url=<span class="string">&quot;https://vip.wps.cn/checkcode/signin/captcha.png?platform=8&amp;encode=0&amp;img_witdh=275.164&amp;img_height=69.184&quot;</span></span><br><span class="line"></span><br><span class="line">    req=requests.post(url=url,headers=headers,data=data0)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (<span class="string">&quot;msg&quot;</span> <span class="keyword">in</span> req.text):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;wps_sid无效&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;wps_sid无效&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sus=json.loads(req.text)[<span class="string">&quot;result&quot;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;免验证签到--&gt;&quot;</span>+sus)</span><br><span class="line">        <span class="keyword">if</span> sus == <span class="string">&quot;error&quot;</span>:</span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60</span>):</span><br><span class="line">                requests.get(url=yz_url,headers=headers)</span><br><span class="line">                req=requests.post(url=url,headers=headers,data=data)</span><br><span class="line">                sus=json.loads(req.text)[<span class="string">&quot;result&quot;</span>]</span><br><span class="line">                <span class="comment">#print(str(n+1)+&quot;尝试验证签到--&gt;&quot;+sus)</span></span><br><span class="line">                time.sleep(random.randint(<span class="number">0</span>,<span class="number">5</span>)/<span class="number">10</span>)</span><br><span class="line">                <span class="keyword">if</span> sus==<span class="string">&quot;ok&quot;</span>:</span><br><span class="line">                    sus=<span class="string">&quot;成功！&quot;</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            sus=<span class="string">&quot;失败，请手动签到！&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;最终签到结果--&gt;&quot;</span>+sus)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;最终签到结果:&quot;</span>+sus</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    s=wps()</span><br><span class="line">    weChatPush(s)</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="GPU查看显卡显存"><a href="#GPU查看显卡显存" class="headerlink" title="GPU查看显卡显存"></a>GPU查看显卡显存</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看GPU01显卡状态</span></span><br><span class="line">jsub -q normal -n 1 -e error.%J -o output.%J -J my_job -m gpu01 nvidia-smi</span><br><span class="line"><span class="meta"># </span><span class="language-bash"><span class="built_in">cat</span> output.作业号</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看GPU02显卡状态</span></span><br><span class="line">jsub -q normal -n 1 -e error.%J -o output.%J -J my_job -m gpu02 nvidia-smi</span><br><span class="line"><span class="meta"># </span><span class="language-bash"><span class="built_in">cat</span> output.作业号</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="linux用户sudo不输密码-Linux-sudo操作免密码"><a href="#linux用户sudo不输密码-Linux-sudo操作免密码" class="headerlink" title="linux用户sudo不输密码 Linux sudo操作免密码"></a>linux用户sudo不输密码 Linux sudo操作免密码</h4><p>sudo是以管理员权限进行操作，但是需要输入密码，如果想在用sudo时不用输入密码，需要修改<code>/etc/sudoers</code> 文件。</p><p><a href="https://www.jianshu.com/p/82f65fb1fde0">https://www.jianshu.com/p/82f65fb1fde0</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo vi /etc/sudoers</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">在最下面一行加上，下面的username需要改成自己的用户名：</span> </span><br><span class="line"></span><br><span class="line">username ALL=(ALL:ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure><h4 id="Miniconda-安装"><a href="#Miniconda-安装" class="headerlink" title="Miniconda 安装"></a>Miniconda 安装</h4><p>地址 <a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/?C=M&amp;O=D">https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/?C=M&amp;O=D</a></p><h4 id="限制root用户远程登录-只能登录普通用户在登录"><a href="#限制root用户远程登录-只能登录普通用户在登录" class="headerlink" title="限制root用户远程登录 只能登录普通用户在登录"></a>限制root用户远程登录 只能登录普通用户在登录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">将</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">PermitRootLogin <span class="built_in">yes</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">改为</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">PermitRootLogin no</span></span><br><span class="line"></span><br><span class="line">systemctl restart sshd</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="查看jhappform密码"><a href="#查看jhappform密码" class="headerlink" title="查看jhappform密码"></a>查看jhappform密码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cd /apps/jhinno/appform/etc/base/</span><br><span class="line"></span><br><span class="line">cat /apps/jhinno/appform/conf/execproxy/jhlogon/jhlogon.qyf</span><br><span class="line"></span><br><span class="line">./jhencrypt -d mima</span><br></pre></td></tr></table></figure><h4 id="为vscode配置LaTex"><a href="#为vscode配置LaTex" class="headerlink" title="为vscode配置LaTex"></a>为vscode配置LaTex</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 获取ISO文件</span></span><br><span class="line">https://tug.org/texlive/acquire-iso.html</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 下载ISO文件后安装</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20220520143728677.png" alt="image-20220520143728677"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20220520143747575.png" alt="image-20220520143747575"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20220520143926471.png" alt="image-20220520143926471"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/v2-c52fd778b93f735d04d71a5df602d2a8_720w.jpg" alt="img"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20220520144032928.png" alt="image-20220520144032928"></p><h4 id="安装VScode插件"><a href="#安装VScode插件" class="headerlink" title="安装VScode插件"></a>安装VScode插件</h4><p>输入**”latex workshop”**，选择第一个LaTeX Workshop插件；</p><h4 id="按Ctrl-，进入设置页面。"><a href="#按Ctrl-，进入设置页面。" class="headerlink" title="按Ctrl + ，进入设置页面。"></a>按<strong>Ctrl + ，</strong>进入设置页面。</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.autoBuild.run&quot;</span><span class="punctuation">:</span> <span class="string">&quot;never&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.showContextMenu&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.intellisense.package.enabled&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.message.error.show&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.message.warning.show&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-pdf&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-outdir=%OUTDIR%&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.recipes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XeLaTeX&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PDFLaTeX&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BibTeX&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LaTeXmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;latexmk&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex -&gt; bibtex -&gt; xelatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex -&gt; bibtex -&gt; pdflatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.clean.fileTypes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;*.aux&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.bbl&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.blg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.idx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.ind&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.lof&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.lot&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.out&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.toc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.acn&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.acr&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.alg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.glg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.glo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.gls&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.ist&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.fls&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.fdb_latexmk&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.autoClean.run&quot;</span><span class="punctuation">:</span> <span class="string">&quot;onFailed&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.recipe.default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lastUsed&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.view.pdf.internal.synctex.keybinding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;double-click&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="测试文件"><a href="#测试文件" class="headerlink" title="测试文件"></a>测试文件</h4><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">\documentclass</span>[a4paper]&#123;article&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>[margin=1in]&#123;geometry&#125; <span class="comment">% 设置边距，符合Word设定</span></span><br><span class="line"><span class="keyword">\usepackage</span>&#123;ctex&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;lipsum&#125;</span><br><span class="line"><span class="keyword">\title</span>&#123;<span class="keyword">\heiti</span><span class="keyword">\zihao</span>&#123;2&#125; This is a test for vscode&#125;</span><br><span class="line"><span class="keyword">\author</span>&#123;<span class="keyword">\songti</span> Ali-loner&#125;</span><br><span class="line"><span class="keyword">\date</span>&#123;2020.08.02&#125;</span><br><span class="line"><span class="keyword">\begin</span>&#123;document&#125;</span><br><span class="line">    <span class="keyword">\maketitle</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;abstract&#125;</span><br><span class="line">    <span class="keyword">\lipsum</span>[2]</span><br><span class="line"><span class="keyword">\end</span>&#123;abstract&#125;</span><br><span class="line"><span class="keyword">\tableofcontents</span></span><br><span class="line"><span class="keyword">\section</span>&#123;This is a section&#125;</span><br><span class="line">Hello world! 你好，世界 ！</span><br><span class="line"><span class="keyword">\end</span>&#123;document&#125;</span><br></pre></td></tr></table></figure><h4 id="服务器上安装配置jupyter"><a href="#服务器上安装配置jupyter" class="headerlink" title="服务器上安装配置jupyter"></a>服务器上安装配置jupyter</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">更新 pip 安装 jupyter</span></span><br><span class="line">pip install --upgrade pip</span><br><span class="line">pip install jupyter</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">配置一下 参数 生成一个配置文件 几下文件位置 ex：/home/peak/.jupyter/jupyter_notebook_config.py</span></span><br><span class="line">jupyter notebook --generate-config</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">运行python 设置一个密码 登录密码 Qyf9999.</span></span><br><span class="line">from notebook.auth import passwd</span><br><span class="line">passwd()</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">输入2次密码用来登录你的jupyter notebook 此时会生成一个密钥 ex: <span class="string">&#x27;sha1:43b95b731276:5d330ee6f6054613b3ab4cc59c5048ff7c70f549&#x27;</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">修改配置文件 删除前面的<span class="comment">#注释</span></span></span><br><span class="line">vim /home/peak/.jupyter/jupyter_notebook_config.py</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">修改项 允许所有IP访问 前面密码的密钥 默认启动时不打开浏览器 修改端口为8889</span></span><br><span class="line">c.NotebookApp.ip=&#x27;0.0.0.0&#x27;</span><br><span class="line">c.NotebookApp.password = &#x27;sha1:43b95b731276:5d330ee6f6054613b3ab4cc59c5048ff7c70f549&#x27;</span><br><span class="line">c.NotebookApp.open_browser = False</span><br><span class="line">c.NotebookApp.port = 8889</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">保存好后启动 加载配置文件 并把日志保存到指定位置 输入<span class="built_in">exit</span> 退出即可</span></span><br><span class="line">jupyter notebook --config /home/peak/.jupyter/jupyter_notebook_config.py --allow-root &gt; /home/peak/log/log.log &amp; exit</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">如果想要停止 查到进程号后 可以直接 <span class="built_in">kill</span> -9 进程号</span></span><br><span class="line">ps -ef | grep &#x27;jupyter&#x27;</span><br><span class="line">kill -9 进程号</span><br></pre></td></tr></table></figure><h4 id="Jupyter-notebook-指定-Python-解释器"><a href="#Jupyter-notebook-指定-Python-解释器" class="headerlink" title="Jupyter notebook 指定 Python 解释器"></a><strong>Jupyter notebook 指定 Python 解释器</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">创建并进入conda环境 安装ipykernel</span></span><br><span class="line">conda activate Dpt</span><br><span class="line">pip install ipykernel</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">将当前conda环境加入到jupyter中 /opt/miniconda3/envs/Dpt/bin/python是Dpt环境的目录</span></span><br><span class="line">sudo /opt/miniconda3/envs/Dpt/bin/python -m ipykernel install --name Dpt</span><br></pre></td></tr></table></figure><h4 id="Python-文件读写与动态输出"><a href="#Python-文件读写与动态输出" class="headerlink" title="Python 文件读写与动态输出"></a>Python 文件读写与动态输出</h4><p>追加文件内容到文件中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 打开文件 以追加的形式打开</span><br><span class="line">time1  = time.strftime(&#x27;%Y-%m-%d %H:%M:%S&#x27;,time.localtime(time.time()))</span><br><span class="line">file = open(&quot;/home/abc.log&quot;, &quot;a&quot;)</span><br><span class="line">str = &quot;the log file created in &quot; + time1</span><br><span class="line"></span><br><span class="line"># 写入文件缓冲区 + &#x27;\n&#x27;表示换行</span><br><span class="line">file.write( str + &#x27;\n&#x27; )</span><br><span class="line"></span><br><span class="line"># 写入文件中</span><br><span class="line">file.flush()</span><br></pre></td></tr></table></figure><p>读取文件并输出，监控文件变化并输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">tail -f -n 20 file.txt</span><br></pre></td></tr></table></figure><h3 id="建好的环境进行注册，通过gym的标准形式进行调用"><a href="#建好的环境进行注册，通过gym的标准形式进行调用" class="headerlink" title="建好的环境进行注册，通过gym的标准形式进行调用"></a>建好的环境进行注册，通过gym的标准形式进行调用</h3><ol><li><p>将我们自己的环境文件（我创建的文件名为grid_mdp.py)拷贝到你<strong>的gym安装目录</strong>&#x2F;gym&#x2F;gym&#x2F;envs&#x2F;classic_control文件夹中。（拷贝在这个文件夹中因为要使用rendering模块。当然，也有其他办法。该方法不唯一）</p><p>&#x2F;opt&#x2F;miniconda3&#x2F;envs&#x2F;Dpt&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;gym</p></li><li><p>打开该文件夹（第一步中的文件夹）下的__init__.py文件，在文件末尾加入语句：</p></li></ol>   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> gym.envs.classic_control.grid_mdp <span class="keyword">import</span> GridEnv</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>进入文件夹你的gym安装目录&#x2F;gym&#x2F;gym&#x2F;envs，打开该文件夹下的__init__.py文件，添加代码：</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">register(</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span>=<span class="string">&#x27;GridWorld-v0&#x27;</span>,</span><br><span class="line"></span><br><span class="line">entry_point=<span class="string">&#x27;gym.envs.classic_control:GridEnv&#x27;</span>,</span><br><span class="line"></span><br><span class="line">max_episode_steps=<span class="number">200</span>,</span><br><span class="line"></span><br><span class="line">reward_threshold=<span class="number">100.0</span>,</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以通过该id 来调用该环境 env = gym.make(&#x27;GridWorld-v0&#x27;)</span></span><br></pre></td></tr></table></figure><h4 id="VSCode-remote连接服务器"><a href="#VSCode-remote连接服务器" class="headerlink" title="VSCode remote连接服务器"></a>VSCode remote连接服务器</h4><ol><li><p>安装remote development插件</p></li><li><p>配置公玥登录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">在本地的 user/xxx/.ssh/ 下执行生成公玥命令</span></span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">上传到服务器 并添加到密钥登录</span></span><br><span class="line"></span><br><span class="line">scp id_rs.pub 用户名@IP地址:/tmp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">配置 并修改权限</span></span><br><span class="line"> </span><br><span class="line">cat /tmp/id_rs.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">chmod 600 ~/.ssh/authorized_keys</span><br><span class="line">sudo systemctl restart sshd</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>在VSCode中修改配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Host 名称</span><br><span class="line">    HostName IP</span><br><span class="line">    User 用户名</span><br><span class="line">    IdentityFile &quot;C:\Users\yufen\.ssh\id_rsa&quot; # 公玥文件地址</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Host 3090</span><br><span class="line">  HostName 172.19.163.234</span><br><span class="line">  User peak</span><br><span class="line">  port 22</span><br><span class="line">  IdentityFile &quot;C:\\Users\\yufen\\.ssh\\id_rsa&quot;</span><br></pre></td></tr></table></figure></li></ol><h4 id="在VSCode中配置conda"><a href="#在VSCode中配置conda" class="headerlink" title="在VSCode中配置conda"></a>在VSCode中配置conda</h4><ol><li>安装 python 插件</li><li>按“shift+ctrl+p”,搜索 Select Interpreter: 选择并重启VS code 即可。</li><li></li></ol><h4 id="权限相关"><a href="#权限相关" class="headerlink" title="权限相关"></a>权限相关</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">创建用户组</span> </span><br><span class="line">sudo groupadd 组名</span><br><span class="line"><span class="meta">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">更改文件的所属用户组</span></span><br><span class="line">sudo chgrp -R 组名 目录</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">更改文件夹的权限 -R 递归</span></span><br><span class="line">sudo chmod 770 -R 目录/文件名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">为用户添加用户组</span></span><br><span class="line">sudo usermod -a -G 用户名 用户组</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">新建用户并加入用户组</span></span><br><span class="line">sudo adduser -u 用户名 -G 用户组</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看torch版本，cuda是否可用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(torch.__version__)</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())</span><br></pre></td></tr></table></figure><h4 id="UPC-GPU账号认证服务没有开启，"><a href="#UPC-GPU账号认证服务没有开启，" class="headerlink" title="UPC GPU账号认证服务没有开启，"></a>UPC GPU账号认证服务没有开启，</h4><p>开启方法是：使用root登录master，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -X io01</span><br><span class="line">vmware</span><br></pre></td></tr></table></figure><p>开启服务，关闭界面（后台运行vmware）</p><h4 id="SH"><a href="#SH" class="headerlink" title="SH"></a>SH</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">亮屏状态下：screen=`dumpsys window policy | grep mIsShowing | grep <span class="string">&#x27;false&#x27;</span>`   亮屏下有返回值mIsShowing=<span class="literal">false</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">返回</span></span><br><span class="line">input keyevent BACK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">am force-stop com.eg.android.AlipayGphone</span><br><span class="line">sleep 3</span><br><span class="line">am start com.eg.android.AlipayGphone/.FastStartActivity</span><br><span class="line">sleep 3</span><br><span class="line">am startservice com.eg.android.AlipayGphone/com.alipay.android.launcher.service.LauncherService</span><br><span class="line">sleep 1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">启动与停止服务</span></span><br><span class="line">am startservice com.eg.android.AlipayGphone/com.alipay.android.launcher.service.LauncherService</span><br><span class="line">am stopservice com.eg.android.AlipayGphone/com.alipay.android.launcher.service.LauncherService</span><br><span class="line"></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/system/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">唤醒屏幕的脚本</span></span><br><span class="line">LogDir=&quot;/sdcard/Android/Peak/run.log&quot;</span><br><span class="line">startTime=$(date +%m/%d-%H:%M:%S) </span><br><span class="line">echo $startTime&quot; : Start Keep Screen ON &quot; &gt;&gt; $LogDir</span><br><span class="line">screen=`dumpsys window policy | grep mIsShowing | grep &#x27;false&#x27;`   </span><br><span class="line"></span><br><span class="line">if [ -z $screen ]</span><br><span class="line">then</span><br><span class="line">  echo &quot; Now screen is OFF,try to start！&quot; &gt;&gt; $LogDir</span><br><span class="line">  input keyevent 26</span><br><span class="line">  sleep 1</span><br><span class="line">  input swipe 800 2000 800 1200</span><br><span class="line">  sleep 1</span><br><span class="line">else</span><br><span class="line">  echo &quot; Now screen is On,it&#x27;s OK! &quot; &gt;&gt; $LogDir</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">com.eg.android.AlipayGphone</span><br><span class="line"></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/system/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">唤起支付宝脚本</span></span><br><span class="line">LogDir=&quot;/sdcard/Android/Peak/run.log&quot;</span><br><span class="line">startTime=$(date +%m/%d-%H:%M:%S) </span><br><span class="line">echo $startTime&quot; : Start Ali Now &quot; &gt;&gt; $LogDir</span><br><span class="line">COUNT=$(ps -ef |grep payGphone |grep -v &quot;grep&quot; |wc -l)</span><br><span class="line">screen=`dumpsys window policy | grep mIsShowing | grep &#x27;false&#x27;`   </span><br><span class="line"></span><br><span class="line">if [ -z $screen ]</span><br><span class="line">then</span><br><span class="line">  echo &quot; Now screen is OFF,try to start！&quot; &gt;&gt; $LogDir</span><br><span class="line">  input keyevent 26</span><br><span class="line">  sleep 1</span><br><span class="line">  input swipe 800 2000 800 1200</span><br><span class="line">  sleep 1</span><br><span class="line">else</span><br><span class="line">  echo &quot; Now screen is On,it&#x27;s OK! &quot; &gt;&gt; $LogDir</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $COUNT -ne 0 ] ;then</span><br><span class="line">    echo &quot; Ali is runing!&quot; &gt;&gt; $LogDir</span><br><span class="line">    am stopservice com.eg.android.AlipayGphone/com.alipay.android.launcher.service.LauncherService</span><br><span class="line">    sleep 1</span><br><span class="line">    am startservice com.eg.android.AlipayGphone/com.alipay.android.launcher.service.LauncherService</span><br><span class="line">else</span><br><span class="line">    echo &quot; Ali is not run, try to start！&quot; &gt;&gt; $LogDir</span><br><span class="line">    am start com.eg.android.AlipayGphone/.FastStartActivity</span><br><span class="line">    sleep 1</span><br><span class="line">    input keyevent BACK</span><br><span class="line">    am startservice com.eg.android.AlipayGphone/com.alipay.android.launcher.service.LauncherService</span><br><span class="line">    sleep 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/system/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">关闭耗电应用 准备睡觉 QQ 微信 音乐 支付宝 并清理垃圾</span></span><br><span class="line">LogDir=&quot;/sdcard/Android/Peak/run.log&quot;</span><br><span class="line">startTime=$(date +%m/%d-%H:%M:%S) </span><br><span class="line">echo $startTime&quot; : Start Sleep to stop APP&quot; &gt;&gt; $LogDir</span><br><span class="line"></span><br><span class="line">am force-stop com.eg.android.AlipayGphone</span><br><span class="line">am force-stop com.tencent.mm</span><br><span class="line">am force-stop com.tencent.mobileqq</span><br><span class="line">am force-stop com.netease.cloudmusic</span><br><span class="line"></span><br><span class="line">LogDir=&quot;/sdcard/Android/Peak/run.log&quot;</span><br><span class="line">startTime=$(date +%m/%d-%H:%M:%S) </span><br><span class="line">echo $startTime&quot; : Fuck file&quot; &gt;&gt; $LogDir</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> 加载配置文件</span></span><br><span class="line">source /data/adb/modules/CrondStart/sh/FUCK-XXX.conf</span><br><span class="line"><span class="meta"># </span><span class="language-bash"> 读取配置文件</span></span><br><span class="line">for i in $sdcard $Download $Android $SelfDefinition; do</span><br><span class="line"> rm -rf $i ; </span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/system/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">启动常用软件放到后台并锁屏</span></span><br><span class="line">LogDir=&quot;/sdcard/Android/Peak/run.log&quot;</span><br><span class="line">startTime=$(date +%m/%d-%H:%M:%S) </span><br><span class="line">echo $startTime&quot; : Start some APP to background &quot; &gt;&gt; $LogDir</span><br><span class="line">screen=`dumpsys window policy | grep mIsShowing | grep &#x27;false&#x27;`   </span><br><span class="line">am start com.tencent.mm/.ui.LauncherUI</span><br><span class="line">sleep 10</span><br><span class="line">input keyevent BACK</span><br><span class="line">am start com.netease.cloudmusic/.activity.LoadingActivity</span><br><span class="line">sleep 10</span><br><span class="line">input keyevent BACK</span><br><span class="line">am force-stop com.netease.cloudmusic</span><br><span class="line">am force-stop com.eg.android.AlipayGphone</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ -z $screen ]</span><br><span class="line">then</span><br><span class="line">  echo &quot; Now screen is OFF,done！&quot; &gt;&gt; $LogDir</span><br><span class="line">else</span><br><span class="line">  echo &quot; Now screen is On,take it OFF! &quot; &gt;&gt; $LogDir</span><br><span class="line">  input keyevent 26</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Win11关闭小组件"><a href="#Win11关闭小组件" class="headerlink" title="Win11关闭小组件"></a>Win11关闭小组件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">管理员权限打开powershell，输入以下命令：</span></span><br><span class="line">Get-AppxPackage -Name &quot;MicrosoftWindows.Client.WebExperience&quot; -AllUsers | Remove-AppxPackage -AllUsers</span><br></pre></td></tr></table></figure><h3 id="ssh远程链接服务器，避免因断网而中断训练de-方法"><a href="#ssh远程链接服务器，避免因断网而中断训练de-方法" class="headerlink" title="ssh远程链接服务器，避免因断网而中断训练de 方法"></a>ssh远程链接服务器，避免因断网而中断训练de 方法</h3><hr><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">1 链接服务器.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">2 利用screen 命令 ，重起一个新的screen.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">新screen的名字，可以任起</span></span><br><span class="line"></span><br><span class="line">screen -S name </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">3 开始训练.</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">4 可以断开terminal，此时训练不受影响</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">恢复</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">1 启动terminal，查看存在的screen的命令.</span></span><br><span class="line"></span><br><span class="line">screen -ls</span><br><span class="line"></span><br><span class="line">screen -r 30362</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">2 断开当前的screen.</span></span><br><span class="line">按 Ctrl + A， 然后 K 键 然后 y 键</span><br></pre></td></tr></table></figure><h3 id="杀掉端口"><a href="#杀掉端口" class="headerlink" title="杀掉端口"></a>杀掉端口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fuser -k -n tcp 5000</span><br></pre></td></tr></table></figure><h3 id="Vmware-workstation-16许可证"><a href="#Vmware-workstation-16许可证" class="headerlink" title="Vmware workstation 16许可证"></a>Vmware workstation 16许可证</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ZF3R0-FHED2-M80TY-8QYGC-NPKYF</span><br><span class="line">YF390-0HF8P-M81RQ-2DXQE-M2UT6</span><br><span class="line">ZF71R-DMX85-08DQY-8YMNC-PPHV8</span><br><span class="line"></span><br><span class="line">前面的如果已经失效，用下面的</span><br><span class="line"></span><br><span class="line">FA1M0-89YE3-081TQ-AFNX9-NKUC0</span><br></pre></td></tr></table></figure><h4 id="CentOS-8安装docker"><a href="#CentOS-8安装docker" class="headerlink" title="CentOS 8安装docker"></a>CentOS 8安装docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">更新yum 安装依赖</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">添加yum源</span></span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">安装</span></span><br><span class="line">yum install docker-ce</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">启动并设置开机自启动</span></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">验证</span></span><br><span class="line">docker version</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">安装青龙面板</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">安装nvjdc   目录之间映射关系</span></span><br><span class="line">docker run   --name nvjdc -p 5702:80 -d  -v  /home/qyf/workspace/nvjdc/Config.json:/app/Config/Config.json:ro \-v /home/qyf/workspace/nvjdc/.local-chromium:/app/.local-chromium  \-it --privileged=true  nolanhzy/nvjdc:0.8</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">安装chromium</span></span><br><span class="line">docker container ls -a</span><br><span class="line"> yum install unzip</span><br><span class="line"> cd /home/qyf/workspace/nvjdc/</span><br><span class="line"> mkdir -p  .local-chromium/Linux-884014 &amp;&amp; cd .local-chromium/Linux-884014</span><br><span class="line"> wget https://mirrors.huaweicloud.com/chromium-browser-snapshots/Linux_x64/884014/chrome-linux.zip &amp;&amp; unzip chrome-linux.zip</span><br><span class="line"> unzip chrome-linux.zip</span><br><span class="line"> docker restart nvjdc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">reboot后如何重新启用青龙面板</span> </span><br><span class="line">docker exec -it qinglong bash</span><br><span class="line">cd /ql/ninja/backend</span><br><span class="line">pm2 start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker exec -it qinglong nginx -c /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">查看</span></span><br><span class="line"></span><br><span class="line">防火墙某个端口是否开放</span><br><span class="line"></span><br><span class="line">firewall-cmd --query-port=3306/tcp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">开放防火墙端口3306</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=8889/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=5000/tcp --permanent</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">注意：开放端口后要重启防火墙生效</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">重启防火墙</span></span><br><span class="line"></span><br><span class="line">systemctl restart firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">关闭防火墙端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --remove-port=3306/tcp --permanent</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">查看防火墙状态</span></span><br><span class="line"></span><br><span class="line">systemctl status firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">关闭防火墙</span></span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">打开防火墙</span></span><br><span class="line"></span><br><span class="line">systemctl start firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">开放一段端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=40000-45000/tcp --permanent</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">查看开放的端口列表</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">查看被监听(Listen)的端口</span></span><br><span class="line"></span><br><span class="line">netstat -lntp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">检查端口被哪个进程占用</span></span><br><span class="line"></span><br><span class="line">netstat -lnp|grep 3306</span><br></pre></td></tr></table></figure><h3 id="UPC-1"><a href="#UPC-1" class="headerlink" title="UPC"></a>UPC</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">监控服务启动  status状态</span></span><br><span class="line">/etc/init.d/jhinsight-jhdc start</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 1 Linux 安装Conda环境</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#下载</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 上传到服务器</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 安装 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看torch版本，cuda是否可用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(torch.__version__)</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())</span><br></pre></td></tr></table></figure><h4 id="Conda-迁移"><a href="#Conda-迁移" class="headerlink" title="Conda 迁移"></a>Conda 迁移</h4><p>Step1：在想要迁移的虚拟环境sample中安装conda-pack工具包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source activate sample</span><br><span class="line">conda install conda-pack</span><br><span class="line">conda install -c conda-forge conda-pack</span><br></pre></td></tr></table></figure><p>或者采用pip安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install conda-pack  #pip install git+https://github.com/conda/conda-pack.git</span><br></pre></td></tr></table></figure><p>Step2：将当前虚拟环境sample打包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conda-pack</span><br><span class="line">ls</span><br><span class="line"><span class="meta"># </span><span class="language-bash">example.tar.gz 即为打包完成的输出文件</span></span><br><span class="line">source deactivate</span><br></pre></td></tr></table></figure><p>Step3：将example.tar.gz迁移到其他路径或其他机器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv example.tar.gz ~/computer_two</span><br></pre></td></tr></table></figure><p>Step4：在另一台机器上解包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd ~/computer_two/</span><br><span class="line"><span class="meta"># </span><span class="language-bash">example.tar.gz 即为迁移过来的环境包</span></span><br><span class="line">mkdir myenv</span><br><span class="line">tar -xf example.tar.gz -C myenv</span><br><span class="line">ls</span><br><span class="line"><span class="meta"># </span><span class="language-bash">example.tar.gz myenv</span></span><br></pre></td></tr></table></figure><p>Step5：激活虚拟环境</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source myenv/bin/activate</span><br></pre></td></tr></table></figure><h2 id="修改IP地址"><a href="#修改IP地址" class="headerlink" title="修改IP地址"></a>修改IP地址</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">ip addr  #查看当前网卡名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">- 修改网卡配置文件</span></span><br><span class="line"></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens192 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BOOTPROTO=static # 网络模式 -- 固定</span><br><span class="line">ONBOOT=yes # 重启更新</span><br><span class="line">IPADDR=192.168.8.75 # 配置当前节点 IP</span><br><span class="line">NETMASK=255.255.255.0 # 子网掩码</span><br><span class="line">GATEWAY=192.168.1.1 # 网关</span><br><span class="line">DNS1=8.8.8.8 # dns</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">创建用户加入用户组</span></span><br><span class="line"></span><br><span class="line">sudo adduser user1</span><br><span class="line"><span class="meta">#</span><span class="language-bash">为用户创建密码方法如下</span></span><br><span class="line">sudo passwd user1</span><br><span class="line"><span class="meta">#</span><span class="language-bash">删除用户</span></span><br><span class="line">sudo userdel -r user1</span><br><span class="line"><span class="meta">#</span><span class="language-bash">为用户添加sudo</span></span><br><span class="line">sudo usermod -a -G wheel user1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">重启网卡</span></span><br><span class="line"></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="版本-内核"><a href="#版本-内核" class="headerlink" title="版本 内核"></a>版本 内核</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">unme -a #查看内核版本</span><br><span class="line"></span><br><span class="line">CentOS Linux release 8.4.2105</span><br><span class="line"></span><br><span class="line">cat /etc/redhat-release</span><br><span class="line"></span><br><span class="line">cat /etc/*release #查看系统版本</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="GPU运行"><a href="#GPU运行" class="headerlink" title="GPU运行"></a>GPU运行</h2><p>nvidia-smi</p><h2 id="配置vnc-1"><a href="#配置vnc-1" class="headerlink" title="配置vnc"></a>配置vnc</h2><p><a href="https://www.cnblogs.com/xuanbjut/p/14289178.html">https://www.cnblogs.com/xuanbjut/p/14289178.html</a></p><p>添加用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/tigervnc/vncserver.users</span><br><span class="line"></span><br><span class="line">:1=qyf   #对应5901端口</span><br></pre></td></tr></table></figure><p>拷贝模板</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /usr/lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@1.service</span><br><span class="line"><span class="meta"># </span><span class="language-bash">@1.service 对应：1用户</span></span><br></pre></td></tr></table></figure><p>设置密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vncpasswd</span><br><span class="line"></span><br><span class="line">sudo systemctl start vncserver@:1  #对应：1用户</span><br><span class="line"></span><br><span class="line">设置开机启动</span><br><span class="line">sudo systemctl enable vncserver@:1</span><br></pre></td></tr></table></figure><p>开启服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start vncserver@:1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">sudo systemctl start vncserver@:1.service</span></span><br></pre></td></tr></table></figure><p>查看端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -tulpn | grep vnc</span><br></pre></td></tr></table></figure><p>配置防火墙</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --add-service vnc-server</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2 id="miniconda安装"><a href="#miniconda安装" class="headerlink" title="miniconda安装"></a>miniconda安装</h2><p><a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/">https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/</a></p><p>下载conda</p><h2 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h2><p>jps</p><h2 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h2><p>sudo systemctl stop firewalld</p><p>start开启</p><h2 id="windows-minconda安装"><a href="#windows-minconda安装" class="headerlink" title="windows minconda安装"></a>windows minconda安装</h2><p><a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/">https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/</a></p><p><a href="https://zhuanlan.zhihu.com/p/102564715">https://zhuanlan.zhihu.com/p/102564715</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">首先在conda的终端激活自己想要迁移的环境</span><br><span class="line"></span><br><span class="line">conda activate your_env</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">然后生成自己的环境文件</span><br><span class="line"></span><br><span class="line">conda env export &gt; your_env.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在另一台机器上的conda终端克隆迁移的环境即可</span><br><span class="line"></span><br><span class="line">conda env create -f your_env.yaml</span><br><span class="line">pip导出安装的库到requirements.txt</span><br><span class="line"></span><br><span class="line"> pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure><h2 id="GPU路径"><a href="#GPU路径" class="headerlink" title="GPU路径"></a>GPU路径</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">currenth = <span class="string">&#x27;/hpcfiles/users/qyf/project/DeepRL_Algorithms-master&#x27;</span></span><br><span class="line">sys.path.append(currenth)</span><br></pre></td></tr></table></figure><h2 id="快速跳转到上N层目录"><a href="#快速跳转到上N层目录" class="headerlink" title="快速跳转到上N层目录"></a>快速跳转到上N层目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line">结尾添加别名</span><br><span class="line">alias cd1=&#x27;cd ..&#x27;</span><br><span class="line">alias cd2=&#x27;cd ../..&#x27;</span><br><span class="line">alias cd3=&#x27;cd ../../..&#x27;</span><br><span class="line">alias cd4=&#x27;cd ../../../..&#x27;</span><br><span class="line">alias cd5=&#x27;cd ../../../../..&#x27;</span><br><span class="line">alias cd6=&#x27;cd ../../../../../..&#x27;</span><br><span class="line">使修改生效</span><br><span class="line">source .bashrc  或 source /etc/profile</span><br></pre></td></tr></table></figure><h2 id="GPU任务"><a href="#GPU任务" class="headerlink" title="GPU任务"></a>GPU任务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">jhosts attrib -l 查看到所有资源包含cpu、内存、显卡等资源</span><br><span class="line">jjobs 不使用参数，显示目前正在排队或运行的作业 -a 显示最近完成的作业及正在运行或排队的作业 #-l 作业号 显示指定作业的详细信息</span><br><span class="line">jctrl kill &lt;作业号&gt; 强制杀掉指定的作业</span><br><span class="line">&lt;jsub&gt;： 提交作业</span><br><span class="line">&lt;-q normal&gt;： 指定 normal 队列</span><br><span class="line">&lt;-n 1&gt;： 指定该作业所需 1 核</span><br><span class="line">&lt;-e error.%J&gt;： 错误信息输出到 error.%J 文件中</span><br><span class="line">&lt;-o output.%J&gt;： 正确信息输出到 output.%J 文件中</span><br><span class="line">&lt;-J my_job&gt;： 指定作业名字为 my_job</span><br><span class="line">&lt;test&gt;： 执行的脚本</span><br><span class="line">提交任务</span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -q normal</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -n 2</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -e error.%J</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -o output.%J</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -J qyf_task</span></span><br><span class="line">source /apps/software/anaconda3/bin/activate torch</span><br><span class="line">python /hpcfiles/users/qyf/project/DeepRL_Algorithms-master/Algorithms/pytorch/PPO/main.py &gt;&gt; train.log</span><br><span class="line"></span><br><span class="line">jsub &lt;./up.sh</span><br></pre></td></tr></table></figure><h2 id="gym环境"><a href="#gym环境" class="headerlink" title="gym环境"></a>gym环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">安装box2d</span></span><br><span class="line">pip install gym </span><br><span class="line">conda install swig</span><br><span class="line">pip install box2d box2d-kengz --user</span><br></pre></td></tr></table></figure><h2 id="HTML网页网课加速助手"><a href="#HTML网页网课加速助手" class="headerlink" title="HTML网页网课加速助手"></a>HTML网页网课加速助手</h2><p><strong>document.querySelector(‘video’).playbackRate &#x3D; 4.0;</strong></p><h2 id="防火墙-1"><a href="#防火墙-1" class="headerlink" title="防火墙"></a>防火墙</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1.启动防火墙</span> </span><br><span class="line">systemctl start firewalld</span><br><span class="line"><span class="meta"># </span><span class="language-bash">2.禁用防火墙</span> </span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta"># </span><span class="language-bash">3.设置开机启动</span></span><br><span class="line">systemctl enable firewalld</span><br><span class="line"><span class="meta"># </span><span class="language-bash">4.停止并禁用开机启动</span> </span><br><span class="line">sytemctl disable firewalld</span><br><span class="line"><span class="meta"># </span><span class="language-bash">5.重启防火墙</span> </span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="meta">#</span><span class="language-bash">end</span></span><br></pre></td></tr></table></figure><h2 id="安装JAVA"><a href="#安装JAVA" class="headerlink" title="安装JAVA"></a>安装JAVA</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/lib</span><br><span class="line">sudo mkdir jvm #创建/usr/lib/jvm目录用来存放JDK文件</span><br><span class="line">sudo tar -zxvf ./jdk-8u291-linux-x64.tar.gz -C /usr/lib/jvm #解压</span><br><span class="line">vim ~/.bashrc #系统变量</span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_291</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br><span class="line">source ~/.bashrc#立即生效</span><br><span class="line"><span class="meta">#</span><span class="language-bash">end</span></span><br></pre></td></tr></table></figure><h2 id="ssh-配置免密登录"><a href="#ssh-配置免密登录" class="headerlink" title="ssh 配置免密登录"></a>ssh 配置免密登录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cd ~/.ssh/        </span><br><span class="line"><span class="meta"># </span><span class="language-bash">若没有该目录，请先执行一次ssh localhost</span></span><br><span class="line">ssh-keygen -t rsa    </span><br><span class="line"><span class="meta"># </span><span class="language-bash">会有提示，都按回车即可</span></span><br><span class="line">cat ./id_rsa.pub &gt;&gt; ./authorized_keys  </span><br><span class="line"><span class="meta"># </span><span class="language-bash">加入授权</span></span><br><span class="line">chmod g-w ~ </span><br><span class="line"><span class="meta">#</span><span class="language-bash">修改权限SSH不希望home目录和~/.ssh目录对组有写权限</span></span><br><span class="line">chmod 700 ~/.ssh</span><br><span class="line">chmod 600 ~/.ssh/authorized_keys</span><br><span class="line"><span class="meta">#</span><span class="language-bash">结束</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="linux用户创建"><a href="#linux用户创建" class="headerlink" title="linux用户创建"></a>linux用户创建</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser user1</span><br><span class="line"><span class="meta">#</span><span class="language-bash">为用户创建密码方法如下</span></span><br><span class="line">sudo passwd user1</span><br><span class="line"><span class="meta">#</span><span class="language-bash">删除用户</span></span><br><span class="line">sudo userdel -r user1</span><br><span class="line"><span class="meta">#</span><span class="language-bash">为用户添加sudo</span></span><br><span class="line">sudo usermod -a -G wheel user1</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir a #创建文件夹</span><br><span class="line">rmdir a #删除文件夹</span><br><span class="line">mv a b#改名，移动</span><br><span class="line">rm a #删除</span><br><span class="line">cp a b #复制文件或目录</span><br><span class="line">cat a #查看文件内容 </span><br><span class="line">touch a #修改文件时间或创建新文件</span><br><span class="line">tac a #反向查看文件内容</span><br><span class="line"></span><br><span class="line">grep -i &#x27;user&#x27; ~/.bashrc#从文件内查找字符串</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="linux常用命令"><a href="#linux常用命令" class="headerlink" title="linux常用命令"></a>linux常用命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nvcc -V #查看cuda版本</span><br><span class="line">crontab -l #查看当前定时任务</span><br><span class="line">crontab -e #编辑当前定时任务</span><br><span class="line">conda create -n env-name python=2.7  #conda新建一个虚拟环境-n env-name是设置新建环境的名字，特定python版本</span><br><span class="line">conda activate env-name #激活指定虚拟环境</span><br><span class="line">conda deactivate #离开虚拟环境</span><br><span class="line">conda env list #可以列出你所创建的所有环境conda info --envs</span><br><span class="line">conda env remove -n env-name #删除指定的环境 </span><br></pre></td></tr></table></figure><p>使用如下Conda命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n env2 --clone conda-env1</span><br></pre></td></tr></table></figure><p>这里conda-env2是新创建的Conda环境，conda-env1是被复制的Conda环境，<br>复制完成后，两个环境的Python配置是完全相同的；</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pip install package -i https://pypi.tuna.tsinghua.edu.cn/simple some-package #使用清华下载</span><br><span class="line">conda config --remove-key channels # 换回默认源(清除所有用户添加的镜像源路径，只保留默认的路径)</span><br><span class="line"><span class="meta">#</span><span class="language-bash">配置文件</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">全局的是在/etc目录下（/etc/profile）/etc/profile</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">用户个人的是在用户的家目录下（~/.profile）个人：<span class="built_in">cat</span> ~/.bash_profile</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">用户启动加载文件（~/.bashrc）<span class="built_in">cat</span> ~/.bashrc</span></span><br><span class="line">conda install --channel https://conda.anaconda.org/conda-forge pandas-alive=0.2.3conda install pandas_alive -c conda-forge</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment"># 镜像源</span></span></span><br><span class="line">conda config --remove channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ #删除镜像源,命令</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">conda config --set show_channel_urls yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment"># 找不到模块</span></span></span><br><span class="line"></span><br><span class="line"> ModuleNotFoundError: No module named &#x27;XXX&#x27;  https://www.cnblogs.com/dreamyu/p/7889959.html</span><br><span class="line">import os,sys</span><br><span class="line">curPath = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line">rootPath = os.path.split(curPath)[0]</span><br><span class="line">sys.path.append(rootPath)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">GPU上传作业</span></span><br><span class="line">jjobs -a#查看作业</span><br><span class="line">jsub &lt; ./task.sh#提交作业</span><br><span class="line"><span class="meta">#</span><span class="language-bash">提交作业</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB  -q normal</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -n 32</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -e error.%J</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -o output.%J</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">JSUB -J qyf_test</span></span><br><span class="line">python /hpcfiles/users/qyf/project/DC-DRL/common_modules/agent.py &gt; log.log</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">显示变量</span></span><br><span class="line">echo $PATH</span><br><span class="line">方法1</span><br><span class="line"><span class="meta">#</span><span class="language-bash">配置完后可以通过<span class="built_in">echo</span> <span class="variable">$PATH</span>查看配置结果。</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">生效方法：立即生效</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">有效期限：临时改变，只能在当前的终端窗口中有效，当前窗口关闭后就会恢<span class="comment">#复原有的path配置</span></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">用户局限：仅对当前用户</span></span><br><span class="line">export PATH=/usr/local/bin:$PATH</span><br><span class="line">方法2</span><br><span class="line"><span class="meta">#</span><span class="language-bash">通过修改.bashrc文件:</span></span><br><span class="line">vim ~/.bashrc </span><br><span class="line"><span class="meta">#</span><span class="language-bash">在最后一行添上：</span></span><br><span class="line">export PATH=/usr/local/eclipse:$PATH</span><br><span class="line"><span class="meta">#</span><span class="language-bash">生效方法：（有以下两种）</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">1、关闭当前终端窗口，重新打开一个新终端窗口就能生效</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">2、输入“<span class="built_in">source</span> ~/.bashrc”命令，立即生效</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">有效期限：永久有效</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">用户局限：仅对当前用户</span></span><br><span class="line">方法3</span><br><span class="line"><span class="meta">#</span><span class="language-bash">通过修改profile文件:</span></span><br><span class="line">vim /etc/profile</span><br><span class="line">export PATH=/usr/local/bin:$PATH</span><br><span class="line"><span class="meta">#</span><span class="language-bash">生效方法：系统重启</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">有效期限：永久有效</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">用户局限：对所有用户</span></span><br><span class="line">方法4</span><br><span class="line"><span class="meta">#</span><span class="language-bash">通过修改environment文件:</span></span><br><span class="line">vim /etc/environment</span><br><span class="line">在PATH=&quot;/usr/local/sbin:/usr/sbin:/usr/bin:/sbin:/bin&quot;中加入 </span><br><span class="line">&quot;:/usr/local/bin&quot;</span><br><span class="line"><span class="meta">#</span><span class="language-bash">生效方法：系统重启</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">有效期限：永久有效</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">用户局限：对所有用户</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash"><span class="comment"># 常使用的tar压缩命令为</span></span>  </span><br><span class="line">tar -zcvf  压缩名.tar.gz  文件/目录</span><br><span class="line"></span><br><span class="line">.tar.gz文件，这种文件是tar文件的压缩文件，可以使用tar命令进行解压。解压：</span><br><span class="line">tar -zxvf pythontab.tar.gz</span><br><span class="line">单纯的.gz文件解压，这种文件不可以使用tar命令解压，需要用gunzip解压，使用命令gzip</span><br><span class="line">解压：gzip -d pythontab.gz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">使用zip进行压缩的时候命令格式为</span>   </span><br><span class="line">zip -q -r 压缩包名.zip   目录/文件名</span><br><span class="line"><span class="meta">#</span><span class="language-bash">解压</span></span><br><span class="line">unzip</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">解压文件tgz</span><br><span class="line">例如文件名为: yyyy.tgz</span><br><span class="line">先使用GZIP解压为TAR文件</span><br><span class="line">gzip -dv yyyy.tgz</span><br><span class="line">同时解压后生成yyyy.tar文件</span><br><span class="line">再使用tar解压yyyy.tar文件</span><br><span class="line">tar xvf yyyy.tar</span><br><span class="line">解压下边的命令：</span><br><span class="line">gzip -dv R220-ESiVision-WebEnv-X86-Linux.tgz</span><br><span class="line">tar xvf R220-ESiVision-WebEnv-X86-Linux.tar</span><br><span class="line"></span><br><span class="line">压缩：tgz文件。</span><br><span class="line">tar -czvf R220-ESiVision-WebEnv-X86-Linux.tgz apache-tomcat-5.5.23 jdk1.5.0_12 net-snmp-5.1.1</span><br><span class="line">tar -czvf filename.tgz file</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">修改文件权限</span></span><br><span class="line">chmod 777 makePlus.sh</span><br><span class="line"></span><br><span class="line">查看系统版本/os</span><br><span class="line">cat /proc/version</span><br><span class="line">cat /etc/redhat-release</span><br><span class="line">uname -a 显示如下</span><br><span class="line"> uname -r</span><br></pre></td></tr></table></figure><h2 id="找不到包"><a href="#找不到包" class="headerlink" title="找不到包"></a>找不到包</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os,sys</span><br><span class="line">curPath = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line">sys.path.append(curPath)</span><br><span class="line">rootPath = os.path.split(curPath)[<span class="number">0</span>]</span><br><span class="line">sys.path.append(rootPath)</span><br><span class="line"><span class="comment">#sys.path.append(&#x27;./common&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os,sys</span><br><span class="line">curPath = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"><span class="built_in">print</span>(curPath)</span><br><span class="line">rootPath1 = os.path.split(curPath)[<span class="number">0</span>]</span><br><span class="line">rootPath2 = os.path.split(rootPath1)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(rootPath2)</span><br><span class="line">pathaa = <span class="string">&#x27;/hpcfiles/users/qyf/test/DeepRL_Algorithms-master&#x27;</span></span><br><span class="line">sys.path.append(pathaa)<span class="comment">#地址</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;record all common commands&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://peaky2022.gitee.io/peaky/categories/Linux/"/>
    
    
    <category term="Linux" scheme="http://peaky2022.gitee.io/peaky/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Springboot笔记</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/05/05/a54293f2.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/05/05/a54293f2.html</id>
    <published>2021-05-05T08:27:22.000Z</published>
    <updated>2022-03-03T15:01:47.625Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot常用模块"><a href="#SpringBoot常用模块" class="headerlink" title="SpringBoot常用模块"></a>SpringBoot常用模块</h1><h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><h3 id="LayUI-基本的后台管理模板"><a href="#LayUI-基本的后台管理模板" class="headerlink" title="LayUI 基本的后台管理模板"></a>LayUI 基本的后台管理模板</h3><blockquote><p>下载地址：<a href="https://fengfeng.lanzoui.com/iLVVnooajzc">LayUI下载</a></p></blockquote><blockquote><p>官网地址：<a href="https://www.layui.com/">LayUI官网</a></p></blockquote><span id="more"></span><h3 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h3><p>modules为页面加载的JS,</p><blockquote><p>自定义模块如下：</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  扩展一个 mymod 模块</span></span><br><span class="line"><span class="comment">**/</span>      </span><br><span class="line">;</span><br><span class="line">layui.<span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">exports</span></span>)&#123; <span class="comment">//提示：模块也可以依赖其它模块，如：layui.define(&#x27;mod1&#x27;, callback);</span></span><br><span class="line">  <span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">hello</span>: <span class="keyword">function</span>(<span class="params">str</span>)&#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">&#x27;Hello &#x27;</span>+ (str||<span class="string">&#x27;mymod&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//调用其他模块 </span></span><br><span class="line">   layui.<span class="title function_">use</span>([<span class="string">&#x27;form&#x27;</span>, <span class="string">&#x27;upload&#x27;</span>],<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> e = layui.<span class="property">$</span>,<span class="comment">//调用$.get(url,&#123;&#125;)</span></span><br><span class="line">   &#125;);</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//输出 mymod 接口</span></span><br><span class="line">  <span class="built_in">exports</span>(<span class="string">&#x27;mymod&#x27;</span>, obj);</span><br><span class="line">&#125;);    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  扩展一个 mymod 模块,设定扩展模块所在的目录，然后就可以在别的JS文件中使用了</span></span><br><span class="line"><span class="comment">**/</span>     </span><br><span class="line"><span class="comment">//config的设置是全局的</span></span><br><span class="line">layui.<span class="title function_">config</span>(&#123;</span><br><span class="line">  <span class="attr">base</span>: <span class="string">&#x27;/res/js/&#x27;</span> <span class="comment">//假设这是你存放拓展模块的根目录</span></span><br><span class="line">&#125;).<span class="title function_">extend</span>(&#123; <span class="comment">//设定模块别名</span></span><br><span class="line">  <span class="attr">mymod</span>: <span class="string">&#x27;mymod&#x27;</span> <span class="comment">//如果 mymod.js 是在根目录，也可以不用设定别名</span></span><br><span class="line">  ,<span class="attr">mod1</span>: <span class="string">&#x27;admin/mod1&#x27;</span> <span class="comment">//相对于上述 base 目录的子目录</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//你也可以忽略 base 设定的根目录，直接在 extend 指定路径（主要：该功能为 layui 2.2.0 新增）</span></span><br><span class="line">layui.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="attr">mod2</span>: <span class="string">&#x27;&#123;/&#125;http://cdn.xxx.com/lib/mod2&#x27;</span> <span class="comment">// &#123;/&#125;的意思即代表采用自有路径，即不跟随 base 路径</span></span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//使用拓展模块</span></span><br><span class="line">layui.<span class="title function_">use</span>([<span class="string">&#x27;mymod&#x27;</span>, <span class="string">&#x27;mod1&#x27;</span>], <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> mymod = layui.<span class="property">mymod</span></span><br><span class="line">  ,mod1 = layui.<span class="property">mod1</span></span><br><span class="line">  ,mod2 = layui.<span class="property">mod2</span>;</span><br><span class="line">  </span><br><span class="line">  mymod.<span class="title function_">hello</span>(<span class="string">&#x27;World!&#x27;</span>); <span class="comment">//弹出 Hello World!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>页面调用JS脚本如下：</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">layui.<span class="title function_">use</span>([<span class="string">&#x27;form&#x27;</span>, <span class="string">&#x27;upload&#x27;</span>], <span class="keyword">function</span>(<span class="params"></span>)&#123;  <span class="comment">//如果只加载一个模块，可以不填数组。如：layui.use(&#x27;form&#x27;)</span></span><br><span class="line">  <span class="keyword">var</span> form = layui.<span class="property">form</span> <span class="comment">//获取form模块</span></span><br><span class="line">  ,upload = layui.<span class="property">upload</span>; <span class="comment">//获取upload模块</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//监听提交按钮</span></span><br><span class="line">  form.<span class="title function_">on</span>(<span class="string">&#x27;submit(test)&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//实例化一个上传控件</span></span><br><span class="line">  <span class="title function_">upload</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;上传接口url&#x27;</span></span><br><span class="line">    ,<span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Javascript-脚本"><a href="#Javascript-脚本" class="headerlink" title="Javascript 脚本"></a>Javascript 脚本</h3><h4 id="渲染一个图表"><a href="#渲染一个图表" class="headerlink" title="渲染一个图表"></a>渲染一个图表</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//渲染图表</span></span><br><span class="line">            layui.<span class="title function_">use</span>([<span class="string">&quot;carousel&quot;</span>, <span class="string">&quot;echarts&quot;</span>], <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> e = layui.<span class="property">$</span>,</span><br><span class="line">                    t = layui.<span class="property">carousel</span>,</span><br><span class="line">                    a = layui.<span class="property">echarts</span>,</span><br><span class="line">                    i = [],</span><br><span class="line">                    l = [&#123;</span><br><span class="line">                        <span class="attr">title</span>: &#123;</span><br><span class="line">                            <span class="attr">text</span>: <span class="string">&quot;温度变化曲线&quot;</span>,</span><br><span class="line">                            <span class="attr">x</span>: <span class="string">&quot;left&quot;</span>,</span><br><span class="line">                            <span class="attr">textStyle</span>: &#123;</span><br><span class="line">                                <span class="attr">fontSize</span>: <span class="number">14</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">tooltip</span>: &#123;</span><br><span class="line">                            <span class="attr">trigger</span>: <span class="string">&quot;axis&quot;</span>,</span><br><span class="line">                            <span class="attr">formatter</span>: <span class="string">&quot;&#123;b&#125;&lt;br&gt;温度：&#123;c&#125;℃&quot;</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">xAxis</span>: [&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&quot;category&quot;</span>,</span><br><span class="line">                            <span class="attr">data</span>: date</span><br><span class="line">                        &#125;],</span><br><span class="line">                        <span class="attr">yAxis</span>: [&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&quot;value&quot;</span></span><br><span class="line">                        &#125;],</span><br><span class="line">                        <span class="attr">series</span>: [&#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>,</span><br><span class="line">                            <span class="attr">data</span>: temperature,</span><br><span class="line">                            <span class="attr">markPoint</span>: &#123;</span><br><span class="line">                                <span class="attr">data</span>: [&#123;</span><br><span class="line">                                    <span class="attr">type</span>: <span class="string">&quot;max&quot;</span>,</span><br><span class="line">                                    <span class="attr">name</span>: <span class="string">&quot;最大值&quot;</span></span><br><span class="line">                                &#125;,</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="attr">type</span>: <span class="string">&quot;min&quot;</span>,</span><br><span class="line">                                        <span class="attr">name</span>: <span class="string">&quot;最小值&quot;</span></span><br><span class="line">                                    &#125;]</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">markLine</span>: &#123;</span><br><span class="line">                                <span class="attr">data</span>: [&#123;</span><br><span class="line">                                    <span class="attr">type</span>: <span class="string">&quot;average&quot;</span>,</span><br><span class="line">                                    <span class="attr">name</span>: <span class="string">&quot;平均值&quot;</span></span><br><span class="line">                                &#125;]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;]</span><br><span class="line">                    &#125;,</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">//第二个</span></span><br><span class="line">                            <span class="attr">title</span>: &#123;</span><br><span class="line">                                <span class="attr">text</span>: <span class="string">&quot;湿度-淀粉含量变化&quot;</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">tooltip</span>: &#123;</span><br><span class="line">                                <span class="attr">trigger</span>: <span class="string">&quot;axis&quot;</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">legend</span>: &#123;</span><br><span class="line">                                <span class="attr">data</span>: [<span class="string">&quot;淀粉含量%&quot;</span>, <span class="string">&quot;湿度%&quot;</span>]</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">xAxis</span>: [&#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&quot;category&quot;</span>,</span><br><span class="line">                                <span class="attr">boundaryGap</span>: !<span class="number">1</span>,</span><br><span class="line">                                <span class="attr">data</span>: date</span><br><span class="line">                            &#125;],</span><br><span class="line">                            <span class="attr">yAxis</span>: [&#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&quot;value&quot;</span>,</span><br><span class="line">                                <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                                    <span class="attr">formatter</span>: <span class="string">&quot;&#123;value&#125; &quot;</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;],</span><br><span class="line">                            <span class="attr">series</span>: [&#123;</span><br><span class="line">                                <span class="attr">name</span>: <span class="string">&quot;淀粉含量%&quot;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>,</span><br><span class="line">                                <span class="attr">data</span>: starch,</span><br><span class="line">                                <span class="attr">markPoint</span>: &#123;</span><br><span class="line">                                    <span class="attr">data</span>: [&#123;</span><br><span class="line">                                        <span class="attr">type</span>: <span class="string">&quot;max&quot;</span>,</span><br><span class="line">                                        <span class="attr">name</span>: <span class="string">&quot;最大值&quot;</span></span><br><span class="line">                                    &#125;,</span><br><span class="line">                                        &#123;</span><br><span class="line">                                            <span class="attr">type</span>: <span class="string">&quot;min&quot;</span>,</span><br><span class="line">                                            <span class="attr">name</span>: <span class="string">&quot;最小值&quot;</span></span><br><span class="line">                                        &#125;]</span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="attr">markLine</span>: &#123;</span><br><span class="line">                                    <span class="attr">data</span>: [&#123;</span><br><span class="line">                                        <span class="attr">type</span>: <span class="string">&quot;average&quot;</span>,</span><br><span class="line">                                        <span class="attr">name</span>: <span class="string">&quot;平均值&quot;</span></span><br><span class="line">                                    &#125;]</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;,</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="attr">name</span>: <span class="string">&quot;湿度%&quot;</span>,</span><br><span class="line">                                    <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>,</span><br><span class="line">                                    <span class="attr">data</span>: humidity,</span><br><span class="line">                                    <span class="attr">markPoint</span>: &#123;</span><br><span class="line">                                        <span class="attr">data</span>: [&#123;</span><br><span class="line">                                            <span class="attr">type</span>: <span class="string">&quot;max&quot;</span>,</span><br><span class="line">                                            <span class="attr">name</span>: <span class="string">&quot;最大值&quot;</span></span><br><span class="line">                                        &#125;,</span><br><span class="line">                                            &#123;</span><br><span class="line">                                                <span class="attr">type</span>: <span class="string">&quot;min&quot;</span>,</span><br><span class="line">                                                <span class="attr">name</span>: <span class="string">&quot;最小值&quot;</span></span><br><span class="line">                                            &#125;]</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    <span class="attr">markLine</span>: &#123;</span><br><span class="line">                                        <span class="attr">data</span>: [&#123;</span><br><span class="line">                                            <span class="attr">type</span>: <span class="string">&quot;average&quot;</span>,</span><br><span class="line">                                            <span class="attr">name</span>: <span class="string">&quot;平均值&quot;</span></span><br><span class="line">                                        &#125;]</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;]</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &#123;</span><br><span class="line">                           <span class="comment">//第三个</span></span><br><span class="line">                            <span class="attr">title</span>: &#123;</span><br><span class="line">                                <span class="attr">text</span>: <span class="string">&quot;PH-酒精含量变化&quot;</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">tooltip</span>: &#123;</span><br><span class="line">                                <span class="attr">trigger</span>: <span class="string">&quot;axis&quot;</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">legend</span>: &#123;</span><br><span class="line">                                <span class="attr">data</span>: [<span class="string">&quot;酒精含量%&quot;</span>, <span class="string">&quot;PH&quot;</span>]</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">xAxis</span>: [&#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&quot;category&quot;</span>,</span><br><span class="line">                                <span class="attr">boundaryGap</span>: !<span class="number">1</span>,</span><br><span class="line">                                <span class="attr">data</span>: date</span><br><span class="line">                            &#125;],</span><br><span class="line">                            <span class="attr">yAxis</span>: [&#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&quot;value&quot;</span>,</span><br><span class="line">                                <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                                    <span class="attr">formatter</span>: <span class="string">&quot;&#123;value&#125; &quot;</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;],</span><br><span class="line">                            <span class="attr">series</span>: [&#123;</span><br><span class="line">                                <span class="attr">name</span>: <span class="string">&quot;PH&quot;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>,</span><br><span class="line">                                <span class="attr">data</span>: acid,</span><br><span class="line">                                <span class="attr">markPoint</span>: &#123;</span><br><span class="line">                                    <span class="attr">data</span>: [&#123;</span><br><span class="line">                                        <span class="attr">type</span>: <span class="string">&quot;max&quot;</span>,</span><br><span class="line">                                        <span class="attr">name</span>: <span class="string">&quot;最大值&quot;</span></span><br><span class="line">                                    &#125;,</span><br><span class="line">                                        &#123;</span><br><span class="line">                                            <span class="attr">type</span>: <span class="string">&quot;min&quot;</span>,</span><br><span class="line">                                            <span class="attr">name</span>: <span class="string">&quot;最小值&quot;</span></span><br><span class="line">                                        &#125;]</span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="attr">markLine</span>: &#123;</span><br><span class="line">                                    <span class="attr">data</span>: [&#123;</span><br><span class="line">                                        <span class="attr">type</span>: <span class="string">&quot;average&quot;</span>,</span><br><span class="line">                                        <span class="attr">name</span>: <span class="string">&quot;平均值&quot;</span></span><br><span class="line">                                    &#125;]</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;,</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="attr">name</span>: <span class="string">&quot;酒精含量%&quot;</span>,</span><br><span class="line">                                    <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>,</span><br><span class="line">                                    <span class="attr">data</span>: alcohol,</span><br><span class="line">                                    <span class="attr">markPoint</span>: &#123;</span><br><span class="line">                                        <span class="attr">data</span>: [&#123;</span><br><span class="line">                                            <span class="attr">type</span>: <span class="string">&quot;max&quot;</span>,</span><br><span class="line">                                            <span class="attr">name</span>: <span class="string">&quot;最大值&quot;</span></span><br><span class="line">                                        &#125;,</span><br><span class="line">                                            &#123;</span><br><span class="line">                                                <span class="attr">type</span>: <span class="string">&quot;min&quot;</span>,</span><br><span class="line">                                                <span class="attr">name</span>: <span class="string">&quot;最小值&quot;</span></span><br><span class="line">                                            &#125;]</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    <span class="attr">markLine</span>: &#123;</span><br><span class="line">                                        <span class="attr">data</span>: [&#123;</span><br><span class="line">                                            <span class="attr">type</span>: <span class="string">&quot;average&quot;</span>,</span><br><span class="line">                                            <span class="attr">name</span>: <span class="string">&quot;平均值&quot;</span></span><br><span class="line">                                        &#125;]</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;]</span><br><span class="line">                        &#125;],</span><br><span class="line">                    n = <span class="title function_">e</span>(<span class="string">&quot;#LAY-index-dataview&quot;</span>).<span class="title function_">children</span>(<span class="string">&quot;div&quot;</span>),</span><br><span class="line">                    r = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">                        i[e] = a.<span class="title function_">init</span>(n[e], layui.<span class="property">echartsTheme</span>),</span><br><span class="line">                            i[e].<span class="title function_">setOption</span>(l[e]),</span><br><span class="line">                            <span class="variable language_">window</span>.<span class="property">onresize</span> = i[e].<span class="property">resize</span></span><br><span class="line">                    &#125;;</span><br><span class="line">                <span class="keyword">if</span> (n[<span class="number">0</span>]) &#123;</span><br><span class="line">                    <span class="title function_">r</span>(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">var</span> o = <span class="number">0</span>;</span><br><span class="line">                    t.<span class="title function_">on</span>(<span class="string">&quot;change(LAY-index-dataview)&quot;</span>,</span><br><span class="line">                        <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">                            <span class="title function_">r</span>(o = e.<span class="property">index</span>)</span><br><span class="line">                        &#125;),</span><br><span class="line">                        layui.<span class="property">admin</span>.<span class="title function_">on</span>(<span class="string">&quot;side&quot;</span>,</span><br><span class="line">                            <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                                <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                                        <span class="title function_">r</span>(o)</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    <span class="number">300</span>)</span><br><span class="line">                            &#125;),</span><br><span class="line">                        layui.<span class="property">admin</span>.<span class="title function_">on</span>(<span class="string">&quot;hash(tab)&quot;</span>,</span><br><span class="line">                            <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                                layui.<span class="title function_">router</span>().<span class="property">path</span>.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>) || <span class="title function_">r</span>(o)</span><br><span class="line">                            &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure><h4 id="时间格式化器"><a href="#时间格式化器" class="headerlink" title="时间格式化器"></a>时间格式化器</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   &lt;script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//var time2 = new Date(time).format(&quot;yyyy-MM-dd&quot;);</span></span><br><span class="line">    <span class="title class_">Date</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">format</span> = <span class="keyword">function</span>(<span class="params">fmt</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> o = &#123;</span><br><span class="line">        <span class="string">&quot;M+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getMonth</span>()+<span class="number">1</span>, <span class="comment">//月份</span></span><br><span class="line">        <span class="string">&quot;d+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getDate</span>(), <span class="comment">//日</span></span><br><span class="line">        <span class="string">&quot;h+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getHours</span>()%<span class="number">12</span> == <span class="number">0</span> ? <span class="number">12</span> : <span class="variable language_">this</span>.<span class="title function_">getHours</span>()%<span class="number">12</span>, <span class="comment">//小时</span></span><br><span class="line">        <span class="string">&quot;H+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getHours</span>(), <span class="comment">//小时</span></span><br><span class="line">        <span class="string">&quot;m+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getMinutes</span>(), <span class="comment">//分</span></span><br><span class="line">        <span class="string">&quot;s+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getSeconds</span>(), <span class="comment">//秒</span></span><br><span class="line">        <span class="string">&quot;q+&quot;</span> : <span class="title class_">Math</span>.<span class="title function_">floor</span>((<span class="variable language_">this</span>.<span class="title function_">getMonth</span>()+<span class="number">3</span>)/<span class="number">3</span>), <span class="comment">//季度</span></span><br><span class="line">        <span class="string">&quot;S&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getMilliseconds</span>() <span class="comment">//毫秒</span></span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">if</span>(<span class="regexp">/(y+)/</span>.<span class="title function_">test</span>(fmt))</span><br><span class="line">        fmt=fmt.<span class="title function_">replace</span>(<span class="title class_">RegExp</span>.<span class="property">$1</span>, (<span class="variable language_">this</span>.<span class="title function_">getFullYear</span>()+<span class="string">&quot;&quot;</span>).<span class="title function_">substr</span>(<span class="number">4</span> - <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span>));</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> o)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;(&quot;</span>+ k +<span class="string">&quot;)&quot;</span>).<span class="title function_">test</span>(fmt))</span><br><span class="line">          fmt = fmt.<span class="title function_">replace</span>(<span class="title class_">RegExp</span>.<span class="property">$1</span>, (<span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span>==<span class="number">1</span>) ? (o[k]) : ((<span class="string">&quot;00&quot;</span>+ o[k]).<span class="title function_">substr</span>((<span class="string">&quot;&quot;</span>+ o[k]).<span class="property">length</span>)));</span><br><span class="line">      <span class="keyword">return</span> fmt;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="Jquery调用"><a href="#Jquery调用" class="headerlink" title="Jquery调用"></a>Jquery调用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;http://libs.baidu.com/jquery/1.8.3/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//模板 替换HTML网页内容</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;sensorList2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/html&quot;</span> &gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">    //each为多显示内容</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">    </span><span class="template-tag">&#123;&#123;#  <span class="name">layui.each</span>(<span class="name">d</span>, function(<span class="name">index</span>, item)&#123; &#125;&#125;</span></span></span></span><br><span class="line"><span class="template-tag"><span class="language-handlebars"><span class="language-xml">    &lt;option <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; item.path &#125;&#125;&quot;</span>&gt;&#123;&#123;item.time+item.file&#125;&#125;&lt;/option&gt;</span></span></span></span><br><span class="line"><span class="template-tag"><span class="language-handlebars"><span class="language-xml">    &#123;&#123;#  &#125;); &#125;&#125;</span><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$.<span class="title function_">get</span>(<span class="string">&quot;/upload/finish&quot;</span>,&#123;&#125;, <span class="keyword">function</span>(<span class="params">sensordata</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     <span class="comment">//格式化时间</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (sensordata.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; sensordata.<span class="property">length</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          sensordata[i].<span class="property">time</span> = <span class="keyword">new</span> <span class="title class_">Date</span>(sensordata[i].<span class="property">time</span>).<span class="title function_">format</span>(<span class="string">&quot;yy-MM-dd HH:mm &quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//调用模板</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      layui.<span class="title function_">use</span>(<span class="string">&quot;laytpl&quot;</span>,<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> laytpl = layui.<span class="property">laytpl</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> getTpl2 = sensorList2.<span class="property">innerHTML</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                ,view2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sensorView2&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">laytpl</span>(getTpl2).<span class="title function_">render</span>(sensordata, <span class="keyword">function</span>(<span class="params">html2</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          view2.<span class="property">innerHTML</span> = html2;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="URL中的变量取出"><a href="#URL中的变量取出" class="headerlink" title="URL中的变量取出"></a>URL中的变量取出</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将URL中的变量取出</span></span><br><span class="line">    <span class="comment">//调用方式</span></span><br><span class="line">    <span class="comment">// getQueryVariable(&quot;sensorId&quot;)  or var id =getQueryVariable(&quot;sensorId&quot;);</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getQueryVariable</span>(<span class="params">variable</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> query = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">var</span> vars = query.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.<span class="property">length</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> pair = vars[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(pair[<span class="number">0</span>] == variable)&#123;<span class="keyword">return</span> pair[<span class="number">1</span>];&#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="根据某些值得改变来选择显示隐藏DIV"><a href="#根据某些值得改变来选择显示隐藏DIV" class="headerlink" title="根据某些值得改变来选择显示隐藏DIV"></a>根据某些值得改变来选择显示隐藏DIV</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--如果message是空的话就不显示此标签--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not (message == null)&#125;&quot;</span>   &gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果value是1 的话值为第一个否则为第二个--&gt;</span></span><br><span class="line">class=&quot;$&#123;value==1?&#x27;a&#x27;:&#x27;b&#x27;&#125;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  $(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//隐藏div</span></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">&quot;#otherReason&quot;</span>).<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//给div添加change事件</span></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">&quot;#select&quot;</span>).<span class="title function_">change</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span>($(<span class="variable language_">this</span>).<span class="title function_">val</span>() == <span class="number">4</span> ) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#otherReason&quot;</span>).<span class="title function_">show</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span></span></span><br><span class="line"><span class="language-javascript">      &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#otherReason&quot;</span>).<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="修改span标签的值"><a href="#修改span标签的值" class="headerlink" title="修改span标签的值"></a>修改span标签的值</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&lt;!-- 搜索框js --&gt;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">changeType</span>(<span class="params">type</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;type&quot;</span>).<span class="property">value</span> = type;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> a = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;display&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span> (type == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    a.<span class="property">innerHTML</span> = <span class="string">&quot;标题&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    a.<span class="property">innerHTML</span> = <span class="string">&quot;内容&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    a.<span class="property">innerHTML</span> = <span class="string">&quot;发件人&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="空格-换行-居中"><a href="#空格-换行-居中" class="headerlink" title="空格+换行+居中"></a>空格+换行+居中</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>  空格 </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>换行</span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span>分割线</span><br><span class="line">style=&quot;text-align:center&quot;  文字居中</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;alert alert-danger&quot;</span> <span class="attr">role</span>=<span class="string">&quot;alert&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center&quot;</span>&gt;</span></span><br><span class="line">                                    此处暂时没有信息！</span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="修改input的placeholder"><a href="#修改input的placeholder" class="headerlink" title="修改input的placeholder"></a>修改input的placeholder</h4><p>方法1：通过js来设置文本框input的placeholder值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;input&quot;).setAttribute(&quot;placeholder&quot;,&quot;新文本内容&quot;);</span><br></pre></td></tr></table></figure><p>方法2：通过jquery设置文本框input的placeholder值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(&#x27;#input&#x27;).attr(&#x27;placeholder&#x27;,&#x27;新文本内容&#x27;)；</span><br></pre></td></tr></table></figure><h4 id="判断input值为空"><a href="#判断input值为空" class="headerlink" title="判断input值为空"></a>判断input值为空</h4><p><a href="https://blog.csdn.net/weixin_42645716/article/details/87984442">https://blog.csdn.net/weixin_42645716/article/details/87984442</a></p><p>一、Input获取value</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> value=<span class="string">&quot;请输入姓名&quot;</span> name=<span class="string">&quot;name&quot;</span> id=<span class="string">&quot;name&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> name; </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    name = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;name&quot;</span>).<span class="property">value</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    name = form1.<span class="property">name</span>.<span class="property">value</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    name = $(<span class="string">&quot;#name&quot;</span>).<span class="title function_">val</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    name =  $(<span class="string">&quot;input[id=&#x27;name&#x27;]&quot;</span>).<span class="title function_">val</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    name = $(<span class="string">&quot;#name&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;value&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    name = $(<span class="string">&quot;input[id=&#x27;name&#x27;]&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;value&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>二、判断value是否为空</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 方法一:</span><br><span class="line">if(name == null || name == undefined || name == &#x27;&#x27;)&#123;</span><br><span class="line">    console.log(&quot;value 为空&quot;)</span><br><span class="line">&#125;</span><br><span class="line">// 方法二:</span><br><span class="line">if(name.length &gt; 0 )&#123;</span><br><span class="line">    console.log(&quot;value 不为空&quot;)</span><br><span class="line">&#125;三、null、undefined、‘’的区别</span><br></pre></td></tr></table></figure><p>null:空对象\不是对象,转为数值为0<br>undefined:全局对象window的一个特殊属性.undefined表示”缺少值”，就是此处应该有一个值，但是还没有定义。转为数值为NaN.典型用法是：</p><p>（1）变量被声明了，但没有赋值时，就等于undefined。<br>（2) 调用函数时，应该提供的参数没有提供，该参数等于undefined。<br>（3）对象没有赋值的属性，该属性的值为undefined。<br>（4）函数没有返回值时，默认返回undefined。</p><h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><h3 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h3><p>下载地址：<a href="https://fengfeng.lanzoui.com/i6Ei0oo81gd">APP 1.0</a></p><p>下载地址： <a href="https://fengfeng.lanzoui.com/ipkWVooeifa">备份</a></p><h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><h5 id="RestController"><a href="#RestController" class="headerlink" title="RestController"></a>RestController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span>=<span class="meta">@Controller</span>+<span class="meta">@ResponseBoby</span><span class="comment">//返回数据可以是JSON或者是String、Map、List等执行ajax回调</span></span><br></pre></td></tr></table></figure><h5 id="ResultJSON"><a href="#ResultJSON" class="headerlink" title="ResultJSON"></a>ResultJSON</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口返回的JSON数据</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">resultJson</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">resultJson</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">resultJson</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">resultJson</span><span class="params">(<span class="type">int</span> count, T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.count = count;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/path&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/path&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/path&quot;)</span></span><br><span class="line"><span class="comment">//携带的参数</span></span><br><span class="line"><span class="meta">@RequestParam(&quot;parmester&quot;)</span> Integer id</span><br></pre></td></tr></table></figure><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><h5 id="获取时间戳"><a href="#获取时间戳" class="headerlink" title="获取时间戳"></a>获取时间戳</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Timestamp</span> <span class="variable">timestamp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timestamp</span>(System.currentTimeMillis());</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy/MM/dd hh:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">timestamp</span> <span class="operator">=</span> sdf.format(log.getTime());<span class="comment">//格式化器</span></span><br><span class="line"></span><br><span class="line">thymeleaf 时间戳格式化器</span><br><span class="line">th:text=<span class="string">&quot;$&#123;#dates.format(Time, &#x27;yyyy-MM-dd hh:mm:ss&#x27;)&#125;&quot;</span></span><br></pre></td></tr></table></figure><h5 id="从html页面的form表单提取数据与封装"><a href="#从html页面的form表单提取数据与封装" class="headerlink" title="从html页面的form表单提取数据与封装"></a>从html页面的form表单提取数据与封装</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestParam(&quot;select&quot;)</span> Integer val   <span class="comment">//根据name获取值</span></span><br><span class="line">    Model model         <span class="comment">//封装model</span></span><br><span class="line">    model.addAttribute(<span class="string">&quot;focusgoods&quot;</span>,selectallfocusbyid);   <span class="comment">//名值对形式</span></span><br><span class="line">    HttpSession session</span><br><span class="line">    session.setAttribute(<span class="string">&quot;goodshot&quot;</span>,goods);</span><br></pre></td></tr></table></figure><h5 id="String-转Int"><a href="#String-转Int" class="headerlink" title="String 转Int"></a>String 转Int</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer.parseInt(id)</span><br></pre></td></tr></table></figure><h5 id="判断一个list集合是否为空"><a href="#判断一个list集合是否为空" class="headerlink" title="判断一个list集合是否为空"></a>判断一个list集合是否为空</h5><p><strong>isEmpty() 和(list.size() &#x3D;&#x3D; 0)都是判断List内容是否为空。</strong></p><p><strong>null判断是判断有没有对list集合分配内存空间，而不是list里面内容是否为空</strong></p><h5 id="转发与重定向"><a href="#转发与重定向" class="headerlink" title="转发与重定向"></a>转发与重定向</h5><p><strong>转发</strong></p><p>1.使用 “forword” 关键字</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;forword:/url&quot;</span>;</span><br></pre></td></tr></table></figure><p>2.使用servlet 提供的API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getRequestDispatcher(<span class="string">&quot;/url&quot;</span>).forward(request,response);</span><br></pre></td></tr></table></figure><p><strong>重定向</strong></p><p>1.使用servlet 提供的API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpServletResponse response;</span><br><span class="line">response.sendRedirect(<span class="string">&quot;/url&quot;</span>);<span class="comment">//转发到制定的url及对应Controler</span></span><br></pre></td></tr></table></figure><p>2.使用 “redirect” 关键字</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;redirect:/url&quot;</span>;</span><br></pre></td></tr></table></figure><h5 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;Select * From message where title like CONCAT(&#x27;%&#x27;,#&#123;title&#125;,&#x27;%&#x27;)&quot;)</span></span><br></pre></td></tr></table></figure><h5 id="文件上传与Java调用Python"><a href="#文件上传与Java调用Python" class="headerlink" title="文件上传与Java调用Python"></a>文件上传与Java调用Python</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当前时间、文件名</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">      <span class="type">Timestamp</span> <span class="variable">timestamp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timestamp</span>(System.currentTimeMillis());</span><br><span class="line">      <span class="comment">//时间转换成字符串区分上传文件</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> timestamp.getTime()+<span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="comment">//定义上传文件的目录为upload/times/file</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">dirPath</span> <span class="operator">=</span> <span class="string">&quot;/upload/&quot;</span>+path;</span><br><span class="line">      <span class="comment">//存储记录</span></span><br><span class="line">      <span class="type">analyze</span> <span class="variable">analyze</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">analyze</span>(timestamp,originalFilename,((<span class="type">float</span>)file.getSize())/<span class="number">1024</span>,<span class="string">&quot;未分析&quot;</span>,path);</span><br><span class="line">      <span class="type">Boolean</span> <span class="variable">result</span> <span class="operator">=</span> analyzeMapper.addNewFile(analyze);</span><br><span class="line">      <span class="comment">//文件的存储</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;/&quot;</span>+originalFilename;</span><br><span class="line">      <span class="comment">//新建一个要保存目录的新文件，将上传的文件法制过去</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dirPath + filePath).mkdirs();</span><br><span class="line">      <span class="type">File</span> <span class="variable">save</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dirPath + filePath).getAbsoluteFile();</span><br><span class="line">      file.transferTo(save);</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用python代码</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;/&quot;</span>+originalFilename;</span><br><span class="line">      <span class="type">String</span> <span class="variable">analyPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\upload\\analyze.py&quot;</span>;</span><br><span class="line">      <span class="type">String</span> <span class="variable">projectPath</span>  <span class="operator">=</span>  <span class="string">&quot;D:\\upload\\&quot;</span>+path+filePath;</span><br><span class="line">      <span class="type">String</span> <span class="variable">savePath</span>  <span class="operator">=</span>  <span class="string">&quot;D:\\upload\\&quot;</span>+path; </span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//这个方法是类似隐形开启了命令执行器，输入指令执行python脚本</span></span><br><span class="line">          <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> Runtime.getRuntime()</span><br><span class="line">                  .exec(<span class="string">&quot;python &quot;</span>+analyPath+<span class="string">&quot;  --filePath &quot;</span>+projectPath);</span><br><span class="line">          <span class="comment">//这种方式获取返回值的方式是需要用python打印输出，然后java去获取命令行的输出，在java返回</span></span><br><span class="line">          <span class="type">InputStreamReader</span> <span class="variable">ir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.getInputStream());</span><br><span class="line">          <span class="type">LineNumberReader</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LineNumberReader</span>(ir);</span><br><span class="line">          <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> input.readLine();<span class="comment">//中文的话这里可能会有乱码，可以尝试转一下不过问题不大</span></span><br><span class="line"><span class="comment">//            result1 = new String(result.getBytes(&quot;iso8859-1&quot;),&quot;utf-8&quot;);</span></span><br><span class="line">          input.close();</span><br><span class="line">          ir.close();</span><br><span class="line">          <span class="type">int</span> <span class="variable">re</span> <span class="operator">=</span> process.waitFor();</span><br><span class="line">          System.out.println(result);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;调用python脚本并读取结果时出错：&quot;</span> + e.getMessage());</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><h5 id="返回一张图片"><a href="#返回一张图片" class="headerlink" title="返回一张图片"></a>返回一张图片</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取图片加载一下</span></span><br><span class="line">      <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(savePath);</span><br><span class="line">      <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">      <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">      <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span>((len = fileInputStream.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">          bos.write(b, <span class="number">0</span>, len);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">byte</span>[] fileByte = bos.toByteArray();</span><br><span class="line">      <span class="comment">//以上为读取图片变成字节数组</span></span><br><span class="line">      <span class="comment">//进行base64位加密</span></span><br><span class="line">      <span class="type">BASE64Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BASE64Encoder</span>();</span><br><span class="line">      <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> encoder.encode(fileByte);</span><br><span class="line">      <span class="comment">//System.out.println(data);</span></span><br><span class="line">      HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">      map.put(<span class="string">&quot;image&quot;</span>,data);</span><br><span class="line">      map.put(<span class="string">&quot;res&quot;</span>,res);</span><br><span class="line">      <span class="keyword">return</span> map;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;Image&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://libs.baidu.com/jquery/1.8.3/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">loada</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      $.<span class="title function_">get</span>(<span class="string">&quot;/test/img&quot;</span>,&#123;&#125;, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> image = data.<span class="property">image</span>;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#Image&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&quot;data:image/png;base64,&quot;</span> + image);<span class="comment">//添加一个属性</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//上传完毕回调</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入一条记录</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into `analyze`(time,file,size,state,path) values (#&#123;time&#125;,#&#123;file&#125;,#&#123;size&#125;,#&#123;state&#125;,#&#123;path&#125;)&quot;)</span></span><br><span class="line">   Boolean <span class="title function_">addNewFile</span><span class="params">(analyze analyze)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询所有记录</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from `analyze` ORDER BY id DESC limit #&#123;Start&#125;,#&#123;Limit&#125;&quot;)</span></span><br><span class="line">   List&lt;analyze&gt; <span class="title function_">pageSensorFile</span><span class="params">( Integer Start, Integer Limit)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//改</span></span><br><span class="line"><span class="meta">@Update(&quot;UPDATE `analyze` SET state=#&#123;state&#125; WHERE (path=#&#123;path&#125;)&quot;)</span></span><br><span class="line">   Boolean <span class="title function_">changeState</span><span class="params">(String state,String path)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删</span></span><br><span class="line"><span class="meta">@Update(&quot;UPDATE `analyze` SET state=#&#123;state&#125; WHERE (path=#&#123;path&#125;)&quot;)</span></span><br><span class="line">   Boolean <span class="title function_">changeState</span><span class="params">(String state,String path)</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;SpringBoot常用模块&quot;&gt;&lt;a href=&quot;#SpringBoot常用模块&quot; class=&quot;headerlink&quot; title=&quot;SpringBoot常用模块&quot;&gt;&lt;/a&gt;SpringBoot常用模块&lt;/h1&gt;&lt;h2 id=&quot;前端&quot;&gt;&lt;a href=&quot;#前端&quot; class=&quot;headerlink&quot; title=&quot;前端&quot;&gt;&lt;/a&gt;前端&lt;/h2&gt;&lt;h3 id=&quot;LayUI-基本的后台管理模板&quot;&gt;&lt;a href=&quot;#LayUI-基本的后台管理模板&quot; class=&quot;headerlink&quot; title=&quot;LayUI 基本的后台管理模板&quot;&gt;&lt;/a&gt;LayUI 基本的后台管理模板&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;下载地址：&lt;a href=&quot;https://fengfeng.lanzoui.com/iLVVnooajzc&quot;&gt;LayUI下载&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;官网地址：&lt;a href=&quot;https://www.layui.com/&quot;&gt;LayUI官网&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="编程" scheme="http://peaky2022.gitee.io/peaky/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="学习" scheme="http://peaky2022.gitee.io/peaky/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="编程" scheme="http://peaky2022.gitee.io/peaky/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>DRL笔记</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/03/15/217f21be.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/03/15/217f21be.html</id>
    <published>2021-03-15T14:44:14.000Z</published>
    <updated>2022-03-03T15:01:47.794Z</updated>
    
    <content type="html"><![CDATA[<h4 id="强化学习介绍"><a href="#强化学习介绍" class="headerlink" title="强化学习介绍"></a>强化学习介绍</h4><p>根据不同的分列方法可以将强化学习算法分成不同的种类：<br><strong>1.基于概率（policy-based）和基于价值（value-based）</strong></p><p>基于概率是强化学习中最直接的一种, 他能通过感官分析所处的环境, 直接输出下一步要采取的各种动作的概率, 然后根据概率采取行动, 所以每种动作都有可能被选中, 只是可能性不同. 而基于价值的方法输出则是所有动作的价值, 我们会根据最高价值来选着动作, 相比基于概率的方法, 基于价值的决策部分更为铁定, 毫不留情, 就选价值最高的, 而基于概率的, 即使某个动作的概率最高, 但是还是不一定会选到他.</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312210405206.png" alt="image-20210312210405206"></p><p>其中policy-based中的典型算法有Policy Gradients，value-based的典型算法有Q-learning、SARSA、DQN，两者重合的典型模型有AC、A2C、A3C</p><span id="more"></span><p><strong>2.在线学习（on-policy）和离线学习（off-policy）</strong></p><p>所谓在线学习（on-policy）, 就是指我必须本人在场, 并且一定是本人边玩边学习, 学习者与环境必须产生实际的交互。</p><p>而离线学习（off-policy）是你可以选择自己玩, 也可以选择看着别人玩, 通过看别人玩来学习别人的行为准则。</p><p>on-policy的典型算法是SARSA， off-policy的典型算法是Q-learning、DQN。</p><p>on-policy是的学习者必学进行完一系列实际动作后才能产生样本，这样效率往往较慢。off-policy可以从以往的经验或别人的动作开学习，效率往往比较高。</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312210627505.png" alt="image-20210312210627505"></p><p><strong>3.model-based和model-free</strong><br>可以将所有强化学习的方法分为理不理解所处环境,如果我们不尝试去理解环境, 环境给了我们什么就是什么. 我们就把这种方法叫做 model-free, 这里的 model 就是用模型来表示环境, 那理解了环境也就是学会了用一个模型来代表环境, 所以这种就是 model-based 方法.</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312210824998.png" alt="image-20210312210824998"></p><h4 id="SARSA算法原理"><a href="#SARSA算法原理" class="headerlink" title="SARSA算法原理"></a>SARSA算法原理</h4><p>强化学习的主要功能就是让agent学习尽可能好的动作action，使其后续获得的奖励尽可能的大。</p><p>假设在时刻t时，处于状态长期奖励为：<br><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/2020032311212617.png" alt="在这里插入图片描述"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312211035990.png" alt="image-20210312211035990"><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312211102633.png" alt="image-20210312211102633"></p><p> <img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312213327171.png" alt="image-20210312213327171"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312213401080.png" alt="image-20210312213401080"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312213418619.png" alt="image-20210312213418619"></p><h4 id="二、SARSA代码"><a href="#二、SARSA代码" class="headerlink" title="二、SARSA代码"></a>二、SARSA代码</h4><p>此处直接参考莫烦python的<a href="https://morvanzhou.github.io/tutorials/machine-learning/reinforcement-learning/1-1-A-RL/">强化学习教程</a>进行代码编写，在基础上说明每一行代码的用途</p><p>1.environment的编写<br>首先RL需要一个环境，因为我们控制不了环境（比如下围棋时我们不不能改变棋盘的大小，何落子方式，只能只能在范围内落在线与线之间的交叉点上），这个环境是不可以改变的，因此后面的Q-learning也将沿用此环境。通常不同的问题有不同环境，我们真正需要关注的是agent即算法逻辑的编写。<br>此处以走方格为例编写一个environment</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312215227492.png" alt="image-20210312215227492"></p><p>maze_env</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Reinforcement learning maze example.</span></span><br><span class="line"><span class="string">Red rectangle:          explorer.</span></span><br><span class="line"><span class="string">Black rectangles:       hells       [reward = -1].</span></span><br><span class="line"><span class="string">Yellow bin circle:      paradise    [reward = +1].</span></span><br><span class="line"><span class="string">All other states:       ground      [reward = 0].</span></span><br><span class="line"><span class="string">This script is the environment part of this example. The RL is in RL_brain.py.</span></span><br><span class="line"><span class="string">View more on my tutorial page: https://morvanzhou.github.io/tutorials/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">if</span> sys.version_info.major == <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">import</span> Tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">UNIT = <span class="number">40</span>   <span class="comment"># pixels</span></span><br><span class="line">MAZE_H = <span class="number">4</span>  <span class="comment"># grid height</span></span><br><span class="line">MAZE_W = <span class="number">4</span>  <span class="comment"># grid width</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Maze</span>(tk.Tk, <span class="built_in">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(Maze, self).__init__()</span><br><span class="line">        self.action_space = [<span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;r&#x27;</span>]</span><br><span class="line">        self.n_actions = <span class="built_in">len</span>(self.action_space)</span><br><span class="line">        self.title(<span class="string">&#x27;maze&#x27;</span>)</span><br><span class="line">        self.geometry(<span class="string">&#x27;&#123;0&#125;x&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(MAZE_H * UNIT, MAZE_H * UNIT))</span><br><span class="line">        self._build_maze()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_maze</span>(<span class="params">self</span>):</span><br><span class="line">        self.canvas = tk.Canvas(self, bg=<span class="string">&#x27;white&#x27;</span>,</span><br><span class="line">                           height=MAZE_H * UNIT,</span><br><span class="line">                           width=MAZE_W * UNIT)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create grids</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, MAZE_W * UNIT, UNIT):</span><br><span class="line">            x0, y0, x1, y1 = c, <span class="number">0</span>, c, MAZE_H * UNIT</span><br><span class="line">            self.canvas.create_line(x0, y0, x1, y1)</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, MAZE_H * UNIT, UNIT):</span><br><span class="line">            x0, y0, x1, y1 = <span class="number">0</span>, r, MAZE_W * UNIT, r</span><br><span class="line">            self.canvas.create_line(x0, y0, x1, y1)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create origin</span></span><br><span class="line">        origin = np.array([<span class="number">20</span>, <span class="number">20</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># hell</span></span><br><span class="line">        hell1_center = origin + np.array([UNIT * <span class="number">2</span>, UNIT])</span><br><span class="line">        self.hell1 = self.canvas.create_rectangle(</span><br><span class="line">            hell1_center[<span class="number">0</span>] - <span class="number">15</span>, hell1_center[<span class="number">1</span>] - <span class="number">15</span>,</span><br><span class="line">            hell1_center[<span class="number">0</span>] + <span class="number">15</span>, hell1_center[<span class="number">1</span>] + <span class="number">15</span>,</span><br><span class="line">            fill=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">        <span class="comment"># hell</span></span><br><span class="line">        hell2_center = origin + np.array([UNIT, UNIT * <span class="number">2</span>])</span><br><span class="line">        self.hell2 = self.canvas.create_rectangle(</span><br><span class="line">            hell2_center[<span class="number">0</span>] - <span class="number">15</span>, hell2_center[<span class="number">1</span>] - <span class="number">15</span>,</span><br><span class="line">            hell2_center[<span class="number">0</span>] + <span class="number">15</span>, hell2_center[<span class="number">1</span>] + <span class="number">15</span>,</span><br><span class="line">            fill=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create oval</span></span><br><span class="line">        oval_center = origin + UNIT * <span class="number">2</span></span><br><span class="line">        self.oval = self.canvas.create_oval(</span><br><span class="line">            oval_center[<span class="number">0</span>] - <span class="number">15</span>, oval_center[<span class="number">1</span>] - <span class="number">15</span>,</span><br><span class="line">            oval_center[<span class="number">0</span>] + <span class="number">15</span>, oval_center[<span class="number">1</span>] + <span class="number">15</span>,</span><br><span class="line">            fill=<span class="string">&#x27;yellow&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create red rect</span></span><br><span class="line">        self.rect = self.canvas.create_rectangle(</span><br><span class="line">            origin[<span class="number">0</span>] - <span class="number">15</span>, origin[<span class="number">1</span>] - <span class="number">15</span>,</span><br><span class="line">            origin[<span class="number">0</span>] + <span class="number">15</span>, origin[<span class="number">1</span>] + <span class="number">15</span>,</span><br><span class="line">            fill=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pack all</span></span><br><span class="line">        self.canvas.pack()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        self.update()</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        self.canvas.delete(self.rect)</span><br><span class="line">        origin = np.array([<span class="number">20</span>, <span class="number">20</span>])</span><br><span class="line">        self.rect = self.canvas.create_rectangle(</span><br><span class="line">            origin[<span class="number">0</span>] - <span class="number">15</span>, origin[<span class="number">1</span>] - <span class="number">15</span>,</span><br><span class="line">            origin[<span class="number">0</span>] + <span class="number">15</span>, origin[<span class="number">1</span>] + <span class="number">15</span>,</span><br><span class="line">            fill=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">        <span class="comment"># return observation</span></span><br><span class="line">        <span class="keyword">return</span> self.canvas.coords(self.rect)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">step</span>(<span class="params">self, action</span>):</span><br><span class="line">        s = self.canvas.coords(self.rect)</span><br><span class="line">        base_action = np.array([<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> action == <span class="number">0</span>:   <span class="comment"># up</span></span><br><span class="line">            <span class="keyword">if</span> s[<span class="number">1</span>] &gt; UNIT:</span><br><span class="line">                base_action[<span class="number">1</span>] -= UNIT</span><br><span class="line">        <span class="keyword">elif</span> action == <span class="number">1</span>:   <span class="comment"># down</span></span><br><span class="line">            <span class="keyword">if</span> s[<span class="number">1</span>] &lt; (MAZE_H - <span class="number">1</span>) * UNIT:</span><br><span class="line">                base_action[<span class="number">1</span>] += UNIT</span><br><span class="line">        <span class="keyword">elif</span> action == <span class="number">2</span>:   <span class="comment"># right</span></span><br><span class="line">            <span class="keyword">if</span> s[<span class="number">0</span>] &lt; (MAZE_W - <span class="number">1</span>) * UNIT:</span><br><span class="line">                base_action[<span class="number">0</span>] += UNIT</span><br><span class="line">        <span class="keyword">elif</span> action == <span class="number">3</span>:   <span class="comment"># left</span></span><br><span class="line">            <span class="keyword">if</span> s[<span class="number">0</span>] &gt; UNIT:</span><br><span class="line">                base_action[<span class="number">0</span>] -= UNIT</span><br><span class="line"></span><br><span class="line">        self.canvas.move(self.rect, base_action[<span class="number">0</span>], base_action[<span class="number">1</span>])  <span class="comment"># move agent</span></span><br><span class="line"></span><br><span class="line">        s_ = self.canvas.coords(self.rect)  <span class="comment"># next state</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># reward function</span></span><br><span class="line">        <span class="keyword">if</span> s_ == self.canvas.coords(self.oval):</span><br><span class="line">            reward = <span class="number">1</span></span><br><span class="line">            done = <span class="literal">True</span></span><br><span class="line">            s_ = <span class="string">&#x27;terminal&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> s_ <span class="keyword">in</span> [self.canvas.coords(self.hell1), self.canvas.coords(self.hell2)]:</span><br><span class="line">            reward = -<span class="number">1</span></span><br><span class="line">            done = <span class="literal">True</span></span><br><span class="line">            s_ = <span class="string">&#x27;terminal&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            reward = <span class="number">0</span></span><br><span class="line">            done = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s_, reward, done</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self</span>):</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        self.update()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>():</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        s = env.reset()</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            env.render()</span><br><span class="line">            a = <span class="number">1</span></span><br><span class="line">            s, r, done = env.step(a)</span><br><span class="line">            <span class="keyword">if</span> done:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    env = Maze()</span><br><span class="line">    env.after(<span class="number">100</span>, update)</span><br><span class="line">    env.mainloop()</span><br></pre></td></tr></table></figure><p><strong>agent</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> maze_env <span class="keyword">import</span> Maze    <span class="comment">#即为上面的environment</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment">#RL的父类定义</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RL</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="comment">#actions为可选动作， learning_rate为学习率，reward_decay为传递奖励是的递减系数gamma，1-e_greed为随机选择其他动作的概率</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, actions, learning_rate=<span class="number">0.01</span>, reward_decay=<span class="number">0.9</span>, e_greedy=<span class="number">0.9</span></span>):</span><br><span class="line">        self.actions = actions</span><br><span class="line">        self.lr = learning_rate</span><br><span class="line">        self.gamma = reward_decay</span><br><span class="line">        self.epsilon = e_greedy</span><br><span class="line">        <span class="comment">#初始化qtable，行为observation的state， 列为当前状态可以选择的action（对于所有列，可以选择的action一样）</span></span><br><span class="line">        self.q_table = pd.DataFrame(columns = self.actions, dtype=np.float64)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">choose_action</span>(<span class="params">self, observation</span>):</span><br><span class="line">        self.check_state_exist(observation)  <span class="comment">#检查当前状态是否存在，不存在就添加这个状态</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> np.random.uniform() &lt; self.epsilon:</span><br><span class="line">            state_action = self.q_table.loc[observation, :]  <span class="comment">#找到当前状态可以选择的动作</span></span><br><span class="line">            <span class="comment">#由于初始化或更新后一个状态下的动作值可能是相同的，为了避免每次都选择相同动作，用random.choice在值最大的action中损及选择一个</span></span><br><span class="line">            action = np.random.choice(state_action[state_action==np.<span class="built_in">max</span>(state_action)].index)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            action = np.random.choice(self.actions)   <span class="comment">#0.1的几率随机选择动作</span></span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_state_exist</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="keyword">if</span> state <span class="keyword">not</span> <span class="keyword">in</span> self.q_table.index:</span><br><span class="line">            <span class="comment">#若找不到该obversation的转态，则添加该状态到新的qtable</span></span><br><span class="line">            <span class="comment">#新的state的动作的q初始值赋值为0，列名为dataframe的列名，index为state</span></span><br><span class="line">            self.q_table = self.q_table.append(pd.Series([<span class="number">0</span>]*<span class="built_in">len</span>(self.actions), index=self.q_table.columns, name=state))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#不同方式的学习方法不同，用可变参数，直接pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learning</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SarsaTable</span>(<span class="title class_ inherited__">RL</span>):  <span class="comment">#继承上面的RL</span></span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="comment">#参数自己定义，含义继承父类RL</span></span><br><span class="line">    <span class="comment">#类方法choose_action、check_state_exist自动继承RL，参数不变</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, actions, learning_rate=<span class="number">0.01</span>, reward_decay=<span class="number">0.9</span>, e_greedy=<span class="number">0.9</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(SarsaTable, self).__init__(actions, learning_rate, reward_decay, e_greedy)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learning</span>(<span class="params">self, s, a,r, s_, a_</span>):</span><br><span class="line">        self.check_state_exist(s_)   <span class="comment">#检查动作后状态s_是否存在</span></span><br><span class="line">        </span><br><span class="line">        q_old = self.q_table.loc[s, a]  <span class="comment">#旧的q[s,a]值</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> s_!=<span class="string">&#x27;terminal&#x27;</span>:</span><br><span class="line">            <span class="comment">#取下个状态s_和动作a_下q值</span></span><br><span class="line">            q_predict = self.q_table.loc[s_, a_]</span><br><span class="line">            q_new = r+self.gamma*q_predict   <span class="comment">#计算新的值</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            q_new = r</span><br><span class="line">        </span><br><span class="line">        self.q_table.loc[s,a] = q_old - self.lr*(q_new - q_old)    <span class="comment">#根据更新公式更新，类似于梯度下降</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>():</span><br><span class="line">    <span class="keyword">for</span> episode <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        <span class="comment">#初始化环境</span></span><br><span class="line">        observation = env.reset()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#根据当前状态选行为</span></span><br><span class="line">        action = RL.choose_action(<span class="built_in">str</span>(observation))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># 刷新环境</span></span><br><span class="line">            env.render()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 在环境中采取行为, 获得下一个 state_ (obervation_), reward, 和是否终止</span></span><br><span class="line">            observation_, reward, done = env.step(action)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#根据observation_选择observation_下应该选择的动作action_</span></span><br><span class="line">            action_ = RL.choose_action(<span class="built_in">str</span>(observation_))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#从当前状态state，当前动作action，奖励r，执行动作后state_，state_下的action_,(s,a,r,s,a)</span></span><br><span class="line">            RL.learning(<span class="built_in">str</span>(observation), action, reward, <span class="built_in">str</span>(observation_), action_)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 将下一个当成下一步的 state (observation) and action。</span></span><br><span class="line">            <span class="comment">#与qlearning的却别是sarsa在observation_下真正执行了动作action_，供下次使用</span></span><br><span class="line">            <span class="comment">#而qlearning中下次状态observation_时还要重新选择action_</span></span><br><span class="line">            observation = observation_</span><br><span class="line">            action = action_</span><br><span class="line">            </span><br><span class="line">             <span class="comment"># 终止时跳出循环</span></span><br><span class="line">        <span class="keyword">if</span> done:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 大循环完毕</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;game over&#x27;</span>)</span><br><span class="line">    env.destroy()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    env = Maze()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#Sarsa和SarsaLambda的调用方式一模一样</span></span><br><span class="line">    <span class="comment">#RL = SarsaTable(actions=list(range(env.n_actions)))</span></span><br><span class="line">    RL = SarsaLambdaTable(actions=<span class="built_in">list</span>(<span class="built_in">range</span>(env.n_actions)))</span><br><span class="line"></span><br><span class="line">    env.after(<span class="number">100</span>, update)</span><br><span class="line">    env.mainloop()</span><br></pre></td></tr></table></figure><h4 id="Q-learning、"><a href="#Q-learning、" class="headerlink" title="Q-learning、"></a>Q-learning、</h4><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315201907446.png" alt="image-20210315201907446"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/20200323154100203.png" alt="在这里插入图片描述"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315202102199.png" alt="image-20210315202102199"></p><p>用同一个env</p><p>qlearnning-agent</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> maze_env <span class="keyword">import</span> Maze</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RL的父类定义</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RL</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    <span class="comment"># actions为可选动作， learning_rate为学习率，reward_decay为传递奖励是的递减系数gamma，1-e_greed为随机选择其他动作的概率</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, actions, learning_rate=<span class="number">0.01</span>, reward_decay=<span class="number">0.9</span>, e_greedy=<span class="number">0.9</span></span>):</span><br><span class="line">        self.actions = actions</span><br><span class="line">        self.lr = learning_rate</span><br><span class="line">        self.gamma = reward_decay</span><br><span class="line">        self.epsilon = e_greedy</span><br><span class="line">        <span class="comment"># 初始化qtable，行为observation的state， 列为当前状态可以选择的action（对于所有列，可以选择的action一样）</span></span><br><span class="line">        self.q_table = pd.DataFrame(columns=self.actions, dtype=np.float64)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">choose_action</span>(<span class="params">self, observation</span>):</span><br><span class="line">        self.check_state_exist(observation)  <span class="comment"># 检查当前状态是否存在，不存在就添加这个状态</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> np.random.uniform() &lt; self.epsilon:</span><br><span class="line">            state_action = self.q_table.loc[observation, :]  <span class="comment"># 找到当前状态可以选择的动作</span></span><br><span class="line">            <span class="comment"># 由于初始化或更新后一个状态下的动作值可能是相同的，为了避免每次都选择相同动作，用random.choice在值最大的action中损及选择一个</span></span><br><span class="line">            action = np.random.choice(state_action[state_action == np.<span class="built_in">max</span>(state_action)].index)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            action = np.random.choice(self.actions)  <span class="comment"># 0.1的几率随机选择动作</span></span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_state_exist</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="keyword">if</span> state <span class="keyword">not</span> <span class="keyword">in</span> self.q_table.index:</span><br><span class="line">            <span class="comment"># 若找不到该obversation的转态，则添加该状态到新的qtable</span></span><br><span class="line">            <span class="comment"># 新的state的动作的q初始值赋值为0，列名为dataframe的列名，index为state</span></span><br><span class="line">            self.q_table = self.q_table.append(</span><br><span class="line">                pd.Series([<span class="number">0</span>] * <span class="built_in">len</span>(self.actions), index=self.q_table.columns, name=state))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 不同方式的学习方法不同，用可变参数，直接pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learning</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># QLearning继承RL</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QLearningTable</span>(<span class="title class_ inherited__">RL</span>):</span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    <span class="comment"># 参数自己定义，含义继承父类RL</span></span><br><span class="line">    <span class="comment"># 类方法choose_action、check_state_exist自动继承RL，参数不变</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, actions, learning_rate=<span class="number">0.01</span>, reward_decay=<span class="number">0.9</span>, e_greedy=<span class="number">0.9</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(QLearningTable, self).__init__(actions, learning_rate, reward_decay, e_greedy)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根绝当前观察状态s，选择动作a，选择动作后的奖励r，和执行动作后的状态s_，来更新qtable</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learning</span>(<span class="params">self, s, a, r, s_</span>):</span><br><span class="line">        self.check_state_exist(s_)  <span class="comment"># 检查动作后状态s_是否存在</span></span><br><span class="line"></span><br><span class="line">        q_old = self.q_table.loc[s, a]  <span class="comment"># 旧的q[s,a]值</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> s_ != <span class="string">&#x27;terminal&#x27;</span>:</span><br><span class="line">            <span class="comment"># 下个状态下最大的值</span></span><br><span class="line">            max_s_ = self.q_table.loc[s_, :].<span class="built_in">max</span>()</span><br><span class="line">            q_new = r + self.gamma * max_s_  <span class="comment"># 计算新的值</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            q_new = r</span><br><span class="line"></span><br><span class="line">        self.q_table.loc[s, a] = q_old - self.lr * (q_new - q_old)  <span class="comment"># 根据更新公式更新，类似于梯度下降</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update</span>():</span><br><span class="line">    <span class="keyword">for</span> episode <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        <span class="comment"># 初始化 state 的观测值</span></span><br><span class="line">        observation = env.reset()  <span class="comment"># 每轮训练都要初始化观测值，即回到原点状态</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            env.render()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># RL 大脑根据 state 的观测值挑选 action</span></span><br><span class="line">            action = RL.choose_action(<span class="built_in">str</span>(observation))  <span class="comment"># qlearning采用greeed方法，选择q值最大的action</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 探索者在环境中实施这个 action, 并得到环境返回的下一个 state 观测值, reward 和 done (是否是掉下地狱或者升上天堂)</span></span><br><span class="line">            <span class="comment"># 是根据当前选择动作，观察到的采取动作后的状态和奖励</span></span><br><span class="line">            observation_, reward, done = env.step(action)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># RL 从这个序列 (state, action, reward, state_) 中学习</span></span><br><span class="line">            <span class="comment"># 根绝旧observation的q值，和采取动作，以及奖励和采取动作后的observation_的最大q值进行更新</span></span><br><span class="line">            RL.learning(<span class="built_in">str</span>(observation), action, reward, <span class="built_in">str</span>(observation_))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 将下一个 state 的值传到下一次循环</span></span><br><span class="line">            observation = observation_</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> done:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 结束游戏并关闭窗口</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;game over&#x27;</span>)</span><br><span class="line">    env.destroy()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 定义环境 env 和 RL 方式</span></span><br><span class="line">    env = Maze()</span><br><span class="line">    RL = QLearningTable(actions=<span class="built_in">list</span>(<span class="built_in">range</span>(env.n_actions)))</span><br><span class="line">    <span class="comment"># 开始可视化环境 env</span></span><br><span class="line">    env.after(<span class="number">100</span>, update)</span><br><span class="line">    env.mainloop()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>唯一不同是on -&gt;off</p><p>并未真正执行a’，而是选择所有a中Q值最大的一项；</p><h5 id="DQN"><a href="#DQN" class="headerlink" title="DQN"></a>DQN</h5><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315202734362.png" alt="image-20210315202734362"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315203248027.png" alt="image-20210315203248027"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315203406102.png" alt="image-20210315203406102"></p><p>DQN的算法</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/20200323172714471.png" alt="在这里插入图片描述"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315204554812.png" alt="image-20210315204554812"></p><h5 id="学习策略：observation"><a href="#学习策略：observation" class="headerlink" title="学习策略：observation"></a>学习策略：observation</h5><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315213257698.png" alt="image-20210315213257698"></p><p><strong>更新方式一</strong>：更新慢，需要将所有的动作执行完才能更新</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315205418821.png" alt="image-20210315205418821"></p><p><strong><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/20200323190859264.png" alt="在这里插入图片描述">更新方式二</strong>：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/20200323191743435.png" alt="在这里插入图片描述"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315211111470.png" alt="image-20210315211111470"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315211131717.png" alt="image-20210315211131717"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315221326359.png" alt="image-20210315221326359"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315221342578.png" alt="image-20210315221342578"></p><p>但上面算法中，也有一些与Q-learning不同的地方，这是使DQN变得更加有效和技巧：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315221711848.png" alt="image-20210315221711848"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210315221729557.png" alt="image-20210315221729557"></p><h4 id="Dobule-DQN"><a href="#Dobule-DQN" class="headerlink" title="Dobule DQN"></a>Dobule DQN</h4><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316191813210.png" alt="image-20210316191813210"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316193812638.png" alt="image-20210316193812638"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316193825686.png" alt="image-20210316193825686"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316193923094.png" alt="image-20210316193923094"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316193946037.png" alt="image-20210316193946037"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316194102502.png" alt="image-20210316194102502"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Double_DeepQNetwork</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment">#replace_target_iter为更新target network的步数，防止target network和eval network差别过大</span></span><br><span class="line">    <span class="comment">#memory_size为buffer储存记忆上线，方便使用以前记忆学习</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_actions, n_features,learning_rate=<span class="number">0.01</span>,reward_decay=<span class="number">0.9</span>,e_greedy=<span class="number">0.9</span>,replace_target_iter=<span class="number">300</span>,memory_size=<span class="number">500</span>,batch_size=<span class="number">32</span>,e_greedy_increment=<span class="literal">None</span>,output_graph=<span class="literal">False</span></span>):</span><br><span class="line">        self.n_actions = n_actions</span><br><span class="line">        self.n_features = n_features</span><br><span class="line">        self.lr = learning_rate</span><br><span class="line">        self.gamma = reward_decay</span><br><span class="line">        self.epsilon_max = e_greedy     <span class="comment"># epsilon后面奖励对前面的递减参数</span></span><br><span class="line">        self.replace_target_iter = replace_target_iter  <span class="comment"># 更换 target_net 的步数</span></span><br><span class="line">        self.memory_size = memory_size  <span class="comment"># 记忆上限</span></span><br><span class="line">        self.batch_size = batch_size    <span class="comment"># 每次更新时从 memory 里面取多少记忆出来</span></span><br><span class="line">        self.epsilon_increment = e_greedy_increment <span class="comment"># epsilon 的增量</span></span><br><span class="line">        <span class="comment">#epsilon = 0等于0时，后面的奖励创传不到前面，前面的状态就开启随机探索模式</span></span><br><span class="line">        self.epsilon = <span class="number">0</span> <span class="keyword">if</span> e_greedy_increment <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> self.epsilon_max <span class="comment"># 是否开启探索模式, 并逐步减少探索次数</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录学习次数 (用于判断是否更换 target_net 参数)</span></span><br><span class="line">        self.learn_step_counter = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化全 0 记忆 [s, a, r, s_]， 实际上feature为状态的维度，n_features*2分别记录s和s_，+2记录a和r</span></span><br><span class="line">        self.memory = np.zeros((self.memory_size, n_features*<span class="number">2</span>+<span class="number">2</span>))</span><br><span class="line">        </span><br><span class="line">        self._build_net()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#替换 target net 的参数</span></span><br><span class="line">        t_params = tf.get_collection(<span class="string">&#x27;target_net_params&#x27;</span>)  <span class="comment">#提取 target_net 的参数</span></span><br><span class="line">        e_params = tf.get_collection(<span class="string">&#x27;eval_net_params&#x27;</span>)   <span class="comment"># 提取  eval_net 的参数</span></span><br><span class="line">        <span class="comment">#将eval_network中每一个variable的值赋值给target network的对应变量</span></span><br><span class="line">        self.replace_target_op = [tf.assign(t, e) <span class="keyword">for</span> t, e <span class="keyword">in</span> <span class="built_in">zip</span>(t_params, e_params)] <span class="comment">#更新 target_net 参数</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        self.sess = tf.Session()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> output_graph:</span><br><span class="line">            tf.summary.FileWriter(<span class="string">&quot;logs/&quot;</span>, self.sess.graph)</span><br><span class="line">        </span><br><span class="line">        self.sess.run(tf.global_variables_initializer())</span><br><span class="line">        <span class="comment">#用于记录# 记录所有 cost 变化</span></span><br><span class="line">        self.cost_his = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#李宏毅老师克重的relpay buffer，通过以往的记忆中不断训练</span></span><br><span class="line">    <span class="comment">#这是DQN变为off-policy的核心</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">store_transition</span>(<span class="params">self, s, a, r, s_</span>):</span><br><span class="line">        <span class="comment">#如果DeepQNetwork中定义了memory_counter，进行记忆存储</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;memory_counter&#x27;</span>):</span><br><span class="line">            self.memory_counter = <span class="number">0</span></span><br><span class="line">        <span class="comment">#记录一条 [s, a, r, s_] 记录</span></span><br><span class="line">        transition = np.hstack((s, [a, r], s_))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#总 memory 大小是固定的, 如果超出总大小, 旧 memory 就被新 memory 替换</span></span><br><span class="line">        index = self.memory_counter % self.memory_size  <span class="comment">#类似hashmap赋值思想</span></span><br><span class="line">        self.memory[index, :] = transition  <span class="comment">#进行替换</span></span><br><span class="line">        </span><br><span class="line">        self.memory_counter += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">#建立神经网络</span></span><br><span class="line">    <span class="comment">#此处建立两个申请网络，一个为target network，用于得到q现实。一个为eval_network，用于得到q估计</span></span><br><span class="line">    <span class="comment">#target network和eval_network结构一样，target network用比较老的参数，eval_network为真正训练的神经网络</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_net</span>(<span class="params">self</span>):</span><br><span class="line">        tf.reset_default_graph()  <span class="comment">#清空计算图</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#创建eval神经网络,及时提升参数</span></span><br><span class="line">        self.s = tf.placeholder(tf.float32, [<span class="literal">None</span>, self.n_features], name=<span class="string">&#x27;s&#x27;</span>)  <span class="comment"># 用来接收 observation，即神经网络的输入</span></span><br><span class="line">        self.q_target = tf.placeholder(tf.float32, [<span class="literal">None</span>, self.n_actions], name=<span class="string">&#x27;Q_target&#x27;</span>) <span class="comment"># q_target的值, 这个之后会通过计算得到，神经网络的输出</span></span><br><span class="line">        <span class="comment">#eval_net域下的变量</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;eval_net&#x27;</span>):</span><br><span class="line">            <span class="comment">#c_names用于在一定步数之后更新target network</span></span><br><span class="line">            <span class="comment">#GLOBAL_VARIABLES作用是collection默认加入所有的Variable对象，用于共享</span></span><br><span class="line">            c_names = [<span class="string">&#x27;eval_net_params&#x27;</span>, tf.GraphKeys.GLOBAL_VARIABLES]</span><br><span class="line">            n_l1 = <span class="number">10</span>  <span class="comment">#n_l1为network隐藏层神经元的个数 </span></span><br><span class="line">            w_initializer = tf.random_normal_initializer(<span class="number">0.</span>,<span class="number">0.3</span>)  </span><br><span class="line">            b_initializer = tf.constant_initializer(<span class="number">0.1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#eval_network第一层全连接神经网络</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;l1&#x27;</span>):</span><br><span class="line">                w1 = tf.get_variable(<span class="string">&#x27;w1&#x27;</span>, [self.n_features, n_l1], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b1 = tf.get_variable(<span class="string">&#x27;b1&#x27;</span>, [<span class="number">1</span>, n_l1], initializer=b_initializer, collections=c_names)</span><br><span class="line">                l1 = tf.nn.relu(tf.matmul(self.s, w1)+b1)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#eval_network第二层全连接神经网络</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;l1&#x27;</span>):</span><br><span class="line">                w2 = tf.get_variable(<span class="string">&#x27;w2&#x27;</span>, [n_l1, self.n_actions], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b2 = tf.get_variable(<span class="string">&#x27;b2&#x27;</span>, [<span class="number">1</span>, self.n_actions], initializer=b_initializer, collections=c_names)</span><br><span class="line">                <span class="comment">#求出q估计值，长度为n_actions的向量</span></span><br><span class="line">                self.q_eval = tf.matmul(l1, w2) + b2</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;loss&#x27;</span>): <span class="comment"># 求误差</span></span><br><span class="line">            <span class="comment">#使用平方误差</span></span><br><span class="line">            self.loss = tf.reduce_mean(tf.squared_difference(self.q_target, self.q_eval))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;train&#x27;</span>):    <span class="comment"># 梯度下降</span></span><br><span class="line">            optimizer = tf.train.RMSPropOptimizer(self.lr)</span><br><span class="line">            self._train_op = optimizer.minimize(self.loss)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#创建target network，输入选择一个action后的状态s_,输出q_target</span></span><br><span class="line">        self.s_ = tf.placeholder(tf.float32, [<span class="literal">None</span>, self.n_features], name=<span class="string">&#x27;s_&#x27;</span>)    <span class="comment"># 接收下个 observation</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;target_net&#x27;</span>):</span><br><span class="line">            c_names = [<span class="string">&#x27;target_net_params&#x27;</span>, tf.GraphKeys.GLOBAL_VARIABLES]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># target_net 的第一层fc， collections 是在更新 target_net 参数时会用到</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;l1&#x27;</span>):</span><br><span class="line">                w1 = tf.get_variable(<span class="string">&#x27;w1&#x27;</span>, [self.n_features, n_l1], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b1 = tf.get_variable(<span class="string">&#x27;b1&#x27;</span>, [<span class="number">1</span>, n_l1], initializer=b_initializer, collections=c_names)</span><br><span class="line">                l1 = tf.nn.relu(tf.matmul(self.s_, w1) + b1)</span><br><span class="line">                </span><br><span class="line">            <span class="comment"># target_net 的第二层fc</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;l2&#x27;</span>):</span><br><span class="line">                w2 = tf.get_variable(<span class="string">&#x27;w2&#x27;</span>, [n_l1, self.n_actions], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b2 = tf.get_variable(<span class="string">&#x27;b2&#x27;</span>, [<span class="number">1</span>, self.n_actions], initializer=b_initializer, collections=c_names)</span><br><span class="line">                <span class="comment">#申请网络输出</span></span><br><span class="line">                self.q_next = tf.matmul(l1, w2) + b2</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">print</span>(self.q_next)</span><br><span class="line">                </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">choose_action</span>(<span class="params">self, observation</span>):</span><br><span class="line">        <span class="comment">#根据observation（state）选行为</span></span><br><span class="line">        <span class="comment">#使用eval network选出state下的行为估计</span></span><br><span class="line">        <span class="comment">#将observation的shape变为(1, size_of_observation)，行向量变为列向量才能与NN维度统一</span></span><br><span class="line">        observation = observation[np.newaxis, :]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> np.random.uniform() &lt; self.epsilon:</span><br><span class="line">            action_value = self.sess.run(self.q_eval, feed_dict=&#123;self.s:observation&#125;)</span><br><span class="line">            action = np.argmax(action_value)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            action = np.random.randint(<span class="number">0</span>, self.n_actions)   <span class="comment">#随机选择</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learn</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.learn_step_counter % self.replace_target_iter ==<span class="number">0</span>:</span><br><span class="line">            self.sess.run(self.replace_target_op)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\ntarget_params_replaced\n&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#从memory中随机抽取batch_size这么多记忆</span></span><br><span class="line">        <span class="keyword">if</span> self.memory_counter &gt; self.memory_size:   <span class="comment">#说明记忆库已经存满，可以从记忆库任意位置收取</span></span><br><span class="line">            sample_index = np.random.choice(self.memory_size, size=self.batch_size)</span><br><span class="line">        <span class="keyword">else</span>:   <span class="comment">#记忆库还没有存满，从现有的存储记忆提取</span></span><br><span class="line">            sample_index = np.random.choice(self.memory_counter, size=self.batch_size)</span><br><span class="line">        </span><br><span class="line">        batch_memory= self.memory[sample_index, :]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取q_next即q现实(target_net产生的q)和q_eval(eval_net产生的q)</span></span><br><span class="line">        <span class="comment">#q_next和q_eval都是一个向量，包含了对应状态下所有动作的q值</span></span><br><span class="line">        <span class="comment">#实际上feature为状态的维度，batch_memory[:, -self.n_features:]为s_,即状态s采取动作action后的状态s_, batch_memory[:, :self.n_features]为s</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取q_next即q现实(target_net产生的q)和q_eval(eval_net产生的q)</span></span><br><span class="line">        <span class="comment">#q_next和q_eval都是一个向量，包含了对应状态下所有动作的q值</span></span><br><span class="line">        <span class="comment">#实际上feature为状态的维度，batch_memory[:, -self.n_features:]为s_,即状态s采取动作action后的状态s_, batch_memory[:, :self.n_features]为s</span></span><br><span class="line">        <span class="comment">#q_next, q_eval的维度为[None,n_actions]</span></span><br><span class="line">        q_next, q_eval = self.sess.run([self.q_next, self.q_eval], feed_dict=&#123;self.s_: batch_memory[:, -self.n_features:],self.s: batch_memory[:, :self.n_features]&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#用t+1的状态带入eval network先选出动作</span></span><br><span class="line">        action_value = self.sess.run(self.q_eval, feed_dict=&#123;self.s: batch_memory[:, -self.n_features:]&#125;)</span><br><span class="line">        <span class="comment">#维度为[batch_size, 1]</span></span><br><span class="line">        action = np.argmax(action_value, axis=<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#下面这几步十分重要. q_next, q_eval 包含所有 action 的值, 而我们需要的只是已经选择好的 action 的值, 其他的并不需要.所以我们将其他的 action 值全变成 0, 将用到的 action 误差值 反向传递回去, 作为更新凭据.</span></span><br><span class="line">        <span class="comment">#这是我们最终要达到的样子, 比如 q_target - q_eval = [1, 0, 0] - [-1, 0, 0] = [2, 0, 0]</span></span><br><span class="line">        <span class="comment"># q_eval = [-1, 0, 0] 表示这一个记忆中有我选用过 action 0, 而action0带来的 Q(s, a0)=-1,而其他的 Q(s, a1)=Q(s, a2)=0</span></span><br><span class="line">        <span class="comment"># q_target = [1, 0, 0] 表示这个记忆中的 r+gamma*maxQ(s_) = 1, 而且不管在 s_ 上我们取了哪个 action</span></span><br><span class="line">        <span class="comment"># 我们都需要对应上 q_eval 中的 action 位置, 所以就将 q_target的1放在了 action0的位置.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 下面也是为了达到上面说的目的, 不过为了更方面让程序运算, 达到目的的过程有点不同.# 是将 q_eval 全部赋值给 q_target, 这时 q_target-q_eval 全为 0,</span></span><br><span class="line">        <span class="comment"># 不过 我们再根据 batch_memory 当中的 action 这个 column 来给 q_target 中的对应的 memory-action 位置来修改赋值.</span></span><br><span class="line">        <span class="comment"># 使新的赋值为 reward + gamma * maxQ(s_), 这样 q_target-q_eval 就可以变成我们所需的样子.</span></span><br><span class="line">        q_target = q_eval.copy()</span><br><span class="line">        <span class="comment">#每个样本下标</span></span><br><span class="line">        batch_index = np.arange(self.batch_size, dtype=np.int32)</span><br><span class="line">        <span class="comment">#记录每个样本执行的动作</span></span><br><span class="line">        eval_act_index = batch_memory[:, self.n_features].astype(<span class="built_in">int</span>)</span><br><span class="line">        <span class="comment">#记录每个样本动作的奖励</span></span><br><span class="line">        reward = batch_memory[:, self.n_features + <span class="number">1</span>]</span><br><span class="line">        <span class="comment">#生成每个样本中q值对应动作的更新，即生成的q现实， </span></span><br><span class="line">        q_target[batch_index, eval_act_index]=reward+self.gamma * q_next[batch_index, action] </span><br><span class="line">        </span><br><span class="line">        <span class="comment">#假如在这个 batch 中, 我们有2个提取的记忆, 根据每个记忆可以生产3个 action 的值:</span></span><br><span class="line">        <span class="comment">#q_eval =[[1, 2, 3],[4, 5, 6]]， 另q_target = q_eval.copy()</span></span><br><span class="line">        <span class="comment">#然后根据 memory 当中的具体 action 位置来修改 q_target 对应 action 上的值:</span></span><br><span class="line">        <span class="comment">#比如在:记忆 0 的 q_target 计算值是 -1, 而且我用了 action 0;忆1的 q_target 计算值是-2, 而且我用了 action 2:</span></span><br><span class="line">        <span class="comment">#q_target =[[-1, 2, 3],[4, 5, -2]]</span></span><br><span class="line">        <span class="comment">#所以 (q_target - q_eval) 就变成了:[[(-1)-(1), 0, 0],[0, 0, (-2)-(6)]]</span></span><br><span class="line">        <span class="comment">#最后我们将这个 (q_target - q_eval) 当成误差, 反向传递会神经网络</span></span><br><span class="line">        <span class="comment">#所有为 0 的 action 值是当时没有选择的 action, 之前有选择的 action 才有不为0的值.</span></span><br><span class="line">        <span class="comment">#我们只反向传递之前选择的 action 的值,</span></span><br><span class="line">        _, self.cost = self.sess.run([self._train_op, self.loss],feed_dict=&#123;self.s: batch_memory[:, :self.n_features],self.q_target: q_target&#125;)</span><br><span class="line">        </span><br><span class="line">        self.cost_his.append(self.cost) <span class="comment"># 记录 cost 误差</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#每调用一次learn，降低一次epsilon，即行为随机性</span></span><br><span class="line">        self.epsilon = self.epsilon + self.epsilon_increment <span class="keyword">if</span> self.epsilon &lt; self.epsilon_max <span class="keyword">else</span> self.epsilon_max</span><br><span class="line">        </span><br><span class="line">        self.learn_step_counter += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">plot_cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">        plt.plot(np.arange(<span class="built_in">len</span>(self.cost_his)), self.cost_his)</span><br><span class="line">        plt.ylabel(<span class="string">&#x27;Cost&#x27;</span>)</span><br><span class="line">        plt.xlabel(<span class="string">&#x27;training steps&#x27;</span>)</span><br><span class="line">        plt.show()</span><br></pre></td></tr></table></figure><p>Double-DQN的agent编写与DQN几乎一样只是在求q估计的时候先用eval network求出价值最大的动作，再讲这个动作带入target network。<br>之前在DQN中使用的公式为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">q_target[batch_index, eval_act_index]=reward+self.gamma * np.<span class="built_in">max</span>(q_next, axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#改为：</span></span><br><span class="line"><span class="comment">#用t+1的状态带入eval network先选出动作</span></span><br><span class="line">action_value = self.sess.run(self.q_eval, feed_dict=&#123;self.s: batch_memory[:, -self.n_features:]&#125;)</span><br><span class="line"><span class="comment">#维度为[batch_size, 1]</span></span><br><span class="line">action = np.argmax(action_value, axis=<span class="number">1</span>)</span><br><span class="line">q_target[batch_index, eval_act_index]=reward+self.gamma * q_next[batch_index, action]</span><br></pre></td></tr></table></figure><h4 id="Duling-DQN"><a href="#Duling-DQN" class="headerlink" title="Duling DQN"></a>Duling DQN</h4><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316204901396.png" alt="image-20210316204901396"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316204930844.png" alt="image-20210316204930844"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316205031940.png" alt="image-20210316205031940"></p><p>Dueling DQN与DQN的网络结构不同，其他过程相似。着重是更改原来DQN Agent的build_net()方法。<br>之前构建的方式是通过一个隐藏层直接获得q值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;l1&#x27;</span>):</span><br><span class="line">                w2 = tf.get_variable(<span class="string">&#x27;w2&#x27;</span>, [n_l1, self.n_actions], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b2 = tf.get_variable(<span class="string">&#x27;b2&#x27;</span>, [<span class="number">1</span>, self.n_actions], initializer=b_initializer, collections=c_names)</span><br><span class="line">                <span class="comment">#求出q估计值，长度为n_actions的向量</span></span><br><span class="line">                self.q_eval = tf.matmul(l1, w2) + b2</span><br><span class="line">                </span><br><span class="line"><span class="comment">#现在将q_eval 拆分为状态价值v和动作价值a，其中动作价值a的均值为0（q_target需要做同样的改动）：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#状态的价值</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;value&#x27;</span>):</span><br><span class="line">                w21 = tf.get_variable(<span class="string">&#x27;w21&#x27;</span>, [n_l1, <span class="number">1</span>], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b21 = tf.get_variable(<span class="string">&#x27;b21&#x27;</span>, [<span class="number">1</span>], initializer=b_initializer, collections=c_names)</span><br><span class="line">                vs_out = tf.matmul(l1, w21) + b21</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#动作的advantage</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;advantage&#x27;</span>):</span><br><span class="line">                w22 = tf.get_variable(<span class="string">&#x27;w22&#x27;</span>, [n_l1, self.n_actions], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b22 = tf.get_variable(<span class="string">&#x27;b22&#x27;</span>, [<span class="number">1</span>, self.n_actions], initializer=b_initializer, collections=c_names)</span><br><span class="line">                aa = tf.matmul(l1, w22) + b22</span><br><span class="line">                <span class="comment">#为了不让A直接学成了Q, 我们减掉了A的均值，此时A的均值始终为0</span></span><br><span class="line">                aa_out = aa - tf.reduce_mean(aa, axis=<span class="number">1</span>, keep_dims=<span class="literal">True</span>)</span><br><span class="line">                </span><br><span class="line">            <span class="comment">#合并V和A, 求出q估计值</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;Q&#x27;</span>):</span><br><span class="line">                self.q_eval = vs_out + aa_out</span><br><span class="line">                </span><br><span class="line">               </span><br></pre></td></tr></table></figure><p>完整的dueling DQN的Agent的代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dueling_DeepQNetwork</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment">#replace_target_iter为更新target network的步数，防止target network和eval network差别过大</span></span><br><span class="line">    <span class="comment">#memory_size为buffer储存记忆上线，方便使用以前记忆学习</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_actions, n_features,learning_rate=<span class="number">0.01</span>,reward_decay=<span class="number">0.9</span>,e_greedy=<span class="number">0.9</span>,replace_target_iter=<span class="number">300</span>,memory_size=<span class="number">500</span>,batch_size=<span class="number">32</span>,e_greedy_increment=<span class="literal">None</span>,output_graph=<span class="literal">False</span></span>):</span><br><span class="line">        self.n_actions = n_actions</span><br><span class="line">        self.n_features = n_features</span><br><span class="line">        self.lr = learning_rate</span><br><span class="line">        self.gamma = reward_decay</span><br><span class="line">        self.epsilon_max = e_greedy     <span class="comment"># epsilon后面奖励对前面的递减参数</span></span><br><span class="line">        self.replace_target_iter = replace_target_iter  <span class="comment"># 更换 target_net 的步数</span></span><br><span class="line">        self.memory_size = memory_size  <span class="comment"># 记忆上限</span></span><br><span class="line">        self.batch_size = batch_size    <span class="comment"># 每次更新时从 memory 里面取多少记忆出来</span></span><br><span class="line">        self.epsilon_increment = e_greedy_increment <span class="comment"># epsilon 的增量</span></span><br><span class="line">        <span class="comment">#epsilon = 0等于0时，后面的奖励创传不到前面，前面的状态就开启随机探索模式</span></span><br><span class="line">        self.epsilon = <span class="number">0</span> <span class="keyword">if</span> e_greedy_increment <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> self.epsilon_max <span class="comment"># 是否开启探索模式, 并逐步减少探索次数</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 记录学习次数 (用于判断是否更换 target_net 参数)</span></span><br><span class="line">        self.learn_step_counter = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化全 0 记忆 [s, a, r, s_]， 实际上feature为状态的维度，n_features*2分别记录s和s_，+2记录a和r</span></span><br><span class="line">        self.memory = np.zeros((self.memory_size, n_features*<span class="number">2</span>+<span class="number">2</span>))</span><br><span class="line">        </span><br><span class="line">        self._build_net()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#替换 target net 的参数</span></span><br><span class="line">        t_params = tf.get_collection(<span class="string">&#x27;target_net_params&#x27;</span>)  <span class="comment">#提取 target_net 的参数</span></span><br><span class="line">        e_params = tf.get_collection(<span class="string">&#x27;eval_net_params&#x27;</span>)   <span class="comment"># 提取  eval_net 的参数</span></span><br><span class="line">        <span class="comment">#将eval_network中每一个variable的值赋值给target network的对应变量</span></span><br><span class="line">        self.replace_target_op = [tf.assign(t, e) <span class="keyword">for</span> t, e <span class="keyword">in</span> <span class="built_in">zip</span>(t_params, e_params)] <span class="comment">#更新 target_net 参数</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        self.sess = tf.Session()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> output_graph:</span><br><span class="line">            tf.summary.FileWriter(<span class="string">&quot;logs/&quot;</span>, self.sess.graph)</span><br><span class="line">        </span><br><span class="line">        self.sess.run(tf.global_variables_initializer())</span><br><span class="line">        <span class="comment">#用于记录# 记录所有 cost 变化</span></span><br><span class="line">        self.cost_his = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#李宏毅老师克重的relpay buffer，通过以往的记忆中不断训练</span></span><br><span class="line">    <span class="comment">#这是DQN变为off-policy的核心</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">store_transition</span>(<span class="params">self, s, a, r, s_</span>):</span><br><span class="line">        <span class="comment">#如果DeepQNetwork中定义了memory_counter，进行记忆存储</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;memory_counter&#x27;</span>):</span><br><span class="line">            self.memory_counter = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#记录一条 [s, a, r, s_] 记录</span></span><br><span class="line">        transition = np.hstack((s, [a, r], s_))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#总 memory 大小是固定的, 如果超出总大小, 旧 memory 就被新 memory 替换</span></span><br><span class="line">        index = self.memory_counter % self.memory_size  <span class="comment">#类似hashmap赋值思想</span></span><br><span class="line">        self.memory[index, :] = transition  <span class="comment">#进行替换</span></span><br><span class="line">        </span><br><span class="line">        self.memory_counter += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">#建立神经网络</span></span><br><span class="line">    <span class="comment">#此处建立两个申请网络，一个为target network，用于得到q现实。一个为eval_network，用于得到q估计</span></span><br><span class="line">    <span class="comment">#target network和eval_network结构一样，target network用比较老的参数，eval_network为真正训练的神经网络</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_net</span>(<span class="params">self</span>):</span><br><span class="line">        tf.reset_default_graph()  <span class="comment">#清空计算图</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#创建eval神经网络,及时提升参数</span></span><br><span class="line">        self.s = tf.placeholder(tf.float32, [<span class="literal">None</span>, self.n_features], name=<span class="string">&#x27;s&#x27;</span>)  <span class="comment"># 用来接收 observation，即神经网络的输入</span></span><br><span class="line">        self.q_target = tf.placeholder(tf.float32, [<span class="literal">None</span>, self.n_actions], name=<span class="string">&#x27;Q_target&#x27;</span>) <span class="comment"># q_target的值, 这个之后会通过计算得到，神经网络的输出</span></span><br><span class="line">        <span class="comment">#eval_net域下的变量</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;eval_net&#x27;</span>):</span><br><span class="line">            <span class="comment">#c_names用于在一定步数之后更新target network</span></span><br><span class="line">            <span class="comment">#GLOBAL_VARIABLES作用是collection默认加入所有的Variable对象，用于共享</span></span><br><span class="line">            c_names = [<span class="string">&#x27;eval_net_params&#x27;</span>, tf.GraphKeys.GLOBAL_VARIABLES]</span><br><span class="line">            n_l1 = <span class="number">10</span>  <span class="comment">#n_l1为network隐藏层神经元的个数 </span></span><br><span class="line">            w_initializer = tf.random_normal_initializer(<span class="number">0.</span>,<span class="number">0.3</span>)  </span><br><span class="line">            b_initializer = tf.constant_initializer(<span class="number">0.1</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#eval_network第一层全连接神经网络</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;l1&#x27;</span>):</span><br><span class="line">                w1 = tf.get_variable(<span class="string">&#x27;w1&#x27;</span>, [self.n_features, n_l1], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b1 = tf.get_variable(<span class="string">&#x27;b1&#x27;</span>, [<span class="number">1</span>, n_l1], initializer=b_initializer, collections=c_names)</span><br><span class="line">                l1 = tf.nn.relu(tf.matmul(self.s, w1)+b1)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#状态的价值</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;value&#x27;</span>):</span><br><span class="line">                w21 = tf.get_variable(<span class="string">&#x27;w21&#x27;</span>, [n_l1, <span class="number">1</span>], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b21 = tf.get_variable(<span class="string">&#x27;b21&#x27;</span>, [<span class="number">1</span>], initializer=b_initializer, collections=c_names)</span><br><span class="line">                vs_out = tf.matmul(l1, w21) + b21</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#动作的advantage</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;advantage&#x27;</span>):</span><br><span class="line">                w22 = tf.get_variable(<span class="string">&#x27;w22&#x27;</span>, [n_l1, self.n_actions], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b22 = tf.get_variable(<span class="string">&#x27;b22&#x27;</span>, [<span class="number">1</span>, self.n_actions], initializer=b_initializer, collections=c_names)</span><br><span class="line">                aa = tf.matmul(l1, w22) + b22</span><br><span class="line">                <span class="comment">#为了不让A直接学成了Q, 我们减掉了A的均值，此时A的均值始终为0</span></span><br><span class="line">                aa_out = aa - tf.reduce_mean(aa, axis=<span class="number">1</span>, keep_dims=<span class="literal">True</span>)</span><br><span class="line">                </span><br><span class="line">            <span class="comment">#合并V和A, 求出q估计值</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;Q&#x27;</span>):</span><br><span class="line">                self.q_eval = vs_out + aa_out</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;loss&#x27;</span>): <span class="comment"># 求误差</span></span><br><span class="line">            <span class="comment">#使用平方误差</span></span><br><span class="line">            self.loss = tf.reduce_mean(tf.squared_difference(self.q_target, self.q_eval))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;train&#x27;</span>):    <span class="comment"># 梯度下降</span></span><br><span class="line">            optimizer = tf.train.RMSPropOptimizer(self.lr)</span><br><span class="line">            self._train_op = optimizer.minimize(self.loss)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#创建target network，输入选择一个action后的状态s_,输出q_target</span></span><br><span class="line">        self.s_ = tf.placeholder(tf.float32, [<span class="literal">None</span>, self.n_features], name=<span class="string">&#x27;s_&#x27;</span>)    <span class="comment"># 接收下个 observation</span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;target_net&#x27;</span>):</span><br><span class="line">            c_names = [<span class="string">&#x27;target_net_params&#x27;</span>, tf.GraphKeys.GLOBAL_VARIABLES]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># target_net 的第一层fc， collections 是在更新 target_net 参数时会用到</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;l1&#x27;</span>):</span><br><span class="line">                w1 = tf.get_variable(<span class="string">&#x27;w1&#x27;</span>, [self.n_features, n_l1], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b1 = tf.get_variable(<span class="string">&#x27;b1&#x27;</span>, [<span class="number">1</span>, n_l1], initializer=b_initializer, collections=c_names)</span><br><span class="line">                l1 = tf.nn.relu(tf.matmul(self.s_, w1) + b1)</span><br><span class="line"></span><br><span class="line">            <span class="comment">#状态的价值</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;value&#x27;</span>):</span><br><span class="line">                w21 = tf.get_variable(<span class="string">&#x27;w21&#x27;</span>, [n_l1, <span class="number">1</span>], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b21 = tf.get_variable(<span class="string">&#x27;b21&#x27;</span>, [<span class="number">1</span>], initializer=b_initializer, collections=c_names)</span><br><span class="line">                vs_out = tf.matmul(l1, w21) + b21</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#动作的advantage</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;advantage&#x27;</span>):</span><br><span class="line">                w22 = tf.get_variable(<span class="string">&#x27;w22&#x27;</span>, [n_l1, self.n_actions], initializer=w_initializer, collections=c_names)</span><br><span class="line">                b22 = tf.get_variable(<span class="string">&#x27;b22&#x27;</span>, [<span class="number">1</span>, self.n_actions], initializer=b_initializer, collections=c_names)</span><br><span class="line">                aa = tf.matmul(l1, w22) + b22</span><br><span class="line">                <span class="comment">#为了不让A直接学成了Q, 我们减掉了A的均值，此时A的均值始终为0</span></span><br><span class="line">                aa_out = aa - tf.reduce_mean(aa, axis=<span class="number">1</span>, keep_dims=<span class="literal">True</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#合并V和A, 求出q估计值</span></span><br><span class="line">            <span class="keyword">with</span> tf.variable_scope(<span class="string">&#x27;Q&#x27;</span>):</span><br><span class="line">                self.q_next = vs_out + aa_out</span><br><span class="line">            </span><br><span class="line">        <span class="built_in">print</span>(self.q_next)</span><br><span class="line">                </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">choose_action</span>(<span class="params">self, observation</span>):</span><br><span class="line">        <span class="comment">#根据observation（state）选行为</span></span><br><span class="line">        <span class="comment">#使用eval network选出state下的行为估计</span></span><br><span class="line">        <span class="comment">#将observation的shape变为(1, size_of_observation)，行向量变为列向量才能与NN维度统一</span></span><br><span class="line">        observation = observation[np.newaxis, :]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> np.random.uniform() &lt; self.epsilon:</span><br><span class="line">            action_value = self.sess.run(self.q_eval, feed_dict=&#123;self.s:observation&#125;)</span><br><span class="line">            action = np.argmax(action_value)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            action = np.random.randint(<span class="number">0</span>, self.n_actions)   <span class="comment">#随机选择</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learn</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.learn_step_counter % self.replace_target_iter ==<span class="number">0</span>:</span><br><span class="line">            self.sess.run(self.replace_target_op)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\ntarget_params_replaced\n&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#从memory中随机抽取batch_size这么多记忆</span></span><br><span class="line">        <span class="keyword">if</span> self.memory_counter &gt; self.memory_size:   <span class="comment">#说明记忆库已经存满，可以从记忆库任意位置收取</span></span><br><span class="line">            sample_index = np.random.choice(self.memory_size, size=self.batch_size)</span><br><span class="line">        <span class="keyword">else</span>:   <span class="comment">#记忆库还没有存满，从现有的存储记忆提取</span></span><br><span class="line">            sample_index = np.random.choice(self.memory_counter, size=self.batch_size)</span><br><span class="line">        </span><br><span class="line">        batch_memory= self.memory[sample_index, :]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取q_next即q现实(target_net产生的q)和q_eval(eval_net产生的q)</span></span><br><span class="line">        <span class="comment">#q_next和q_eval都是一个向量，包含了对应状态下所有动作的q值</span></span><br><span class="line">        <span class="comment">#实际上feature为状态的维度，batch_memory[:, -self.n_features:]为s_,即状态s采取动作action后的状态s_, batch_memory[:, :self.n_features]为s</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取q_next即q现实(target_net产生的q)和q_eval(eval_net产生的q)</span></span><br><span class="line">        <span class="comment">#q_next和q_eval都是一个向量，包含了对应状态下所有动作的q值</span></span><br><span class="line">        <span class="comment">#实际上feature为状态的维度，batch_memory[:, -self.n_features:]为s_,即状态s采取动作action后的状态s_, batch_memory[:, :self.n_features]为s</span></span><br><span class="line">        <span class="comment">#q_next, q_eval的维度为[None,n_actions]</span></span><br><span class="line">        q_next, q_eval = self.sess.run([self.q_next, self.q_eval], feed_dict=&#123;self.s_: batch_memory[:, -self.n_features:],self.s: batch_memory[:, :self.n_features]&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#下面这几步十分重要. q_next, q_eval 包含所有 action 的值, 而我们需要的只是已经选择好的 action 的值, 其他的并不需要.所以我们将其他的 action 值全变成 0, 将用到的 action 误差值 反向传递回去, 作为更新凭据.</span></span><br><span class="line">        <span class="comment">#这是我们最终要达到的样子, 比如 q_target - q_eval = [1, 0, 0] - [-1, 0, 0] = [2, 0, 0]</span></span><br><span class="line">        <span class="comment"># q_eval = [-1, 0, 0] 表示这一个记忆中有我选用过 action 0, 而action0带来的 Q(s, a0)=-1,而其他的 Q(s, a1)=Q(s, a2)=0</span></span><br><span class="line">        <span class="comment"># q_target = [1, 0, 0] 表示这个记忆中的 r+gamma*maxQ(s_) = 1, 而且不管在 s_ 上我们取了哪个 action</span></span><br><span class="line">        <span class="comment"># 我们都需要对应上 q_eval 中的 action 位置, 所以就将 q_target的1放在了 action0的位置.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 下面也是为了达到上面说的目的, 不过为了更方面让程序运算, 达到目的的过程有点不同.# 是将 q_eval 全部赋值给 q_target, 这时 q_target-q_eval 全为 0,</span></span><br><span class="line">        <span class="comment"># 不过 我们再根据 batch_memory 当中的 action 这个 column 来给 q_target 中的对应的 memory-action 位置来修改赋值.</span></span><br><span class="line">        <span class="comment"># 使新的赋值为 reward + gamma * maxQ(s_), 这样 q_target-q_eval 就可以变成我们所需的样子.</span></span><br><span class="line">        </span><br><span class="line">        q_target = q_eval.copy()</span><br><span class="line">        <span class="comment">#每个样本下标</span></span><br><span class="line">        batch_index = np.arange(self.batch_size, dtype=np.int32)</span><br><span class="line">        <span class="comment">#记录每个样本执行的动作</span></span><br><span class="line">        eval_act_index = batch_memory[:, self.n_features].astype(<span class="built_in">int</span>)</span><br><span class="line">        <span class="comment">#记录每个样本动作的奖励</span></span><br><span class="line">        reward = batch_memory[:, self.n_features + <span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#生成每个样本中q值对应动作的更新，即生成的q现实，</span></span><br><span class="line">        q_target[batch_index, eval_act_index]=reward+self.gamma * np.<span class="built_in">max</span>(q_next, axis=<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#假如在这个 batch 中, 我们有2个提取的记忆, 根据每个记忆可以生产3个 action 的值:</span></span><br><span class="line">        <span class="comment">#q_eval =[[1, 2, 3],[4, 5, 6]]， 另q_target = q_eval.copy()</span></span><br><span class="line">        <span class="comment">#然后根据 memory 当中的具体 action 位置来修改 q_target 对应 action 上的值:</span></span><br><span class="line">        <span class="comment">#比如在:记忆 0 的 q_target 计算值是 -1, 而且我用了 action 0;忆1的 q_target 计算值是-2, 而且我用了 action 2:</span></span><br><span class="line">        <span class="comment">#q_target =[[-1, 2, 3],[4, 5, -2]]</span></span><br><span class="line">        <span class="comment">#所以 (q_target - q_eval) 就变成了:[[(-1)-(1), 0, 0],[0, 0, (-2)-(6)]]</span></span><br><span class="line">        <span class="comment">#最后我们将这个 (q_target - q_eval) 当成误差, 反向传递会神经网络</span></span><br><span class="line">        <span class="comment">#所有为 0 的 action 值是当时没有选择的 action, 之前有选择的 action 才有不为0的值.</span></span><br><span class="line">        <span class="comment">#我们只反向传递之前选择的 action 的值,</span></span><br><span class="line">        _, self.cost = self.sess.run([self._train_op, self.loss],feed_dict=&#123;self.s: batch_memory[:, :self.n_features],self.q_target: q_target&#125;)</span><br><span class="line">        </span><br><span class="line">        self.cost_his.append(self.cost) <span class="comment"># 记录 cost 误差</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#每调用一次learn，降低一次epsilon，即行为随机性</span></span><br><span class="line">        self.epsilon = self.epsilon + self.epsilon_increment <span class="keyword">if</span> self.epsilon &lt; self.epsilon_max <span class="keyword">else</span> self.epsilon_max</span><br><span class="line">        </span><br><span class="line">        self.learn_step_counter += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">plot_cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">        plt.plot(np.arange(<span class="built_in">len</span>(self.cost_his)), self.cost_his)</span><br><span class="line">        plt.ylabel(<span class="string">&#x27;Cost&#x27;</span>)</span><br><span class="line">        plt.xlabel(<span class="string">&#x27;training steps&#x27;</span>)</span><br><span class="line">        plt.show()</span><br></pre></td></tr></table></figure><h4 id="Policy-Gradient"><a href="#Policy-Gradient" class="headerlink" title="Policy Gradient"></a>Policy Gradient</h4><p>之前说的SARSA、Q-learning、DQN学习的都是在状态s下动作a的价值，属于value-based的方法。而Policy Gradient学习的是在状态s下每个动作a被选择的概率，属于policy-based的方法。</p><p>我们先说Policy Gradient的整体思想，之后将整体思想进行拆分，产生Policy Gradient每一步的流程。</p><p>Policy Gradient的网络要学习的是状态下动作输出的概率。按照常识来讲，可以获得越大的奖励的动作应该被选择的概率是越大的。需要注意的是这里所说的奖励并不是一个动作单步的奖励，而是当整个游戏结束时，这个动作整体所产生的价值，这个价值我们叫做advantage。因此我们的网络要学习的目标就是：按照每个动作的概率进行选择时，获得的奖励的期望值是最大的。</p><p><a href="https://www.jianshu.com/p/428b640046aa">https://www.jianshu.com/p/428b640046aa</a></p><h5 id="策略梯度"><a href="#策略梯度" class="headerlink" title="策略梯度"></a>策略梯度</h5><p>在PG算法中，我们的Agent又被称为Actor，Actor对于一个特定的任务，都有自己的一个策略π，策略π通常用一个神经网络表示，其参数为θ。从一个特定的状态state出发，一直到任务的结束，被称为一个完整的eposide，在每一步，我们都能获得一个奖励r，一个完整的任务所获得的最终奖励被称为R。这样，一个有T个时刻的eposide，Actor不断与环境交互，形成如下的序列τ：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316210642889.png" alt="image-20210316210642889"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210311213430270.png" alt="image-20210311213430270"></p><p>这样一个序列τ是不确定的，因为Actor在不同state下所采取的action可能是不同的，一个序列τ发生的概率为：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210311213447597.png" alt="image-20210311213447597"></p><p>序列τ所获得的奖励为每个阶段所得到的奖励的和，称为R(τ)。因此，在Actor的策略为π的情况下，所能获得的期望奖励为：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210311213514694.png" alt="image-20210311213514694"></p><p>而我们的期望是调整Actor的策略π，使得期望奖励最大化，于是我们有了策略梯度的方法，既然我们的期望函数已经有了，我们只要使用梯度提升的方法更新我们的网络参数θ（即更新策略π）就好了，所以问题的重点变为了求参数的梯度。梯度的求解过程如下：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316210915795.png" alt="image-20210316210915795"></p><p>首先利用log函数求导的特点进行转化，随后用N次采样的平均值来近似期望，最后，我们将pθ展开，将与θ无关的项去掉，即得到了最终的结果。</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210311213315228.png" alt="image-20210311213315228"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210311213339458.png" alt="image-20210311213339458"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316211600007.png" alt="image-20210316211600007"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316211642310.png" alt="image-20210316211642310"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316211734692.png" alt="image-20210316211734692"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316211747501.png" alt="image-20210316211747501"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210316211839980.png" alt="image-20210316211821933"></p><p>policy gradient 的Agent的实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> maze_env_drl <span class="keyword">import</span> Maze</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PolicyGradient</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n_actions, n_features, learning_rate=<span class="number">0.01</span>, reward_decay=<span class="number">0.95</span>, output_graph=<span class="literal">False</span></span>):</span><br><span class="line">        self.n_actions = n_actions</span><br><span class="line">        self.n_features = n_features</span><br><span class="line">        self.lr = learning_rate     <span class="comment"># 学习率</span></span><br><span class="line">        self.gamma = reward_decay   <span class="comment"># reward 递减率</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#因为需要模拟整个回合才能得到最终奖励，才能进行网络学习，所以需要将达到终点点整个序列的状态、动作、奖励记录下来</span></span><br><span class="line">        self.ep_obs, self.ep_as, self.ep_rs = [], [], []    <span class="comment">#这是我们存储 回合信息的 list</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#下面与之前是一样的</span></span><br><span class="line">        self._build_net()  <span class="comment">#建立网络</span></span><br><span class="line">        self.sess = tf.Session()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> output_graph:</span><br><span class="line">            tf.summary.FileWriter(<span class="string">&quot;logs/&quot;</span>, self.sess.graph)</span><br><span class="line">        </span><br><span class="line">        self.sess.run(tf.global_variables_initializer())</span><br><span class="line">        </span><br><span class="line">    <span class="comment">#与此前不同之前储存记忆利用的是replay buffer机制。存储内容分可能来自不同执行序列和不同参数的神经网络</span></span><br><span class="line">    <span class="comment">#此处只是为了储存达到终点前一个系列的动作</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">store_transition</span>(<span class="params">self, s, a, r</span>):</span><br><span class="line">        self.ep_obs.append(s)</span><br><span class="line">        self.ep_as.append(a)</span><br><span class="line">        self.ep_rs.append(r)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#构建网络，因为直接走到终点，奖励是可以观察的，不再需要target_work去求st+1的最大价值</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_net</span>(<span class="params">self</span>):</span><br><span class="line">        tf.reset_default_graph()  <span class="comment">#清空计算图</span></span><br><span class="line">        <span class="keyword">with</span> tf.name_scope(<span class="string">&#x27;input&#x27;</span>):</span><br><span class="line">            self.tf_obs = tf.placeholder(tf.float32, [<span class="literal">None</span>, self.n_features], name=<span class="string">&quot;observations&quot;</span>)  <span class="comment">#接收observation</span></span><br><span class="line">            <span class="comment">#标签维度为[batch_size, 1]。标签是具体动作，不是概率</span></span><br><span class="line">            self.tf_acts = tf.placeholder(tf.int32, [<span class="literal">None</span>, ], name=<span class="string">&quot;actions_num&quot;</span>)   <span class="comment"># 接收我们在这个回合中选过的actions</span></span><br><span class="line">            <span class="comment">#接收每个state-action所对应的value(通过reward计算),注意此处不是单步的奖励，而是整个一些列动作的奖励,vt=本reward + 衰减的未来reward</span></span><br><span class="line">            self.tf_vt = tf.placeholder(tf.float32, [<span class="literal">None</span>, ], name=<span class="string">&quot;actions_value&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#权重初始化方式</span></span><br><span class="line">        w_initializer = tf.random_normal_initializer(<span class="number">0.</span>,<span class="number">0.3</span>)  </span><br><span class="line">        b_initializer = tf.constant_initializer(<span class="number">0.1</span>)</span><br><span class="line">        n_l1 = <span class="number">10</span>  <span class="comment">#n_l1为network隐藏层神经元的个数 </span></span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&quot;lay1&quot;</span>):</span><br><span class="line">            w1 = tf.get_variable(<span class="string">&#x27;w1&#x27;</span>, [self.n_features, n_l1], initializer=w_initializer)</span><br><span class="line">            b1 = tf.get_variable(<span class="string">&#x27;b1&#x27;</span>, [<span class="number">1</span>, n_l1], initializer=b_initializer)</span><br><span class="line">            l1 = tf.nn.tanh(tf.matmul(self.tf_obs, w1)+b1)</span><br><span class="line">        <span class="keyword">with</span> tf.variable_scope(<span class="string">&quot;lay2&quot;</span>):</span><br><span class="line">            w2 = tf.get_variable(<span class="string">&#x27;w2&#x27;</span>, [n_l1, self.n_actions], initializer=w_initializer)</span><br><span class="line">            b2 = tf.get_variable(<span class="string">&#x27;b2&#x27;</span>, [<span class="number">1</span>, self.n_actions], initializer=b_initializer)</span><br><span class="line">            output = tf.matmul(l1, w2)+b2</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#ploicy gradient求解在一个状态下每个动作的概率，因此使用softmax出动作概率</span></span><br><span class="line">        self.all_act_prob = tf.nn.softmax(output)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> tf.name_scope(<span class="string">&#x27;loss&#x27;</span>):</span><br><span class="line">            <span class="comment">#交叉熵作为损失函数,训练样本中选中的action即为我们的label,因为还没求出最终损失,此处用reduce_sum</span></span><br><span class="line">            neg_log_prob = -tf.reduce_sum(tf.log(self.all_act_prob)*tf.one_hot(self.tf_acts, self.n_actions), axis=<span class="number">1</span>)</span><br><span class="line">            <span class="comment">#可是视为当前这个局部损失*对应权重，可以看到state-action的value越大，权重越大</span></span><br><span class="line">            <span class="comment">#可以认为state-action的value越大，就越会顺着这个梯度下降，这个动作就越可信</span></span><br><span class="line">            <span class="comment">#若不加基准线b为如下方式：</span></span><br><span class="line">            <span class="comment">#loss = tf.reduce_mean(neg_log_prob * (self.tf_vt))</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">#加入基准线b的损失</span></span><br><span class="line">            loss = tf.reduce_mean(neg_log_prob * (self.tf_vt-tf.reduce_mean(self.tf_vt)))</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">with</span> tf.name_scope(<span class="string">&#x27;train&#x27;</span>):</span><br><span class="line">            self.train_op = tf.train.AdamOptimizer(self.lr).minimize(loss)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#之前DQN根据最大动作价值选择动作，ploicy gradient根据网络输出的动作概率，依照概率选择动作</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">choose_action</span>(<span class="params">self, observation</span>):</span><br><span class="line">        <span class="comment"># 所有action的概率</span></span><br><span class="line">        prob_weights = self.sess.run(self.all_act_prob, feed_dict=&#123;self.tf_obs: observation[np.newaxis, :]&#125;)</span><br><span class="line">        <span class="comment">#按照概率选择动作</span></span><br><span class="line">        action = np.random.choice(<span class="built_in">range</span>(prob_weights.shape[<span class="number">1</span>]), p=prob_weights.ravel())</span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#用于计算回合的state-action value</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_discount_and_norm_rewards</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#先计算单步的奖励，在逐步将后面的奖励逐步衰减加到前面</span></span><br><span class="line">        discounted_ep_rs = np.zeros_like(self.ep_rs)</span><br><span class="line">        running_add = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#将后面的奖励逐步衰减加到前面</span></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(self.ep_rs))):</span><br><span class="line">            running_add = running_add * self.gamma + self.ep_rs[t]</span><br><span class="line">            discounted_ep_rs[t] = running_add</span><br><span class="line">            </span><br><span class="line">        <span class="comment">#防止每个回合计算出的奖励量纲不同，进行正态标准化</span></span><br><span class="line">        discounted_ep_rs = np.array(discounted_ep_rs,dtype=np.<span class="built_in">float</span>) </span><br><span class="line">        discounted_ep_rs -= np.mean(discounted_ep_rs)</span><br><span class="line">        discounted_ep_rs /= np.std(discounted_ep_rs)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> discounted_ep_rs</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learn</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#因为训练时传入的不是动作单步奖励，执行完动作后的整体奖励，因此先计算执行完动作后的整体奖励</span></span><br><span class="line">        discounted_ep_rs_norm = self._discount_and_norm_rewards()</span><br><span class="line">        <span class="comment">#np.vstack(self.ep_obs)的shape=[None, n_obs]，np.array(self.ep_as)的shape=[None,]，discounted_ep_rs_norm的shape=[None,]</span></span><br><span class="line">        <span class="comment">#每次的训练样本相当于一和完整流程状态和对应的动作以及对应奖励。</span></span><br><span class="line">        self.sess.run(self.train_op, feed_dict=&#123;self.tf_obs: np.vstack(self.ep_obs),self.tf_acts: np.array(self.ep_as),self.tf_vt: discounted_ep_rs_norm&#125;)</span><br><span class="line">        <span class="comment">#次回合动作已经训练完，清空记忆。下次训练需要重新产生训练样本</span></span><br><span class="line">        self.ep_obs, self.ep_as, self.ep_rs = [], [], []</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#返回这一回合的state-action value</span></span><br><span class="line">        <span class="keyword">return</span> discounted_ep_rs_norm  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_maze</span>(<span class="params">RENDER</span>):</span><br><span class="line">    <span class="keyword">for</span> episode <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3000</span>):</span><br><span class="line">        <span class="comment"># 初始化环境</span></span><br><span class="line">        observation = env.reset()</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> RENDER:</span><br><span class="line">                <span class="comment"># 刷新环境</span></span><br><span class="line">                env.render()</span><br><span class="line">            <span class="comment"># DQN 根据观测值选择行为</span></span><br><span class="line">            action = RL.choose_action(observation)</span><br><span class="line">            <span class="comment"># 环境根据行为给出下一个state, reward,是否终止</span></span><br><span class="line">            observation_, reward, done = env.step(action)</span><br><span class="line">            <span class="comment">#存储记忆</span></span><br><span class="line">            RL.store_transition(observation, action, reward)</span><br><span class="line">            <span class="comment">#知道获得最终奖励才能进行训练，这是MC的方法</span></span><br><span class="line">            <span class="keyword">if</span> done:</span><br><span class="line">                ep_rs_sum=<span class="built_in">sum</span>(RL.ep_rs)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;running_reward&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">locals</span>():</span><br><span class="line">                    running_reward = ep_rs_sum</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    running_reward = running_reward * <span class="number">0.99</span> + ep_rs_sum * <span class="number">0.01</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> running_reward&gt; DISPLAY_REWARD_THRESHOLD:</span><br><span class="line">                    RENDER=<span class="literal">True</span></span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;episode:&quot;</span>, episode, <span class="string">&quot;  reward:&quot;</span>, <span class="built_in">int</span>(running_reward))</span><br><span class="line">                </span><br><span class="line">                vt = RL.learn()</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> episode==<span class="number">0</span>:</span><br><span class="line">                    plt.plot(vt)    <span class="comment"># plot这个回合的vt</span></span><br><span class="line">                    plt.xlabel(<span class="string">&#x27;episode steps&#x27;</span>)</span><br><span class="line">                    plt.ylabel(<span class="string">&#x27;normalized state-action value&#x27;</span>)</span><br><span class="line">                    plt.show()</span><br><span class="line">                <span class="keyword">break</span>   <span class="comment">#此次模拟完毕</span></span><br><span class="line">                </span><br><span class="line">            observation = observation_  <span class="comment">#还没有获取奖励，去要继续执行模拟</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    RENDER=<span class="literal">False</span></span><br><span class="line">    DISPLAY_REWARD_THRESHOLD=<span class="number">300</span></span><br><span class="line">    env = Maze() </span><br><span class="line">    </span><br><span class="line">    RL = PolicyGradient(n_actions=env.n_actions, n_features=env.n_features, learning_rate=<span class="number">0.02</span>, reward_decay=<span class="number">0.99</span>, output_graph=<span class="literal">True</span>)</span><br><span class="line">    run_maze(RENDER)</span><br></pre></td></tr></table></figure><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317112639995.png" alt="image-20210317112639995"></p><p>可以看出policy gradient是基于回合更新的，因此我们需要需要很大的耐心和环境产生交互样本，进行回合训练，并且由于每个回合是不稳定的，因此我们需要的大量的样本</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155054551.png" alt="image-20210317155054551"></p><p>Q-learning学习的是每个动作的价值，要求动作必须是离散的。</p><p>policy gradient和Q-learning都有各自的优缺点。我们可以将两者整合起来，即记忆使用off-policy的学习，也可以使用连续的动作。</p><p>下面两段话摘自莫烦python的强化学习教程：Actor-Critic 的 Actor 的前生是 Policy Gradients, 这能让它毫不费力地在连续动作中选取合适的动作, 而 Q-learning 做这件事会瘫痪. 那为什么不直接用 Policy Gradients 呢? 原来 Actor Critic 中的 Critic 的前生是 Q-learning 或者其他的 以值为基础的学习法 , 能进行单步更新, 而传统的 Policy Gradients 则是回合更新, 这降低了学习效率。</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155324880.png" alt="image-20210317155324880"></p><p>Actor 和 Critic, 他们都能用不同的神经网络来代替 . 在 Policy Gradients 的影片中提到过, 现实中的奖惩会左右 Actor 的更新情况. Policy Gradients 也是靠着这个来获取适宜的更新. 那么何时会有奖惩这种信息能不能被学习呢? 这看起来不就是 以值为基础的强化学习方法做过的事吗. 那我们就拿一个 Critic 去学习这些奖惩机制, 学习完了以后. 由 Actor 来指手画脚, 由 Critic 来告诉 Actor 你的那些指手画脚哪些指得好, 哪些指得差, Critic 通过学习环境和奖励之间的关系, 能看到现在所处状态的潜在奖励, 所以用它来指点 Actor 便能使 Actor 每一步都在更新, 如果使用单纯的 Policy Gradients, Actor 只能等到回合结束才能开始更新。</p><p>以前我们用过回合的奖励来进行policy gradient的更新，Actor-Critic将回合奖励替换成动作的价值，来对网络进行学习，自然就将Q-learning结合了起来：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155528931.png" alt="image-20210317155528931"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155542474.png" alt="image-20210317155542474"></p><p>在PG策略中，如果我们用Q函数来代替R，同时我们创建一个Critic网络来计算Q函数值，那么我们就得到了Actor-Critic方法。Actor参数的梯度变为：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210311221748445.png" alt="image-20210311221748445"></p><p>此时的Critic根据估计的Q值和实际Q值的<strong>平方误差</strong>进行更新，对Critic来说，其loss为：</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210311221814333.png" alt="image-20210311221814333"></p><p>AC代码的实现地址为：<a href="https://github.com/princewen/tensorflow_practice/tree/master/RL/Basic-AC-Demo">https://github.com/princewen/tensorflow_practice/tree/master/RL/Basic-AC-Demo</a></p><h1 id="Advantage-Actor-Critic-A2C"><a href="#Advantage-Actor-Critic-A2C" class="headerlink" title="Advantage Actor-Critic(A2C)"></a>Advantage Actor-Critic(A2C)</h1><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155623826.png" alt="image-20210317155623826"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155634647.png" alt="image-20210317155634647"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155755636.png" alt="image-20210317155755636"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155831237.png" alt="image-20210317155831237"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317155955489.png" alt="image-20210317155955489"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317160425425.png" alt="image-20210317160425425"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317160942244.png" alt="image-20210317160942244"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210317162607727.png" alt="image-20210317162607727"></p><p>本文基于如下架构进行Advantage Actor-Critic的Agent实现。其中Actor和Critic的第一层权重共享：</p><h4 id="Q-learning"><a href="#Q-learning" class="headerlink" title="Q-learning"></a>Q-learning</h4><p>Q-learning是一种value_based的方法。</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312203323472.png" alt="image-20210312203323472"></p>]]></content>
    
    
    <summary type="html">&lt;h4 id=&quot;强化学习介绍&quot;&gt;&lt;a href=&quot;#强化学习介绍&quot; class=&quot;headerlink&quot; title=&quot;强化学习介绍&quot;&gt;&lt;/a&gt;强化学习介绍&lt;/h4&gt;&lt;p&gt;根据不同的分列方法可以将强化学习算法分成不同的种类：&lt;br&gt;&lt;strong&gt;1.基于概率（policy-based）和基于价值（value-based）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;基于概率是强化学习中最直接的一种, 他能通过感官分析所处的环境, 直接输出下一步要采取的各种动作的概率, 然后根据概率采取行动, 所以每种动作都有可能被选中, 只是可能性不同. 而基于价值的方法输出则是所有动作的价值, 我们会根据最高价值来选着动作, 相比基于概率的方法, 基于价值的决策部分更为铁定, 毫不留情, 就选价值最高的, 而基于概率的, 即使某个动作的概率最高, 但是还是不一定会选到他.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210312210405206.png&quot; alt=&quot;image-20210312210405206&quot;&gt;&lt;/p&gt;
&lt;p&gt;其中policy-based中的典型算法有Policy Gradients，value-based的典型算法有Q-learning、SARSA、DQN，两者重合的典型模型有AC、A2C、A3C&lt;/p&gt;</summary>
    
    
    
    <category term="RL" scheme="http://peaky2022.gitee.io/peaky/categories/RL/"/>
    
    
    <category term="学习" scheme="http://peaky2022.gitee.io/peaky/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="RL" scheme="http://peaky2022.gitee.io/peaky/tags/RL/"/>
    
  </entry>
  
  <entry>
    <title>Hexo部署到阿里云OSS上</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/03/01/514027fa.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/03/01/514027fa.html</id>
    <published>2021-03-01T08:53:37.000Z</published>
    <updated>2022-03-03T15:01:47.805Z</updated>
    
    <content type="html"><![CDATA[<h2 id="修改hexo适配oss访问规则"><a href="#修改hexo适配oss访问规则" class="headerlink" title="修改hexo适配oss访问规则"></a>修改hexo适配oss访问规则</h2><p>hexo生成的静态博客很多都是以文件夹形式的，然后默认省略了index.html。而对于阿里云的OSS来说，并不会默认访问文件夹下的index.html，所以，生成的时候需要做调整</p><span id="more"></span><h3 id="文章链接修改"><a href="#文章链接修改" class="headerlink" title="文章链接修改"></a>文章链接修改</h3><p>文章的连接直接修改根目录下_config.yml中permalink: p&#x2F;:abbrlink.html的生成规则，详细可以参考之前写的文章<a href="https://www.jianshu.com/p/920894191281">链接持久化</a></p><h3 id="归档、标签、分类修改"><a href="#归档、标签、分类修改" class="headerlink" title="归档、标签、分类修改"></a>归档、标签、分类修改</h3><p>修改主题目录下_config.yml中的menu:加入index.html</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/||</span> <span class="string">home</span></span><br><span class="line">  <span class="comment">#about: /about/|| user</span></span><br><span class="line">  <span class="attr">top:</span> <span class="string">/top/index.html||</span> <span class="string">signal</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">/tags/index.html||</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">categories:</span> <span class="string">/categories/index.html||</span> <span class="string">th</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/index.html||</span> <span class="string">archive</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable/Disable menu icons.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">menu_icons:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="文章翻页跳转"><a href="#文章翻页跳转" class="headerlink" title="文章翻页跳转"></a>文章翻页跳转</h3><p>打开<code>themes\next\layout\_partials\pagination.swig</code>文件，添加format文件路径</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">paginator(&#123;</span></span><br><span class="line">       <span class="attr">prev_text:</span> <span class="string">&#x27;&lt;i class=&quot;fa fa-angle-left&quot; aria-label=&quot;&#x27;</span><span class="string">+__(&#x27;accessibility.prev_page&#x27;)+&#x27;&quot;&gt;&lt;/i&gt;&#x27;,</span></span><br><span class="line">       <span class="attr">next_text:</span> <span class="string">&#x27;&lt;i class=&quot;fa fa-angle-right&quot; aria-label=&quot;&#x27;</span><span class="string">+__(&#x27;accessibility.next_page&#x27;)+&#x27;&quot;&gt;&lt;/i&gt;&#x27;,</span></span><br><span class="line">       <span class="attr">mid_size:</span> <span class="number">1</span><span class="string">,</span></span><br><span class="line">       <span class="attr">format:</span> <span class="string">&#x27;page/%d/index.html&#x27;</span><span class="string">,</span></span><br><span class="line">       <span class="attr">escape:</span> <span class="literal">false</span></span><br><span class="line">     <span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><h3 id="目录分类页中链接修改"><a href="#目录分类页中链接修改" class="headerlink" title="目录分类页中链接修改"></a>目录分类页中链接修改</h3><p>打开<code>themes\next\layout\page.swig</code>文件修改<code>list_categories</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">修改前：</span>      &#123;&#123; <span class="string">list_categories()</span> &#125;&#125;</span><br><span class="line"><span class="string">修改后：</span>      &#123;&#123; <span class="string">list_categories(</span>&#123;<span class="attr">suffix:</span> <span class="string">&#x27;index.html&#x27;</span>&#125;<span class="string">)</span> &#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="标签页中链接修改"><a href="#标签页中链接修改" class="headerlink" title="标签页中链接修改"></a>标签页中链接修改</h3><p>next中标签用到了tagcloud而不是list_tags,而tagclud并没有suffix配置，所以，可以仿照list_tags修改一下。<br>打开node_modules\hexo\lib\plugins\helper\tagcloud.js, 加入suffix配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">修改前：const</span> &#123; <span class="string">transform</span> &#125; <span class="string">=</span> <span class="string">options;</span> </span><br><span class="line"><span class="string">修改后：const</span> &#123; <span class="string">transform</span> , <span class="string">suffix</span> <span class="string">=</span> <span class="string">&#x27;&#x27;</span>&#125; <span class="string">=</span> <span class="string">options;</span></span><br></pre></td></tr></table></figure><p>在result.push的超链接中加入${suffix}</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">result.push(</span></span><br><span class="line">      <span class="string">`&lt;a</span> <span class="string">href=&quot;$&#123;this.url_for(tag.path)&#125;$&#123;suffix&#125;&quot;</span> <span class="string">style=&quot;$&#123;style&#125;&quot;&gt;$&#123;transform</span> <span class="string">?</span> <span class="string">transform(tag.name)</span> <span class="string">:</span> <span class="string">tag.name&#125;&lt;/a&gt;`</span></span><br><span class="line">    <span class="string">);</span></span><br></pre></td></tr></table></figure><p>修改tagcloud调用。打开themes\next\layout\page.swig文件修改tagcloud</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">修改前：&#123;&#123;</span> <span class="string">tagcloud(&#123;min_font:</span> <span class="number">12</span><span class="string">,</span> <span class="attr">max_font:</span> <span class="number">30</span><span class="string">,</span> <span class="attr">amount:</span> <span class="number">300</span><span class="string">,</span> <span class="attr">color:</span> <span class="literal">true</span><span class="string">,</span> <span class="attr">start_color:</span> <span class="string">&#x27;#ccc&#x27;</span><span class="string">,</span> <span class="attr">end_color:</span> <span class="string">&#x27;#111&#x27;</span><span class="string">&#125;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">修改后：&#123;&#123;</span> <span class="string">tagcloud(&#123;min_font:</span> <span class="number">12</span><span class="string">,</span> <span class="attr">max_font:</span> <span class="number">30</span><span class="string">,</span> <span class="attr">amount:</span> <span class="number">300</span><span class="string">,</span> <span class="attr">color:</span> <span class="literal">true</span><span class="string">,</span> <span class="attr">start_color:</span> <span class="string">&#x27;#ccc&#x27;</span><span class="string">,</span> <span class="attr">end_color:</span> <span class="string">&#x27;#111&#x27;</span><span class="string">,suffix:</span> <span class="string">&#x27;index.html&#x27;</span><span class="string">&#125;)</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="文章内的目录和标签连接"><a href="#文章内的目录和标签连接" class="headerlink" title="文章内的目录和标签连接"></a>文章内的目录和标签连接</h3><p>打开themes\next\layout_macro\post.swig文件</p><p>找到for cat in post.categories在href中添加index.html</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">%</span> <span class="string">for</span> <span class="string">cat</span> <span class="string">in</span> <span class="string">post.categories</span> <span class="string">%</span>&#125;</span><br><span class="line">  <span class="string">&lt;span</span> <span class="string">itemprop=&quot;about&quot;</span> <span class="string">itemscope</span> <span class="string">itemtype=&quot;http://schema.org/Thing&quot;&gt;</span></span><br><span class="line">    <span class="string">&lt;a</span> <span class="string">href=&quot;&#123;&#123;</span> <span class="string">url_for(cat.path)</span> <span class="string">&#125;&#125;index.html&quot;</span> <span class="string">itemprop=&quot;url&quot;</span> <span class="string">rel=&quot;index&quot;&gt;</span></span><br><span class="line">      <span class="string">&lt;span</span> <span class="string">itemprop=&quot;name&quot;&gt;&#123;&#123;</span> <span class="string">cat.name</span> <span class="string">&#125;&#125;&lt;/span&gt;</span></span><br><span class="line">    <span class="string">&lt;/a&gt;</span></span><br><span class="line">  <span class="string">&lt;/span&gt;</span></span><br></pre></td></tr></table></figure><p>找到for tag in post.tags在href中添加index.html</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">%</span> <span class="string">for</span> <span class="string">tag</span> <span class="string">in</span> <span class="string">post.tags</span> <span class="string">%</span>&#125;</span><br><span class="line">  <span class="string">&lt;a</span> <span class="string">href=&quot;&#123;&#123;</span> <span class="string">url_for(tag.path)</span> <span class="string">&#125;&#125;index.html&quot;</span> <span class="string">rel=&quot;tag&quot;&gt;&lt;i</span> <span class="string">class=&quot;fa</span> <span class="string">fa-tag&quot;&gt;&lt;/i&gt;</span> &#123;&#123; <span class="string">tag.name</span> &#125;&#125;<span class="string">&lt;/a&gt;</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">endfor</span> <span class="string">%</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="左侧状态栏日志链接"><a href="#左侧状态栏日志链接" class="headerlink" title="左侧状态栏日志链接"></a>左侧状态栏日志链接</h3><p>修改themes\next\layout_macro\sidebar.swig文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">修改前：&lt;a</span> <span class="string">href=&quot;&#123;&#123;</span> <span class="string">url_for(config.archive_dir)</span> <span class="string">&#125;&#125;&quot;&gt;</span></span><br><span class="line"><span class="string">修改后：&lt;a</span> <span class="string">href=&quot;&#123;&#123;</span> <span class="string">url_for(theme.menu.archives.split(&#x27;||&#x27;)[0])</span> <span class="string">&#125;&#125;&quot;&gt;</span></span><br></pre></td></tr></table></figure><h2 id="部署到阿里云OSS"><a href="#部署到阿里云OSS" class="headerlink" title="部署到阿里云OSS"></a>部署到阿里云OSS</h2><p>阿里云OSS国内站点需要绑定备案的域名才可以当静态网站范围。</p><h3 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h3><p>清理编译并自动生成网页</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g</span><br></pre></td></tr></table></figure><p>将博客目录下的public目录上传到OSS根目录下</p><h3 id="脚本自动提交"><a href="#脚本自动提交" class="headerlink" title="脚本自动提交"></a>脚本自动提交</h3><p>安装阿里oss脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ali-oss</span><br></pre></td></tr></table></figure><p>在根目录下创建depoly-to-oss.js文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OSS</span> = <span class="built_in">require</span>(<span class="string">&#x27;ali-oss&#x27;</span>).<span class="property">Wrapper</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promisifyReaddir = util.<span class="title function_">promisify</span>(fs.<span class="property">readdir</span>)</span><br><span class="line"><span class="keyword">const</span> promisifyStat = util.<span class="title function_">promisify</span>(fs.<span class="property">stat</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title function_">OSS</span>(&#123;</span><br><span class="line">  <span class="attr">region</span>: <span class="string">&#x27;&lt;oss region&gt;&#x27;</span>,</span><br><span class="line">  <span class="comment">//云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，部署在服务端使用RAM子账号或STS，部署在客户端使用STS。</span></span><br><span class="line">  <span class="attr">accessKeyId</span>: <span class="string">&#x27;&lt;Your accessKeyId&gt;&#x27;</span>,</span><br><span class="line">  <span class="attr">accessKeySecret</span>: <span class="string">&#x27;&lt;Your accessKeySecret&gt;&#x27;</span>,</span><br><span class="line">  <span class="attr">bucket</span>: <span class="string">&#x27;&lt;Your bucket name&gt;&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传的目录</span></span><br><span class="line"><span class="keyword">const</span> publicPath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./public&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步上传文件</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">put</span>(<span class="params">proPath = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dir = <span class="keyword">await</span> <span class="title function_">promisifyReaddir</span>(<span class="string">`<span class="subst">$&#123;publicPath&#125;</span><span class="subst">$&#123;proPath&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dir.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> stat = <span class="keyword">await</span> <span class="title function_">promisifyStat</span>(path.<span class="title function_">resolve</span>(<span class="string">`<span class="subst">$&#123;publicPath&#125;</span><span class="subst">$&#123;proPath&#125;</span>`</span>, dir[i]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (stat.<span class="title function_">isFile</span>()) &#123;</span><br><span class="line">      <span class="keyword">const</span> fileStream = fs.<span class="title function_">createReadStream</span>(path.<span class="title function_">resolve</span>(<span class="string">`<span class="subst">$&#123;publicPath&#125;</span><span class="subst">$&#123;proPath&#125;</span>`</span>, dir[i]))</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`上传文件: <span class="subst">$&#123;proPath&#125;</span>/<span class="subst">$&#123;dir[i]&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> client.<span class="title function_">putStream</span>(<span class="string">`<span class="subst">$&#123;proPath&#125;</span>/<span class="subst">$&#123;dir[i]&#125;</span>`</span>, fileStream)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (stat.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">      <span class="comment">// 递归子目录</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">put</span>(<span class="string">`<span class="subst">$&#123;proPath&#125;</span>/<span class="subst">$&#123;dir[i]&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">put</span>()</span><br></pre></td></tr></table></figure><p>编译之后，直接使用上传</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node depoly-to-oss.js</span><br></pre></td></tr></table></figure><p><strong>本文作者：</strong> 过客<br><strong>本文链接：</strong> <a href="https://zengwu.com.cn/p/dd7e8a7b.html">https://zengwu.com.cn/p/dd7e8a7b.html</a></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;修改hexo适配oss访问规则&quot;&gt;&lt;a href=&quot;#修改hexo适配oss访问规则&quot; class=&quot;headerlink&quot; title=&quot;修改hexo适配oss访问规则&quot;&gt;&lt;/a&gt;修改hexo适配oss访问规则&lt;/h2&gt;&lt;p&gt;hexo生成的静态博客很多都是以文件夹形式的，然后默认省略了index.html。而对于阿里云的OSS来说，并不会默认访问文件夹下的index.html，所以，生成的时候需要做调整&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="http://peaky2022.gitee.io/peaky/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Hexo" scheme="http://peaky2022.gitee.io/peaky/tags/Hexo/"/>
    
    <category term="教程" scheme="http://peaky2022.gitee.io/peaky/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>LayUI入门</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/01/28/ef00c80b.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/01/28/ef00c80b.html</id>
    <published>2021-01-28T07:41:17.000Z</published>
    <updated>2022-03-03T15:01:47.844Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Start</strong></p><p>LayUI入门</p><p><a href="https://fengfeng.lanzoui.com/iVH4Ekz8f2f">点此下载</a>Layuiadmin</p><p><a href="https://www.layui.com/doc/">点此跳转</a>Layui官方文档</p><p><a href="https://www.cnblogs.com/niuben/p/11038897.html">点此跳转</a>Layui第三方文档</p><span id="more"></span><p>直接开始！</p><h3 id="目录说明"><a href="#目录说明" class="headerlink" title="目录说明"></a>目录说明</h3><p>下载后可以这样部署文件到自己的开发环境</p><ul><li><p>src&#x2F;</p><p>layuiAdmin 源代码，通常用于开发环境（如本地），推荐你在本地开发时，将 .&#x2F;start&#x2F;index.html 中的 layui.css 和 layui.js 的引入路径由 dist 改为 src 目录。</p><ul><li>src&#x2F;controller&#x2F;：存放 JS 业务模块，即对视图进行事件等交互性处理</li><li>src&#x2F;lib&#x2F;：layuiAdmin 的核心模块，一般不推荐修改</li><li>src&#x2F;style&#x2F;：存放样式，其中 admin.css是核心样式</li><li>src&#x2F;views&#x2F;：存放视图文件。其中 layout.html 是整个框架结构的承载，一般不推荐做大量改动。</li><li>src&#x2F;config.js：layuiAdmin 的全局配置文件，可随意修改。</li><li>src&#x2F;index.js：layuiAdmin 的入口模块，一般不推荐修改</li></ul></li><li><p>dist&#x2F;<br>通过 gulp 将 layuiAdmin src 目录的源代码进行构建后生成的目录（即：将 JS 和 CSS 文件进行了压缩等处理），通常用于线上环境。关于 gulp 的使用，下文也有介绍。</p></li><li><p>start&#x2F;<br>存放 layuiAdmin 的入口页面、模拟接口数据、layui</p><p>index.html所有页面基于这个显示</p></li></ul><h3 id="菜单栏"><a href="#菜单栏" class="headerlink" title="菜单栏"></a>菜单栏</h3><ul><li><p>在 start&#x2F;json&#x2F;menu.js 文件中，我们放置了默认的侧边菜单数据，你可以去随意改动它。</p><p>JSON数据:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span> <span class="comment">//状态码，key 名可以通过 config.js 去重新配置</span></span><br><span class="line">  <span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span> <span class="comment">//提示信息</span></span><br><span class="line">  <span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="comment">//菜单数据，key名可以通过 config.js 去重新配置</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;component&quot;</span> <span class="comment">//一级菜单名称（与视图的文件夹名称和路由路径对应）</span></span><br><span class="line">    <span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;组件&quot;</span> <span class="comment">//一级菜单标题</span></span><br><span class="line">    <span class="punctuation">,</span><span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;layui-icon-component&quot;</span> <span class="comment">//一级菜单图标样式</span></span><br><span class="line">    <span class="punctuation">,</span><span class="attr">&quot;jump&quot;</span><span class="punctuation">:</span> &#x27;&#x27; <span class="comment">//自定义一级菜单路由地址，默认按照 name 解析。一旦设置，将优先按照 jump 设定的路由跳转</span></span><br><span class="line">    <span class="punctuation">,</span><span class="attr">&quot;spread&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span> <span class="comment">//是否默认展子菜单（1.0.0-beta9 新增）</span></span><br><span class="line">    <span class="punctuation">,</span><span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="comment">//二级菜单</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;grid&quot;</span> <span class="comment">//二级菜单名称（与视图的文件夹名称和路由路径对应）</span></span><br><span class="line">      <span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;栅格&quot;</span> <span class="comment">//二级菜单标题</span></span><br><span class="line">      <span class="punctuation">,</span><span class="attr">&quot;jump&quot;</span><span class="punctuation">:</span> &#x27;&#x27;  <span class="comment">//自定义二级菜单路由地址</span></span><br><span class="line">      <span class="punctuation">,</span><span class="attr">&quot;spread&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span> <span class="comment">//是否默认展子菜单（1.0.0-beta9 新增）</span></span><br><span class="line">      <span class="punctuation">,</span><span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="comment">//三级菜单</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;list&quot;</span> <span class="comment">//三级菜单名（与视图中最终的文件名和路由对应），如：component/grid/list</span></span><br><span class="line">        <span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;等比例列表排列&quot;</span> <span class="comment">//三级菜单标题</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mobile&quot;</span></span><br><span class="line">        <span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;按移动端排列&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>修改index.html文件的layui-side-menu</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul <span class="keyword">class</span>=<span class="string">&quot;layui-nav layui-nav-tree&quot;</span> lay-shrink=<span class="string">&quot;all&quot;</span> id=<span class="string">&quot;LAY-system-side-menu&quot;</span> lay-filter=<span class="string">&quot;layadmin-system-side-menu&quot;</span>&gt;</span><br><span class="line">  &lt;!--  一级标题   --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">data-name</span>=<span class="string">&quot;home&quot;</span> <span class="attr">class</span>=<span class="string">&quot;layui-nav-item layui-nav-itemed&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">lay-tips</span>=<span class="string">&quot;主页&quot;</span> <span class="attr">lay-direction</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;layui-icon layui-icon-home&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">cite</span>&gt;</span>主页<span class="tag">&lt;/<span class="name">cite</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">&quot;layui-nav-child&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">dd</span> <span class="attr">data-name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;layui-this&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;home/console.html&quot;</span>&gt;</span>控制台<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">data-name</span>=<span class="string">&quot;component&quot;</span> <span class="attr">class</span>=<span class="string">&quot;layui-nav-item&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">lay-tips</span>=<span class="string">&quot;组件&quot;</span> <span class="attr">lay-direction</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;layui-icon layui-icon-component&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">cite</span>&gt;</span>组件<span class="tag">&lt;/<span class="name">cite</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!--  二级级标题   --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">&quot;layui-nav-child&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">dd</span> <span class="attr">data-name</span>=<span class="string">&quot;grid&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span>&gt;</span>栅格<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">&quot;layui-nav-child&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="comment">&lt;!--  三级标题   --&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">dd</span> <span class="attr">data-name</span>=<span class="string">&quot;list&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;component/grid/list.html&quot;</span>&gt;</span>等比例列表排列<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">dd</span> <span class="attr">data-name</span>=<span class="string">&quot;mobile&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;component/grid/mobile.html&quot;</span>&gt;</span>按移动端排列<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">dd</span> <span class="attr">data-name</span>=<span class="string">&quot;button&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;component/button/index.html&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">dd</span> <span class="attr">data-name</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span>&gt;</span>表单<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">&quot;layui-nav-child&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;component/form/element.html&quot;</span>&gt;</span>表单元素<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                      <span class="tag">&lt;<span class="name">dd</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;component/form/group.html&quot;</span>&gt;</span>表单组合<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;<span class="name">dd</span> <span class="attr">data-name</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;component/nav/index.html&quot;</span>&gt;</span>导航<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  &lt;/ul&gt;</span><br></pre></td></tr></table></figure><h3 id="主体内容"><a href="#主体内容" class="headerlink" title="主体内容"></a>主体内容</h3><h4 id="控制台-x2F-主页"><a href="#控制台-x2F-主页" class="headerlink" title="控制台&#x2F;主页"></a>控制台&#x2F;主页</h4><p>略</p><h4 id="数据表格"><a href="#数据表格" class="headerlink" title="数据表格"></a>数据表格</h4><p>需要使用ajax接受异步数据：使用@RestController</p><p>配合接受JSON封装一个<strong>json类</strong>：</p><pre><code>public class resultJson&lt;T&gt; &#123;    private int code;    private String msg;    private int count;    private T data;public resultJson() &#123;&#125;public resultJson(int code, String msg) &#123;    this.code = code;    this.msg = msg;&#125;public resultJson(int code,int count, T data) &#123;    this.code = code;    this.count = count;    this.data = data;&#125;//AUTO Generate Getter and Setter&#125;</code></pre><p>从数据库查询到数据封装到JSON类后返回即可；</p><p><strong>前端调用JSON数据：</strong></p><p>绑定容器、设置数据接口、在表头设定对应的字段</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">html</span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;demo&quot;</span> <span class="attr">lay-filter</span>=<span class="string">&quot;test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- JS --&gt;</span></span><br><span class="line">var table = layui.table;</span><br><span class="line"> </span><br><span class="line">//执行渲染</span><br><span class="line">table.render(&#123;</span><br><span class="line">  elem: &#x27;#demo&#x27; //指定原始表格元素选择器（推荐id选择器）</span><br><span class="line">  ,height: 315 //容器高度</span><br><span class="line">  ,cols: [&#123;&#125;] //设置表头</span><br><span class="line">  //,…… //更多参数参考右侧目录：基本参数选项</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>自动渲染</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;layui-table&quot;</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;height:315, url:&#x27;/demo/table/user/&#x27;, page:true, id:&#x27;test&#x27;&#125;&quot;</span> <span class="attr">lay-filter</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;id&#x27;, width:80, sort: true&#125;&quot;</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;username&#x27;, width:80&#125;&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;sex&#x27;, width:80, sort: true&#125;&quot;</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;city&#x27;&#125;&quot;</span>&gt;</span>城市<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;sign&#x27;&#125;&quot;</span>&gt;</span>签名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;experience&#x27;, sort: true&#125;&quot;</span>&gt;</span>积分<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;score&#x27;, sort: true&#125;&quot;</span>&gt;</span>评分<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;classify&#x27;&#125;&quot;</span>&gt;</span>职业<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;wealth&#x27;, sort: true&#125;&quot;</span>&gt;</span>财富<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="全部参数一览表"><a href="#全部参数一览表" class="headerlink" title="全部参数一览表"></a>全部参数一览表</h5><p>下面是目前 table 模块所支持的全部参数一览表，我们对重点参数进行了的详细说明，你可以点击下述表格最右侧的“示例”去查看</p><table><thead><tr><th align="left">参数</th><th align="left">类型</th><th align="left">说明</th><th align="left">示例值</th></tr></thead><tbody><tr><td align="left">elem</td><td align="left">String&#x2F;DOM</td><td align="left">指定原始 table 容器的选择器或 DOM，方法渲染方式必填</td><td align="left">“#demo”</td></tr><tr><td align="left">cols</td><td align="left">Array</td><td align="left">设置表头。值是一个二维数组。方法渲染方式必填</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#cols">详见表头参数</a></td></tr><tr><td align="left">url（等）</td><td align="left">-</td><td align="left">异步数据接口相关参数。其中 url 参数为必填项</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#async">详见异步接口</a></td></tr><tr><td align="left">toolbar</td><td align="left">String&#x2F;DOM&#x2F;Boolean</td><td align="left">开启表格头部工具栏区域，该参数支持四种类型值：toolbar: ‘#toolbarDemo’ <em>&#x2F;&#x2F;指向自定义工具栏模板选择器</em>toolbar: ‘<div>xxx</div>‘ <em>&#x2F;&#x2F;直接传入工具栏模板字符</em>toolbar: true <em>&#x2F;&#x2F;仅开启工具栏，不显示左侧模板</em>toolbar: ‘default’ <em>&#x2F;&#x2F;让工具栏左侧显示默认的内置模板</em>注意： 1. 该参数为 layui 2.4.0 开始新增。 2. 若需要“列显示隐藏”、“导出”、“打印”等功能，则必须开启该参数</td><td align="left">false</td></tr><tr><td align="left">defaultToolbar</td><td align="left">Array</td><td align="left">该参数可自由配置头部工具栏右侧的图标按钮</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#defaultToolbar">详见头工具栏图标</a></td></tr><tr><td align="left">width</td><td align="left">Number</td><td align="left">设定容器宽度。table容器的默认宽度是跟随它的父元素铺满，你也可以设定一个固定值，当容器中的内容超出了该宽度时，会自动出现横向滚动条。</td><td align="left">1000</td></tr><tr><td align="left">height</td><td align="left">Number&#x2F;String</td><td align="left">设定容器高度</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#height">详见height</a></td></tr><tr><td align="left">cellMinWidth</td><td align="left">Number</td><td align="left">（layui 2.2.1 新增）全局定义所有常规单元格的最小宽度（默认：60），一般用于列宽自动分配的情况。其优先级低于表头参数中的 minWidth</td><td align="left">100</td></tr><tr><td align="left">done</td><td align="left">Function</td><td align="left">数据渲染完的回调。你可以借此做一些其它的操作</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#done">详见done回调</a></td></tr><tr><td align="left">data</td><td align="left">Array</td><td align="left">直接赋值数据。既适用于只展示一页数据，也非常适用于对一段已知数据进行多页展示。</td><td align="left">[{}, {}, {}, {}, …]</td></tr><tr><td align="left">totalRow</td><td align="left">Boolean</td><td align="left">是否开启合计行区域。layui 2.4.0 新增</td><td align="left">false</td></tr><tr><td align="left">page</td><td align="left">Boolean&#x2F;Object</td><td align="left">开启分页（默认：false） 注：从 layui 2.2.0 开始，支持传入一个对象，里面可包含 <a href="https://www.layui.com/doc/modules/laypage.html#options">laypage</a> 组件所有支持的参数（jump、elem除外）</td><td align="left">{theme: ‘#c00’}</td></tr><tr><td align="left">limit</td><td align="left">Number</td><td align="left">每页显示的条数（默认：10）。值务必对应 limits 参数的选项。 注意：<em>优先级低于 page 参数中的 limit 参数</em></td><td align="left">30</td></tr><tr><td align="left">limits</td><td align="left">Array</td><td align="left">每页条数的选择项，默认：[10,20,30,40,50,60,70,80,90]。 注意：<em>优先级低于 page 参数中的 limits 参数</em></td><td align="left">[30,60,90]</td></tr><tr><td align="left">loading</td><td align="left">Boolean</td><td align="left">是否显示加载条（默认：true）。如果设置 false，则在切换分页时，不会出现加载条。该参数只适用于 url 参数开启的方式</td><td align="left">false</td></tr><tr><td align="left">title</td><td align="left">String</td><td align="left">定义 table 的大标题（在文件导出等地方会用到）layui 2.4.0 新增</td><td align="left">“用户表”</td></tr><tr><td align="left">text</td><td align="left">Object</td><td align="left">自定义文本，如空数据时的异常提示等。注：layui 2.2.5 开始新增。</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#text">详见自定义文本</a></td></tr><tr><td align="left">autoSort</td><td align="left">Boolean</td><td align="left">默认 true，即直接由 table 组件在前端自动处理排序。 若为 false，则需自主排序，通常由服务端直接返回排序好的数据。 注意：该参数为 layui 2.4.4 新增</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#onsort">详见监听排序</a></td></tr><tr><td align="left">initSort</td><td align="left">Object</td><td align="left">初始排序状态。用于在数据表格渲染完毕时，默认按某个字段排序。</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#initSort">详见初始排序</a></td></tr><tr><td align="left">id</td><td align="left">String</td><td align="left">设定容器唯一 id。id 是对表格的数据操作方法上是必要的传递条件，它是表格容器的索引，你在下文诸多地方都将会见识它的存在。  值得注意的是：从 layui 2.2.0 开始，该参数也可以自动从 <em><table id="test"></table></em> 中的 id 参数中获取。</td><td align="left">test</td></tr><tr><td align="left">skin（等）</td><td align="left">-</td><td align="left">设定表格各种外观、尺寸等</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#skin">详见表格风格</a></td></tr></tbody></table><h5 id="cols-表头参数一览表"><a href="#cols-表头参数一览表" class="headerlink" title="cols - 表头参数一览表"></a>cols - 表头参数一览表</h5><p>相信我，在你还尚无法驾驭 layui table 的时候，你的所有焦点都应放在这里，它带引领你完成许多可见和不可见甚至你无法想象的工作。如果你采用的是方法渲染，cols 是一个二维数组，表头参数设定在数组内；如果你采用的自动渲染，表头参数的设定应放在 <em><th></em> 标签上</p><table><thead><tr><th align="left">参数</th><th align="left">类型</th><th align="left">说明</th><th align="left">示例值</th></tr></thead><tbody><tr><td align="left">field</td><td align="left">String</td><td align="left">设定字段名。字段名的设定非常重要，且是表格数据列的唯一标识</td><td align="left">username</td></tr><tr><td align="left">title</td><td align="left">String</td><td align="left">设定标题名称</td><td align="left">用户名</td></tr><tr><td align="left">width</td><td align="left">Number&#x2F;String</td><td align="left">设定列宽，若不填写，则自动分配；若填写，则支持值为：数字、百分比 请结合实际情况，对不同列做不同设定。</td><td align="left">200 30%</td></tr><tr><td align="left">minWidth</td><td align="left">Number</td><td align="left">局部定义当前常规单元格的最小宽度（默认：60），一般用于列宽自动分配的情况。其优先级高于基础参数中的 cellMinWidth</td><td align="left">100</td></tr><tr><td align="left">type</td><td align="left">String</td><td align="left">设定列类型。可选值有：normal（常规列，无需设定）checkbox（复选框列）radio（单选框列，layui 2.4.0 新增）numbers（序号列）space（空列）</td><td align="left">任意一个可选值</td></tr><tr><td align="left">LAY_CHECKED</td><td align="left">Boolean</td><td align="left">是否全选状态（默认：false）。必须复选框列开启后才有效，如果设置 true，则表示复选框默认全部选中。</td><td align="left">true</td></tr><tr><td align="left">fixed</td><td align="left">String</td><td align="left">固定列。可选值有：<em>left</em>（固定在左）、<em>right</em>（固定在右）。一旦设定，对应的列将会被固定在左或右，不随滚动条而滚动。 注意：<em>如果是固定在左，该列必须放在表头最前面；如果是固定在右，该列必须放在表头最后面。</em></td><td align="left">left（同 true） right</td></tr><tr><td align="left">hide</td><td align="left">Boolean</td><td align="left">是否初始隐藏列，默认：false。layui 2.4.0 新增</td><td align="left">true</td></tr><tr><td align="left"></td><td align="left"></td><td align="left"></td><td align="left"></td></tr><tr><td align="left">totalRow</td><td align="left">Boolean&#x2F;Object</td><td align="left">是否开启该列的自动合计功能，默认：false。当开启时，则默认由前端自动合计当前行数据。从 layui 2.5.6 开始： 若接口直接返回了合计行数据，则优先读取接口合计行数据，格式如下：<code>codelayui.code&#123;  &quot;code&quot;: 0,  &quot;msg&quot;: &quot;&quot;,  &quot;count&quot;: 1000,  &quot;data&quot;: [&#123;&#125;, &#123;&#125;]  &quot;totalRow&quot;: &#123;    &quot;score&quot;: &quot;666&quot;    ,&quot;experience&quot;: &quot;999&quot;  &#125;&#125;              </code>如上，在 totalRow 中返回所需统计的列字段名和值即可。 另外，totalRow 字段同样可以通过 parseData 回调来解析成为 table 组件所规定的数据格式。</td><td align="left">true</td></tr><tr><td align="left">totalRowText</td><td align="left">String</td><td align="left">用于显示自定义的合计文本。layui 2.4.0 新增</td><td align="left">“合计：”</td></tr><tr><td align="left">sort</td><td align="left">Boolean</td><td align="left">是否允许排序（默认：false）。如果设置 true，则在对应的表头显示排序icon，从而对列开启排序功能。注意：<em>不推荐对值同时存在“数字和普通字符”的列开启排序，因为会进入字典序比对</em>。比如：*’贤心’ &gt; ‘2’ &gt; ‘100’*，这可能并不是你想要的结果，但字典序排列算法（ASCII码比对）就是如此。</td><td align="left">true</td></tr><tr><td align="left">unresize</td><td align="left">Boolean</td><td align="left">是否禁用拖拽列宽（默认：false）。默认情况下会根据列类型（type）来决定是否禁用，如复选框列，会自动禁用。而其它普通列，默认允许拖拽列宽，当然你也可以设置 true 来禁用该功能。</td><td align="left">false</td></tr><tr><td align="left">edit</td><td align="left">String</td><td align="left">单元格编辑类型（默认不开启）目前只支持：<em>text</em>（输入框）</td><td align="left">text</td></tr><tr><td align="left">event</td><td align="left">String</td><td align="left">自定义单元格点击事件名，以便在 <a href="https://www.layui.com/doc/modules/table.html#ontool">tool</a> 事件中完成对该单元格的业务处理</td><td align="left">任意字符</td></tr><tr><td align="left">style</td><td align="left">String</td><td align="left">自定义单元格样式。即传入 CSS 样式</td><td align="left">background-color: #5FB878; color: #fff;</td></tr><tr><td align="left">align</td><td align="left">String</td><td align="left">单元格排列方式。可选值有：<em>left</em>（默认）、<em>center</em>（居中）、<em>right</em>（居右）</td><td align="left">center</td></tr><tr><td align="left">colspan</td><td align="left">Number</td><td align="left">单元格所占列数（默认：1）。一般用于多级表头</td><td align="left">3</td></tr><tr><td align="left">rowspan</td><td align="left">Number</td><td align="left">单元格所占行数（默认：1）。一般用于多级表头</td><td align="left">2</td></tr><tr><td align="left">templet</td><td align="left">String</td><td align="left">自定义列模板，模板遵循 <a href="https://www.layui.com/doc/modules/laytpl.html">laytpl</a> 语法。这是一个非常实用的功能，你可借助它实现逻辑处理，以及将原始数据转化成其它格式，如时间戳转化为日期字符等</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#templet">详见自定义模板</a></td></tr><tr><td align="left">toolbar</td><td align="left">String</td><td align="left">绑定工具条模板。可在每行对应的列中出现一些自定义的操作性按钮</td><td align="left"><a href="https://www.layui.com/doc/modules/table.html#onrowtool">详见行工具事件</a></td></tr></tbody></table><h5 id="templet-自定义列模板"><a href="#templet-自定义列模板" class="headerlink" title="templet - 自定义列模板"></a>templet - 自定义列模板</h5><p>类型：<em>String</em>，默认值：<em>无</em></p><p>在默认情况下，单元格的内容是完全按照数据接口返回的content原样输出的，如果你想对某列的单元格添加链接等其它元素，你可以借助该参数来轻松实现。这是一个非常实用且强大的功能，你的表格内容会因此而丰富多样。</p><blockquote><p>templet 提供了三种使用方式，请结合实际场景选择最合适的一种：</p><ul><li>如果自定义模版的字符量太大，我们推荐你采用【方式一】；</li><li>如果自定义模板的字符量适中，或者想更方便地调用外部方法，我们推荐你采用【方式二】；</li><li>如果自定义模板的字符量很小，我们推荐你采用【方式三】</li></ul></blockquote><p><strong>方式一：绑定模版选择器。</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> table.<span class="title function_">render</span>(&#123;</span><br><span class="line">  <span class="attr">cols</span>: [[</span><br><span class="line">    &#123;<span class="attr">field</span>:<span class="string">&#x27;title&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;文章标题&#x27;</span>, <span class="attr">width</span>: <span class="number">200</span>, <span class="attr">templet</span>: <span class="string">&#x27;#titleTpl&#x27;</span>&#125; <span class="comment">//这里的templet值是模板元素的选择器</span></span><br><span class="line">    ,&#123;<span class="attr">field</span>:<span class="string">&#x27;id&#x27;</span>, <span class="attr">title</span>:<span class="string">&#x27;ID&#x27;</span>, <span class="attr">width</span>:<span class="number">100</span>&#125;</span><br><span class="line">  ]]</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">等价于：</span><br><span class="line">&lt;th lay-data=<span class="string">&quot;&#123;field:&#x27;title&#x27;, width: 200, templet: &#x27;#titleTpl&#x27;&#125;&quot;</span>&gt;文章标题&lt;/th&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;field:&#x27;id&#x27;, width:100&#125;&quot;</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span>   </span><br></pre></td></tr></table></figure><p>下述是templet对应的模板，它可以存放在页面的任意位置。模板遵循于 <a href="https://www.layui.com/doc/modules/laytpl.html">laytpl</a> 语法，可读取到返回的所有数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> id=<span class="string">&quot;titleTpl&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/detail/&#123;&#123;d.id&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;layui-table-link&quot;</span>&gt;</span>&#123;&#123;d.title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">注意：上述的 &#123;&#123;d.<span class="property">id</span>&#125;&#125;、&#123;&#123;d.<span class="property">title</span>&#125;&#125; 是动态内容，它对应数据接口返回的字段名。除此之外，你还可以读取到以下额外字段：</span><br><span class="line">     序号：&#123;&#123; d.<span class="property">LAY_INDEX</span> &#125;&#125; （该额外字段为 layui <span class="number">2.2</span><span class="number">.0</span> 新增）</span><br><span class="line"> </span><br><span class="line">由于模板遵循 laytpl 语法（建议细读 laytpl文档 ），因此在模板中你可以写任意脚本语句（如 <span class="keyword">if</span> <span class="keyword">else</span>/<span class="keyword">for</span>等）：</span><br><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> id=<span class="string">&quot;titleTpl&quot;</span>&gt;</span><br><span class="line">  &#123;&#123;#  <span class="keyword">if</span>(d.<span class="property">id</span> &lt; <span class="number">100</span>)&#123; &#125;&#125;</span><br><span class="line">    &lt;a href=<span class="string">&quot;/detail/&#123;&#123;d.id&#125;&#125;&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;layui-table-link&quot;</span>&gt;&#123;&#123;d.<span class="property">title</span>&#125;&#125;&lt;/a&gt;</span><br><span class="line">  &#123;&#123;#  &#125; <span class="keyword">else</span> &#123; &#125;&#125;</span><br><span class="line">    &#123;&#123;d.<span class="property">title</span>&#125;&#125;(普通用户)</span><br><span class="line">  &#123;&#123;#  &#125; &#125;&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>方式二：函数转义。</strong>自 layui 2.2.5 开始，templet 开始支持函数形式，函数返回一个参数 d，包含接口返回的所有字段和数据。如下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">table.<span class="title function_">render</span>(&#123;</span><br><span class="line">  <span class="attr">cols</span>: [[</span><br><span class="line">    &#123;<span class="attr">field</span>:<span class="string">&#x27;title&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;文章标题&#x27;</span>, <span class="attr">width</span>: <span class="number">200</span></span><br><span class="line">      ,<span class="attr">templet</span>: <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ID：&#x27;</span>+ d.<span class="property">id</span> +<span class="string">&#x27;，标题：&lt;span style=&quot;color: #c00;&quot;&gt;&#x27;</span>+ d.<span class="property">title</span> +<span class="string">&#x27;&lt;/span&gt;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ,&#123;<span class="attr">field</span>:<span class="string">&#x27;id&#x27;</span>, <span class="attr">title</span>:<span class="string">&#x27;ID&#x27;</span>, <span class="attr">width</span>:<span class="number">100</span>&#125;</span><br><span class="line">  ]]</span><br><span class="line">&#125;);    </span><br><span class="line">        </span><br></pre></td></tr></table></figure><p><strong>方式三：直接赋值模版字符。</strong>事实上，templet 也可以直接是一段 html 内容，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">templet</span>: <span class="string">&#x27;&lt;div&gt;&lt;a href=&quot;/detail/&#123;&#123;d.id&#125;&#125;&quot; class=&quot;layui-table-link&quot;&gt;&#123;&#123;d.title&#125;&#125;&lt;/a&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line"> </span><br><span class="line">注意：这里一定要被一层 &lt;div&gt;&lt;/div&gt; 包裹，否则无法读取到模板</span><br></pre></td></tr></table></figure><h5 id="toolbar-绑定工具条模板"><a href="#toolbar-绑定工具条模板" class="headerlink" title="toolbar - 绑定工具条模板"></a>toolbar - 绑定工具条模板</h5><p>类型：<em>String</em>，默认值：<em>无</em></p><p>通常你需要在表格的每一行加上 <em>查看</em>、<em>编辑</em>、<em>删除</em> 这样类似的操作按钮，而 tool 参数就是为此而生，你因此可以非常便捷地实现各种操作功能。<strong>tool 参数和 templet 参数的使用方式完全类似</strong>，通常接受的是一个选择器，也可以是一段HTML字符。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">table.<span class="title function_">render</span>(&#123;</span><br><span class="line">  <span class="attr">cols</span>: [[</span><br><span class="line">    &#123;<span class="attr">field</span>:<span class="string">&#x27;id&#x27;</span>, <span class="attr">title</span>:<span class="string">&#x27;ID&#x27;</span>, <span class="attr">width</span>:<span class="number">100</span>&#125;</span><br><span class="line">    ,&#123;<span class="attr">fixed</span>: <span class="string">&#x27;right&#x27;</span>, <span class="attr">width</span>:<span class="number">150</span>, <span class="attr">align</span>:<span class="string">&#x27;center&#x27;</span>, <span class="attr">toolbar</span>: <span class="string">&#x27;#barDemo&#x27;</span>&#125; <span class="comment">//这里的toolbar值是模板元素的选择器</span></span><br><span class="line">  ]]</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">等价于：</span><br><span class="line">&lt;th lay-data=<span class="string">&quot;&#123;field:&#x27;id&#x27;, width:100&#125;&quot;</span>&gt;<span class="variable constant_">ID</span>&lt;/th&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">th</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;fixed: &#x27;right&#x27;, width:150, align:&#x27;center&#x27;, toolbar: &#x27;#barDemo&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>下述是 toolbar 对应的模板，它可以存放在页面的任意位置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> id=<span class="string">&quot;barDemo&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn layui-btn-xs&quot;</span> <span class="attr">lay-event</span>=<span class="string">&quot;detail&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn layui-btn-xs&quot;</span> <span class="attr">lay-event</span>=<span class="string">&quot;edit&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn layui-btn-danger layui-btn-xs&quot;</span> <span class="attr">lay-event</span>=<span class="string">&quot;del&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">  </span><br><span class="line">  &lt;!-- 这里同样支持 laytpl 语法，如： --&gt;</span><br><span class="line">  &#123;&#123;#  <span class="keyword">if</span>(d.<span class="property">auth</span> &gt; <span class="number">2</span>)&#123; &#125;&#125;</span><br><span class="line">    &lt;a <span class="keyword">class</span>=<span class="string">&quot;layui-btn layui-btn-xs&quot;</span> lay-event=<span class="string">&quot;check&quot;</span>&gt;审核&lt;/a&gt;</span><br><span class="line">  &#123;&#123;#  &#125; &#125;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">注意：属性 lay-event=<span class="string">&quot;&quot;</span> 是模板的关键所在，值可随意定义</span><br></pre></td></tr></table></figure><h3 id="Echart"><a href="#Echart" class="headerlink" title="Echart"></a>Echart</h3><p>这是一个图表的模板。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">layui.<span class="title function_">use</span>([<span class="string">&quot;carousel&quot;</span>,<span class="string">&quot;echarts&quot;</span>],<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> e=layui.<span class="property">$</span></span><br><span class="line">    ,a=(layui.<span class="property">carousel</span>,layui.<span class="property">echarts</span>)</span><br><span class="line">    ,t=[]</span><br><span class="line">    , i=[&#123;</span><br><span class="line">        &lt;!-- 主体部分 --&gt;</span><br><span class="line">        <span class="attr">title</span>:&#123;<span class="attr">text</span>:<span class="string">&quot;未来一周气温变化&quot;</span>,<span class="attr">subtext</span>:<span class="string">&quot;纯属虚构&quot;</span>&#125;</span><br><span class="line">        , <span class="attr">tooltip</span>:&#123;<span class="attr">trigger</span>:<span class="string">&quot;axis&quot;</span>&#125;</span><br><span class="line">        ,<span class="attr">legend</span>:&#123;<span class="attr">data</span>:[<span class="string">&quot;最高气温&quot;</span>,<span class="string">&quot;最低气温&quot;</span>]&#125;</span><br><span class="line">        , <span class="attr">calculable</span>:!<span class="number">0</span></span><br><span class="line">        ,<span class="attr">xAxis</span>:[&#123;<span class="attr">type</span>:<span class="string">&quot;category&quot;</span></span><br><span class="line">                 ,<span class="attr">boundaryGap</span>:!<span class="number">1</span></span><br><span class="line">                 , <span class="attr">data</span>:[<span class="string">&quot;周一&quot;</span>,<span class="string">&quot;周二&quot;</span>,<span class="string">&quot;周三&quot;</span>,<span class="string">&quot;周四&quot;</span>,<span class="string">&quot;周五&quot;</span>,<span class="string">&quot;周六&quot;</span>,<span class="string">&quot;周日&quot;</span>]&#125;]</span><br><span class="line">        , <span class="attr">yAxis</span>:[&#123;<span class="attr">type</span>:<span class="string">&quot;value&quot;</span></span><br><span class="line">                  ,<span class="attr">axisLabel</span>:&#123;<span class="attr">formatter</span>:<span class="string">&quot;&#123;value&#125; °C&quot;</span>&#125;&#125;]</span><br><span class="line">        , <span class="attr">series</span>:[&#123;<span class="attr">name</span>:<span class="string">&quot;最高气温&quot;</span></span><br><span class="line">                   ,<span class="attr">type</span>:<span class="string">&quot;line&quot;</span></span><br><span class="line">                   ,<span class="attr">data</span>:[<span class="number">11</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">10</span>]</span><br><span class="line">                   , <span class="attr">markPoint</span>:&#123;<span class="attr">data</span>:[&#123;<span class="attr">type</span>:<span class="string">&quot;max&quot;</span>,<span class="attr">name</span>:<span class="string">&quot;最大值&quot;</span>&#125;</span><br><span class="line">                                      ,&#123;<span class="attr">type</span>:<span class="string">&quot;min&quot;</span>,<span class="attr">name</span>:<span class="string">&quot;最小值&quot;</span>&#125;]&#125;</span><br><span class="line">                   , <span class="attr">markLine</span>:&#123;<span class="attr">data</span>:[&#123;<span class="attr">type</span>:<span class="string">&quot;average&quot;</span>,<span class="attr">name</span>:<span class="string">&quot;平均值&quot;</span>&#125;]&#125;&#125;</span><br><span class="line">                  , &#123;<span class="attr">name</span>:<span class="string">&quot;最低气温&quot;</span></span><br><span class="line">                     ,<span class="attr">type</span>:<span class="string">&quot;line&quot;</span></span><br><span class="line">                     ,<span class="attr">data</span>:[<span class="number">1</span>,-<span class="number">2</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">0</span>]</span><br><span class="line">                     , <span class="attr">markPoint</span>:&#123;<span class="attr">data</span>:[&#123;<span class="attr">name</span>:<span class="string">&quot;周最低&quot;</span></span><br><span class="line">                                         ,<span class="attr">value</span>:-<span class="number">2</span></span><br><span class="line">                                         ,<span class="attr">xAxis</span>:<span class="number">1</span></span><br><span class="line">                                         ,<span class="attr">yAxis</span>:-<span class="number">1.5</span>&#125;]&#125;</span><br><span class="line">                     , <span class="attr">markLine</span>:&#123;<span class="attr">data</span>:[&#123;<span class="attr">type</span>:<span class="string">&quot;average&quot;</span></span><br><span class="line">                                        ,<span class="attr">name</span>:<span class="string">&quot;平均值&quot;</span>&#125;]&#125;&#125;]&#125;]</span><br><span class="line">    , n=<span class="title function_">e</span>(<span class="string">&quot;#LAY-index-normline&quot;</span>).<span class="title function_">children</span>(<span class="string">&quot;div&quot;</span>)</span><br><span class="line">    , l=<span class="keyword">function</span>(<span class="params">e</span>)&#123;t[e]=a.<span class="title function_">init</span>(n[e],layui.<span class="property">echartsTheme</span>)</span><br><span class="line">        , t[e].<span class="title function_">setOption</span>(i[e])</span><br><span class="line">        ,<span class="variable language_">window</span>.<span class="property">onresize</span>=t[e].<span class="property">resize</span>&#125;;</span><br><span class="line">&lt;!-- 结尾部分 --&gt;</span><br><span class="line">    n[<span class="number">0</span>]&amp;&amp;<span class="title function_">l</span>(<span class="number">0</span>)&#125;),</span><br></pre></td></tr></table></figure><h5 id="页面加载JS所用的语法："><a href="#页面加载JS所用的语法：" class="headerlink" title="页面加载JS所用的语法："></a>页面加载JS所用的语法：</h5><p><a href="https://www.layui.com/doc/base/modules.html#extend">文档示例</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//定义模块</span><br><span class="line">;layui.define(function(e)&#123;e(&quot;sample&quot;,&#123;&#125;)&#125;);</span><br><span class="line">//加载使用模块</span><br><span class="line">layui.use([&#x27;mymod&#x27;, &#x27;mod1&#x27;], function()&#123;</span><br><span class="line">  var mymod = layui.mymod</span><br><span class="line">  ,mod1 = layui.mod1</span><br><span class="line">  ,mod2 = layui.mod2;</span><br><span class="line">  mymod.hello(&#x27;World!&#x27;); //弹出 Hello World!</span><br><span class="line">&#125;);</span><br><span class="line">//定义模块可以加载模块</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Laytpl"><a href="#Laytpl" class="headerlink" title="Laytpl"></a>Laytpl</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script id=<span class="string">&quot;sensorList&quot;</span> type=<span class="string">&quot;text/html&quot;</span>&gt;</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-col-xs12 layui-col-sm4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     &#123;&#123;#  layui.each(d.list, function(index, item)&#123; &#125;&#125;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layuiadmin-card-text&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-text-top&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;layui-icon layui-icon-engine&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;http://www.layui.com/doc/modules/flow.html&quot;</span>&gt;</span>&#123;&#123; item.sensorName &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;layui-text-center&quot;</span>&gt;</span>&#123;&#123; item.sensorDetail &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;layui-text-bottom&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">lay-href</span>=<span class="string">&quot;http://www.layui.com/doc/modules/flow.html&quot;</span>&gt;</span>流加载<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>7 天前<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     &#123;&#123;#  &#125;); &#125;&#125;</span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"> &lt;/script&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  layui.<span class="title function_">use</span>(<span class="string">&quot;laytpl&quot;</span>,<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">var</span> laytpl = layui.<span class="property">laytpl</span>;</span><br><span class="line">   <span class="keyword">var</span> data = &#123; <span class="comment">//数据</span></span><br><span class="line">     <span class="string">&quot;title&quot;</span>:<span class="string">&quot;aaa&quot;</span></span><br><span class="line">     ,<span class="string">&quot;list&quot;</span>:[&#123;<span class="string">&quot;sensorName&quot;</span>:<span class="string">&quot;传感器1&quot;</span>,<span class="string">&quot;sensorDetail&quot;</span>:<span class="string">&quot;描述一般十多年&quot;</span>&#125;,&#123;<span class="string">&quot;sensorName&quot;</span>:<span class="string">&quot;传感器2&quot;</span>,<span class="string">&quot;sensorDetail&quot;</span>:<span class="string">&quot;描述一发般十多年&quot;</span>&#125;,&#123;<span class="string">&quot;sensorName&quot;</span>:<span class="string">&quot;传感器3&quot;</span>,<span class="string">&quot;sensorDetail&quot;</span>:<span class="string">&quot;描述而般十多年&quot;</span>&#125;]</span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="keyword">var</span> getTpl = sensorList.<span class="property">innerHTML</span></span><br><span class="line">           ,view = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sensorView&#x27;</span>);</span><br><span class="line">   <span class="title function_">laytpl</span>(getTpl).<span class="title function_">render</span>(data, <span class="keyword">function</span>(<span class="params">html</span>)&#123;</span><br><span class="line">     view.<span class="property">innerHTML</span> = html;</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><h3 id="前台请求后台JSON数据"><a href="#前台请求后台JSON数据" class="headerlink" title="前台请求后台JSON数据"></a>前台请求后台JSON数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> $.<span class="title function_">post</span>(<span class="string">&quot;/aaa&quot;</span>,&#123;<span class="attr">id</span>:id,<span class="attr">datatablename</span>:datatablename,<span class="attr">dname</span>:dname&#125;, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    title=data;</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line">$.<span class="title function_">post</span>(<span class="string">&#x27;url&#x27;</span>, &#123;&#125;, <span class="keyword">function</span>(<span class="params">str</span>)&#123;</span><br><span class="line">  layer.<span class="title function_">open</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">content</span>: str <span class="comment">//注意，如果str是object，那么需要字符拼接。</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取JSON数据后渲染页面</span></span><br><span class="line">$.<span class="title function_">get</span>(<span class="string">&quot;/database/sensorList&quot;</span>,&#123;&#125;, <span class="keyword">function</span>(<span class="params">sensordata</span>)&#123;</span><br><span class="line"></span><br><span class="line">      layui.<span class="title function_">use</span>(<span class="string">&quot;laytpl&quot;</span>,<span class="keyword">function</span> (<span class="params">sensordata</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> laytpl = layui.<span class="property">laytpl</span></span><br><span class="line">        ,getTpl = sensorList.<span class="property">innerHTML</span></span><br><span class="line">        ,view = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sensorView&#x27;</span>);</span><br><span class="line">        <span class="title function_">laytpl</span>(getTpl).<span class="title function_">render</span>(sensordata, <span class="keyword">function</span>(<span class="params">html</span>)&#123;</span><br><span class="line">          view.<span class="property">innerHTML</span> = html;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>**坑：返回json数据时dao层必须有Setter和Getter否则不能生成JSON数据</p><h4 id="监听Select选择"><a href="#监听Select选择" class="headerlink" title="监听Select选择"></a>监听Select选择</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">对于<span class="title class_">From</span>表单的自动渲染，需要在父标签中添加<span class="keyword">class</span>=<span class="string">&quot;lay-form&quot;</span></span><br><span class="line"></span><br><span class="line">form.<span class="title function_">on</span>(<span class="string">&#x27;select(filter)&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">elem</span>); <span class="comment">//得到select原始DOM对象</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">value</span>); <span class="comment">//得到被选中的值</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">othis</span>); <span class="comment">//得到美化后的DOM对象</span></span><br><span class="line">&#125;);     </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">//获取JSON数据后渲染页面</span><br><span class="line">$.get(&quot;/database/acid?sensorId=1&quot;,&#123;&#125;, function(data)&#123;</span><br><span class="line"></span><br><span class="line">      layui.use([&quot;carousel&quot;,&quot;echarts&quot;],function(data)&#123;</span><br><span class="line">      </span><br><span class="line">  </span><br><span class="line">    var tmpdata = new Array();</span><br><span class="line">        var newindex = 0;</span><br><span class="line">        for( var i = 0; i &lt; 7; i++ ) &#123;</span><br><span class="line">          if (data[i] != null) &#123;</span><br><span class="line">            tmpdata[newindex] = dates.format(data[i].time, &#x27;MM-dd hh:mm&#x27;);</span><br><span class="line">            newindex++;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">    var e=layui.$</span><br><span class="line">    ,a=(layui.carousel,layui.echarts)</span><br><span class="line">    ,t=[]</span><br><span class="line">    , i=[&#123;</span><br><span class="line">        &lt;!-- 主体部分 --&gt;</span><br><span class="line">        title:&#123;text:&quot;PH-酒精含量变化&quot;,subtext:&quot;酒精含量为百分比&quot;&#125;</span><br><span class="line">        , tooltip:&#123;trigger:&quot;axis&quot;&#125;</span><br><span class="line">        ,legend:&#123;data:[&quot;酒精含量&quot;,&quot;PH&quot;]&#125;</span><br><span class="line">        , calculable:!0</span><br><span class="line">        ,xAxis:[&#123;type:&quot;category&quot;</span><br><span class="line">                 ,boundaryGap:!1</span><br><span class="line">                 , data:tmpdata&#125;]</span><br><span class="line">        , yAxis:[&#123;type:&quot;value&quot;</span><br><span class="line">                  ,axisLabel:&#123;formatter:&quot;&#123;value&#125; °C&quot;&#125;&#125;]</span><br><span class="line">        , series:[&#123;name:&quot;最高气温&quot;</span><br><span class="line">                   ,type:&quot;line&quot;</span><br><span class="line">                   ,data:[11,11,15,13,12,13,10]</span><br><span class="line">                   , markPoint:&#123;data:[&#123;type:&quot;max&quot;,name:&quot;最大值&quot;&#125;</span><br><span class="line">                                      ,&#123;type:&quot;min&quot;,name:&quot;最小值&quot;&#125;]&#125;</span><br><span class="line">                   , markLine:&#123;data:[&#123;type:&quot;average&quot;,name:&quot;平均值&quot;&#125;]&#125;&#125;</span><br><span class="line">                  , &#123;name:&quot;最低气温&quot;</span><br><span class="line">                     ,type:&quot;line&quot;</span><br><span class="line">                     ,data:[1,-2,2,5,3,2,0]</span><br><span class="line">                     , markPoint:&#123;data:[&#123;name:&quot;周最低&quot;</span><br><span class="line">                                         ,value:-2</span><br><span class="line">                                         ,xAxis:1</span><br><span class="line">                                         ,yAxis:-1.5&#125;]&#125;</span><br><span class="line">                     , markLine:&#123;data:[&#123;type:&quot;average&quot;</span><br><span class="line">                                        ,name:&quot;平均值&quot;&#125;]&#125;&#125;]&#125;]</span><br><span class="line">    , n=e(&quot;#LAY-index-normline&quot;).children(&quot;div&quot;)</span><br><span class="line">    , l=function(e)&#123;t[e]=a.init(n[e],layui.echartsTheme)</span><br><span class="line">        , t[e].setOption(i[e])</span><br><span class="line">        ,window.onresize=t[e].resize&#125;;</span><br><span class="line">&lt;!-- 结尾部分 --&gt;</span><br><span class="line">    n[0]&amp;&amp;l(0)&#125;),</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h4 id="JS格式化时间日期"><a href="#JS格式化时间日期" class="headerlink" title="JS格式化时间日期"></a>JS格式化时间日期</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">js <span class="title class_">Date</span> <span class="title function_">format</span>(日期格式化:yyyy-<span class="variable constant_">MM</span>-dd <span class="attr">HH</span>:<span class="attr">mm</span>:ss.<span class="property">S</span>)</span><br><span class="line">今天在做日期显示的时候，那个显示格式困扰了很久，各种组件都尝试了，总是不如意，最后自己网上找了一个，然后稍微修改一下，感觉这个<span class="title class_">Util</span>挺常用的，这里mark一下</span><br><span class="line"></span><br><span class="line"><span class="title class_">Date</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">format</span> = <span class="keyword">function</span>(<span class="params">fmt</span>)</span><br><span class="line">&#123; </span><br><span class="line">　　<span class="keyword">var</span> o = &#123;</span><br><span class="line">　　　　<span class="string">&quot;M+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getMonth</span>()+<span class="number">1</span>, <span class="comment">//月份</span></span><br><span class="line">　　　　<span class="string">&quot;d+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getDate</span>(), <span class="comment">//日</span></span><br><span class="line">　　　　<span class="string">&quot;h+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getHours</span>()%<span class="number">12</span> == <span class="number">0</span> ? <span class="number">12</span> : <span class="variable language_">this</span>.<span class="title function_">getHours</span>()%<span class="number">12</span>, <span class="comment">//小时</span></span><br><span class="line">　　　　<span class="string">&quot;H+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getHours</span>(), <span class="comment">//小时</span></span><br><span class="line">　　　　<span class="string">&quot;m+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getMinutes</span>(), <span class="comment">//分</span></span><br><span class="line">　　　　<span class="string">&quot;s+&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getSeconds</span>(), <span class="comment">//秒</span></span><br><span class="line">　　　　<span class="string">&quot;q+&quot;</span> : <span class="title class_">Math</span>.<span class="title function_">floor</span>((<span class="variable language_">this</span>.<span class="title function_">getMonth</span>()+<span class="number">3</span>)/<span class="number">3</span>), <span class="comment">//季度</span></span><br><span class="line">　　　　<span class="string">&quot;S&quot;</span> : <span class="variable language_">this</span>.<span class="title function_">getMilliseconds</span>() <span class="comment">//毫秒</span></span><br><span class="line">　　&#125;;</span><br><span class="line">　　<span class="keyword">if</span>(<span class="regexp">/(y+)/</span>.<span class="title function_">test</span>(fmt))</span><br><span class="line">　　　　fmt=fmt.<span class="title function_">replace</span>(<span class="title class_">RegExp</span>.<span class="property">$1</span>, (<span class="variable language_">this</span>.<span class="title function_">getFullYear</span>()+<span class="string">&quot;&quot;</span>).<span class="title function_">substr</span>(<span class="number">4</span> - <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span>));</span><br><span class="line">　　<span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> o)</span><br><span class="line">　　　　<span class="keyword">if</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;(&quot;</span>+ k +<span class="string">&quot;)&quot;</span>).<span class="title function_">test</span>(fmt))</span><br><span class="line">　　fmt = fmt.<span class="title function_">replace</span>(<span class="title class_">RegExp</span>.<span class="property">$1</span>, (<span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span>==<span class="number">1</span>) ? (o[k]) : ((<span class="string">&quot;00&quot;</span>+ o[k]).<span class="title function_">substr</span>((<span class="string">&quot;&quot;</span>+ o[k]).<span class="property">length</span>)));</span><br><span class="line">　　<span class="keyword">return</span> fmt;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">调用方式：</span><br><span class="line"></span><br><span class="line">　　<span class="keyword">var</span> time1 = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">format</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">　　<span class="keyword">var</span> time2 = <span class="keyword">new</span> <span class="title class_">Date</span>(time).<span class="title function_">format</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">简单记录，不熟前端，有问题大佬们请指正。</span><br></pre></td></tr></table></figure><h4 id="引入JQuery"><a href="#引入JQuery" class="headerlink" title="引入JQuery"></a>引入JQuery</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;http://libs.baidu.com/jquery/1.8.3/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以使用</span></span><br><span class="line">$.<span class="title function_">get</span>(<span class="string">&quot;/database/acid?sensorId=1&quot;</span>,&#123;&#125;, <span class="keyword">function</span>(<span class="params">acidData</span>)&#123;&#125;</span><br><span class="line">      post等</span><br></pre></td></tr></table></figure><h4 id="JS解析URL内的数据"><a href="#JS解析URL内的数据" class="headerlink" title="JS解析URL内的数据"></a>JS解析URL内的数据</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将URL中的变量取出</span></span><br><span class="line">  <span class="comment">//调用方式</span></span><br><span class="line">  <span class="comment">// getQueryVariable(&quot;sensorId&quot;)</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getQueryVariable</span>(<span class="params">variable</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> query = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> vars = query.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.<span class="property">length</span>;i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> pair = vars[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>(pair[<span class="number">0</span>] == variable)&#123;<span class="keyword">return</span> pair[<span class="number">1</span>];&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="数据表格的重载"><a href="#数据表格的重载" class="headerlink" title="数据表格的重载"></a>数据表格的重载</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//渲染一个表格</span></span><br><span class="line">            i.<span class="title function_">render</span>(&#123;</span><br><span class="line">                <span class="attr">elem</span>: <span class="string">&quot;#sensorDataBaseTable&quot;</span>,</span><br><span class="line">                <span class="attr">title</span>:<span class="string">&quot;数据&quot;</span>,</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&quot;/database/dataBaseTable/&quot;</span>,</span><br><span class="line">                <span class="attr">where</span>: &#123;<span class="attr">sensorId</span>:<span class="number">1</span>&#125;</span><br><span class="line">                ,<span class="attr">page</span>: <span class="literal">true</span> <span class="comment">//开启分页</span></span><br><span class="line">                 ,<span class="attr">toolbar</span>: <span class="literal">true</span></span><br><span class="line">                ,<span class="attr">height</span>: <span class="number">550</span> <span class="comment">//容器高度</span></span><br><span class="line">                ,<span class="attr">cols</span>: [[</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">field</span>: <span class="string">&quot;time&quot;</span>,</span><br><span class="line">                        <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&quot;时间&quot;</span>,</span><br><span class="line">                        <span class="attr">sort</span>: !<span class="number">0</span>,</span><br><span class="line">                        <span class="attr">templet</span>: <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(d.<span class="property">time</span>).<span class="title function_">format</span>(<span class="string">&quot;MM-dd HH:mm&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">field</span>: <span class="string">&quot;acidity&quot;</span>,</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&quot;酸度-PH&quot;</span>,</span><br><span class="line">                        <span class="attr">minWidth</span>: <span class="number">100</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">field</span>: <span class="string">&quot;alcohol&quot;</span>,</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&quot;酒精含量%&quot;</span>,</span><br><span class="line">                        <span class="attr">minWidth</span>: <span class="number">100</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">field</span>: <span class="string">&quot;starch&quot;</span>,</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&quot;淀粉含量%&quot;</span>,</span><br><span class="line">                        <span class="attr">minWidth</span>: <span class="number">100</span>,</span><br><span class="line"></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">field</span>: <span class="string">&quot;humidity&quot;</span>,</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&quot;湿度%&quot;</span>,</span><br><span class="line">                        <span class="attr">minWidth</span>: <span class="number">100</span>,</span><br><span class="line"></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">field</span>: <span class="string">&quot;temperature&quot;</span>,</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&quot;温度℃&quot;</span>,</span><br><span class="line">                        <span class="attr">minWidth</span>: <span class="number">100</span>,</span><br><span class="line"></span><br><span class="line">                    &#125;]],</span><br><span class="line">                <span class="attr">limit</span>: <span class="number">10</span>,</span><br><span class="line">                <span class="attr">limits</span>: [<span class="number">10</span>, <span class="number">30</span>, <span class="number">50</span>, <span class="number">80</span>, <span class="number">100</span>,<span class="number">200</span>,<span class="number">400</span>],</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&quot;对不起，加载出现异常！&quot;</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//定义执行重载该表格，查询或修改</span></span><br><span class="line">             <span class="keyword">var</span> $ = layui.<span class="property">$</span>,</span><br><span class="line">            active = &#123;</span><br><span class="line">            <span class="attr">reload</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> sensorId = $(<span class="string">&#x27;#sensorView2&#x27;</span>);</span><br><span class="line">                <span class="keyword">var</span> start = $(<span class="string">&#x27;#start&#x27;</span>);</span><br><span class="line">                <span class="keyword">var</span> end = $(<span class="string">&#x27;#end&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//执行重载</span></span><br><span class="line">                i.<span class="title function_">reload</span>(<span class="string">&#x27;sensorDataBaseTable&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">page</span>: &#123;</span><br><span class="line">                        <span class="attr">curr</span>: <span class="number">1</span> <span class="comment">//重新从第 1 页开始</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    ,<span class="attr">where</span>: &#123;</span><br><span class="line">                            <span class="attr">sensorId</span>: sensorId.<span class="title function_">val</span>(),</span><br><span class="line">                            <span class="attr">start</span>:start.<span class="title function_">val</span>(),</span><br><span class="line">                            <span class="attr">end</span>:end.<span class="title function_">val</span>()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//监听该表格，修改</span></span><br><span class="line">        $(<span class="string">&#x27;.layui-inline .layui-btn&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> type = $(<span class="variable language_">this</span>).<span class="title function_">data</span>(<span class="string">&#x27;type&#x27;</span>);</span><br><span class="line">            active[type] ? active[type].<span class="title function_">call</span>(<span class="variable language_">this</span>) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用templet渲染修改数据</span></span><br><span class="line">table.<span class="title function_">render</span>(&#123;</span><br><span class="line">  <span class="attr">cols</span>: [[</span><br><span class="line">    &#123;<span class="attr">field</span>:<span class="string">&#x27;title&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;文章标题&#x27;</span>, <span class="attr">width</span>: <span class="number">200</span></span><br><span class="line">      ,<span class="attr">templet</span>: <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ID：&#x27;</span>+ d.<span class="property">id</span> +<span class="string">&#x27;，标题：&lt;span style=&quot;color: #c00;&quot;&gt;&#x27;</span>+ d.<span class="property">title</span> +<span class="string">&#x27;&lt;/span&gt;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ,&#123;<span class="attr">field</span>:<span class="string">&#x27;id&#x27;</span>, <span class="attr">title</span>:<span class="string">&#x27;ID&#x27;</span>, <span class="attr">width</span>:<span class="number">100</span>&#125;</span><br><span class="line">  ]]</span><br><span class="line">&#125;);    </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Start&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;LayUI入门&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://fengfeng.lanzoui.com/iVH4Ekz8f2f&quot;&gt;点此下载&lt;/a&gt;Layuiadmin&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.layui.com/doc/&quot;&gt;点此跳转&lt;/a&gt;Layui官方文档&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/niuben/p/11038897.html&quot;&gt;点此跳转&lt;/a&gt;Layui第三方文档&lt;/p&gt;</summary>
    
    
    
    <category term="编程" scheme="http://peaky2022.gitee.io/peaky/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="学习" scheme="http://peaky2022.gitee.io/peaky/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="编程" scheme="http://peaky2022.gitee.io/peaky/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>小米手机刷机入门指北（小白向）</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/01/23/44737761.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/01/23/44737761.html</id>
    <published>2021-01-23T03:03:36.000Z</published>
    <updated>2022-03-03T15:01:47.727Z</updated>
    
    <content type="html"><![CDATA[<p>今天这一期给大家带来小米手机刷机入门指北</p><p>原文来自酷安@米粥酱</p><p>原文链接：<a href="https://www.coolapk.com/feed/17782931?shareKey=YmY1MDY0YjBjYmFiNjAwYjAwYjY~&shareUid=1162770&shareFrom=com.coolapk.market_11.0-beta7">查看链接</a></p><p>本文主要是写给那些想刷机却不知该如何下手的小白用户，大佬们可以先跳过主要写卡刷，线刷部分我会简写。</p><p>文章内容都是一些比较基础的刷机知识，容易理解和快速上手，希望可以帮到各位，好了，我们上正文</p> <span id="more"></span><p>首先我们得先了解一些刷机必备的知识（知道的可以不用点链接）</p><p>BL锁是什么:<a href="https://baike.baidu.com/item/BootLoader/8733520">查看链接</a></p><p>Rec是什么:<a href="https://baike.sm.cn/item/702432c17c0cc802e45521be76eb07c0.html?from=smsc&uc_param_str=dnntnwvepffrgibijbpr">查看链接</a></p><p>Fastboot是什么:<a href="https://baike.baidu.com/item/fastboot/3228436">查看链接</a></p><p>Root是什么:<a href="https://baike.baidu.com/item/root/73226">查看链接</a></p><p>了解完呢，我们就可以正式进入刷机之旅啦</p><p>■卡刷</p><p>●解BL锁部分</p><p>首先，按照小米官方的说法，老机子都是不带BL锁的（老机子用户可以跳过这一part），而大部分的机子（米4之后的）都带BL锁，所以想知道自己手机是否解了锁，开机的时候看第一屏（就是刚刚开机首先显示出来的画面）底下是否有“unlock”字样，有的话就证明你已经解锁了，没有的话就说明你没解。</p><p>（已经解锁的用户请跳过这一part）</p><p>首先我们得去:<a href="http://www.miui.com/unlock/index.html">查看链接</a></p><p>申请解锁小米手机，让自己的账号获取解锁权限</p><p>等收到通知申请成功了，就按照网站上面的提示，下载解锁工具，如果你是新账号，一般来讲则需要等两周左右，所以提前做好准备，或者找个老账号，如果你是老账号就可以秒解。</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps1.png" alt="img"> </p><p>★注意!这里解BL锁成功之后是会抹除所有数据的，请做好备份准备。</p><p>（开发版用户可以忽略以下这一part）</p><p>如果你是稳定版用户，那么建议你去 <a href="http://www.coolapk.com/apk/com.xiaomi.vipaccount">【小米社区】</a> 提前申请开发版，等解锁成功之后，去小米社区下载开发版刷入</p><p>★如果不想刷入开发版可直接跳到下面刷入Recovery部分</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps2.png" alt="img"> </p><p>如果它没提示你怎么刷入开发版，点进设置——我的设备——MIUI版本，然后对准那个图标点几下，直到出来一行字（具体是什么我也忘了）然后点右上角——手动选择安装包，然后去文件夹选好你下载的开发版刷入就可以了。</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps3.png" alt="img"> </p><p>●获取Root权限</p><p>刷入开发版之后，我们就可以开始获取Root权限了</p><p>点击手机管家——应用管理——权限——ROOT权限管理按照提示操作就可以了，ROOT不会抹除任何数据请放心刷入</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps4.png" alt="img"> </p><p>★获取了ROOT权限之后，就要准备你的刷机必备两件套了:Rec和你将要刷入的包，这些东西可以去你的机型的一些交流群的群文件里找到，或者官网</p><p>●刷入Recovery</p><p>Recovery以下简称rec，rec一般常见的有两种，一种是twrp，另一种是橙狐，下面我们就拿twrp举例。</p><p>而一般刷入Rec呢，有两种模式，一种是线刷，一种是卡刷</p><p>◆下面我就先来讲线刷的，稳定版用户注意了，因为你们还没获取root权限所以想通过卡刷刷入的话很难（对小白来说）或者不可能</p><p>这里我们建议下一个cofface tool</p><p>我会在评论区放下载链接，各位投币自取</p><p>按照提示，进入fastboot模式（关机后同时按电源键和音量—）</p><p>（下面是界面）</p><p>根据提示把rec刷入，就行了，当然如果会ADB的大佬们也可以用ADB刷这里我就不讲了毕竟ADB我还没摸熟</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps5.png" alt="img"> </p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps6.png" alt="img"> </p><p>◆卡刷</p><p>这里开发版并且获取root权限的用户看好啦</p><p>获取root之后，准备好相应的rec，并且知道文件存放路径（这个这么基础我就不说了）</p><p>去下载一个 <a href="https://play.google.com/store/apps/details?id=top.zsh2401.imagehelper">查看链接</a></p><p>不知为何你安下架了，所以评论区我也会放下载链接各位投币自取</p><p>然后点进去，退出</p><p>★不要清后台!不要清后台!不要清后台!</p><p>回到root权限管理，给它root权限，然后回去，点击刷入rec，刷入成功后，你可以立马进去开始刷机或者稍后关机再进去</p><p>进Rec方法:关机后同时按电源键和音量＋</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps7.png" alt="img"> </p><p>●进入Rec</p><p>如果说进入Rec之后是正片的话，那前面做的那些，也只是预告而已</p><p>twrp的主页面，如果你的是英语版的话可以去设置里调成中文，如果没有中文选项只能再找个中文版了</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps8.png" alt="img"> </p><p>黑鲨2的页面</p><p>刷机第一部是双清</p><p>直接滑动就行了清除成功后就可以开始刷包</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps9.png" alt="img"> </p><p>如果你刷的是一些比较特殊的包，比如类原生Android Q或者降级包，比如从Q降到P，刷前是需要三清四清啥的，刷后还要格式化data，当然这只是刷这些特殊的包所要用到的步骤，具体要做什么得看你刷什么包</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps10.png" alt="img"> </p><p>格式化data页面</p><p>挂载分区，有时候你没挂载一些分区的话可能清除数据不成功或者找不到你要刷的包所以先看好挂载的分区对了没，具体自己摸索或者问人</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps11.png" alt="img"> </p><p>挂载</p><p>备份的话看资料有没有提前备份好，反正我是不用这玩意</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps12.png" alt="img"> </p><p>备份</p><p>●刷入包</p><p>前面的步骤都做完之后，点击安装，进去选好自己的包就开始刷了，注意了!如果包损坏的话，就得换一个包，所以多备几个包是至关重要的，建议备一个官方包救砖</p><p>这里不仅可以刷第三方ROM，还能刷面具进行root（没有root权限的稳定版用户稳定版用户），刷内核啥的，下面就拿刷EVO举例</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps13.png" alt="img"> </p><p>刷入类原生Android Q的话，刷入成功后不要立马开机，得先格式化data一遍再开</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps14.png" alt="img"> </p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps15.png" alt="img"> </p><p>刷入成功</p><p>开机是会有点久的所以大家不用担心，只要能顺利进入第二屏（开机显示的第二个画面）那就成功了。</p><p>成功开机后，恭喜你，卡刷成功</p><p>■线刷</p><p>因为我刷机大多都是卡刷的，线刷的话我是拿来救砖和降级的，所以线刷我就说这两part吧</p><p>●救砖和降级</p><p>举个例子，如果你是MIUI11用户，想降回MIUI10，那么请先备份好所有数据，因为这会抹除所有数据</p><p>按照上面的步骤解除了BL之后，电脑上下载MIflash和即将刷入的降级包</p><p>用数据线链接电脑</p><p>手机进入fastboot模式，然后进入MIflash，开刷</p><p>官方稳定版完整包下载地址:<a href="https://www.miui.com/getrom.php?m=yes&mobile=2">查看链接</a></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/wps16.png" alt="img"> </p><p>MIflash线刷教程:<a href="http://www.miui.com/shuaji-393.html">查看链接</a></p><p>刷入成功后，你就降级成功了</p><p>★根据我的经验，MIflash刷入如果超过1000s就拔线，重刷，一般五六次就成功了运气好两三次甚至一次</p><p>这个方法适用于救砖和降级，百试百灵</p><p>当然救砖也可以用cofface刷入rec卡刷</p><p>●总结:刷机就好比做数学题，思维活跃很快就能懂</p><p>如果各位大佬觉得我有什么写的不好的话请多指教，勿喷，我这篇是写给小白看的</p><p>再加上我养老了很久，所以如果有些误区的话不妨指出来，我已经尽我的努力将一篇简单易懂易上手的刷机文章写出来了，感谢各位看到这里。</p><p>“愿你刷机半生，归来仍是MIUI”</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;今天这一期给大家带来小米手机刷机入门指北&lt;/p&gt;
&lt;p&gt;原文来自酷安@米粥酱&lt;/p&gt;
&lt;p&gt;原文链接：&lt;a href=&quot;https://www.coolapk.com/feed/17782931?shareKey=YmY1MDY0YjBjYmFiNjAwYjAwYjY~&amp;shareUid=1162770&amp;shareFrom=com.coolapk.market_11.0-beta7&quot;&gt;查看链接&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;本文主要是写给那些想刷机却不知该如何下手的小白用户，大佬们可以先跳过主要写卡刷，线刷部分我会简写。&lt;/p&gt;
&lt;p&gt;文章内容都是一些比较基础的刷机知识，容易理解和快速上手，希望可以帮到各位，好了，我们上正文&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="http://peaky2022.gitee.io/peaky/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="教程" scheme="http://peaky2022.gitee.io/peaky/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>LayuiAdmin 文档</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/01/20/a2f6ccf6.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/01/20/a2f6ccf6.html</id>
    <published>2021-01-20T12:59:04.000Z</published>
    <updated>2022-03-03T15:01:47.827Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/niuben/p/11038846.html">layuiAdmin std v1.x 【iframe版】开发者文档</a></p><h1 id="题外"><a href="#题外" class="headerlink" title="题外"></a><strong>题外</strong></h1><ul><li>该文档适用于 layuiAdmin 专业版（单页面），阅读之前请务必确认是否与你使用的版本对应。</li><li>熟练掌握 layuiAdmin 的前提是熟练掌握 layui，因此除了本篇文档， layui 的文档 也是必不可少的存在。</li><li><a href="https://www.kancloud.cn/dawn-only/layui">看云上的文档</a></li></ul><hr><blockquote><p>layuiAdmin.std（iframe 版） 是完全基于 layui 架构而成的通用型后台管理模板系统，采用传统的 iframe 多页面开发模式，可更快速直接地开发网页后台应用程序，无需过多地学习成本，简单高效，撸起袖子直接干。</p></blockquote><span id="more"></span><h1 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a><strong>快速上手</strong></h1><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a><strong>部署</strong></h3><ol><li>解压文件后，将 layuiAdmin 完整放置在任意目录</li><li>通过本地 web 服务器去访问 .&#x2F;start&#x2F;index.html 即可运行 Demo</li></ol><blockquote><p>由于 layuiAdmin 可采用前后端分离开发模式，因此你无需将其放置在你的服务端 MVC 框架中，你只需要给 layuiAdmin 主入口页面（我们也称之为：宿主页面）进行访问解析，它即可全权完成自身路由的跳转和视图的呈现，而数据层则完全通过服务端提供的异步接口来完成。</p></blockquote><h3 id="目录说明"><a href="#目录说明" class="headerlink" title="目录说明"></a><strong>目录说明</strong></h3><ul><li><p>src&#x2F;</p><p>layuiAdmin 源代码，通常用于开发环境（如本地），推荐你在本地开发时，将 .&#x2F;start&#x2F;index.html 中的 layui.css 和 layui.js 的引入路径由 dist 改为 src 目录。</p><ul><li>src&#x2F;controller&#x2F;：存放 JS 业务模块，即对视图进行事件等交互性处理</li><li>src&#x2F;lib&#x2F;：layuiAdmin 的核心模块，一般不推荐修改</li><li>src&#x2F;style&#x2F;：存放样式，其中 admin.css是核心样式</li><li>src&#x2F;views&#x2F;：存放视图文件。其中 layout.html 是整个框架结构的承载，一般不推荐做大量改动。</li><li>src&#x2F;config.js：layuiAdmin 的全局配置文件，可随意修改。</li><li>src&#x2F;index.js：layuiAdmin 的入口模块，一般不推荐修改</li></ul></li><li><p>dist&#x2F;<br>通过 gulp 将 layuiAdmin src 目录的源代码进行构建后生成的目录（即：将 JS 和 CSS 文件进行了压缩等处理），通常用于线上环境。关于 gulp 的使用，下文也有介绍。</p></li><li><p>start&#x2F;<br>存放 layuiAdmin 的入口页面、模拟接口数据、layui</p></li></ul><h3 id="宿主页面"><a href="#宿主页面" class="headerlink" title="宿主页面"></a><strong>宿主页面</strong></h3><p>你所看到的 start&#x2F;index.html 是我们提供好的宿主页面，它是整个单页面的承载，所有的界面都是在这一个页面中完成跳转和渲染的。事实上，宿主页面可以放在任何地方，但是要注意修改里面的<code>&lt;link&gt; &lt;script&gt;</code>的 src 和 layui.config 中 base 的路径。</p><h3 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a><strong>全局配置</strong></h3><p>当你已经顺利在本地预览了 layuiAdmin 后，你一定迫不及待关注更深层的结构。打开 src 目录，你将看到 config.js，里面存储着所有的默认配置。你可以按照实际需求选择性修改，下面是 layuiAdmin 默认提供的配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">layui.<span class="title function_">define</span>([<span class="string">&#x27;laytpl&#x27;</span>, <span class="string">&#x27;layer&#x27;</span>, <span class="string">&#x27;element&#x27;</span>, <span class="string">&#x27;util&#x27;</span>], <span class="keyword">function</span>(<span class="params"><span class="built_in">exports</span></span>)&#123;</span><br><span class="line">  <span class="built_in">exports</span>(<span class="string">&#x27;setter&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;LAY_app&#x27;</span> <span class="comment">//容器ID</span></span><br><span class="line">    ,<span class="attr">base</span>: layui.<span class="property">cache</span>.<span class="property">base</span> <span class="comment">//记录layuiAdmin文件夹所在路径</span></span><br><span class="line">    ,<span class="attr">views</span>: layui.<span class="property">cache</span>.<span class="property">base</span> + <span class="string">&#x27;views/&#x27;</span> <span class="comment">//视图所在目录</span></span><br><span class="line">    ,<span class="attr">entry</span>: <span class="string">&#x27;index&#x27;</span> <span class="comment">//默认视图文件名</span></span><br><span class="line">    ,<span class="attr">engine</span>: <span class="string">&#x27;.html&#x27;</span> <span class="comment">//视图文件后缀名</span></span><br><span class="line">    ,<span class="attr">pageTabs</span>: <span class="literal">false</span> <span class="comment">//是否开启页面选项卡功能。单页版不推荐开启</span></span><br><span class="line">    </span><br><span class="line">    ,<span class="attr">name</span>: <span class="string">&#x27;layuiAdmin Pro&#x27;</span></span><br><span class="line">    ,<span class="attr">tableName</span>: <span class="string">&#x27;layuiAdmin&#x27;</span> <span class="comment">//本地存储表名</span></span><br><span class="line">    ,<span class="attr">MOD_NAME</span>: <span class="string">&#x27;admin&#x27;</span> <span class="comment">//模块事件名</span></span><br><span class="line">    </span><br><span class="line">    ,<span class="attr">debug</span>: <span class="literal">true</span> <span class="comment">//是否开启调试模式。如开启，接口异常时会抛出异常 URL 等信息</span></span><br><span class="line">    </span><br><span class="line">    ,<span class="attr">interceptor</span>: <span class="literal">false</span> <span class="comment">//是否开启未登入拦截</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//自定义请求字段</span></span><br><span class="line">    ,<span class="attr">request</span>: &#123;</span><br><span class="line">      <span class="attr">tokenName</span>: <span class="string">&#x27;access_token&#x27;</span> <span class="comment">//自动携带 token 的字段名。可设置 false 不携带。</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//自定义响应字段</span></span><br><span class="line">    ,<span class="attr">response</span>: &#123;</span><br><span class="line">      <span class="attr">statusName</span>: <span class="string">&#x27;code&#x27;</span> <span class="comment">//数据状态的字段名称</span></span><br><span class="line">      ,<span class="attr">statusCode</span>: &#123;</span><br><span class="line">        <span class="attr">ok</span>: <span class="number">0</span> <span class="comment">//数据状态一切正常的状态码</span></span><br><span class="line">        ,<span class="attr">logout</span>: <span class="number">1001</span> <span class="comment">//登录状态失效的状态码</span></span><br><span class="line">      &#125;</span><br><span class="line">      ,<span class="attr">msgName</span>: <span class="string">&#x27;msg&#x27;</span> <span class="comment">//状态信息的字段名称</span></span><br><span class="line">      ,<span class="attr">dataName</span>: <span class="string">&#x27;data&#x27;</span> <span class="comment">//数据详情的字段名称</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//独立页面路由，可随意添加（无需写参数）</span></span><br><span class="line">    ,<span class="attr">indPage</span>: [</span><br><span class="line">      <span class="string">&#x27;/user/login&#x27;</span> <span class="comment">//登入页</span></span><br><span class="line">      ,<span class="string">&#x27;/user/reg&#x27;</span> <span class="comment">//注册页</span></span><br><span class="line">      ,<span class="string">&#x27;/user/forget&#x27;</span> <span class="comment">//找回密码</span></span><br><span class="line">      ,<span class="string">&#x27;/template/tips/test&#x27;</span> <span class="comment">//独立页的一个测试 demo</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//扩展的第三方模块</span></span><br><span class="line">    ,<span class="attr">extend</span>: [</span><br><span class="line">      <span class="string">&#x27;echarts&#x27;</span>, <span class="comment">//echarts 核心包</span></span><br><span class="line">      <span class="string">&#x27;echartsTheme&#x27;</span> <span class="comment">//echarts 主题</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//主题配置</span></span><br><span class="line">    ,<span class="attr">theme</span>: &#123;</span><br><span class="line">      <span class="comment">//配色方案，如果用户未设置主题，第一个将作为默认</span></span><br><span class="line">      <span class="attr">color</span>: [&#123;</span><br><span class="line">        <span class="attr">main</span>: <span class="string">&#x27;#20222A&#x27;</span> <span class="comment">//主题色</span></span><br><span class="line">        ,<span class="attr">selected</span>: <span class="string">&#x27;#009688&#x27;</span> <span class="comment">//选中色</span></span><br><span class="line">        ,<span class="attr">logo</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">//logo区域背景色</span></span><br><span class="line">        ,<span class="attr">header</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">//头部区域背景色</span></span><br><span class="line">        ,<span class="attr">alias</span>: <span class="string">&#x27;default&#x27;</span> <span class="comment">//默认别名</span></span><br><span class="line">      &#125;] <span class="comment">//为了减少篇幅，更多主题此处不做列举，可直接参考 config.js</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//初始的颜色索引，对应上面的配色方案数组索引</span></span><br><span class="line">      <span class="comment">//如果本地已经有主题色记录，则以本地记录为优先，除非清除 localStorage（步骤：F12呼出调试工具→Aplication→Local Storage→选中页面地址→layuiAdmin→再点上面的X）</span></span><br><span class="line">      <span class="comment">// 1.0 正式版开始新增</span></span><br><span class="line">      ,<span class="attr">initColorIndex</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="侧边菜单"><a href="#侧边菜单" class="headerlink" title="侧边菜单"></a><strong>侧边菜单</strong></h3><ul><li>在 start&#x2F;json&#x2F;menu.js 文件中，我们放置了默认的侧边菜单数据，你可以去随意改动它。</li><li>如果你需要动态加载菜单，你需要将 views&#x2F;layout.html 中的对应地址改成你的真实接口地址<br>侧边菜单最多可支持到三级。无论你采用静态的菜单还是动态的，菜单的数据格式都必须是一段合法的 JSON，且必须符合以下规范：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">0</span> <span class="comment">//状态码，key 名可以通过 config.js 去重新配置</span></span><br><span class="line">  ,<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span> <span class="comment">//提示信息</span></span><br><span class="line">  ,<span class="string">&quot;data&quot;</span>: [&#123; <span class="comment">//菜单数据，key名可以通过 config.js 去重新配置</span></span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;component&quot;</span> <span class="comment">//一级菜单名称（与视图的文件夹名称和路由路径对应）</span></span><br><span class="line">    ,<span class="string">&quot;title&quot;</span>: <span class="string">&quot;组件&quot;</span> <span class="comment">//一级菜单标题</span></span><br><span class="line">    ,<span class="string">&quot;icon&quot;</span>: <span class="string">&quot;layui-icon-component&quot;</span> <span class="comment">//一级菜单图标样式</span></span><br><span class="line">    ,<span class="string">&quot;jump&quot;</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">//自定义一级菜单路由地址，默认按照 name 解析。一旦设置，将优先按照 jump 设定的路由跳转</span></span><br><span class="line">    ,<span class="string">&quot;spread&quot;</span>: <span class="literal">true</span> <span class="comment">//是否默认展子菜单（1.0.0-beta9 新增）</span></span><br><span class="line">    ,<span class="string">&quot;list&quot;</span>: [&#123; <span class="comment">//二级菜单</span></span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;grid&quot;</span> <span class="comment">//二级菜单名称（与视图的文件夹名称和路由路径对应）</span></span><br><span class="line">      ,<span class="string">&quot;title&quot;</span>: <span class="string">&quot;栅格&quot;</span> <span class="comment">//二级菜单标题</span></span><br><span class="line">      ,<span class="string">&quot;jump&quot;</span>: <span class="string">&#x27;&#x27;</span>  <span class="comment">//自定义二级菜单路由地址</span></span><br><span class="line">      ,<span class="string">&quot;spread&quot;</span>: <span class="literal">true</span> <span class="comment">//是否默认展子菜单（1.0.0-beta9 新增）</span></span><br><span class="line">      ,<span class="string">&quot;list&quot;</span>: [&#123; <span class="comment">//三级菜单</span></span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;list&quot;</span> <span class="comment">//三级菜单名（与视图中最终的文件名和路由对应），如：component/grid/list</span></span><br><span class="line">        ,<span class="string">&quot;title&quot;</span>: <span class="string">&quot;等比例列表排列&quot;</span> <span class="comment">//三级菜单标题</span></span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;mobile&quot;</span></span><br><span class="line">        ,<span class="string">&quot;title&quot;</span>: <span class="string">&quot;按移动端排列&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>TIPS：实际运用时，切勿出现上述中的注释，否则将不是合法的 JSON ，会出现解析错误。<br>需要注意的是以下几点：</p></blockquote><ol><li><p>当任意级菜单有子菜单，点击该菜单都只是收缩和展开操作，而并不会跳转，只有没有子菜单的菜单才被允许跳转。</p></li><li><p>菜单的路由地址默认是按照菜单层级的 name 来设定的。</p><p>我们假设一级菜单的 name 是：a，二级菜单的是：b，三级菜单的 name 是 c，那么：</p><ul><li>三级菜单最终的路由地址就是：<code>/a/b/c</code></li><li>如果二级菜单没有三级菜单，那么二级菜单就是最终路由，地址就是：<code>/a/b/</code></li><li>如果一级菜单没有二级菜单，那么一级菜单就是最终路由，地址就是：<code>/a/</code></li></ul></li><li><p>但如果你设置了 参数 jump，那么就会优先读取 jump 设定的路由地址，如：<code>&quot;jump&quot;: &quot;/user/set&quot;</code></p></li></ol><hr><h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><p>layuiAdmin 的路由是采用 <code>location.hash</code> 的机制，即路由地址是放在 <code>./#/</code> 后面，并通过 layui 自带的方法：<code>layui.router()</code> 来进行解析。每一个路由都对应一个真实存在的视图文件，且路由地址和视图文件的路径是一致的（相对 <code>views</code>目录）。因此，你不再需要通过配置服务端的路由去访问一个页面，也无需在 layuiAdmin 内部代码中去定义路由，而是直接通过 layuiAdmin 的前端路由去访问，即可匹配相应目录的视图，从而呈现出页面结果。</p><h3 id="路由规则"><a href="#路由规则" class="headerlink" title="路由规则"></a><strong>路由规则</strong></h3><blockquote><p>.&#x2F;#&#x2F;path1&#x2F;path2&#x2F;path3&#x2F;key1&#x3D;value1&#x2F;key2&#x3D;value2…</p></blockquote><p>一个实际的示例：</p><blockquote><p>.&#x2F;#&#x2F;user&#x2F;set<br>.&#x2F;#&#x2F;user&#x2F;set&#x2F;uid&#x3D;123&#x2F;type&#x3D;1#xxx（下面将以这个为例继续讲解）</p></blockquote><p>当你需要对路由结构进行解析时，你只需要通过 layui 内置的方法 layui.router() 即可完成。如上面的路由解析出来的结果是：</p><blockquote><p>{<br>path: [‘user’,’set’]<br>,search: {uid: 123, type: 1}<br>,href: ‘user&#x2F;set&#x2F;uid&#x3D;123&#x2F;type&#x3D;1’<br>,hash: ‘xxx’<br>}</p></blockquote><p>可以看到，不同的结构会自动归纳到相应的参数中，其中：</p><blockquote><ul><li>path：存储的是路由的目录结构</li><li>search：存储的是路由的参数部分</li><li>href：存储的是 layuiAdmin 的完整路由地址</li><li>hash：存储的是 layuiAdmin 自身的锚记，跟系统自带的 location.hash 有点类似</li></ul></blockquote><p>通过<code>layui.router()</code> 得到路由对象后，你就可以对页面进行个性化操作、异步参数传值等等。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 JS 中获取路由参数</span></span><br><span class="line"><span class="keyword">var</span> router = layui.<span class="title function_">router</span>();</span><br><span class="line">admin.<span class="title function_">req</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">  ,<span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">uid</span>: router.<span class="property">search</span>.<span class="property">uid</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  在动态模板中获取路由参数 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/html&quot;</span> <span class="attr">template</span> <span class="attr">lay-url</span>=<span class="string">&quot;./xxx/?uid=&#123;&#123; layui.router().search.uid &#125;&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  …</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!-- 或 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/html&quot;</span> <span class="attr">template</span> <span class="attr">lay-url</span>=<span class="string">&quot;./xxx/&quot;</span> <span class="attr">lay-data</span>=<span class="string">&quot;&#123;uid:&#x27;&#123;&#123; layui.router().search.uid &#125;&#125;&#x27;&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  …</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="路由跳转"><a href="#路由跳转" class="headerlink" title="路由跳转"></a><strong>路由跳转</strong></h3><p>通过上文的路由规则，你已经大致清楚了 layuiAdmin 路由的基本原理和解析方法。那么如何完成路由的跳转呢？</p><ol><li>在视图文件的 HTML 代码中，通过对任意元素设定<code>lay-href=&quot;/user/set/uid=123/type=1&quot;</code>，好处是：任意元素都可以触发跳转。缺点是：只能在浏览器当前选项卡完成跳转（注意：不是 layuiAdmin 的选项卡）</li><li>直接对 a 标签设定 href，如： <code>&lt;a href=&quot;#/user/set&quot;&gt;text&lt;/a&gt;</code> 。好处是：你可以通过设定<code>target=&quot;_blank&quot;</code>来打开一个浏览器新选项卡。缺点是：只能设置 a 标签，且前面必须加 &#x2F;#&#x2F;</li><li>在 JS 代码中，还可通过 <code>location.hash = &#39;/user/set&#39;</code>; 来跳转。前面无需加 #，它会自动追加。</li></ol><h3 id="路由结尾"><a href="#路由结尾" class="headerlink" title="路由结尾"></a><strong>路由结尾</strong></h3><p>在路由结尾部分出现的 &#x2F; 与不出现，是两个完全不同的路由。比如下面这个：</p><ol><li>user&#x2F;set<br>读取的视图文件是：.views&#x2F;user&#x2F;set.html</li><li>user&#x2F;set&#x2F;<br>读取的视图文件是：.&#x2F;views&#x2F;user&#x2F;set&#x2F;index.html （TIPS：这里的 index.html 即是目录下的默认主视图，下文会有讲解）</li></ol><p>因此一定要注意结尾处的 &#x2F;，避免视图读取错误。</p><h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><p>这或许是你应用 layuiAdmin 时的主要焦点，在开发过程中，你的大部分精力都可能会聚焦在这里。它取代了服务端 MVC 架构中的 view 层，使得应用开发变得更具扩展性。因此如果你采用 layuiAdmin 的 SPA（单页应用）模式，请务必要抛弃服务端渲染视图的思想，让页面的控制权限重新回归到前端吧！</p><blockquote><p><strong>views</strong>目录存放的正是视图文件，你可以在该目录添加任意的新目录和新文件，通过对应的路由即可访问。</p></blockquote><p>注意：如果是单页面模式，视图文件通常是一段 HTML 碎片，而不能是一个完整的 html 代码结构。</p><h3 id="视图与路由的关系"><a href="#视图与路由的关系" class="headerlink" title="视图与路由的关系"></a><strong>视图与路由的关系</strong></h3><p>每一个视图文件，都对应一个路由。其中<code>index.html</code>是默认文件（你也可以通过 <code>config.js</code> 去重新定义）。视图文件的所在目录决定了路由的访问地址，如：</p><table><thead><tr><th>视图路径</th><th>对应的路由地址</th></tr></thead><tbody><tr><td>.&#x2F;views&#x2F;user&#x2F;index.html</td><td>&#x2F;user&#x2F;</td></tr><tr><td>.&#x2F;views&#x2F;user.html</td><td>&#x2F;user</td></tr><tr><td>.&#x2F;views&#x2F;user&#x2F;set&#x2F;index.html</td><td>&#x2F;user&#x2F;set&#x2F;</td></tr><tr><td>.&#x2F;views&#x2F;user&#x2F;set.html</td><td>&#x2F;user&#x2F;set</td></tr><tr><td>.&#x2F;views&#x2F;user&#x2F;set&#x2F;base.html</td><td>&#x2F;user&#x2F;set&#x2F;base</td></tr></tbody></table><p>通过上述的表格列举的对应关系，可以总结出：</p><ul><li>当视图文件是 index.html，那么路由地址就是它的上级目录（相对 views），以 <code>/</code> 结尾</li><li>当视图文件不是 index.html，那么路由地址就是它的上级目录+视图文件名，不以 <code>/</code> 结尾</li></ul><blockquote><p>值得注意的是：路由路径并非最多只能三级，它可以无限极。但对应的视图也必须存放在相应的层级目录下</p></blockquote><h3 id="视图中加载-JS-模块"><a href="#视图中加载-JS-模块" class="headerlink" title="视图中加载 JS 模块"></a><strong>视图中加载 JS 模块</strong></h3><p>在视图文件中，除了写 HTML，也可以写 JavaScript 代码。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=“<span class="variable constant_">LAY</span>-demo-hello”&gt;<span class="title class_">Hello</span> layuiAdmin&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">layui.<span class="title function_">use</span>(<span class="string">&#x27;admin&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> $ = layui.<span class="property">jquery</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  admin.<span class="title function_">popup</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">content</span>: $(<span class="string">&#x27;#LAY-demo-hello&#x27;</span>).<span class="title function_">html</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>如果该视图对应的 JS 代码量太大，我们更推荐你在 <code>controller</code>目录下新增一个业务模块，并在视图中直接 <code>layui.use</code> 去加载该模块。下面以控制台主页 <code>index.html</code>为例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;html区域&lt;div&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//加载 controller 目录下的对应模块</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">/*</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">  小贴士：</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">    这里 console 模块对应 的 console.js 并不会重复加载，</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">    然而该页面的视图可能会重新插入到容器，那如何保证脚本能重新控制视图呢？有两种方式：</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">      1): 借助 layui.factory 方法获取 console 模块的工厂（回调函数）给 layui.use</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">      2): 直接在 layui.use 方法的回调中书写业务代码，即:</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">          layui.use(&#x27;console&#x27;, function()&#123; </span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">            //同 console.js 中的 layui.define 回调中的代码 </span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">          &#125;);</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">          </span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">  这里我们采用的是方式1。其它很多视图中采用的其实都是方式2，因为更简单些，也减少了一个请求数。</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">  </span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">*/</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">layui.<span class="title function_">use</span>(<span class="string">&#x27;console&#x27;</span>, layui.<span class="title function_">factory</span>(<span class="string">&#x27;console&#x27;</span>));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>当视图被渲染后，layui.factory 返回的函数也会被执行，从而保证在不重复加载 JS 模块文件的前提下，保证脚本能重复执行。</p><hr><h1 id="动态模板"><a href="#动态模板" class="headerlink" title="动态模板"></a><strong>动态模板</strong></h1><p>layuiAdmin 的视图是一个“动静结合”的载体，除了常规的静态模板，你当然还可以在视图中存放动态模板，因此它可谓是焦点中的焦点。</p><h3 id="定义模板"><a href="#定义模板" class="headerlink" title="定义模板"></a><strong>定义模板</strong></h3><p>在视图文件中，通过下述规则定义模板：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template&gt;</span><br><span class="line">  &lt;!-- 动态模板碎片 --&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>下面是一个简单的例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template&gt;</span><br><span class="line">  当前 layuiAdmin 的版本是：&#123;&#123; layui.<span class="property">admin</span>.<span class="property">v</span> &#125;&#125;</span><br><span class="line">  路由地址：&#123;&#123; layui.<span class="title function_">router</span>().<span class="property">href</span> &#125;&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>在不对动态模板设定数据接口地址的情况下，它能读取到全局对象。但更多时候，一个动态模板应该是对应一个接口地址，如下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template lay-url=<span class="string">&quot;接口地址&quot;</span>&gt;</span><br><span class="line">    我叫：&#123;&#123; d.<span class="property">data</span>.<span class="property">username</span> &#125;&#125;</span><br><span class="line">    &#123;&#123;# <span class="keyword">if</span>(d.<span class="property">data</span>.<span class="property">sex</span> === <span class="string">&#x27;男&#x27;</span>)&#123; &#125;&#125;</span><br><span class="line">        公的</span><br><span class="line">    &#123;&#123;# &#125; <span class="keyword">else</span> &#123; &#125;&#125;</span><br><span class="line">        母的</span><br><span class="line">    &#123;&#123;# &#125; &#125;&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>模板中的 <code>d</code> 对应的是你接口返回的 json 转化后的一维对象，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">0</span></span><br><span class="line">  ,<span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;贤心&quot;</span></span><br><span class="line">    ,<span class="string">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么，上述动态模板最终输出的结果就是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我叫：贤心</span><br><span class="line">公的</span><br></pre></td></tr></table></figure><h3 id="模板基础属性"><a href="#模板基础属性" class="headerlink" title="模板基础属性"></a><strong>模板基础属性</strong></h3><p>动态模板支持以下基础属性</p><ul><li>lay-url<br>用于绑定模板的数据接口地址，支持动态模板解析，如：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template lay-url=<span class="string">&quot;https://api.xxx.com?id=&#123;&#123; layui.router().search.id &#125;&#125;&quot;</span>&gt;</span><br><span class="line">  &lt;!-- 动态模板碎片 --&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>lay-type<br>用于设定模板的接口请求类型（默认：get），如：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template lay-url=<span class="string">&quot;接口地址&quot;</span> lay-type=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">  &lt;!-- 动态模板碎片 --&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>lay-data<br>用于定义接口请求的参数，其值是一个 JavaScript object 对象，同样支持动态模板解析，如：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template lay-url=<span class="string">&quot;接口地址&quot;</span> lay-data=<span class="string">&quot;&#123;id: &#x27;&#123;&#123; layui.router().search.id &#125;&#125;&#x27;, type: 1&#125;&quot;</span>&gt;</span><br><span class="line">  &lt;!-- 动态模板碎片 --&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>lay-headers<br>用户定义接口请求的 Request Headers 参数，用法与 lay-data 的完全类似，支持动态模板解析。</li><li>lay-done<br>接口请求完毕并完成视图渲染的回调脚本，里面支持写任意的 JavaScript 语句。事实上它是一个封闭的函数作用域，通过给 Function 实例返回的函数传递一个参数 d，用于得到接口返回的数据：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template lay-url=<span class="string">&quot;接口地址&quot;</span> lay-done=<span class="string">&quot;console.log(d);&quot;</span>&gt;</span><br><span class="line">  &lt;!-- 动态模板碎片 --&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>很多时候，你在动态模板中可能会放入一些类似于 layui 的 form 元素，而有些控件需要执行 form.render() 才会显示，这时，你可以对 lay-done 赋值一个全局函数，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template lay-url=<span class="string">&quot;接口地址&quot;</span> lay-done=<span class="string">&quot;layui.data.done(d);&quot;</span>&gt;</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;layui-form&quot;</span> <span class="attr">lay-filter</span>=<span class="string">&quot;LAY-filter-demo-form&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">title</span>=<span class="string">&quot;复选框&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!--  注意：别看眼花了，下面可不是动态模板，而是 <span class="variable constant_">JS</span> 脚本区域 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">layui.<span class="property">data</span>.<span class="property">done</span> = <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  layui.<span class="title function_">use</span>([<span class="string">&#x27;form&#x27;</span>], <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> form = layui.<span class="property">form</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     form.<span class="title function_">render</span>(<span class="literal">null</span>, <span class="string">&#x27;LAY-filter-demo-form&#x27;</span>); <span class="comment">//渲染该模板下的动态表单</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>TIPS：</p><blockquote><p>如果模板渲染完毕需要处理过多的交互，我们强烈推荐你采用上述的方式定义一个全局函数赋值给 lay-done，会极大地减少维护成本。<br>无需担心该全局函数的冲突问题，该函数是一次性的。其它页面即便声明了一个同样的函数，也只是用于新的视图，丝毫不会对之前的视图造成任何影响。<br>layui.data.done 中的 done 可以随意命名，但需与 lay-done 的赋值对应上。</p></blockquote><p>模板语法</p><blockquote><p>动态模板基于 layui 的 laytpl 模块，详细语法可见：<br><a href="http://www.layui.com/doc/modules/laytpl.html#syntax">http://www.layui.com/doc/modules/laytpl.html#syntax</a></p></blockquote><hr><h1 id="登录与接口鉴权"><a href="#登录与接口鉴权" class="headerlink" title="登录与接口鉴权"></a><strong>登录与接口鉴权</strong></h1><p>由于 layuiAdmin 接管了视图层，所以不必避免可能会与服务端分开部署，这时你有必要了解一下 layuiAdmin 默认提供的：从 登录 到 接口鉴权，再到 注销 的整个流程。</p><h3 id="登录拦截器"><a href="#登录拦截器" class="headerlink" title="登录拦截器"></a><strong>登录拦截器</strong></h3><p>进入登入页面登入成功后，会在 localStorage 的本地表中写入一个字段。如： access_token （名称可以在 config.js 自定义）。拦截器判断没有 access_token 时，则会跳转到登入页。尽管可以通过伪造一个假的 access_token 绕过视图层的拦截，但在请求接口时，会自动带上 access_token，服务端应再次做一层校验。</p><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a><strong>流程</strong></h3><ol><li>打开 <code>config.js</code> ，将 <code>interceptor</code>参数设置为 <code>true</code>（该参数为 1.0.0-beta6 开始新增）。那么，当其未检查到 <code>access_token</code>值时，会强制跳转到登录页面，以获取 access_token。</li><li>打开登录对应的视图文件 <code>views/user/login.html</code>，在代码最下面，你将看到一段已经写好的代码，你需要的是将接口地址改为服务端的真实接口，并返回 <code>access_token</code>值。</li><li>layuiAdmin 会将服务端返回的 <code>access_token</code>值进行本地存储，这时你会发现 layuiAdmin 不再强制跳转到登录页面。并在后面每次请求服务端接口时，都会自动在参数和 <code>Request Headers</code> 中带上 <code>access_token</code>，以便服务端进行鉴权。</li><li>若鉴权成功，顺利返回数据；若鉴权失败，服务端的 <code>code</code>应返回 <code>1001</code>（可在 config.js 自定义） ， layuiAdmin 将会自动清空本地无效 token 并跳转到登入页。</li><li>退出登录：重新打开 <code>controller/common.js</code>，搜索 <code>logout</code>，配上注销接口即可。</li><li></li></ol><blockquote><p>如果是在其它场景请求的接口，如：<code>table.render()</code>，那么你需要获取本地存储的 token 赋值给接口参数，如下：</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置全局 table 实例的 token（这样一来，所有 table 实例均会有效）</span></span><br><span class="line">table.<span class="title function_">set</span>(&#123;</span><br><span class="line">  <span class="attr">headers</span>: &#123; <span class="comment">//通过 request 头传递</span></span><br><span class="line">    <span class="attr">access_token</span>: layui.<span class="title function_">data</span>(<span class="string">&#x27;layuiAdmin&#x27;</span>).<span class="property">access_token</span></span><br><span class="line">  &#125;</span><br><span class="line">  ,<span class="attr">where</span>: &#123; <span class="comment">//通过参数传递</span></span><br><span class="line">    <span class="attr">access_token</span>: layui.<span class="title function_">data</span>(<span class="string">&#x27;layuiAdmin&#x27;</span>).<span class="property">access_token</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">//设置单个 table 实例的 token</span></span><br><span class="line">table.<span class="title function_">render</span>(&#123;</span><br><span class="line">  <span class="attr">elem</span>: <span class="string">&#x27;#xxxx&#x27;</span></span><br><span class="line">  ,<span class="attr">url</span>: <span class="string">&#x27;url&#x27;</span></span><br><span class="line">  ,<span class="attr">where</span>: &#123;</span><br><span class="line">    <span class="attr">access_token</span>: layui.<span class="title function_">data</span>(<span class="string">&#x27;layuiAdmin&#x27;</span>).<span class="property">access_token</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//,headers: &#123;&#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>事实上，layuiAdmin 的所有 Ajax 请求都是采用 <code>admin.req(options)</code>，它会自动传递 <code>access_token</code>，因此推荐你在 JS 执行 Ajax 请求时直接使用它。其中参数 *options *和 <code>$.ajax(options)</code> 的参数完全一样。</p><h3 id="接口鉴权"><a href="#接口鉴权" class="headerlink" title="接口鉴权"></a><strong>接口鉴权</strong></h3><p>我们推荐服务端遵循 <strong>JWT</strong>（JSON Web Token） 标准进行鉴权。对 JWT 不甚了解的同学，可以去搜索一些相关资料，会极大地增加应用的可扩展性。当然，你也可以直接采用传统的 cookie &#x2F; session 机制。</p><hr><h1 id="基础方法"><a href="#基础方法" class="headerlink" title="基础方法"></a><strong>基础方法</strong></h1><ul><li><strong>config 模块</strong></li></ul><blockquote><p>你可以在任何地方通过 layui.setter 得到 config.js 中的配置信息</p></blockquote><ul><li><strong>admin 模块</strong></li></ul><blockquote><p>var admin &#x3D; layui.admin;</p></blockquote><ul><li><strong>admin.req(options)</strong><br>Ajax 请求，用法同 $.ajax(options)，只是该方法会进行错误处理和 token 的自动传递</li><li>admin.screen()<br>获取屏幕类型，根据当前屏幕大小，返回 0 - 3 的值<br>0: 低于768px的屏幕<br>1：768px到992px之间的屏幕<br>2：992px到1200px之间的屏幕<br>3：高于1200px的屏幕</li><li><strong>admin.exit()</strong><br>清除本地 token，并跳转到登入页</li><li><strong>admin.sideFlexible(status)</strong><br>侧边伸缩。status 为 null：收缩；status为 “spread”：展开</li><li><strong>admin.on(eventName, callback)</strong><br>事件监听，下文会有讲解</li><li><strong>admin.popup(options)</strong><br>弹出一个 layuiAdmin 主题风格的 layer 层，参数 options 跟 layer.open(options) 完全相同</li><li><strong>admin.popupRight(options)</strong><br>在屏幕右侧呼出一个面板层。options 同上。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">admin.<span class="title function_">popupRight</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;LAY-popup-right-new1&#x27;</span> <span class="comment">//定义唯一ID，防止重复弹出</span></span><br><span class="line">  ,<span class="attr">success</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//将 views 目录下的某视图文件内容渲染给该面板</span></span><br><span class="line">    layui.<span class="title function_">view</span>(<span class="variable language_">this</span>.<span class="property">id</span>).<span class="title function_">render</span>(<span class="string">&#x27;视图文件所在路径&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>admin.resize(callback)</strong><br>窗口 resize 事件处理，我们推荐你使用该方法取代 jQuery 的 resize 事件，以避免多页面标签下可能存在的冲突。</li><li><strong>admin.fullScreen()</strong><br>全屏</li><li><strong>admin.exitScreen()</strong><br>退出全屏</li><li><strong>admin.events</strong><ul><li><strong>admin.events.refresh()</strong><br>刷新当前右侧区域</li><li><strong>admin.events.closeThisTabs()</strong><br>关闭当前标签页</li><li><strong>admin.events.closeOtherTabs()</strong><br>关闭其它标签页</li><li><strong>admin.events.closeAllTabs()</strong><br>关闭全部标签页</li></ul></li><li><strong>view 模块</strong></li></ul><blockquote><p>var view &#x3D; layui.view;</p></blockquote><ul><li><strong>view(id)</strong><br>获取指定容器，并返回一些视图渲染的方法，如：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//渲染视图，viewPath 即为视图路径</span></span><br><span class="line"><span class="title function_">view</span>(<span class="string">&#x27;id&#x27;</span>).<span class="title function_">render</span>(viewPath).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//视图文件请求完毕，视图内容渲染前的回调</span></span><br><span class="line">&#125;).<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="comment">//视图文件请求完毕和内容渲染完毕的回调</span></span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">//直接向容器插入 html，tpl 为 模板字符；data 是传入的数据。该方法会自动完成动态模板解析</span></span><br><span class="line"><span class="title function_">view</span>(<span class="string">&#x27;id&#x27;</span>).<span class="title function_">send</span>(tpl, data); </span><br></pre></td></tr></table></figure><p>另外，<code>render</code>方法支持动态传参，以用于视图内容接受。如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">admin.<span class="title function_">popup</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;LAY-popup-test1&#x27;</span></span><br><span class="line">  ,<span class="attr">success</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">view</span>(<span class="variable language_">this</span>.<span class="property">id</span>).<span class="title function_">render</span>(<span class="string">&#x27;视图文件所在路径&#x27;</span>, &#123;</span><br><span class="line">       <span class="attr">id</span>: <span class="number">123</span> <span class="comment">//这里的 id 值你可以在一些事件中动态获取（如 table 模块的编辑）</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--那么，在视图文件中，你可以在动态模板中通过 &#123;&#123; [d.params.xxx](http://d.params.xxx/) &#125;&#125; 得到传入的参数，如：--&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template lay-url=<span class="string">&quot;http://api.com?id=&#123;&#123; d.params.id &#125;&#125;&quot;</span>&gt;</span><br><span class="line">  配置了接口的动态模板，且接口动态获取了 render 传入的参数：&#123;&#123; d.<span class="property">params</span>.<span class="property">id</span> &#125;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/html&quot;</span> <span class="attr">template</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  也可以直接获取：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123; <span class="name">d.params.id</span> &#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>而如果是在 JS 语句中去获取模板传递过来的变量，可以借助动态模板的 lay-done 属性去实现，如:</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/html&quot;</span> template lay-done=<span class="string">&quot;layui.data.sendParams(d.params)&quot;</span>&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>然后在 JS 语句中通过执行动态模板 lay-done 中对应的方法得到对应的参数值：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">//定义一个 lay-done 对应的全局方法，以供动态模板执行</span></span><br><span class="line">layui.<span class="property">data</span>.<span class="property">sendParams</span> = <span class="keyword">function</span>(<span class="params">params</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">id</span>) <span class="comment">//得到传递过来的 id 参数（或其他参数）值</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//通过得到的参数值，做一些你想做的事</span></span><br><span class="line">  <span class="comment">//…</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//若需用到 layui 组件，layui.use 需写在该全局方法里面，如：</span></span><br><span class="line">  layui.<span class="title function_">use</span>([<span class="string">&#x27;table&#x27;</span>], <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> table = layui.<span class="property">table</span>;</span><br><span class="line">    table.<span class="title function_">render</span>(&#123;</span><br><span class="line">      <span class="attr">elem</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">      ,<span class="attr">url</span>: <span class="string">&#x27;url?id=&#x27;</span>+ params.<span class="property">id</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>注意：上述实现需保证 layuiAdmin 为 1.2.0+&#96;</p></blockquote><p>总之，驾驭好<code>view().render().done(callback)</code> 对您的项目开发至关重要。</p><hr><h1 id="ID唯一性"><a href="#ID唯一性" class="headerlink" title="ID唯一性"></a><strong>ID唯一性</strong></h1><p>如果你开启了标签页功能，请务必注意 ID 的冲突，尤其是在你自己绑定事件的情况。ID 的命令可以遵循以下规则来规避冲突：</p><blockquote><p>LAY-路由-任意名</p></blockquote><p>以消息中心页面为例，假设它的路由为：<code>/app/message/</code>，那么 ID 应该命名为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button class=&quot;layui-btn&quot; id=&quot;LAY-app-message-del&quot;&gt;删除&lt;/button&gt;</span><br></pre></td></tr></table></figure><hr><h1 id="实用组件"><a href="#实用组件" class="headerlink" title="实用组件"></a><strong>实用组件</strong></h1><h3 id="Hover-提示层"><a href="#Hover-提示层" class="headerlink" title="Hover 提示层"></a><strong>Hover 提示层</strong></h3><p>通过对元素设置 lay-tips&#x3D;”提示内容” 来开启一个 hover 提示，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;i <span class="keyword">class</span>=<span class="string">&quot;layui-icon layui-icon-tips&quot;</span> lay-tips=<span class="string">&quot;要支持的噢&quot;</span> lay-offset=<span class="string">&quot;5&quot;</span>&gt;&lt;/i&gt;</span><br></pre></td></tr></table></figure><p>其中<code>lay-offset</code>用于定于水平偏移距离（单位px），以调整箭头让其对准元素</p><hr><h1 id="事件监听"><a href="#事件监听" class="headerlink" title="事件监听"></a><strong>事件监听</strong></h1><ul><li><strong>hash</strong><br>监听路由地址改变</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下述中的 xxx 可随意定义，不可与已经定义的 hash 事件同名，否则会覆盖上一事件</span></span><br><span class="line">admin.<span class="title function_">on</span>(<span class="string">&#x27;hash(xxx)&#x27;</span>, <span class="keyword">function</span>(<span class="params">router</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(router); <span class="comment">//得到路由信息</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><strong>side</strong><br>监听侧边伸缩</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下述中的 xxx 可随意定义，不可与已经定义的 side 事件同名，否则会覆盖上一事件</span></span><br><span class="line">admin.<span class="title function_">on</span>(<span class="string">&#x27;side(xxx)&#x27;</span>, <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">status</span>); <span class="comment">//得到伸缩状态：spread 为展开状态，其它值为收缩状态</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h1 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a><strong>兼容性</strong></h1><p>layuiAdmin 使用到了 layui 的栅格系统，而栅格则是基于浏览器的媒体查询。ie8、9不支持。<br>所以要在宿主页面（如 start&#x2F;index.html ）加上下面这段保证兼容：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 让<span class="title class_">IE8</span>/<span class="number">9</span>支持媒体查询，从而兼容栅格 --&gt;</span><br><span class="line">&lt;!--[<span class="keyword">if</span> lt <span class="variable constant_">IE</span> <span class="number">9</span>]&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/html5shiv/r29/html5.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;![endif]--&gt;  </span><br></pre></td></tr></table></figure><hr><h1 id="缓存问题"><a href="#缓存问题" class="headerlink" title="缓存问题"></a><strong>缓存问题</strong></h1><p>由于单页面版本的视图文件和静态资源模块都是动态加载的，所以可能存在浏览器的本地缓存问题，事实上我们也考虑到这个，因此，为了避免改动后的文件未及时生效，你只需在入口页面（默认为<code>start/index.html</code>）中，找到 <code>layui.config</code> ，修改其 <code>version</code>的值即可。</p><p>我们推荐你分场景来更新缓存：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 场景一：如果项目是在本地开发。你可以设置 version 为动态毫秒数，如：</span><br><span class="line"><span class="attr">version</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() <span class="comment">//这样你每次刷新页面，都会更新一次缓存</span></span><br><span class="line">* 场景二：如果项目是在线上运行。建议你手工更新 version，如：</span><br><span class="line"><span class="attr">version</span>: <span class="string">&#x27;1.0.0&#x27;</span> <span class="comment">//每次发布项目时，跟着改动下该属性值即可更新静态资源的缓存</span></span><br></pre></td></tr></table></figure><hr><h1 id="升级事项"><a href="#升级事项" class="headerlink" title="升级事项"></a><strong>升级事项</strong></h1><p>从官网更新资源包后，除了 src 和 dist 目录需要注意一下，其它目录和文件均可覆盖，下面以 src 为例（dist 由于是 src 构建后生成的目录，所以本质是和 src 一样的）<br><strong>src 目录下可以直接覆盖的有：</strong></p><blockquote><ul><li>src&#x2F;lib&#x2F;</li><li>src&#x2F;style&#x2F;</li><li>src&#x2F;index.js</li></ul></blockquote><p><strong>需要灵活调配的有：</strong></p><blockquote><ul><li>src&#x2F;controller&#x2F;</li><li>src&#x2F;views&#x2F;</li><li>src&#x2F;config.js</li></ul></blockquote><p>如果没有改动默认配置，事实上 config.js 也可以覆盖升级<br>开发过程中，建议同时运行两个 layuiAdmin 。一个是已经实际运用的，一个是 layuiAdmin 本身的 Demo。以便从 Demo 中获取参考和提取示例。</p><hr><h1 id="源码构建"><a href="#源码构建" class="headerlink" title="源码构建"></a><strong>源码构建</strong></h1><blockquote><p>当你在 src 目录完成开发后，你可通过 gulp 对 src 源码进行自动化构建，以生成用于线上环境的 dist 目录。并在入口页面中的 layui.config 的 base 参数指向 dist。</p></blockquote><p>在资源包中根目录下看到的 gulpfile.js 是 layuiAdmin 写好的任务脚本，package.json 是任务配置文件，你只需按照以下步骤：</p><ol><li>step1：确保你的电脑已经安装好了 Node.js，如果未安装，可去官网下载安装</li><li>step2: 命令行安装 gulp：npm install gulp -g</li><li>step3：切换到 layuiAdmin 项目根目录（即 gulpfile.js 所在目录），命令行安装任务所依赖的包：npm install</li></ol><p><strong>安装完成后，后续只需直接执行命令：gulp 即可完成 src 到 dist 目录的构建</strong></p><p><a href="https://fengfeng.lanzoux.com/iYTvgkmgf5i">下载LayuiAdmin</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/niuben/p/11038846.html&quot;&gt;layuiAdmin std v1.x 【iframe版】开发者文档&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;题外&quot;&gt;&lt;a href=&quot;#题外&quot; class=&quot;headerlink&quot; title=&quot;题外&quot;&gt;&lt;/a&gt;&lt;strong&gt;题外&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;该文档适用于 layuiAdmin 专业版（单页面），阅读之前请务必确认是否与你使用的版本对应。&lt;/li&gt;
&lt;li&gt;熟练掌握 layuiAdmin 的前提是熟练掌握 layui，因此除了本篇文档， layui 的文档 也是必不可少的存在。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.kancloud.cn/dawn-only/layui&quot;&gt;看云上的文档&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;layuiAdmin.std（iframe 版） 是完全基于 layui 架构而成的通用型后台管理模板系统，采用传统的 iframe 多页面开发模式，可更快速直接地开发网页后台应用程序，无需过多地学习成本，简单高效，撸起袖子直接干。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="学习" scheme="http://peaky2022.gitee.io/peaky/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="编程" scheme="http://peaky2022.gitee.io/peaky/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>如何检索文献</title>
    <link href="http://peaky2022.gitee.io/peaky/2021/01/20/23128346.html"/>
    <id>http://peaky2022.gitee.io/peaky/2021/01/20/23128346.html</id>
    <published>2021-01-20T08:17:12.000Z</published>
    <updated>2022-03-03T15:01:47.682Z</updated>
    
    <content type="html"><![CDATA[<h4 id="如何检索文献"><a href="#如何检索文献" class="headerlink" title="如何检索文献"></a><strong>如何检索文献</strong></h4><p>1.<strong>SCI-hub</strong></p><p><a href="https://www.sci-hub.ren/">点此进入</a></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120150538642.png" alt="image-20210120150538642"></p><span id="more"></span><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120150836403.png" alt="image-20210120150836403"></p><p>2、<strong>Web of Science</strong></p><p><a href="https://wvpn.upc.edu.cn/http/77726476706e69737468656265737421f1e7518f69276d52710e82a297422f30a0c6fa320a29ae/UA_GeneralSearch_input.do?product=UA&search_mode=GeneralSearch&SID=6CMGhnJBf81CB7CzxgE&preferencesSaved=">点此进入</a>需要校内IP或者挂VPN</p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120154756525.png" alt="image-20210120154756525"></p><p>3、<strong>PubMed</strong></p><p><a href="https://wvpn.upc.edu.cn/https/77726476706e69737468656265737421e0e243912234265e7d0a80e296592e7bb7d62ae2c192eb/27597849/">点此进入</a></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120155023837.png" alt="image-20210120155023837"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120155133949.png" alt="image-20210120155133949"></p><p>4、谷歌学术</p><p><a href="https://g.luciaz.me/">谷歌搜索国内镜像</a>密码是心灵之约，浙大的镜像</p><p><a href="https://ac.scmor.com/">谷歌学术镜像导航</a>南京理工大学哪个教学楼能通宵？一工</p><p><a href="https://ac.scmor.com/"><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120160211898.png" alt="image-20210120160211898"></a></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120155856248.png" alt="image-20210120155856248"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120155926365.png" alt="image-20210120155926365"></p><p><img src="https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120160120661.png" alt="image-20210120160120661"></p>]]></content>
    
    
    <summary type="html">&lt;h4 id=&quot;如何检索文献&quot;&gt;&lt;a href=&quot;#如何检索文献&quot; class=&quot;headerlink&quot; title=&quot;如何检索文献&quot;&gt;&lt;/a&gt;&lt;strong&gt;如何检索文献&lt;/strong&gt;&lt;/h4&gt;&lt;p&gt;1.&lt;strong&gt;SCI-hub&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.sci-hub.ren/&quot;&gt;点此进入&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic-20201016.oss-cn-qingdao.aliyuncs.com/img/image-20210120150538642.png&quot; alt=&quot;image-20210120150538642&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="http://peaky2022.gitee.io/peaky/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="http://peaky2022.gitee.io/peaky/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
</feed>
